<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Restore Data | Couchbase Docs</title>
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="The Backup Service REST API supports the restoration of data from an active, imported, or archived repository into either the host cluster or into another cluster running the Backup Service.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/rest-api/backup-restore-data.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/rest-api/pages/backup-restore-data.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Reference</li>
<li class="crumb"><a href="rest-intro.html">REST API Reference</a></li>
<li class="crumb"><a href="backup-rest-api.html">Backup Service API</a></li>
<li class="crumb"><a href="backup-restore-data.html">Restore Data</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Restore Data</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
The Backup Service REST API supports the restoration of data from an active, imported, or archived repository into either the host cluster or into another cluster running the Backup Service.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-methods-and-uris"><a class="anchor" href="#http-methods-and-uris"></a>HTTP Methods and URIs</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>POST /cluster/self/repository/&lt; "active" | "imported" | "archived" &gt;/&lt;repository-id&gt;/restore</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="description"><a class="anchor" href="#description"></a>Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Documents from a specified repository are restored from that repository to the cluster.
The repository can be active, imported, or archived.
Details of the restoration must be specified as a JSON payload.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="curl-syntax"><a class="anchor" href="#curl-syntax"></a>Curl Syntax</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>curl -X POST http://&lt;backup-node-ip-address-or-domain-name&gt;:8097/cluster/self/\
repository/&lt; "active" | "imported" | "archived" &gt;/\
&lt;repository-id&gt;/restore
  -u &lt;username&gt;:&lt;password&gt;
  -d &lt;restore-specification&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>username</code> and <code>password</code> must identify an administrator with the Full Admin role.
The <code>repository-id</code> must be the name of an active, imported, or archived repository, according to the statement&#8217;s preceding path-parameter.</p>
</div>
<div class="paragraph">
<p>The <code>restore-specification</code> must be a JSON document containing the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>target</em>, which is the IP address or qualified domain-name of the cluster onto which the data is to be restored.
Note that this need not be the host cluster, and need not be a cluster running the Backup Service.
Port <code>8091</code> should be specified.</p>
</li>
<li>
<p>The username and password of an administrator for the target cluster who has the Full Admin role.</p>
</li>
<li>
<p>Optionally, whether data that resides in one bucket (on the repository) is to be restored onto another (on the cluster).
The default is for data to be restored to the same bucket.</p>
</li>
<li>
<p>Optionally, whether the intended destination bucket for the restore should be automatically created.
The default value is <code>false</code>.</p>
</li>
<li>
<p>Optionally, whether empty collections should be removed from the restore.
The default value is <code>false</code>.</p>
</li>
<li>
<p>Optionally, whether data for each specific service should be included or omitted from the restore.
The default value is to include all.</p>
</li>
<li>
<p>Optionally, the first and last backups within the repository that are to be included in the restore, along with all backups that occurred in between them.
The default is to include all backups.</p>
</li>
<li>
<p>Optionally, regular expressions to filter documents' keys and values, to constrain the documents that are included in the restore.
The default is to apply no constraints.</p>
</li>
<li>
<p>Optionally, whether the bucket configuration from the repository should be restored to the bucket currently on the cluster.
The default is not to restore the old configuration.</p>
</li>
<li>
<p>Optionally, whether earlier versions of documents (on the repository) should be permitted to overwrite later versions (on the cluster).
The default is <em>not</em> to permit this.</p>
</li>
<li>
<p>Optionally, an updated timestamp for the keys.
This should only be specified when a new expiration value is established for the documents to be restored; and <em>must</em> be set when <code>all</code> documents are granted a new expiration.
The timestamp value can be specified either as a time in RFC3339 format, or <code>0</code>: <code>0</code> means there is no expiration applied.</p>
</li>
<li>
<p>Optionally, a new expiration (<em>time-to-live</em>) value for the documents being restored.
This parameter can either be set to <code>none</code>, <code>all</code> or <code>expired</code>; and should be only used when the timestamp for the documents is also updated.
If <code>none</code> is specified, TTL values are not changed: this is the default.
If <code>all</code> is specified, TTL values for all documents are replaced with the value of the new timestamp.
If <code>expired</code> is specified, TTL values are changed only for documents that have already expired.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Syntactically, the <code>restore-specification</code> is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "target": &lt;ip-address-or-domain-name&gt;":8091",
  "user": &lt;username&gt;,
  "password": &lt;password&gt;",
  "auto_create_buckets": &lt; true | false &gt;,
  "auto_remove_collections": &lt; true | false &gt;,
  "disable_analytics": &lt; true | false &gt;,
  "disable_data": &lt; true | false &gt;,
  "disable_eventing": &lt; true | false &gt;,
  "disable_ft": &lt; true | false &gt;,
  "disable_gsi_indexes": &lt; true | false &gt;,
  "disable_views": &lt; true | false &gt;,
  "end": &lt;earliest-backup-to-include&gt;,
  "filter_keys": &lt;regular-expression&gt;,
  "filter_values": &lt;regular-expression&gt;,
  "force_updates": &lt; true | false &gt;,
  "map_data": &lt; old-bucket"="new-bucket &gt;,
  "start": &lt;latest-backup-to-include&gt;,
  "enable_bucket_config": &lt; true | false &gt;,
  "replace_ttl": &lt; "all" | "none" | "expired" &gt;,
  "replace_ttl_with": &lt; RFC3339-time-value | "0" &gt;
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="responses"><a class="anchor" href="#responses"></a>Responses</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Successful execution returns <code>200 OK</code>, and a task-id for the restore.</p>
</div>
<div class="paragraph">
<p>If the specified repository cannot be located, <code>404 Object Not Found</code> is returned, with an object such as the following: <code>{"status":404,"msg":"repository res4tRepo does not exist"}</code>.</p>
</div>
<div class="paragraph">
<p>If the call is improperly formatted, <code>400 Bad Request</code> is returned; with an object such as the following: <code>{"status":400,"msg":"invalid request body","extras":"invalid character '{' looking for beginning of object key string"}</code>.</p>
</div>
<div class="paragraph">
<p>If an internal error prevents successful execution, <code>500 Internal Server Error</code> is returned; with a message containing additional information on the error.</p>
</div>
<div class="paragraph">
<p>Failure to authenticate returns <code>401 Unauthorized</code>.
An incorrectly specified URI returns <code>404 Object Not Found</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example"><a class="anchor" href="#example"></a>Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following example restores to the host cluster data from the Data Service currently contained in the active repository <code>restRepo</code>.
The expression specifies start and end backups, and imposes filters on document keys and values.
It also restores the data to a new bucket (<code>ts7</code>), to be automatically created by the Backup Service as part of the restore procedure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -v -X POST http://127.0.0.1:8097/api/v1/api/v1/cluster/self/\
repository/active/restRepo/restore \
-u Administrator:password \
-d '{"target":"http://127.0.0.1:8091","user":"Administrator","password":"password",
"auto_create_buckets":true,"auto_remove_collections":true,"disable_analytics":true,"disable_data":false,"disable_eventing":true,"disable_ft":true,"disable_gsi_indexes":true,"disable_views":true,"end":"2020-09-29T11_28_16.197951+01_00","filter_keys":"^airline","filter_values":"MIL*","force_updates":true,"map_data":"travel-sample=ts7","start":"2020-09-29T11_08_15.666658+01_00"}'</pre>
</div>
</div>
<div class="paragraph">
<p>If successful, the call returns a task-id, such as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"task_name":"restore-f97ce4b9-ac43-4726-bc1f-b5c92b19ce00"}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="see-also"><a class="anchor" href="#see-also"></a>See Also</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An overview of the Backup Service is provided in <a href="../learn/services-and-indexes/services/backup-service.html" class="xref page">Backup Service</a>.
A step-by-step guide to using Couchbase Web Console to configure and use the Backup Service is provided in <a href="../manage/manage-backup-and-restore/manage-backup-and-restore.html" class="xref page">Manage Backup and Restore</a>.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
