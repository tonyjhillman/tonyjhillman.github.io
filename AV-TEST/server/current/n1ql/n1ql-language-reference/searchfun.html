<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Search Functions | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Search functions enable you to use full text search (FTS) queries directly within a SQL++ query.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/n1ql/n1ql-language-reference/searchfun.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/pages/n1ql-language-reference/searchfun.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb"><a href="../query.html">Query</a></li>
<li class="crumb"><a href="index.html">SQL++ Language Reference</a></li>
<li class="crumb"><a href="functions.html">Functions</a></li>
<li class="crumb"><a href="searchfun.html">Search Functions</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Search Functions</h1>
<div class="labels">
<ul><li class="reference"><span><i class="fas fa-book"></i></i> reference</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Search functions enable you to use full text search (<a href="../../fts/fts-introduction.html" class="xref page">FTS</a>) queries directly within a SQL++ query.</p>
</div>
<h3 id="prerequisites" class="float">Prerequisites</h3>
<div class="paragraph">
<p>To use any of the search functions, the Search service must be available on the cluster.
It is also recommended, but not required, that you should create suitable full text indexes for the searches that you need to perform.
For more information, refer to <a href="../../fts/fts-quickstart-guide.html#preparing-for-full-text-searches" class="xref page">Preparing for Full Text Searches</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The examples in this page all assume that demonstration full text indexes have been created, as described in <a href="#fts:fts-demonstration-indexes.adoc" class="xref unresolved">Demonstration Indexes</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<h3 id="authorization" class="float">Authorization</h3>
<div class="paragraph">
<p>You do not need credentials for the FTS service to be able to use the search functions in a query.
The role <strong>Data Admin</strong> must be assigned to those who intend to create indexes; and the role <strong>Data Reader</strong> to those who intend to perform searches.
For information on creating users and assigning roles, see <a href="../../learn/security/authorization-overview.html" class="xref page">Authorization</a>.</p>
</div>
<h3 id="when-to-use-search-functions" class="float">When to Use Search Functions</h3>
<div class="paragraph">
<p>The search functions are useful when you need to combine a full text search with the power of a SQL++ query; for example, combining joins and natural-language search in the same query.</p>
</div>
<div class="paragraph">
<p>If you only need to use the capabilities of a full text search without any SQL++ features, consider making use of the Search service directly, through the user interface, the REST API, or an SDK.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="search"><a class="anchor" href="#search"></a>SEARCH(<code>identifier</code>, <code>query</code>[, <code>options</code>])</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description"><a class="anchor" href="#description"></a>Description</h3>
<div class="paragraph">
<p>This function enables you to use a full text search to filter a result set, or as a join predicate.
It is only allowed in the <a href="where.html" class="xref page">WHERE</a> clause or the <a href="join.html" class="xref page">ON</a> clause.</p>
</div>
<div class="paragraph">
<p>If a query contains a SEARCH function, the Query engine analyzes the entire query, including the search specification, to select the best index to use with this search, taking any index hints into account.
The Query engine then passes the search specification over to the Search engine to perform the search.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If no suitable full text index can be selected, or no full text index exists, the Query engine falls back on a Primary index or qualified GSI index to produce document keys, and then fetches the documents.
The Search service then creates a temporary index in memory to perform the search.
This process may be slower than using a suitable full text index.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">identifier</dt>
<dd>
<p>[Required] An expression in the form <code><em>keyspaceAlias</em>[.<em>path</em>]</code>, consisting of the keyspace or keyspace alias in which to search, followed by the path to a field in which to search, using dot notation.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The identifier must contain the keyspace or keyspace alias if there is more than one input source in the FROM clause.
If there is only one input source in the FROM clause, and the identifier contains a path, the keyspace or keyspace alias may be omitted.
However, if the path is omitted, the keyspace or keyspace alias is mandatory.</p>
</li>
<li>
<p>When the identifier contains a path, it is used as the default field in the <em>query</em> argument, as long as the <em>query</em> argument is a query string.
If the path is omitted, the default field is set to <code>_all</code>.
If the <em>query</em> argument is a query string which specifies a field, this field takes priority, and the path in the identifier is ignored.
Similarly, if the <em>query</em> argument is a query object, the path is ignored.</p>
</li>
<li>
<p>The path must use Search syntax rather than SQL++ syntax; in other words, you cannot specify array locations such as <code>[*]</code> or <code>[3]</code> in the path.</p>
</li>
<li>
<p>If the keyspace, keyspace alias, or path contains any characters such as <code>-</code>, you must surround that part of the identifier with backticks <code>``</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>identifier</em> argument cannot be replaced by a SQL++ query parameter.</p>
</div>
</dd>
<dt class="hdlist1">query</dt>
<dd>
<p>[Required] The full text search query.
This may be one of the following:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A query string.
For more details, refer to <a href="#fts:fts-query-types.adoc#query-string-query-syntax" class="xref unresolved">Query String Query</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>object</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The query object within a full text search request.
For more details, refer to <a href="#fts-supported-queries.adoc" class="xref unresolved">Supported Queries</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>object</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A complete full text search request, including sort and pagination options, and so on.
For more details, refer to <a href="../../fts/fts-sorting.html" class="xref page">Sorting Query Results</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When specifying a complete full text search request with the SQL++ SEARCH() function, if the value of the <code>size</code> parameter is greater than the <a href="#fts:fts-response-object-schema.adoc#request" class="xref unresolved">maximum number of full text search results</a>, the query ignores the <code>size</code> parameter and returns all matching results.</p>
</div>
<div class="paragraph">
<p>This is different to the behavior of a complete full text search request in the Search service, where the query returns an error if the value of the <code>size</code> parameter is greater than the maximum number of full text search results.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <em>query</em> argument may be replaced by a SQL++ query parameter, as long as the query parameter resolves to a string or an object.</p>
</div>
</dd>
<dt class="hdlist1">options</dt>
<dd>
<p>[Optional] A JSON object containing options for the search.
The object may contain the following fields:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>index</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string, object</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>index</code> field may be a string, containing the name of a full text index in the keyspace.
(This may be a full text index alias, but only if the full text index is in the same keyspace.)
This provides an index hint to the Query engine.
If the full text index does not exist, an error occurs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also provide an index hint to the Query engine with the <a href="hints.html#use-index-clause" class="xref page">USE INDEX clause</a>.
This takes precedence over a hint provided by the <code>index</code> field.</p>
</div>
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>The <code>index</code> field may also be an object, containing an example of a full text index mapping.
This is treated as an input to the index mapping.
It overrides the default mapping and is used during index selection and filtering.</p>
</div>
<div class="paragraph">
<p>The object must either have a default mapping with no type mapping, or a single type mapping with the default mapping disabled.
For more information, refer to <a href="../../fts/fts-creating-indexes.html" class="xref page">Creating Indexes</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>indexUUID</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A string, containing the UUID of a full text index in the keyspace.
This provides an index hint to the Query engine.
If the full text index cannot be identified, an error occurs.</p>
</div>
<div class="paragraph">
<p>You can use the <code>indexUUID</code> field alongside the <code>index</code> field to help identify a full text index.
The <code>indexUUID</code> field and the <code>index</code> field must both identify the same full text index.
If they identify different full text indexes, or if either of them does not identify a full text index, an error occurs.</p>
</div>
<div class="paragraph">
<p>You can find the UUID of a full text index by viewing the index definition.
You can do this using the <a href="../../fts/fts-creating-indexes.html#using-the-index-definition-preview" class="xref page">Index Definition Preview</a> in the Query Workbench, or the <a href="../../rest-api/rest-fts-indexing.html" class="xref page">Index Definition</a> endpoints provided by the Full Text Search REST API.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>out</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A name given to this full text search operation in this keyspace.
You can use this name to refer to this operation using the <a href="#search_meta">SEARCH_META()</a> and <a href="#search_score">SEARCH_SCORE()</a> functions.
If this field is omitted, the name of this full text search operation defaults to <code>"out"</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>(other)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>(any)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Other fields are ignored by the Query engine and are passed on to the Search engine as options.
The values of these options may be replaced with SQL++ query parameters, such as <code>"analyzer": $analyzer</code>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <em>options</em> argument cannot be replaced by a SQL++ query parameter, but it may contain SQL++ query parameters.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="return-value"><a class="anchor" href="#return-value"></a>Return Value</h3>
<div class="paragraph">
<p>A boolean, representing whether the search query is found within the input path.</p>
</div>
<div class="paragraph">
<p>This returns <code>true</code> if the search query is found within the input path, or <code>false</code> otherwise.</p>
</div>
</div>
<div class="sect2">
<h3 id="limitations"><a class="anchor" href="#limitations"></a>Limitations</h3>
<div class="paragraph">
<p>The Query service can select a full text index for efficient search in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the SEARCH() function is used in a WHERE clause or in an ANSI JOIN.
The SEARCH() function must be on the leftmost (first) JOIN.
It may be on the outer side of a nested-loop JOIN, or either side of a hash JOIN.
RIGHT OUTER JOINs are rewritten as LEFT OUTER JOINs.</p>
</li>
<li>
<p>If the SEARCH() function is evaluated on the <code>true</code> condition in positive cases: for example, <code>SEARCH(<em>field</em>, <em>query</em>, <em>options</em>)</code>, <code>SEARCH(<em>field</em>, <em>query</em>, <em>options</em>) = true</code>, <code>SEARCH(<em>field</em>, <em>query</em>, <em>options</em>) IN [true, true, true]</code>, or a condition including one of these with <code>AND</code> or <code>OR</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Query service cannot select a full text index for efficient search in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a USE KEYS hint is present; or if the SEARCH() function is used on the inner side of a nested-loop JOIN, a lookup JOIN or lookup NEST, an index JOIN or index NEST, an UNNEST clause, a subquery expression, a subquery result, or a correlated query.</p>
</li>
<li>
<p>If the SEARCH() function is evaluated on the <code>false</code> condition, or in negative cases: for example, <code>NOT SEARCH(<em>field</em>, <em>query</em>, <em>options</em>)</code>, <code>SEARCH(<em>field</em>, <em>query</em>, <em>options</em>) = false</code>, <code>SEARCH(<em>field</em>, <em>query</em>, <em>options</em>) != false</code>, <code>SEARCH(<em>field</em>, <em>query</em>, <em>options</em>) IN [false, true, 1, "a"]</code>, or in a condition using the relation operators <code>&lt;</code>, <code><=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>BETWEEN</code>, <code>NOT</code>, <code>LIKE</code>, or <code>NOT LIKE</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In these cases, the Query service must fetch the documents, and the Search service creates a temporary index in memory to perform the search.
This may affect performance.</p>
</div>
<div class="paragraph">
<p>If the SEARCH() function is present for a keyspace, no GSI covering scan is possible on that keyspace.
If more than one FTS or GSI index are used in the plan, IntersectScan or Ordered IntersectScan is performed.
To avoid this, use a USE INDEX hint.</p>
</div>
<div class="paragraph">
<p>Order pushdown is possible only if query ORDER BY has only <a href="#search_score">SEARCH_SCORE()</a> on the leftmost keyspace.
Offset and Limit pushdown is possible if the query only has a SEARCH() predicate, using a single search index&#8201;&#8212;&#8201;no IntersectScan or OrderIntersectScan.
Group aggregates and projection are not pushed.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples"><a class="anchor" href="#examples"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/searchfun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="title">Search using a query string</div>
<div class="content">
<div class="paragraph">
<p>The following queries are equivalent:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT META(t1).id
FROM airline AS t1
WHERE SEARCH(t1.country, "+United +States");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT META(t1).id
FROM airline AS t1
WHERE SEARCH(t1, "country:\"United States\"");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[

  {
    "id": "airline_10"
  },
  {
    "id": "airline_10123"
  },
  {
    "id": "airline_10226"
  },
  {
    "id": "airline_10748"
  },
  // ...
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The results are unordered, so they may be returned in a different order each time.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Search using a query object</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT t1.name
FROM hotel AS t1
WHERE SEARCH(t1, {
  "match": "bathrobes",
  "field": "reviews.content",
  "analyzer": "standard"
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "name": "Typoeth Cottage"
  },
  {
    "name": "Great Orme Lighthouse"
  },
  {
    "name": "New Road Guest House (B&amp;B)"
  },
  // ...
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The results are unordered, so they may be returned in a different order each time.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Search using a complete full text search request</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT t1.name
FROM hotel AS t1
WHERE SEARCH(t1, {
  "explain": false,
  "fields": [
     "*"
   ],
   "highlight": {},
   "query": {
     "match": "bathrobes",
     "field": "reviews.content",
     "analyzer": "standard"
   },
   "size" : 5,
   "sort": [
      {
       "by" : "field",
       "field" : "reviews.ratings.Overall",
       "mode" : "max",
       "missing" : "last"
      }
   ]
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "name": "Waunifor"
  },
  {
    "name": "Bistro Prego With Rooms"
  },
  {
    "name": "Thornehill Broome Beach Campground"
  },
  // ...
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query returns 5 results, and the results are ordered, as specified by the search options.
As an alternative, you could limit the number of results and order them using the SQL++ <a href="limit.html" class="xref page">LIMIT</a> and <a href="orderby.html" class="xref page">ORDER BY</a> clauses.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Search against a full text search index that carries a custom type mapping</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT META(t1).id
FROM hotel AS t1
WHERE t1.type = "hotel" AND SEARCH(t1.description, "amazing");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "id": "hotel_20422"
  },
  {
    "id": "hotel_22096"
  },
  {
    "id": "hotel_25243"
  },
  {
    "id": "hotel_27741"
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the full text search index being queried has its default mapping disabled and has a custom type mapping defined, the query needs to specify the type explicitly.
The above query uses the demonstration index <a href="#fts:fts-demonstration-indexes.adoc#travel-sample-index-hotel-description" class="xref unresolved">travel-sample-index-hotel-description</a>, which has the custom type mapping "hotel".</p>
</div>
<div class="paragraph">
<p>For more information on defining custom type mappings within the full text search index, refer to <a href="../../fts/fts-creating-indexes.html#specifying-type-mappings" class="xref page">Specifying Type Mappings</a>.
Note that for SQL++ queries, only full text search indexes with one type mapping are searchable.
Also the supported type identifiers at the moment are "type_field" and "docid_prefix"; "docid_regexp" isn&#8217;t supported yet for SEARCH queries via SQL++.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="search_meta"><a class="anchor" href="#search_meta"></a>SEARCH_META([<code>identifier</code>])</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description-2"><a class="anchor" href="#description-2"></a>Description</h3>
<div class="paragraph">
<p>This function is intended to be used in a query which contains a <a href="#search">SEARCH()</a> function.
It returns the metadata given by the Search engine for each document found by the <a href="#search">SEARCH()</a> function.
If there is no <a href="#search">SEARCH()</a> function in the query, or if a full text index was not used to evaluate the search, the function returns MISSING.</p>
</div>
</div>
<div class="sect2">
<h3 id="arguments-2"><a class="anchor" href="#arguments-2"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">identifier</dt>
<dd>
<p>[Optional] An expression in the form <code>[<em>keyspaceAlias</em>.]<em>outname</em></code>, consisting of the keyspace or keyspace alias in which the full text search operation was performed, followed by the outname of the full text search operation, using dot notation.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The identifier must contain the keyspace or keyspace alias if there is more than one input source in the FROM clause.
If there is only one input source in the FROM clause, the keyspace or keyspace alias may be omitted.</p>
</li>
<li>
<p>The identifier must contain the outname if there is more than one <a href="#search">SEARCH()</a> function in the query.
If there is only one <a href="#search">SEARCH()</a> function in the query, the identifier may be omitted altogether.</p>
</li>
<li>
<p>The outname is specified by the <code>out</code> field within the <a href="#search">SEARCH()</a> function&#8217;s <em>options</em> argument.
If an outname was not specified by the <a href="#search">SEARCH()</a> function, the outname defaults to <code>"out"</code>.</p>
</li>
<li>
<p>If the keyspace or keyspace alias contains any characters such as <code>-</code>, you must surround that part of the identifier with backticks <code>``</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="return-value-2"><a class="anchor" href="#return-value-2"></a>Return Value</h3>
<div class="paragraph">
<p>A JSON object containing the metadata returned by the Search engine.
By default, the metadata includes the score and ID of the search result.
It may also include other metadata requested by advanced search options, such as the location of the search terms or an explanation of the search results.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-2"><a class="anchor" href="#examples-2"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/searchfun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="title">Select search metadata</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT SEARCH_META() AS meta <i class="conum" data-value="1"></i><b>(1)</b>
FROM hotel AS t1
WHERE SEARCH(t1, {
  "query": {
    "match": "bathrobes",
    "field": "reviews.content",
    "analyzer": "standard"
  },
  "includeLocations": true
}) <i class="conum" data-value="2"></i><b>(2)</b>
LIMIT 3;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There is only one <a href="#search">SEARCH()</a> function in this query, so the SEARCH_META() function does not need to specify the outname.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The full text search specifies that locations should be included in the search result metadata.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "meta": {
      "id": "hotel_12068", <i class="conum" data-value="1"></i><b>(1)</b>
      "locations": { <i class="conum" data-value="2"></i><b>(2)</b>
        "reviews.content": {
          "bathrobes": [
            {
              "array_positions": [
                8
              ],
              "end": 664,
              "pos": 122,
              "start": 655
            }
          ]
        }
      },
      "score": 0.3471730605306995 <i class="conum" data-value="3"></i><b>(3)</b>
    }
  },
  // ...
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The id is included in the search result metadata by default.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The location of the search term is included in the search result metadata as requested.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The score is included in the search result metadata by default.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Select the search metadata by outname</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT t1.name, SEARCH_META(s1) AS meta <i class="conum" data-value="1"></i><b>(1)</b>
FROM hotel AS t1
WHERE SEARCH(t1.description, "mountain", {"out": "s1"}) <i class="conum" data-value="2"></i><b>(2)</b>
AND SEARCH(t1, {
  "query": {
    "match": "bathrobes",
    "field": "reviews.content",
    "analyzer": "standard"
  }
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This query contains two <a href="#search">SEARCH()</a> functions.
The outname indicates which metadata we want.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The outname is set by the <em>options</em> argument in this <a href="#search">SEARCH()</a> function.
This query only uses one data source, so there is no need to specify the keyspace.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "name": "Marina del Rey Marriott"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="search_score"><a class="anchor" href="#search_score"></a>SEARCH_SCORE([<code>identifier</code>])</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description-3"><a class="anchor" href="#description-3"></a>Description</h3>
<div class="paragraph">
<p>This function is intended to be used in a query which contains a <a href="#search">SEARCH()</a> function.
It returns the score given by the Search engine for each document found by the <a href="#search">SEARCH()</a> function.
If there is no <a href="#search">SEARCH()</a> function in the query, or if a full text index was not used to evaluate the search, the function returns MISSING.</p>
</div>
<div class="paragraph">
<p>This function is the same as <a href="#search_meta">SEARCH_META().score</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="arguments-3"><a class="anchor" href="#arguments-3"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">identifier</dt>
<dd>
<p>[Optional] An expression in the form <code>[<em>keyspaceAlias</em>.]<em>outname</em></code>, consisting of the keyspace or keyspace alias in which the full text search operation was performed, followed by the outname of the full text search operation, using dot notation.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The identifier must contain the keyspace or keyspace alias if there is more than one input source in the FROM clause.
If there is only one input source in the FROM clause, the keyspace or keyspace alias may be omitted.</p>
</li>
<li>
<p>The identifier must contain the outname if there is more than one <a href="#search">SEARCH()</a> function in the query.
If there is only one <a href="#search">SEARCH()</a> function in the query, the identifier may be omitted altogether.</p>
</li>
<li>
<p>The outname is specified by the <code>out</code> field within the <a href="#search">SEARCH()</a> function&#8217;s <em>options</em> argument.
If an outname was not specified by the <a href="#search">SEARCH()</a> function, the outname defaults to <code>"out"</code>.</p>
</li>
<li>
<p>If the keyspace or keyspace alias contains any characters such as <code>-</code>, you must surround that part of the identifier with backticks <code>``</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="return-value-3"><a class="anchor" href="#return-value-3"></a>Return Value</h3>
<div class="paragraph">
<p>A number reflecting the score of the result.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-3"><a class="anchor" href="#examples-3"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/searchfun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="title">Select the search score</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT name, description, SEARCH_SCORE() AS score <i class="conum" data-value="1"></i><b>(1)</b>
FROM hotel AS t1
WHERE SEARCH(t1.description, "mountain")
ORDER BY score DESC
LIMIT 3;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There is only one <a href="#search">SEARCH()</a> function in this query, so the SEARCH_SCORE() function does not need to specify the outname.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "description": "3 Star Hotel next to the Mountain Railway terminus and set in 30 acres of grounds which include Dolbadarn Castle",
    "name": "The Royal Victoria Hotel"
  },
  {
    "description": "370 guest rooms offering both water and mountain view.",
    "name": "Marina del Rey Marriott"
  },
  {
    "description": "This small family run hotel captures the spirit of Mull and is a perfect rural holiday retreat. The mountain and sea blend together to give fantastic, panoramic views from the hotel which is in an elevated position on the shoreline. Panoramic views are also available from the bar and restaurant which serves local produce 7 days a week.",
    "name": "The Glenforsa Hotel"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-links"><a class="anchor" href="#related-links"></a>Related Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="../../fts/fts-introduction.html" class="xref page">Full Text Search</a></p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
