<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Flex Indexes | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="The Flex Index feature enables you run a SQL++ query as a full-text search query, using a full-text index.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/n1ql/n1ql-language-reference/flex-indexes.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/pages/n1ql-language-reference/flex-indexes.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb"><a href="../query.html">Query</a></li>
<li class="crumb"><a href="../advanced.html">Advanced Features</a></li>
<li class="crumb"><a href="flex-indexes.html">Flex Indexes</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Flex Indexes</h1>
<div class="labels">
<ul>
<li class="concept"><span><i class="far fa-lightbulb"></i> concept</span></li>
</ul>
</div>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise Edition</a></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
The Flex Index feature enables you run a SQL++ query as a full-text search query, using a full-text index.
This means that you can write queries in SQL++ to leverage the Search service&#8217;s keyword search capabilities.
</blockquote>
</div>
<div class="paragraph">
<p>In Couchbase Server, a global secondary index (GSI) uses a B-tree structure for fast exact search, whereas full-text search (FTS) uses an inverted index to provide efficient term search.
In Couchbase Server 6.5 and later, it is possible to perform a full-text search within a SQL++ query using <a href="searchfun.html" class="xref page">search functions</a>.
However this requires you to write the full-text search using the FTS syntax.</p>
</div>
<div class="paragraph">
<p>Starting with Couchbase Server 6.6, the <em>Flex Index</em> feature provides the ability for a SQL++ query to leverage either a global secondary index or full-text index transparently with standard SQL++ syntax, simplifying the application development process.</p>
</div>
<div class="paragraph">
<p>The full-text index must be defined in a certain way to be usable by a SQL++ query; similarly, the SQL++ query must have certain characteristics to be able to use the full-text index.
If these requirements are met, the query is transformed into an FTS query, and run against the full-text index.</p>
</div>
<div class="paragraph">
<p>Using a Flex Index query may offer advantages in the following situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the search conditions are not predetermined.</p>
</li>
<li>
<p>When the search predicate involves a large number of fields combined using AND or OR.</p>
</li>
<li>
<p>When the search predicate involves multiple arrays.</p>
</li>
<li>
<p>When an application requires a full-text search combined with SQL++ aggregation or joins.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a general introduction to creating full-text indexes, refer to <a href="../../fts/fts-creating-indexes.html" class="xref page">Creating Indexes</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To understand how a SQL++ query can make use of a full-text index, it&#8217;s important to understand the differences between the semantics of SQL++ queries and full-text indexes, and the restrictions that arise from these differences.</p>
</div>
<div class="sect2">
<h3 id="semantic-differences"><a class="anchor" href="#semantic-differences"></a>Semantic Differences</h3>
<div class="paragraph">
<p>Full-text indexes have different semantics to SQL++ queries.
Some of the main differences are described here.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SQL++ uses escaped path names, whereas full-text indexes flatten the field names.</p>
</li>
<li>
<p>SQL++ uses array subscripts to identify array objects, for example <code>1.arr1[0].b</code>; whereas full-text indexes ignore subscripts, for example <code>f1.arr1.b</code>.
This means full-text indexes cannot uniquely identify the path.</p>
</li>
<li>
<p>In SQL++, data can be compared across data types.
This is not possible with a full-text index.</p>
</li>
<li>
<p>SQL++ handles MISSING fields, whereas these are not handled by a full-text index.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="restrictions"><a class="anchor" href="#restrictions"></a>Restrictions</h3>
<div class="paragraph">
<p>Because of the semantic differences described above, there are several restrictions to the way a Flex Index query can use a full-text index.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Flex Index query cannot use a full-text index as a <a href="covering-indexes.html" class="xref page">covering index</a>.</p>
</li>
<li>
<p>A Flex Index query cannot use a full-text index with a query on fields whose names contain special characters.</p>
</li>
<li>
<p>A Flex Index query may include LIMIT and OFFSET clauses, but they cannot be <a href="#learn:services-and-indexes/indexes/index_pushdowns.adoc" class="xref unresolved">pushed down to the full-text index</a>.</p>
</li>
<li>
<p>A Flex Index query may include Aggregate functions and Window functions, but they cannot be <a href="#learn:services-and-indexes/indexes/index_pushdowns.adoc" class="xref unresolved">pushed down to the full-text index</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Flex Index queries only make use of full-text indexes to find the access path to the required data.
The query engine then fetches the data from the data service.</p>
</div>
<div class="paragraph">
<p>Flex Index queries may use full-text indexes to do an intersect scan with other indexes.
For further details, refer to <a href="#usage">Usage</a> below.</p>
</div>
</div>
<div class="sect2">
<h3 id="index-availability"><a class="anchor" href="#index-availability"></a>Index Availability</h3>
<div class="paragraph">
<p>Full-text indexes are online and searchable as soon as they are created.
GSI indexes are online and searchable after they have been built.
For further details, refer to <a href="build-index.html" class="xref page">BUILD INDEX</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Assuming that there is no search function in the query predicate, there are two ways to specify that you would like to use a full-text index with a SQL++ query:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>USE FTS</code> hint in the SQL++ query.
For full details, refer to <a href="hints.html#index-type" class="xref page">USE Clause</a>.</p>
</li>
<li>
<p>Set the <code>use_fts</code> request-level parameter to <code>true</code>.
For full details, refer to <a href="../../settings/query-settings.html" class="xref page">Settings and Parameters</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using an index hint, you may specify preferred indexes by name, or simply specify the preferred index type&#8201;&#8212;&#8201;<code>FTS</code> or <code>GSI</code>.
It is possible to specify mixed index types.</p>
</div>
<div id="ex-usage-1" class="exampleblock">
<div class="title">Example 1. Use FTS, no index specified</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT META(d).id
FROM default AS d
USE INDEX (USING FTS)
WHERE d.f1 = "xyz" AND d.f2 = 100;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The query engine considers all available full-text indexes.</p>
</li>
<li>
<p>If any full-text index qualifies, the full-text index is used.</p>
</li>
<li>
<p>If none of the full-text indexes qualify, the query engine considers other available GSI and primary indexes, following existing rules.</p>
</li>
</ol>
</div>
<div id="ex-usage-2" class="exampleblock">
<div class="title">Example 2. Use FTS or GSI, no index specified</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT META(d).id
FROM default AS d
USE INDEX (USING FTS, USING GSI)
WHERE d.f1 = "xyz" AND d.f2 = 100;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If any GSI index covers the query, the covering index is used and all other indexes are ignored.</p>
</li>
<li>
<p>If the query is not covered, the query engine considers all available full-text indexes and GSI indexes.</p>
</li>
<li>
<p>If any full-text indexes qualify, the query engine does an intersect scan of all the qualified full-text indexes and GSI indexes.</p>
</li>
<li>
<p>If none of the full-text indexes qualify, the query engine considers other available GSI and primary indexes, following existing rules.</p>
</li>
</ol>
</div>
<div id="ex-usage-3" class="exampleblock">
<div class="title">Example 3. Prefer the specified FTS and GSI indexes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT META(d).id
FROM default AS d
USE INDEX (fix1 USING FTS, gix1 USING GSI)
WHERE d.f1 = "xyz" AND d.f2 = 100;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the specified GSI index covers the query, the covering index is used and all other indexes are ignored.</p>
</li>
<li>
<p>If the query is not covered, the query engine considers the specified full-text indexes and all available GSI indexes.</p>
</li>
<li>
<p>If the specified full-text index qualifies, the query engine does an intersect scan of the full-text index and all qualified GSI indexes.</p>
</li>
<li>
<p>If the specified full-text index does not qualify, the query engine considers other available GSI and primary indexes, following existing rules.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In all cases, if the query meets the requirements to use a full-text index, and a qualified full-text index is selected, the query is transformed into an FTS <a href="#fts:fts-query-types.adoc#simple-queries" class="xref unresolved">simple query</a> (<em>not</em> a query string query), and the simple query is run against the qualified full-text index.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If the query predicate contains a search function, none of this applies&#8201;&#8212;&#8201;instead, an index is selected for the query according to the method described on the <a href="searchfun.html" class="xref page">Search Functions</a> page.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fts-requirements"><a class="anchor" href="#fts-requirements"></a>Full-Text Index Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to use a full-text index with a SQL++ query, the full-text index must meet certain requirements.</p>
</div>
<div class="sect2">
<h3 id="analyzer"><a class="anchor" href="#analyzer"></a>Analyzer</h3>
<div class="paragraph">
<p>The full-text index <em>must</em> use the <a href="#fts:fts-using-analyzers.adoc#pre-constructed-analyzers" class="xref unresolved">keyword analyzer</a>.</p>
</div>
<div class="paragraph">
<p>To specify that a full-text index should use the keyword analyzer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Add Index</strong>, <strong>Edit Index</strong>, or <strong>Clone Index</strong> screen, click the <strong>Advanced</strong> heading to display the Advanced settings panel.</p>
</li>
<li>
<p>Open the <strong>Default Analyzer</strong> pull-down menu and select <code>keyword</code>.</p>
<div class="imageblock">
<div class="content">
<img src="../_images/flex-fts-keyword-analyzer.png" alt="FTS Settings Advanced Panel with Default Analyzer set to keyword" width="498" height="552">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="type-mappings"><a class="anchor" href="#type-mappings"></a>Type Mappings</h3>
<div class="paragraph">
<p>The full-text index <em>must</em> use one of the following type mappings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default type mapping</p>
</li>
<li>
<p>A single custom type mapping</p>
</li>
<li>
<p>Multiple custom type mappings</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The full-text index may <em>not</em> use the default type mapping along with one or more custom type mappings.</p>
</div>
</div>
<div class="sect2">
<h3 id="indexed-fields"><a class="anchor" href="#indexed-fields"></a>Indexed Fields</h3>
<div class="paragraph">
<p>If the full-text index uses the default type mapping, only child mappings and fields mapped under the default type mapping can be used in a query.
In case of dynamic mapping or dynamic child mappings, any field within the mapping can be used within a query.</p>
</div>
<div class="paragraph">
<p>If the full-text index has multiple custom type mappings, all the fields that you want to query must be indexed within all the requested type mappings.</p>
</div>
<div class="paragraph">
<p>Child mappings and fields mapped under top level type mappings can all be used within a query, provided they are enabled.</p>
</div>
<div class="paragraph">
<p>When <a href="../../fts/fts-creating-indexes.html#inserting-a-child-field" class="xref page">creating a full-text definition in the Couchbase Web Console</a>, the child fields listed by field name or by <strong>searchable as</strong> may be used within a SQL++ query.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The type field in a custom type mapped index is <em>not</em> searchable.
</td>
</tr>
</table>
</div>
<div id="ex-indexed-fields" class="exampleblock">
<div class="title">Example 4. Child fields that may be used in a query</div>
<div class="content">
<div class="paragraph">
<p>A full-text index definition contains the following child fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "reviews": {
    "enabled": true,
    "dynamic": false,
    "properties": {
      "review": {
        "enabled": true,
        "dynamic": false,
        "properties": {
          "author": {
            "enabled": true,
            "dynamic": false,
            "fields": [{
                "name": "author", <i class="conum" data-value="1"></i><b>(1)</b>
                "type": "text",
                "index": true,
                "analyzer": "keyword"
              }]
          }
        }
      }
    }
  },
  "id": {
    "enabled": true,
    "dynamic": false,
    "fields": [{
        "name": "id", <i class="conum" data-value="2"></i><b>(2)</b>
        "type": "number",
        "index": true
      }]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A query may search the following fields with this full-text index:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>reviews.review.author</code> field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>id</code> field</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-requirements"><a class="anchor" href="#query-requirements"></a>Query Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to use a full-text index with a SQL++ query, the query must also meet certain requirements.</p>
</div>
<div class="sect2">
<h3 id="conditional-expression"><a class="anchor" href="#conditional-expression"></a>Conditional Expression for Custom Type Mappings</h3>
<div class="paragraph">
<p>If the full-text index has a single custom type mapping, the query predicate <em>must</em> contain an expression matching the type, independent of the rest of the predicate.</p>
</div>
<div id="ex-conditional-1" class="exampleblock">
<div class="title">Example 5. Conditional expression for a custom type mapping with a simple predicate</div>
<div class="content">
<div class="paragraph">
<p>A full-text index definition contains the following custom type mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"doc_config.mode": "type_field",
"doc_config.type_field": "type"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query can be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT meta().id
FROM `keyspace` USE INDEX (USING FTS)
WHERE type = "hotel" <i class="conum" data-value="1"></i><b>(1)</b>
AND country = "US";</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Conditional expression matching the type mapping</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>If you have several expressions within the WHERE clause, the query engine needs to be able to resolve the conditional expression without any ambiguity, to avoid the possibility of false negatives.</p>
</div>
<div id="ex-conditional-2" class="exampleblock">
<div class="title">Example 6. Conditional expression for a custom type mapping with a complex predicate</div>
<div class="content">
<div class="paragraph">
<p>The following query is ambiguous, and cannot be used with the full-text index defined in <a href="#ex-conditional-1">Example 5</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT meta().id
FROM `keyspace` USE INDEX (USING FTS)
WHERE type = "hotel" AND country = "US" OR country = "CAN";</code></pre>
</div>
</div>
<div class="paragraph">
<p>With brackets setting the priority of the AND and OR operators, the following queries are unambiguous, and can be used with the full-text index defined in <a href="#ex-conditional-1">Example 5</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT meta().id
FROM `keyspace` USE INDEX (USING FTS)
WHERE type = "hotel" AND (country = "US" OR country = "CAN");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT meta().id
FROM default USE INDEX (USING FTS)
WHERE type = "hotel"
AND (
    country = "US" OR country = "CAN"
    AND id &gt;= 0 AND id &lt;= 10
    OR id &gt;= 20 AND id &lt;= 30
);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT meta().id
FROM default USE INDEX (USING FTS)
WHERE type = "hotel"
AND (country = "US" OR country = "CAN")
AND (id &gt;= 0 AND id &lt;= 10 OR id &gt;= 20 AND id &lt;= 30);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Similarly, if the full-text index contains multiple custom type mappings, the query engine needs to be able to resolve the conditional expression without any ambiguity, to avoid the possibility of false negatives.</p>
</div>
<div id="ex-conditional-3" class="exampleblock">
<div class="title">Example 7. Conditional expression for multiple custom type mappings</div>
<div class="content">
<div class="paragraph">
<p>The following predicates can be used with a full-text index with multiple custom type mappings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE type = "xyz"
WHERE (type = "xyz" OR type = "abc")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following predicate cannot be used with a full-text index with multiple custom type mappings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE type = "xyz" OR type = "abc"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="n1ql-predicates"><a class="anchor" href="#n1ql-predicates"></a>SQL++ Predicates</h3>
<div class="paragraph">
<p>SQL++ predicates can be used with a Flex Index query, as long as they meet certain requirements, as detailed below.</p>
</div>
<div class="sect3">
<h4 id="equality"><a class="anchor" href="#equality"></a>Equality Expressions</h4>
<div class="paragraph">
<p>You can use an equality expression with a full-text index, as long as the field is either explicitly indexed, or if the indexing is dynamic within the keyword analyzer.</p>
</div>
<div id="ex-equality-1" class="exampleblock">
<div class="title">Example 8. Equality expressions with a dynamic keyword index</div>
<div class="content">
<div class="paragraph">
<p>The following predicates can be used with a dynamic keyword index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE a = "12"
WHERE b = true
WHERE c = 13</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-equality-2" class="exampleblock">
<div class="title">Example 9. Equality expressions with explicitly indexed fields</div>
<div class="content">
<div class="paragraph">
<p>A full-text index has the following explicitly indexed fields: <code>a</code> (text), <code>b</code> (boolean), <code>c</code> (numeric).</p>
</div>
<div class="paragraph">
<p>The following predicates can be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE a = "12"
WHERE b = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following predicates cannot be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE c = "13" <i class="conum" data-value="1"></i><b>(1)</b>
WHERE d = "N/A" <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>c</code> is indexed as numeric</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>d</code> is not indexed</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>The left-hand side of an equality expression must be a field name or a fully-qualified path.
It may not be an expression.
Conversely, the right-hand side of an equality expression may not depend on the keyspace.</p>
</div>
<div id="ex-equality-3" class="exampleblock">
<div class="title">Example 10. Equality expression with field name</div>
<div class="content">
<div class="paragraph">
<p>The following predicate can be used with a full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE state = LOWER("CALIFORNIA")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following predicate cannot be used with a full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE LOWER(state) = "california" <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Left-hand side is an expression</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="and"><a class="anchor" href="#and"></a>AND Expressions</h4>
<div class="paragraph">
<p>You can use an <code>AND</code> expression with a full-text index.
Partial sargability is supported: this means that one or both of the requested child expressions must be indexed for the query to use a full-text index.
If there&#8217;s a possibility of false positives, the query engine filters the results using KV fetches.</p>
</div>
<div id="ex-and" class="exampleblock">
<div class="title">Example 11. AND expressions</div>
<div class="content">
<div class="paragraph">
<p>In a full-text index, the fields <code>a</code> and <code>b</code> are indexed.</p>
</div>
<div class="paragraph">
<p>The following expressions can be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE a = "12" AND b = "34" <i class="conum" data-value="1"></i><b>(1)</b>
WHERE a = "12" AND d = "56" <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Searches for <code>a</code> and <code>b</code> using the full-text index</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Searches for <code>a</code> using the full-text index, and uses KV fetch to filter results for <code>d</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following expressions cannot be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE d = "56" AND e = "78" <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Neither <code>d</code> nor <code>e</code> are indexed</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="or"><a class="anchor" href="#or"></a>OR Expressions</h4>
<div class="paragraph">
<p>You can use an <code>OR</code> expression with a full-text index.
Partial sargability is not supported: all the requested child expressions must be indexed.
This is to avoid false negatives.</p>
</div>
<div id="ex-or" class="exampleblock">
<div class="title">Example 12. OR expressions</div>
<div class="content">
<div class="paragraph">
<p>In a full-text index, the fields <code>a</code> and <code>b</code> are indexed.</p>
</div>
<div class="paragraph">
<p>The following expressions can be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE a = "12" OR b = "34" <i class="conum" data-value="1"></i><b>(1)</b>
WHERE a = "12" OR a = "98" <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Searches for <code>a</code> and <code>b</code> using the full-text index</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Searches for <code>a</code> using the full-text index</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following expressions cannot be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE a = "12" OR d = "56" <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>d</code> is not indexed (false negatives)</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compound-expressions"><a class="anchor" href="#compound-expressions"></a>Compound Expressions</h4>
<div class="paragraph">
<p>You can use compound expressions with a full-text index, as long as they respect the rules of <a href="#and">AND Expressions</a> and <a href="#or">OR Expressions</a> expressions described above, and do not return false negatives.</p>
</div>
<div id="ex-compound" class="exampleblock">
<div class="title">Example 13. Compound expressions</div>
<div class="content">
<div class="paragraph">
<p>A full-text index definition has a type mapping <code>X</code> with 2 child fields&#8201;&#8212;&#8201;<code>name</code> (text), <code>age</code> (numeric).</p>
</div>
<div class="paragraph">
<p>The following predicate can be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE type = "X" AND name = "abc" AND age = 10 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>No chance of false negatives, all fields are sargable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following predicates cannot be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE type = "X" OR name = "abc" AND age = 10 <i class="conum" data-value="1"></i><b>(1)</b>
WHERE type = "X" AND name = "abc" OR age = 10 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is treated as an OR expression: <code>(type = "X") OR (name = "abc" AND age = 10)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is treated as an OR expression: <code>(type = "X" AND name = "abc") OR (age = 10)</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>AND takes precedence over OR, so these predicates are treated as OR expressions.
Both child expressions of an OR expression must be indexed.
Therefore these predicates cannot be used with a full-text index.</p>
</div>
<div class="paragraph">
<p>However, the following predicate can be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE type = "X" AND (name = "abc" OR age = 10) <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Brackets alter the order of precedence so there is no chance of false negatives</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ranges"><a class="anchor" href="#ranges"></a>Range Expressions</h4>
<div class="paragraph">
<p>You can use range expressions with a full-text index, as long as the range expressions meet the following criteria:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ranges must be deterministic: that is, they should have a clear start and finish.</p>
</li>
<li>
<p>Range boundaries must be of the same data type.</p>
</li>
<li>
<p>The maximum range boundary expression must always come after the minimum range boundary expression.</p>
</li>
<li>
<p>If there are several range expressions, or there is a mixture of range expressions and other expressions, the range expressions need to be contiguous.</p>
</li>
</ol>
</div>
<div id="ex-ranges" class="exampleblock">
<div class="title">Example 14. Range expressions</div>
<div class="content">
<div class="paragraph">
<p>The following range expressions can be used with a full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE a &gt;= 10 AND a &lt;= 20
WHERE b &gt;= "hot" AND b &lt;= "hotel"
WHERE c &gt;= "2020-03-01" AND c &lt;= "2020-04-01" <i class="conum" data-value="1"></i><b>(1)</b>

WHERE type = "xyz" AND a &gt;= 10 AND a &lt;= 20
WHERE a &gt;= 10 AND a &lt;= 20 AND type = "xyz"
WHERE type = "xyz" AND (a &gt;= 10 AND a &lt;= 20) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ranges are deterministic, range boundaries are of similar type, and maximum range boundary comes after minimum range boundary</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Range expressions are contiguous</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following range expressions cannot be used with a full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE a &gt;= 10
WHERE b &lt; "hotel"
WHERE c &gt; "2020-03-01"
WHERE a &gt;= 10 OR a &lt;= 20 <i class="conum" data-value="1"></i><b>(1)</b>

WHERE a &lt;= 20 AND a &gt;= 10
WHERE a &gt;= 20 AND a &lt;= 10 <i class="conum" data-value="2"></i><b>(2)</b>

WHERE a &gt;= 10 AND a &lt;= "hot" <i class="conum" data-value="3"></i><b>(3)</b>

WHERE a &gt;= 10 AND type = "xyz" AND a &lt;= 20 <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ranges are open-ended (non-deterministic)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Maximum range boundary comes before minimum range boundary</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Range boundaries are of different data types</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Range expression is not contiguous</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="isstring-and-issnumber"><a class="anchor" href="#isstring-and-issnumber"></a>ISSTRING() and ISNUMBER()</h4>
<div class="paragraph">
<p>You can use the <a href="typefun.html#isstring" class="xref page">ISSTRING()</a> and <a href="typefun.html#isnumber" class="xref page">ISNUMBER()</a> functions as a workaround to support open-ended ranges with a full-text index.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The query engine translates <code>ISSTRING(x)</code> to a range establishing the data type of the object as a string, i.e. greater than or equal to an empty string, and less than an empty array: <code>"" <= x AND x < []</code>.</p>
</li>
<li>
<p>The query engine translates <code>ISNUMBER(y)</code> to a range establishing the data type of the object as numeric, i.e. greater than the boolean value <code>true</code>, and less than an empty string: <code>true < y AND y < ""</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to <a href="datatypes.html#collation" class="xref page">Collation</a> for more information.</p>
</div>
<div id="ex-isstring-and-issnumber" class="exampleblock">
<div class="title">Example 15. Workarounds for open-ended ranges</div>
<div class="content">
<div class="paragraph">
<p>The following open-ended ranges can be used with a full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE ISSTRING(name) AND name &gt;= "abhi" <i class="conum" data-value="1"></i><b>(1)</b>
WHERE ISNUMBER(age) AND age &gt; 30 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An open-ended range specifying any string later than "abhi".</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An open-ended range specifying any number greater than 30.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="like"><a class="anchor" href="#like"></a>LIKE Expressions</h4>
<div class="paragraph">
<p>You can use a <code>LIKE</code> expression with a full-text index, as long as the <code>LIKE</code> expression contains a simple string, or a string followed by the <code>%</code> wildcard.</p>
</div>
<div class="paragraph">
<p>If the <code>LIKE</code> expression contains a simple string, it must respect the rules outlined in the <a href="#equality">Equality Expressions</a> section above.
A string followed by the <code>%</code> wildcard, such as <code>a LIKE bc%</code>, will be treated as a range expression.
Other <code>LIKE</code> expressions cannot be used with a full-text index.</p>
</div>
<div id="ex-like" class="exampleblock">
<div class="title">Example 16. LIKE expressions</div>
<div class="content">
<div class="paragraph">
<p>The following predicates may be used with a full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE a LIKE "hotel" <i class="conum" data-value="1"></i><b>(1)</b>
WHERE a LIKE "hote%" <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The query engine treats this expression as the equality expression <code>a = "hotel"</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The query engine treats this expression as the range <code>a >= "hote" AND a <= "hotf"</code></td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="between"><a class="anchor" href="#between"></a>BETWEEN Expressions</h4>
<div class="paragraph">
<p>You can use a <code>BETWEEN</code> expression with a full-text index.
The range specified by the <code>BETWEEN</code> expression must respect the rules outlined in the <a href="#ranges">Range Expressions</a> section above.
<code>BETWEEN</code> expressions that mix data type boundaries cannot be used with a full-text index.</p>
</div>
<div id="ex-between" class="exampleblock">
<div class="title">Example 17. BETWEEN expressions</div>
<div class="content">
<div class="paragraph">
<p>The following predicate may be used with a full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">WHERE a BETWEEN 10 AND 20 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The query engine treats this expression as the range <code>a >= 10 AND a <= 20</code></td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="any-in-satisfies"><a class="anchor" href="#any-in-satisfies"></a>ANY &#8230;&#8203; IN &#8230;&#8203; SATISFIES Expressions</h4>
<div class="paragraph">
<p>You can use an <code>ANY</code> &#8230;&#8203; <code>IN</code> &#8230;&#8203; <code>SATISFIES</code> expression with a full-text index.
The <code>ANY</code> &#8230;&#8203; <code>IN</code> &#8230;&#8203; <code>SATISFIES</code> expression must operate over an array, which may be an array of objects or any supported data types.</p>
</div>
<div id="ex-any-in-satisfies" class="exampleblock">
<div class="title">Example 18. ANY &#8230;&#8203; IN &#8230;&#8203; SATISFIES expressions</div>
<div class="content">
<div class="paragraph">
<p>A full-text index definition contains the following type mapping over documents of type <code>"hotel"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "hotel": {
    "default_analyzer": "keyword",
    "enabled": true,
    "properties": {
      "reviews": {
        "enabled": true,
        "properties": {
          "ratings": {
            "enabled": true,
            "properties": {
              "Cleanliness": {
                "enabled": true,
                "fields": [
                  {
                    "index": true,
                    "name": "Cleanliness",
                    "type": "number"
                  }
                ]
              },
              "Overall": {
                "enabled": true,
                "fields": [
                  {
                    "index": true,
                    "name": "Overall",
                    "type": "number"
                  }
                ]
              }
            }
          },
          "author": {
            "enabled": true,
            "fields": [
              {
                "index": true,
                "name": "author",
                "type": "text"
              }
            ]
          }
        }
      },
      "public_likes": {
        "enabled": true,
        "fields": [
          {
            "index": true,
            "name": "public_likes",
            "type": "text"
          }
        ]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following predicates may be used with this full-text index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WHERE type = "hotel" AND ANY r in reviews SATISFIES r.author = "xyz" END

WHERE type = "hotel" AND ANY r in reviews SATISFIES r.ratings.Cleanliness = 5 OR r.ratings.Overall = 4 END

WHERE type = "hotel" AND ANY r in reviews SATISFIES r.ratings.Cleanliness = 5 OR r.ratings.Overall = 4 END AND ANY p in public_likes SATISFIES p LIKE "xyz" END</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="every-in-satisfies"><a class="anchor" href="#every-in-satisfies"></a>EVERY &#8230;&#8203; IN &#8230;&#8203; SATISFIES Expressions</h4>
<div class="paragraph">
<p>You can use an <code>EVERY</code> &#8230;&#8203; <code>IN</code> &#8230;&#8203; <code>SATISFIES</code> expression with a full-text index.
The <code>EVERY</code> &#8230;&#8203; <code>IN</code> &#8230;&#8203; <code>SATISFIES</code> expression must operate over an array, which may be an array of objects or any supported data types.</p>
</div>
<div id="ex-every-in-satisfies" class="exampleblock">
<div class="title">Example 19. EVERY &#8230;&#8203; IN &#8230;&#8203; SATISFIES expressions</div>
<div class="content">
<div class="paragraph">
<p>The following predicate may be used with the full-text index defined in <a href="#ex-any-in-satisfies">Example 18</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WHERE EVERY r IN reviews SATISFIES r.ratings.Cleanliness = 5 END</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="any-and-every-in-satisfies"><a class="anchor" href="#any-and-every-in-satisfies"></a>ANY AND EVERY &#8230;&#8203; IN &#8230;&#8203; SATISFIES Expressions</h4>
<div class="paragraph">
<p>You can use an <code>ANY AND EVERY</code> &#8230;&#8203; <code>IN</code> &#8230;&#8203; <code>SATISFIES</code> expression with a full-text index.
The <code>ANY AND EVERY</code> &#8230;&#8203; <code>IN</code> &#8230;&#8203; <code>SATISFIES</code> expression must operate over an array, which may be an array of objects or any supported data types.</p>
</div>
<div id="ex-any-and-every-in-satisfies" class="exampleblock">
<div class="title">Example 20. ANY AND EVERY &#8230;&#8203; IN &#8230;&#8203; SATISFIES expressions</div>
<div class="content">
<div class="paragraph">
<p>The following predicate may be used with the full-text index defined in <a href="#ex-any-in-satisfies">Example 18</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WHERE ANY AND EVERY r IN reviews SATISFIES r.ratings.Cleanliness = 5 END</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="not"><a class="anchor" href="#not"></a>NOT Expressions</h4>
<div class="paragraph">
<p>You cannot use a complex <code>NOT</code> expression with a full-text index.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="joins"><a class="anchor" href="#joins"></a>JOINs</h3>
<div class="paragraph">
<p>JOINs may be used with a full-text index, as long as the JOIN predicate meets the requirements to be used with a full-text index.
Refer to <a href="#n1ql-predicates">SQL++ Predicates</a> above.</p>
</div>
</div>
<div class="sect2">
<h3 id="pagination"><a class="anchor" href="#pagination"></a>ORDER, LIMIT, and OFFSET</h3>
<div class="paragraph">
<p>The LIMIT, OFFSET, and ORDER clauses can be used with a full-text index when the index uses the default type mapping or a single custom type mapping.</p>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
