<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>UPDATE | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="UPDATE replaces a document that already exists with updated values.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/n1ql/n1ql-language-reference/update.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/pages/n1ql-language-reference/update.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb"><a href="../query.html">Query</a></li>
<li class="crumb"><a href="index.html">SQL++ Language Reference</a></li>
<li class="crumb">Statements</li>
<li class="crumb"><a href="update.html">UPDATE</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">UPDATE</h1>
<div class="labels">
<ul><li class="reference"><span><i class="fas fa-book"></i></i> reference</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<style type="text/css">
  /* DOC-10177 */
  .hdlist table tr td.hdlist1,
  .hdlist table tr td.hdlist2 {
    padding: 1.5rem 0 0;
  }

  /* Compact horizontal definition lists */
  .hdlist.compact,
  .hdlist.compact {
    padding-top: 1rem;
  }
  .hdlist.compact table tr td.hdlist1,
  .hdlist.compact table tr td.hdlist2 {
    padding: 0.5rem 0 0;
  }

  /* Descriptions in horizontal description lists should have left padding */
  .hdlist table tr td.hdlist2,
  .hdlist.compact table tr td.hdlist2 {
    padding-left: 1rem;
  }

  /* Paragraphs in horizontal description lists should not have left margin */
  .hdlist table .hdlist1 + .hdlist2 p {
    margin-left: 0; !important
  }

  /* Horizontal definitions should match style of vertical definitions */
  td.hdlist1 {
    font-weight: 600;
  }
</style>
<style type="text/css">

/* details like other paragraph divs */
  .doc details {
    margin-top: 1rem;
  }
  .doc .paragraph + .details {
    margin-top: 1.5rem;
  }

/* summary like other titles */
  .doc details > summary.title {
    font-size: 1rem;
    font-weight: 600;
    line-height: 1.2;
    margin-bottom: 1rem;
    color: #52566c;
  }

</style>
<div class="quoteblock abstract">
<blockquote>
UPDATE replaces a document that already exists with updated values.
</blockquote>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please note that the examples on this page will alter the data in your sample buckets.
To restore your sample data, remove and reinstall the <code>travel-sample</code> bucket.
Refer to <a href="../../manage/manage-settings/install-sample-buckets.html" class="xref page">Sample Buckets</a> for details.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="rbac-privileges"><a class="anchor" href="#rbac-privileges"></a>RBAC Privileges</h3>
<div class="paragraph">
<p>User executing the UPDATE statement must have the <em>Query Update</em> privilege on the target keyspace.
If the statement has any clauses that needs data read, such as SELECT clause, or RETURNING clause, then <em>Query Select</em> privilege is also required on the keyspaces referred in the respective clauses.
For more details about user roles, see
<a href="../../learn/security/authorization-overview.html" class="xref page">Authorization</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A user with the <em>Data Writer</em> privilege may set documents to expire.
When the document expires, the data service deletes the document, even though the user may not have the <em>Query Delete</em> privilege.
</td>
</tr>
</table>
</div>
<details>
<summary class="title">RBAC Examples</summary>
<div class="content">
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/update.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="paragraph">
<p>To execute the following statement, you must have the <em>Query Update</em> privilege on <code>airport</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-rbac.n1ql">UPDATE airport SET foo = 5;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute the following statement, you must have the <em>Query Update</em> privilege on <code>airport</code> and <em>Query Select</em> privilege on <code>`beer-sample`</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-rbac-sub.n1ql">UPDATE airport
SET foo = 9
WHERE city IN (SELECT RAW city FROM `beer-sample` WHERE type = "brewery");</code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute the following statement, you must have the <em>Query Update</em> and <em>Query Select</em> privileges on <code>airport</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-rbac-return.n1ql">UPDATE airport
SET city = "San Francisco"
WHERE lower(city) = "san francisco"
RETURNING *;</code></pre>
</div>
</div>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="syntax"><a class="anchor" href="#syntax"></a>Syntax</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dml.ebnf#L120-L121">update ::= 'UPDATE' target-keyspace use-keys? set-clause? unset-clause?
            where-clause? limit-clause? returning-clause?</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/update.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="hdlist compact">
<table>
<tr>
<td class="hdlist1">
target-keyspace
</td>
<td class="hdlist2">
<p><a href="#update-target">Update Target</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
<tr>
<td class="hdlist1">
use-keys
</td>
<td class="hdlist2">
<p><a href="#update-hint">Update Hint</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
<tr>
<td class="hdlist1">
set-clause
</td>
<td class="hdlist2">
<p><a href="#set-clause">SET Clause</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
<tr>
<td class="hdlist1">
unset-clause
</td>
<td class="hdlist2">
<p><a href="#unset-clause">UNSET Clause</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
<tr>
<td class="hdlist1">
where-clause
</td>
<td class="hdlist2">
<p><a href="#where-clause">WHERE Clause</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
<tr>
<td class="hdlist1">
limit-clause
</td>
<td class="hdlist2">
<p><a href="#limit-clause">LIMIT Clause</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
<tr>
<td class="hdlist1">
returning-clause
</td>
<td class="hdlist2">
<p><a href="#returning-clause">RETURNING Clause</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="update-target"><a class="anchor" href="#update-target"></a>Update Target</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dml.ebnf#L138">target-keyspace ::= keyspace-ref ( 'AS'? alias )?</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/target-keyspace.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>The update target is the keyspace which you want to update.</p>
</div>
<div class="hdlist compact">
<table>
<tr>
<td class="hdlist1">
keyspace-ref
</td>
<td class="hdlist2">
<p><a href="#keyspace-ref">Keyspace Reference</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
<tr>
<td class="hdlist1">
alias
</td>
<td class="hdlist2">
<p><a href="#update-alias">AS Alias</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="keyspace-ref"><a class="anchor" href="#keyspace-ref"></a>Keyspace Reference</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dql.ebnf#L86">keyspace-ref ::= keyspace-path | keyspace-partial</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/keyspace-ref.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div id="keyspace-path" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dql.ebnf#L90">keyspace-path ::= ( namespace ':' )? bucket ( '.' scope '.' collection )?</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/keyspace-path.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div id="keyspace-partial" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dql.ebnf#L94">keyspace-partial ::= collection</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/keyspace-partial.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Keyspace reference for the update target.
For more details, refer to <a href="from.html#from-keyspace-ref" class="xref page">Keyspace Reference</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="update-alias"><a class="anchor" href="#update-alias"></a>AS Alias</h4>
<div class="paragraph">
<p>Assigns another name to the keyspace reference.
For details, refer to <a href="from.html#section_ax5_2nx_1db" class="xref page">AS Clause</a>.</p>
</div>
<div class="paragraph">
<p>Assigning an alias to the keyspace reference is optional.
If you assign an alias to the keyspace reference, the <code>AS</code> keyword may be omitted.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="update-hint"><a class="anchor" href="#update-hint"></a>Update Hint</h3>
<div class="paragraph">
<p>You can use a <code>USE KEYS</code> hint on the update target to specify the keys of the data items to be updated.
For details, refer to <a href="hints.html#use-keys-clause" class="xref page">USE KEYS Clause</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="set-clause"><a class="anchor" href="#set-clause"></a>SET Clause</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dml.ebnf#L147-L148">set-clause ::= 'SET' ( meta '=' expiration | path '=' expr update-for? )
               ( ',' ( meta '=' expiration | path '=' expr update-for? ) )*</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/set-clause.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Specifies the value for an attribute to be changed.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
path
</td>
<td class="hdlist2">
<p>A <a href="#path">path</a> specifying the attribute to be changed.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
expr
</td>
<td class="hdlist2">
<p>The value may be a generic expression term, a subquery, or an expression that resolves to nested array elements.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
update-for
</td>
<td class="hdlist2">
<p><a href="#update-for">FOR Clause</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SET clause also supports alternative arguments which enable you to set the expiration of the document.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
meta
</td>
<td class="hdlist2">
<p>A <a href="metafun.html#meta" class="xref page">META().expiration</a> expression specifying the expiration property of the document being updated.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
expiration
</td>
<td class="hdlist2">
<p>An integer, or an expression resolving to an integer, representing the <a href="#java-sdk:howtos:kv-operations.adoc#document-expiration" class="xref unresolved">document expiration</a> in seconds.</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the document expiration is not specified, the document expiration is set according to the request-level <a href="../../settings/query-settings.html#preserve_expiration" class="xref page">preserve_expiration</a> parameter.
If this is <code>true</code>, the existing document expiration is preserved; if <code>false</code>, the document expiration defaults to <code>0</code>, meaning the document expiration is the same as the <a href="../../learn/data/expiration.html" class="xref page">bucket expiration</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="unset-clause"><a class="anchor" href="#unset-clause"></a>UNSET Clause</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dml.ebnf#L152">unset-clause ::= 'UNSET' path update-for? (',' path update-for?)*</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/unset-clause.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Removes the specified attribute from the document.</p>
</div>
<div class="hdlist compact">
<table>
<tr>
<td class="hdlist1">
path
</td>
<td class="hdlist2">
<p>A <a href="#path">path</a> specifying the attribute to be removed.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
update-for
</td>
<td class="hdlist2">
<p><a href="#update-for">FOR Clause</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot use the UNSET clause to unset the document expiration.
To unset the document expiration, set the document expiration to <code>0</code>.
Alternatively, if the request-level <a href="../../settings/query-settings.html#preserve_expiration" class="xref page">preserve_expiration</a> parameter is set to <code>false</code>, simply update the document without specifying the document expiration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="update-for"><a class="anchor" href="#update-for"></a>FOR Clause</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dml.ebnf#L156-L158">update-for ::= ('FOR' (name-var ':')? var ('IN' | 'WITHIN') path
               (','   (name-var ':')? var ('IN' | 'WITHIN') path)* )+
               ('WHEN' cond)? 'END'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/update-for.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div id="path" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dql.ebnf#L66">path ::= identifier ( '[' expr ']' )* ( '.' identifier ( '[' expr ']' )* )*</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/path.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Uses the FOR statement to iterate over a nested array to SET or UNSET the given attribute for every matching element in the array.
The FOR clause can evaluate functions and expressions, and the UPDATE statement supports multiple nested FOR expressions to access and update fields in nested arrays.
Additional array levels are supported by chaining the FOR clauses.</p>
</div>
</div>
<div class="sect2">
<h3 id="where-clause"><a class="anchor" href="#where-clause"></a>WHERE Clause</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dql.ebnf#L362">where-clause ::= 'WHERE' cond</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/where-clause.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Specifies the condition that needs to be met for data to be updated.
Optional.</p>
</div>
</div>
<div class="sect2">
<h3 id="limit-clause"><a class="anchor" href="#limit-clause"></a>LIMIT Clause</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dql.ebnf#L453">limit-clause ::= 'LIMIT' expr</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/limit-clause.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Specifies the greatest number of objects that can be updated.
This clause must have a non-negative integer as its upper bound.
Optional.</p>
</div>
</div>
<div class="sect2">
<h3 id="returning-clause"><a class="anchor" href="#returning-clause"></a>RETURNING Clause</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/dml.ebnf#L142-L143">returning-clause ::= 'RETURNING' (result-expr (',' result-expr)* |
                    ('RAW' | 'ELEMENT' | 'VALUE') expr)</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/returning-clause.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Specifies the information to be returned by the operation as a query result.
For more details, refer to <a href="insert.html#returning-clause" class="xref page">RETURNING Clause</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/update.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For some of these examples, the Query Workbench may warn you that the query has no WHERE clause and will update all documents.
In this case, you can ignore the warning: the USE KEYS hint in these examples ensures that the query updates only one document.
</td>
</tr>
</table>
</div>
<div id="example-1" class="exampleblock">
<div class="title">Example 1. Set an attribute</div>
<div class="content">
<div class="paragraph">
<p>The following statement sets the nickname of the landmark "Tradeston Pedestrian Bridge" to "Squiggly Bridge".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-set.n1ql">UPDATE landmark
USE KEYS "landmark_10090"
SET nickname = "Squiggly Bridge"
RETURNING landmark.nickname;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-set.jsonc">[
  {
    "nickname": "Squiggly Bridge"
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="example-2" class="exampleblock">
<div class="title">Example 2. Unset an attribute</div>
<div class="content">
<div class="paragraph">
<p>This statement removes the <code>nickname</code> attribute from the <code>landmark</code> keyspace for the document with the key <code>landmark_10090</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-unset.n1ql">UPDATE landmark
USE KEYS "landmark_10090"
UNSET nickname
RETURNING landmark.name;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-unset.jsonc">[
  {
    "name": "Tradeston Pedestrian Bridge"
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="example-3" class="exampleblock">
<div class="title">Example 3. Set attributes in an array</div>
<div class="content">
<div class="paragraph">
<p>This statement sets the <code>codeshare</code> attribute for each element in the <code>schedule</code> array for document <code>route_10003</code> in the <code>route</code> keyspace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-set-array.n1ql">UPDATE route t
USE KEYS "route_10003"
SET s.codeshare = NULL FOR s IN schedule END
RETURNING t;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-set-array.jsonc">[
  {
    "t": {
      "airline": "AF",
      "airlineid": "airline_137",
      "destinationairport": "ATL",
      "distance": 654.9546621929924,
      "equipment": "757 739",
      "id": 10003,
      "schedule": [
        {
          "codeshare": null,
          "day": 0,
          "flight": "AF986",
          "utc": "22:26:00"
        },
        {
          "codeshare": null,
          "day": 0,
          "flight": "AF962",
          "utc": "04:25:00"
        },
// ...
      ],
      "sourceairport": "TPA",
      "stops": 0,
      "type": "route"
    }
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="example-4" class="exampleblock">
<div class="title">Example 4. Set nested array elements</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-set-nested.n1ql">UPDATE hotel AS h USE KEYS "hotel_10025"
SET i.ratings = OBJECT_ADD(i.ratings, "new", "new_value" ) FOR i IN reviews END
RETURNING h.reviews[*].ratings;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-set-nested.jsonc">[
  {
    "ratings": [
      {
        "Cleanliness": 5,
        "Location": 4,
        "Overall": 4,
        "Rooms": 3,
        "Service": 5,
        "Value": 4,
        "new": "new_value"
      },
      {
        "Business service (e.g., internet access)": 4,
        "Check in / front desk": 4,
        "Cleanliness": 4,
        "Location": 4,
        "Overall": 4,
        "Rooms": 3,
        "Service": 3,
        "Value": 5,
        "new": "new_value"
      }
    ]
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="example-5" class="exampleblock">
<div class="title">Example 5. Access nested arrays</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-unset-nested.n1ql">UPDATE hotel AS h USE KEYS "hotel_10025"
UNSET i.new FOR i IN
  (ARRAY j.ratings FOR j IN reviews END)
END
RETURNING h.reviews[*].ratings;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-unset-nested.jsonc">[
  {
    "ratings": [
      {
        "Cleanliness": 5,
        "Location": 4,
        "Overall": 4,
        "Rooms": 3,
        "Service": 5,
        "Value": 4
      },
      {
        "Business service (e.g., internet access)": 4,
        "Check in / front desk": 4,
        "Cleanliness": 4,
        "Location": 4,
        "Overall": 4,
        "Rooms": 3,
        "Service": 3,
        "Value": 5
      }
    ]
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="example-6" class="exampleblock">
<div class="title">Example 6. Update a document with the results of a subquery</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-set-sub.n1ql">UPDATE airport AS a
SET hotels =
  (SELECT  h.name, h.id
  FROM  hotel AS h
  WHERE h.city = "Nice")
WHERE a.faa ="NCE"
RETURNING a;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-set-sub.jsonc">[
  {
    "a": {
      "airportname": "Cote D\\'Azur",
      "city": "Nice",
      "country": "France",
      "faa": "NCE",
      "geo": {
        "alt": 12,
        "lat": 43.658411,
        "lon": 7.215872
      },
      "hotels": [
        {
          "id": 20419,
          "name": "Best Western Hotel Riviera Nice"
        },
        {
          "id": 20420,
          "name": "Hotel Anis"
        },
        {
          "id": 20421,
          "name": "NH Nice"
        },
        {
          "id": 20422,
          "name": "Hotel Suisse"
        },
        {
          "id": 20423,
          "name": "Gounod"
        },
        {
          "id": 20424,
          "name": "Grimaldi Hotel Nice"
        },
        {
          "id": 20425,
          "name": "Negresco"
        }
      ],
      "icao": "LFMN",
      "id": 1354,
      "type": "airport",
      "tz": "Europe/Paris"
    }
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="example-7" class="exampleblock">
<div class="title">Example 7. Update a document and set expiration</div>
<div class="content">
<div class="paragraph">
<p>Update a document and set the expiration to 1 week.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-set-expire.n1ql">UPDATE route t USE KEYS "route_10003"
SET meta(t).expiration = 7*24*60*60,
s.codeshare = NULL FOR s IN schedule END;</code></pre>
</div>
</div>
</div>
</div>
<div id="example-8" class="exampleblock">
<div class="title">Example 8. Update a document and preserve expiration</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-preserve-expire.n1ql">UPDATE route t USE KEYS "route_10003"
SET meta(t).expiration = meta(t).expiration,
s.codeshare = NULL FOR s IN schedule END;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in Couchbase Server 7.1 and later, it is possible to preserve the document expiration using the request-level <a href="../../settings/query-settings.html#preserve_expiration" class="xref page">preserve_expiration</a> parameter.</p>
</div>
</div>
</div>
<div id="example-9" class="exampleblock">
<div class="title">Example 9. Update a document and unset expiration</div>
<div class="content">
<div class="paragraph">
<p>Set the document expiration to 0 to unset the document expiration.
(In this case, the document expiration defaults to be the same as the bucket expiration.)</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-unset-expire.n1ql">UPDATE route t USE KEYS "route_10003"
SET meta(t).expiration = 0,
s.codeshare = NULL FOR s IN schedule END;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if the request-level <a href="../../settings/query-settings.html#preserve_expiration" class="xref page">preserve_expiration</a> parameter is set to <code>false</code>, and you update the document without specifying the document expiration, the document expiration defaults to 0.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/dml/update-unset-expire-alt.n1ql">UPDATE route t USE KEYS "route_10003"
SET s.codeshare = NULL FOR s IN schedule END;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
