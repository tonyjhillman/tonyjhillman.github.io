<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Aggregate Functions | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Aggregate functions take multiple values from documents, perform calculations, and return a single value as the result.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/n1ql/n1ql-language-reference/aggregatefun.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb"><a href="../query.html">Query</a></li>
<li class="crumb"><a href="index.html">SQL++ Language Reference</a></li>
<li class="crumb"><a href="functions.html">Functions</a></li>
<li class="crumb"><a href="aggregatefun.html">Aggregate Functions</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Aggregate Functions</h1>
<div class="labels">
<ul><li class="reference"><span><i class="fas fa-book"></i></i> reference</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<style type="text/css">
  /* DOC-10177 */
  .hdlist table tr td.hdlist1,
  .hdlist table tr td.hdlist2 {
    padding: 1.5rem 0 0;
  }

  /* Compact horizontal definition lists */
  .hdlist.compact,
  .hdlist.compact {
    padding-top: 1rem;
  }
  .hdlist.compact table tr td.hdlist1,
  .hdlist.compact table tr td.hdlist2 {
    padding: 0.5rem 0 0;
  }

  /* Descriptions in horizontal description lists should have left padding */
  .hdlist table tr td.hdlist2,
  .hdlist.compact table tr td.hdlist2 {
    padding-left: 1rem;
  }

  /* Paragraphs in horizontal description lists should not have left margin */
  .hdlist table .hdlist1 + .hdlist2 p {
    margin-left: 0; !important
  }

  /* Horizontal definitions should match style of vertical definitions */
  td.hdlist1 {
    font-weight: 600;
  }
</style>
<div class="paragraph">
<p>Aggregate functions take multiple values from documents, perform calculations, and return a single value as the result.
The function names are case insensitive.</p>
</div>
<div class="paragraph">
<p>You can only use aggregate functions in <code>SELECT</code>, <code>LETTING</code>, <code>HAVING</code>, and <code>ORDER BY</code> clauses.
When using an aggregate function in a query, the query operates as an aggregate query.</p>
</div>
<div class="paragraph">
<p>In Couchbase Server Enterprise Edition, aggregate functions can also be used as <a href="windowfun.html" class="xref page">window functions</a> when they are used with a window specification, which is introduced by the <code>OVER</code> keyword.</p>
</div>
<div class="paragraph">
<p>In Couchbase Server 7.0 and later, window functions (and aggregate functions used as window functions) may specify their own inline window definitions, or they may refer to a named window defined by the WINDOW clause elsewhere in the query.
By defining a named window with the WINDOW clause, you can reuse the window definition across several functions in the query, potentially making the query easier to write and maintain.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="syntax"><a class="anchor" href="#syntax"></a>Syntax</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the generic syntax of aggregate functions.
Refer to sections below for details of individual aggregate functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/n1ql.ebnf#L276-L277">aggregate-function ::= aggregate-function-name '(' ( aggregate-quantifier? expr |
                       ( path '.' )? '*' ) ')' filter-clause? over-clause?</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/aggregate-function.png" alt="Syntax diagram">
</div>
</div>
<div class="hdlist compact">
<table>
<tr>
<td class="hdlist1">
aggregate-quantifier
</td>
<td class="hdlist2">
<p><a href="#aggregate-quantifier">Aggregate Quantifier</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
<tr>
<td class="hdlist1">
filter-clause
</td>
<td class="hdlist2">
<p><a href="#filter-clause">FILTER Clause</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
<tr>
<td class="hdlist1">
over-clause
</td>
<td class="hdlist2">
<p><a href="#over-clause">OVER Clause</a> <span class="icon"><i class="fa fa-caret-down"></i></span></p>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h3>
<div class="paragraph">
<p>Aggregate functions take a single <a href="index.html#N1QL_Expressions" class="xref page">expression</a> as an argument, which is used to compute the aggregate function.
The <code>COUNT</code> function can instead take a wildcard (*) or a <a href="index.html#nested-path-exp" class="xref page">path</a> with a wildcard (path.*) as its argument.</p>
</div>
</div>
<div class="sect2">
<h3 id="aggregate-quantifier"><a class="anchor" href="#aggregate-quantifier"></a>Aggregate Quantifier</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/n1ql.ebnf#L281">aggregate-quantifier ::= 'ALL' | 'DISTINCT'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/aggregate-quantifier.png" alt="Syntax diagram">
</div>
</div>
<div class="paragraph">
<p>The <strong>aggregate quantifier</strong> determines whether the function aggregates all values in the group, or distinct values only.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ALL</code></dt>
<dd>
<p>All objects are included in the computation.</p>
</dd>
<dt class="hdlist1"><code>DISTINCT</code></dt>
<dd>
<p>Only distinct objects are included in the computation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This quantifier can only be used with aggregate functions.</p>
</div>
<div class="paragraph">
<p>This quantifier is optional.
If omitted, the default value is <code>ALL</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="filter-clause"><a class="anchor" href="#filter-clause"></a>FILTER Clause</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/n1ql.ebnf#L285">filter-clause ::= 'FILTER' '(' 'WHERE' cond ')'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/filter-clause.png" alt="Syntax diagram">
</div>
</div>
<div class="paragraph">
<p>The FILTER clause enables you to specify which values are included in the aggregate.
This clause is available for aggregate functions, and aggregate functions used as window functions.
(It is not permitted for dedicated window functions.)</p>
</div>
<div class="paragraph">
<p>The FILTER clause is useful when a query contains several aggregate functions, each of which requires a different condition.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">cond</dt>
<dd>
<p>[Required] Conditional expression.
Values for which the condition resolves to TRUE are included in the aggregation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The conditional expression is subject to the same rules as the conditional expression in the query WHERE clause, and the same rules as aggregation operands.
It may not contain a subquery, a window function, or an outer reference.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the query block contains an aggregate function which uses the FILTER clause, the aggregation is not pushed down to the indexer.
Refer to <a href="groupby-aggregate-performance.html#filter-clause" class="xref page">Grouping and Aggregate Pushdown</a> for more details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="over-clause"><a class="anchor" href="#over-clause"></a>OVER Clause</h3>
<div class="paragraph labels">
<p><span class="edition"><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/n1ql.ebnf#L310">over-clause ::= 'OVER' ( '(' window-definition ')' | window-ref )</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/over-clause.png" alt="Syntax diagram">
</div>
</div>
<div class="paragraph">
<p>The OVER clause introduces the window specification for the function.
There are two ways of specifying the window.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <em>inline window definition</em> specifies the window directly within the function call.
It is delimited by parentheses <code>()</code> and has exactly the same syntax as the window definition in a WINDOW clause.
For further details, refer to <a href="window.html#window-definition" class="xref page">Window Definition</a>.</p>
</li>
<li>
<p>A <em>window reference</em> is an <a href="identifiers.html" class="xref page">identifier</a> which refers to a named window.
The named window must be defined by a WINDOW clause in the same query block as the function call.
For further details, refer to <a href="window.html" class="xref page">WINDOW Clause</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="defaults"><a class="anchor" href="#defaults"></a>Default Values</h3>
<div class="paragraph">
<p>If there is no input row for the group, <code>COUNT</code> functions return <code>0</code>.
All other aggregate functions return NULL.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="array_agg"><a class="anchor" href="#array_agg"></a><a id="array_agg_distinct"></a>ARRAY_AGG( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value"><a class="anchor" href="#return-value"></a>Return Value</h3>
<div class="paragraph">
<p>With the <code>ALL</code> quantifier, or no quantifier, returns an array of the non-MISSING values in the group, including NULL values.</p>
</div>
<div class="paragraph">
<p>With the <code>DISTINCT</code> quantifier, returns an array of the distinct non-MISSING values in the group, including NULL values.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples"><a class="anchor" href="#examples"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>List all values of the <code>Cleanliness</code> reviews given:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT ARRAY_AGG(reviews[0].ratings.Cleanliness) AS Reviews
FROM hotel;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Reviews": [
      -1,
      -1,
      -1,
      -1,
      -1,
      // ...
    ]
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>List all unique values of the <code>Cleanliness</code> reviews given:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT ARRAY_AGG(DISTINCT reviews[0].ratings.Cleanliness) AS Reviews
FROM hotel;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "UniqueReviews": [
      -1,
      1,
      2,
      3,
      4,
      5
    ]
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="avg"><a class="anchor" href="#avg"></a><a id="avg_distinct"></a>AVG( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This function has an alias <a href="#mean">MEAN()</a>.</p>
</div>
<div class="sect2">
<h3 id="return-value-2"><a class="anchor" href="#return-value-2"></a>Return Value</h3>
<div class="paragraph">
<p>With the <code>ALL</code> quantifier, or no quantifier, returns the arithmetic mean (average) of all the number values in the group.</p>
</div>
<div class="paragraph">
<p>With the <code>DISTINCT</code> quantifier, returns the arithmetic mean (average) of all the distinct number values in the group.</p>
</div>
<div class="paragraph">
<p>Returns NULL if there are no number values in the group.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-2"><a class="anchor" href="#examples-2"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the average altitude of airports in the <code>airport</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/avg.n1ql">SELECT AVG(geo.alt) AS AverageAltitude FROM airport;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/avg.jsonc">[
  {
    "AverageAltitude": 870.1651422764228
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the average number of stops per route vs. the average of distinct numbers of stops:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/avg-all.n1ql">SELECT AVG(ALL stops) AS AvgAllStops FROM route;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in 0.0002 since nearly all routes have 0 stops.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/avg-distinct.n1ql">SELECT AVG(DISTINCT stops) AS AvgDistinctStops FROM route;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in 0.5 since all routes have only 1 or 0 stops.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="count_all"><a class="anchor" href="#count_all"></a>COUNT(*)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value-3"><a class="anchor" href="#return-value-3"></a>Return Value</h3>
<div class="paragraph">
<p>Returns count of all the input rows for the group, regardless of value. <sup class="footnote" id="_footnote_count">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
</div>
<div class="sect2">
<h3 id="example"><a class="anchor" href="#example"></a>Example</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the number of documents in the <code>landmark</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT COUNT(*) AS CountAll FROM landmark;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "CountAll": 4495
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="count"><a class="anchor" href="#count"></a><a id="count_distinct"></a>COUNT( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value-4"><a class="anchor" href="#return-value-4"></a>Return Value</h3>
<div class="paragraph">
<p>With the <code>ALL</code> quantifier, or no quantifier, returns count of all the non-NULL and non-MISSING values in the group. <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="paragraph">
<p>With the <code>DISTINCT</code> quantifier, returns count of all the distinct non-NULL and non-MISSING values in the group.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-3"><a class="anchor" href="#examples-3"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the number of documents with an airline route stop in the <code>route</code> keyspace regardless of its value:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT COUNT(stops) AS CountOfStops FROM route;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "CountOfStops": 24024
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the number of unique values of airline route stops in the <code>route</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT COUNT(DISTINCT stops) AS CountOfDistinctStops
FROM route;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "CountOfSDistinctStops": 2 <i class="conum" data-value="1"></i><b>(1)</b>
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Results in 2 because there are only 0 or 1 stops.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="countn"><a class="anchor" href="#countn"></a>COUNTN( [ ALL | DISTINCT ] <code>expression</code> )</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value-5"><a class="anchor" href="#return-value-5"></a>Return Value</h3>
<div class="paragraph">
<p>With the <code>ALL</code> quantifier, or no quantifier, returns a count of all the numeric values in the group. <sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="paragraph">
<p>With the <code>DISTINCT</code> quantifier, returns a count of all the distinct numeric values in the group.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-4"><a class="anchor" href="#examples-4"></a>Examples</h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The count of numeric values in a mixed group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT COUNTN(list.val) AS CountOfNumbers
FROM [
  {"val":1},
  {"val":1},
  {"val":2},
  {"val":"abc"}
] AS list;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "CountOfNumbers": 3
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The count of unique numeric values in a mixed group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT COUNTN(DISTINCT list.val) AS CountOfNumbers
FROM [
  {"val":1},
  {"val":1},
  {"val":2},
  {"val":"abc"}
] AS list;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "CountOfNumbers": 2
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="max"><a class="anchor" href="#max"></a>MAX( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value-6"><a class="anchor" href="#return-value-6"></a>Return Value</h3>
<div class="paragraph">
<p>Returns the maximum non-NULL, non-MISSING value in the group in SQL++ collation order.</p>
</div>
<div class="paragraph">
<p>This function returns the same result with the <code>ALL</code> quantifier, the <code>DISTINCT</code> quantifier, or no quantifier.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-5"><a class="anchor" href="#examples-5"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="title">Max of an integer field</div>
<div class="content">
<div class="paragraph">
<p>Find the northernmost latitude of any hotel in the <code>hotel</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT MAX(geo.lat) AS MaxLatitude FROM hotel;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "MaxLatitude": 60.15356
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Max of a string field</div>
<div class="content">
<div class="paragraph">
<p>Find the hotel whose name is last alphabetically in the <code>hotel</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT MAX(name) AS MaxName FROM hotel;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "MaxName": "pentahotel Birmingham"
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That result might have been surprising since lowercase letters come after uppercase letters and are therefore "higher" than uppercase letters.
To avoid this uppercase/lowercase confusion, you should first make all values uppercase or lowercase, as in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Max of a string field, regardless of case</div>
<div class="content">
<div class="paragraph">
<p>Find the hotel whose name is last alphabetically in the <code>hotel</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT MAX(UPPER(name)) AS MaxName FROM hotel;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "MaxName": "YOSEMITE LODGE AT THE FALLS"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mean"><a class="anchor" href="#mean"></a><a id="mean_distinct"></a>MEAN( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alias for <a href="#avg">AVG()</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="median"><a class="anchor" href="#median"></a><a id="median_distinct"></a>MEDIAN( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value-7"><a class="anchor" href="#return-value-7"></a>Return Value</h3>
<div class="paragraph">
<p>With the <code>ALL</code> quantifier, or no quantifier, returns the median of all the number values in the group.
If there is an even number of number values, returns the mean of the median two values.</p>
</div>
<div class="paragraph">
<p>With the <code>DISTINCT</code> quantifier, returns the median of all the distinct number values in the group.
If there is an even number of distinct number values, returns the mean of the median two values.</p>
</div>
<div class="paragraph">
<p>Returns NULL if there are no number values in the group.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-6"><a class="anchor" href="#examples-6"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the median altitude of airports in the <code>airport</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT MEDIAN(geo.alt) AS MedianAltitude
FROM airport;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "MedianAltitude": 361.5
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the median of distinct altitudes of airports in the <code>airport</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT MEDIAN(DISTINCT geo.alt) AS MedianAltitude FROM airport;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "MedianDistinctAltitude": 758
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="min"><a class="anchor" href="#min"></a>MIN( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value-8"><a class="anchor" href="#return-value-8"></a>Return Value</h3>
<div class="paragraph">
<p>Returns the minimum non-NULL, non-MISSING value in the group in SQL++ collation order.</p>
</div>
<div class="paragraph">
<p>This function returns the same result with the <code>ALL</code> quantifier, the <code>DISTINCT</code> quantifier, or no quantifier.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-7"><a class="anchor" href="#examples-7"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="title">Min of an integer field</div>
<div class="content">
<div class="paragraph">
<p>Find the southernmost latitude of any hotel in the <code>hotel</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/min-num.n1ql">SELECT MIN(geo.lat) AS MinLatitude FROM hotel;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/min-num.jsonc">[
  {
    "MinLatitude": 32.68092
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Min of a string field</div>
<div class="content">
<div class="paragraph">
<p>Find the hotel whose name is first alphabetically in the <code>hotel</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/min-string.n1ql">SELECT MIN(name) AS MinName FROM hotel;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/min-string.jsonc">[
  {
    "MinName": "'La Mirande Hotel"
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>That result might have been surprising since some symbols come before letters and are therefore "lower" than letters.
To avoid this symbol confusion, you can specify letters only, as in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Min of a string field, regardless of preceding non-letters</div>
<div class="content">
<div class="paragraph">
<p>Find the first hotel alphabetically in the <code>hotel</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/min-filter.n1ql">SELECT MIN(name) FILTER (WHERE SUBSTR(name,0)&gt;="A") AS MinName
FROM hotel;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/min-filter.jsonc">[
  {
    "MinName": "AIRE NATURELLE LE GROZEAU Aire naturelle"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stddev"><a class="anchor" href="#stddev"></a><a id="stddev_distinct"></a>STDDEV( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value-9"><a class="anchor" href="#return-value-9"></a>Return Value</h3>
<div class="paragraph">
<p>With the <code>ALL</code> quantifier, or no quantifier, returns the <a href="#eqn_samp_std_dev">corrected sample standard deviation</a> of all the number values in the group.</p>
</div>
<div class="paragraph">
<p>With the <code>DISTINCT</code> quantifier, returns the <a href="#eqn_samp_std_dev">corrected sample standard deviation</a> of all the distinct number values in the group.</p>
</div>
<div class="paragraph">
<p>Returns NULL if there are no number values in the group.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-8"><a class="anchor" href="#examples-8"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the sample standard deviation of all values:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT STDDEV(reviews[0].ratings.Cleanliness) AS StdDev
FROM hotel
WHERE city="London";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "StdDev": 2.0554275433769753
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the sample standard deviation of a single value:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT STDDEV(reviews[0].ratings.Cleanliness) AS StdDevSingle
FROM hotel
WHERE name="Sachas Hotel";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "StdDevSingle": 0 <i class="conum" data-value="1"></i><b>(1)</b>
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There is only one matching result in the input, so the function returns <code>0</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the sample standard deviation of distinct values:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT STDDEV(DISTINCT reviews[0].ratings.Cleanliness) AS StdDev
FROM hotel
WHERE city="London";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "StdDevDistinct": 2.1602468994692865
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stddev_pop"><a class="anchor" href="#stddev_pop"></a><a id="stddev_pop_distinct"></a>STDDEV_POP( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value-10"><a class="anchor" href="#return-value-10"></a>Return Value</h3>
<div class="paragraph">
<p>With the <code>ALL</code> quantifier, or no quantifier, returns the <a href="#eqn_pop_std_dev">population standard deviation</a> of all the number values in the group.</p>
</div>
<div class="paragraph">
<p>With the <code>DISTINCT</code> quantifier, returns the <a href="#eqn_pop_std_dev">population standard deviation</a> of all the distinct number values in the group.</p>
</div>
<div class="paragraph">
<p>Returns NULL if there are no number values in the group.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-9"><a class="anchor" href="#examples-9"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the population standard deviation of all values:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT STDDEV_POP(reviews[0].ratings.Cleanliness) AS PopStdDev
FROM hotel
WHERE city="London";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "PopStdDev": 2.0390493736539432
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the population standard deviation of distinct values:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT STDDEV_POP(DISTINCT reviews[0].ratings.Cleanliness) AS PopStdDev
FROM hotel
WHERE city="London";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
      "PopStdDevDistinct": 1.9720265943665387
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stddev_samp"><a class="anchor" href="#stddev_samp"></a><a id="stddev_samp_distinct"></a>STDDEV_SAMP( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A near-synonym for <a href="#stddev">STDDEV()</a>.
The only difference is that <code>STDDEV_SAMP()</code> returns NULL if there is only one matching element.</p>
</div>
<div class="sect2">
<h3 id="example-2"><a class="anchor" href="#example-2"></a>Example</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the sample standard deviation of a single value:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT STDDEV_SAMP(reviews[0].ratings.Cleanliness) AS StdDevSingle
FROM hotel
WHERE name="Sachas Hotel";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "StdDevSamp": null <i class="conum" data-value="1"></i><b>(1)</b>
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There is only one matching result in the input, so the function returns NULL.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sum"><a class="anchor" href="#sum"></a><a id="sum_distinct"></a>SUM( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value-11"><a class="anchor" href="#return-value-11"></a>Return Value</h3>
<div class="paragraph">
<p>With the <code>ALL</code> quantifier, or no quantifier, returns the sum of all the number values in the group.</p>
</div>
<div class="paragraph">
<p>With the <code>DISTINCT</code> quantifier, returns the arithmetic sum of all the distinct number values in the group.</p>
</div>
<div class="paragraph">
<p>Returns NULL if there are no number values in the group.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-10"><a class="anchor" href="#examples-10"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the sum total of all airline route stops in the <code>route</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT SUM(stops) AS SumOfStops FROM route;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the <code>route</code> keyspace, nearly all flights are non-stop (0 stops) and only six flights have 1 stop, so we expect 6 flights of 1 stop each, a total of 6.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "SumOfStops": 6 <i class="conum" data-value="1"></i><b>(1)</b>
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There are 6 routes with 1 stop each.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the sum total of all unique numbers of airline route stops in the <code>route</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT SUM(DISTINCT stops) AS SumOfStops FROM route;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "SumOfDistinctStops": 1 <i class="conum" data-value="1"></i><b>(1)</b>
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There are only 0 and 1 stops per route; and 0 + 1 = 1.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="variance"><a class="anchor" href="#variance"></a><a id="variance_distinct"></a>VARIANCE( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="return-value-12"><a class="anchor" href="#return-value-12"></a>Return Value</h3>
<div class="paragraph">
<p>With the <code>ALL</code> quantifier, or no quantifier, returns the unbiased sample variance (the square of the <a href="#eqn_samp_std_dev">corrected sample standard deviation</a>) of all the number values in the group.</p>
</div>
<div class="paragraph">
<p>With the <code>DISTINCT</code> quantifier, returns the unbiased sample variance (the square of the <a href="#eqn_samp_std_dev">corrected sample standard deviation</a>) of all the distinct number values in the group.</p>
</div>
<div class="paragraph">
<p>Returns NULL if there are no number values in the group.</p>
</div>
<div class="paragraph">
<p>This function has a near-synonym <a href="#variance_samp">VARIANCE_SAMP()</a>.
The only difference is that <code>VARIANCE()</code> returns NULL if there is only one matching element.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-11"><a class="anchor" href="#examples-11"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the sample variance of all values:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT VARIANCE(reviews[0].ratings.Cleanliness) AS Variance
FROM hotel
WHERE city="London";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Variance": 4.224782386072708
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the sample variance of a single value:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT VARIANCE(reviews[0].ratings.Cleanliness) AS VarianceSingle
FROM hotel
WHERE name="Sachas Hotel";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "VarianceSingle": 0 <i class="conum" data-value="1"></i><b>(1)</b>
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There is only one matching result in the input, so the function returns <code>0</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the sampling variance of distinct values:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT VARIANCE(DISTINCT reviews[0].ratings.Cleanliness) AS Variance
FROM hotel
WHERE city="London";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "VarianceDistinct": 4.666666666666667
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="variance_pop"><a class="anchor" href="#variance_pop"></a><a id="variance_pop_distinct"></a>VARIANCE_POP( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This function has an alias <a href="#var_pop">VAR_POP()</a>.</p>
</div>
<div class="sect2">
<h3 id="return-value-13"><a class="anchor" href="#return-value-13"></a>Return Value</h3>
<div class="paragraph">
<p>With the <code>ALL</code> quantifier, or no quantifier, returns the population variance (the square of the <a href="#eqn_pop_std_dev">population standard deviation</a>) of all the number values in the group.</p>
</div>
<div class="paragraph">
<p>With the <code>DISTINCT</code> quantifier, returns the population variance (the square of the <a href="#eqn_pop_std_dev">population standard deviation</a>) of all the distinct number values in the group.</p>
</div>
<div class="paragraph">
<p>Returns NULL if there are no number values in the group.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-12"><a class="anchor" href="#examples-12"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the population variance of all values:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT VARIANCE_POP(reviews[0].ratings.Cleanliness) AS PopVariance
FROM hotel
WHERE city="London";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "PopVariance": 4.157722348198537
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the population variance of distinct values:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT VARIANCE_POP(DISTINCT reviews[0].ratings.Cleanliness) AS PopVarianceDistinct
FROM hotel
WHERE city="London";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
      "PopVarianceDistinct": 3.8888888888888893
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="variance_samp"><a class="anchor" href="#variance_samp"></a><a id="variance_samp_distinct"></a>VARIANCE_SAMP( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A near-synonym for <a href="#variance">VARIANCE()</a>.
The only difference is that <code>VARIANCE_SAMP()</code> returns NULL if there is only one matching element.</p>
</div>
<div class="paragraph">
<p>This function has an alias <a href="#var_samp">VAR_SAMP()</a>.</p>
</div>
<div class="sect2">
<h3 id="example-3"><a class="anchor" href="#example-3"></a>Example</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/aggregatefun.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Find the sample standard deviation of a single value:</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT VARIANCE_SAMP(reviews[0].ratings.Cleanliness) AS VarianceSamp
FROM hotel
WHERE name="Sachas Hotel";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "VarianceSamp": null <i class="conum" data-value="1"></i><b>(1)</b>
  }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There is only one matching result in the input, so the function returns NULL.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="var_pop"><a class="anchor" href="#var_pop"></a><a id="var_pop_distinct"></a>VAR_POP( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alias for <a href="#variance_pop">VARIANCE_POP()</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="var_samp"><a class="anchor" href="#var_samp"></a><a id="var_samp_distinct"></a>VAR_SAMP( [ ALL | DISTINCT ] <code>expression</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alias for <a href="#variance_samp">VARIANCE_SAMP()</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="formulas"><a class="anchor" href="#formulas"></a>Formulas</h2>
<div class="sectionbody">
<div id="eqn_samp_std_dev" class="paragraph">
<div class="title">Corrected Sample Standard Deviation</div>
<p>The corrected sample standard deviation is calculated according to the following formula.</p>
</div>
<div class="stemblock">
<div class="content">
\$s = sqrt(1/(n-1) sum_(i=1)^n (x_i - barx)^2)\$
</div>
</div>
<div id="eqn_pop_std_dev" class="paragraph">
<div class="title">Population Standard Deviation</div>
<p>The population standard deviation is calculated according to the following formula.</p>
</div>
<div class="stemblock">
<div class="content">
\$sigma = sqrt((sum(x_i - mu)^2)/N)"\$
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-links"><a class="anchor" href="#related-links"></a>Related Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="groupby.html" class="xref page">GROUP BY Clause</a> for GROUP BY, LETTING, and HAVING clauses.</p>
</li>
<li>
<p><a href="window.html" class="xref page">WINDOW Clause</a> for WINDOW clauses.</p>
</li>
<li>
<p><a href="windowfun.html" class="xref page">Window Functions</a> for window functions.</p>
</li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. When counting all the documents within a collection, this function usually relies on the collection statistics, which include any <a href="../../learn/data/transactions.html#additional-storage-use" class="xref page">transaction records</a> that may be stored in that collection. However, if the query performs an index scan using the primary index on that collection, counting all documents does not include any transaction records.
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: { inlineMath: [["\\(", "\\)"]], displayMath: [["\\[", "\\]"]], ignoreClass: "nostem|nolatexmath" },
  asciimath2jax: { delimiters: [["\\$", "\\$"]], ignoreClass: "nostem|noasciimath" },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>
