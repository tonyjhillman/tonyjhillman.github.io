<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Keyspace Hints | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Keyspace hints apply to a specific keyspace.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/n1ql/n1ql-language-reference/keyspace-hints.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/pages/n1ql-language-reference/keyspace-hints.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb"><a href="../query.html">Query</a></li>
<li class="crumb"><a href="index.html">SQL++ Language Reference</a></li>
<li class="crumb"><a href="optimizer-hints.html">Hints</a></li>
<li class="crumb"><a href="keyspace-hints.html">Keyspace Hints</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Keyspace Hints</h1>
<div class="labels">
<ul><li class="reference"><span><i class="fas fa-book"></i></i> reference</span></li>
</ul>
</div>
<div class="labels">
<ul>
<li class="status"><span>Couchbase Server 7.1</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Keyspace hints apply to a specific keyspace.
</blockquote>
</div>
<div class="paragraph">
<p>A keyspace hint is a type of <a href="optimizer-hints.html" class="xref page">optimizer hint</a>.
Keyspace hints include <em>index</em> hints, which enable you to specify indexes, and <em>join</em> hints, which enable you to specify join methods.</p>
</div>
<div class="paragraph">
<p>For each keyspace hint, you must specify the keyspace or keyspaces that the hint applies to.
If a keyspace is given an explicit alias in the query, then the hint must refer to the explicit alias, not the keyspace name. This is to avoid confusion in situations where the same keyspace can be used multiple times (with different aliases) in the same query.</p>
</div>
<div class="paragraph">
<p>If the keyspace is <em>not</em> given an explicit alias in the query, the hint must refer to the keyspace using the keyspace name.
(If the keyspace name is a dotted path, the hint must refer to the keyspace using its implicit alias, which is the last component in the keyspace path.)</p>
</div>
<div class="paragraph">
<p>There are two possible formats for each optimizer hint: simple syntax and JSON syntax.
Note that you cannot mix simple syntax and JSON syntax in the same hint comment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="index"><a class="anchor" href="#index"></a>INDEX</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This hint directs the optimizer to consider one or more specified secondary indexes.
If not specified, the optimizer selects the optimal available index.</p>
</div>
<div class="sect2">
<h3 id="simple-syntax"><a class="anchor" href="#simple-syntax"></a>Simple Syntax</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L36">gsi-hint-simple ::= 'INDEX' '(' keyspace index* ')'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/gsi-hint-simple.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>With the simple syntax, this hint specifies a single keyspace expression, and zero, one, or more indexes.
You can use this hint multiple times within the hint comment to specify hints for more than one keyspace.</p>
</div>
<div class="sect3">
<h4 id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">keyspace</dt>
<dd>
<p>The keyspace or alias to which this hint applies.</p>
</dd>
<dt class="hdlist1">index</dt>
<dd>
<p>A secondary index that the optimizer should consider for the given keyspace.
This argument is optional; if omitted, the optimizer considers <em>all</em> secondary indexes available in the given keyspace.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="json-syntax"><a class="anchor" href="#json-syntax"></a>JSON Syntax</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L68">gsi-hint-json ::= '"index"' ':' ( index-array | index-object )</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/gsi-hint-json.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>With the JSON syntax, this hint takes the form of an <code>index</code> property.
You may only use this property once within the hint comment.
The value of this property may be an <a href="#index-array">Index Array</a> or an <a href="#index-object">Index Object</a>.</p>
</div>
<div class="sect3">
<h4 id="index-array"><a class="anchor" href="#index-array"></a>Index Array</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L84">index-array ::= '[' index-object ( ',' index-object )* ']'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/index-array.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Use this array to specify indexes for multiple keyspaces.
Each element must be an <a href="#index-object">Index Object</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="index-object"><a class="anchor" href="#index-object"></a>Index Object</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L88">index-object ::= '{' keyspace-property ',' indexes-property '}'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/index-object.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Use this object to specify indexes for a single keyspace.
It must contain a <a href="#keyspace-property">Keyspace Property</a> and an <a href="#indexes-property">Indexes Property</a>.
The order of the properties within the object is not significant.</p>
</div>
</div>
<div class="sect3">
<h4 id="keyspace-property"><a class="anchor" href="#keyspace-property"></a>Keyspace Property</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L106">keyspace-property ::= ( '"keyspace"' | '"alias"' ) ':' '"' keyspace '"'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/keyspace-property.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Synonym for <code>"keyspace"</code>: <code>"alias"</code></p>
</div>
<div class="paragraph">
<p>The value of this property is the keyspace or alias to which this hint applies.</p>
</div>
</div>
<div class="sect3">
<h4 id="indexes-property"><a class="anchor" href="#indexes-property"></a>Indexes Property</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L92-L94">indexes-property ::= '"indexes"' ':' ( 'null'
                                     | '"' index '"'
                                     | '[' '"' index '"' ( ',' '"' index '"' )* ']' )</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/indexes-property.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>The value of this property may be:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>null</code>
</td>
<td class="hdlist2">
<p>The optimizer considers all secondary indexes available in the given keyspace.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
An <em>index</em> string
</td>
<td class="hdlist2">
<p>A secondary index that the optimizer should consider for the given keyspace.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
An array of <em>index</em> strings
</td>
<td class="hdlist2">
<p>An array of secondary indexes that the optimizer should consider for the given keyspace.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="index-examples"><a class="anchor" href="#index-examples"></a>Examples</h3>
<div class="paragraph">
<p>For the examples in this section, it is assumed that the cost-based optimizer is active, and all optimizer statistics are up-to-date.</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/keyspace-hints.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div id="ex-index-opt" class="exampleblock">
<div class="title">Optimized index selection</div>
<div class="content">
<div class="paragraph">
<p>The following query does not include an index hint.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/index-opt.n1ql#L6-L9">SELECT id
FROM route
WHERE sourceairport = "SFO"
LIMIT 1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you examine the plan for this query, you can see that the optimizer has selected the index <code>def_inventory_route_sourceairport</code>, which is installed with the travel sample dataset.</p>
</div>
<div class="listingblock">
<div class="title">Explain plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/index-opt.jsonc#L11-L14">{
  "#operator": "IndexScan3",
  "bucket": "travel-sample",
  "index": "def_inventory_route_sourceairport",</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-index-hint" class="exampleblock">
<div class="title">INDEX hint</div>
<div class="content">
<div class="paragraph">
<p>The following query hints that the optimizer should select the index <code>def_inventory_route_route_src_dst_day</code> for the keyspace <code>route</code>.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/index-hint.n1ql#L6-L9">SELECT /*+ INDEX (route def_inventory_route_route_src_dst_day) */ id <i class="conum" data-value="1"></i><b>(1)</b>
FROM route <i class="conum" data-value="2"></i><b>(2)</b>
WHERE sourceairport = "SFO"
LIMIT 1;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The keyspace is not given an explicit alias in the query.
You must therefore refer to the keyspace using the keyspace name or implicit alias&#8201;&#8212;&#8201;in this case, <code>route</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The implicit alias is the last element in the keyspace path.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you examine the plan for this query, you can see that the query uses the suggested index.</p>
</div>
<div class="listingblock">
<div class="title">Explain plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/index-hint.jsonc#L25-L28">"scan": {
  "#operator": "IndexScan3",
  "bucket": "travel-sample",
  "index": "def_inventory_route_route_src_dst_day",</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="legacy-equivalent"><a class="anchor" href="#legacy-equivalent"></a>Legacy Equivalent</h3>
<div class="paragraph">
<p>This hint is equivalent to the legacy <code>USE INDEX (USING GSI)</code> clause.
For more details, refer to <a href="hints.html#use-index-clause" class="xref page">USE INDEX Clause</a>.</p>
</div>
<div class="paragraph">
<p>Note that you cannot use a hint comment and the <code>USE</code> clause to specify optimizer hints on the same keyspace.
If you do this, the hint comment and the <code>USE</code> clause are marked as erroneous and ignored by the optimizer.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="index_fts"><a class="anchor" href="#index_fts"></a>INDEX_FTS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This hint directs the optimizer to consider one or more specified full-text indexes.
If not specified, the optimizer selects the optimal available index.</p>
</div>
<div class="sect2">
<h3 id="simple-syntax-2"><a class="anchor" href="#simple-syntax-2"></a>Simple Syntax</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L40">fts-hint-simple ::= 'INDEX_FTS' '(' keyspace index* ')'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/fts-hint-simple.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>With the simple syntax, this hint specifies a single keyspace expression; and zero, one, or more indexes.
You can use this hint multiple times within the hint comment to specify hints for more than one keyspace.</p>
</div>
<div class="sect3">
<h4 id="arguments-2"><a class="anchor" href="#arguments-2"></a>Arguments</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">keyspace</dt>
<dd>
<p>The keyspace or alias to which this hint applies.</p>
</dd>
<dt class="hdlist1">index</dt>
<dd>
<p>A full-text index that the optimizer should consider for the given keyspace.
This argument is optional; if omitted, the optimizer considers <em>all</em> full-text indexes available in the given keyspace.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="json-syntax-2"><a class="anchor" href="#json-syntax-2"></a>JSON Syntax</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L72">fts-hint-json ::= '"index_fts"' ':' ( index-array | index-object )</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/fts-hint-json.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>With the JSON syntax, this hint takes the form of an <code>index_fts</code> property.
You may only use this property once within the hint comment.
The value of this property may be an <a href="#index-array-fts">Index Array</a> or an <a href="#index-object-fts">Index Object</a>.</p>
</div>
<div class="sect3">
<h4 id="index-array-fts"><a class="anchor" href="#index-array-fts"></a>Index Array</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L84">index-array ::= '[' index-object ( ',' index-object )* ']'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/index-array.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Use this array to specify indexes for multiple keyspaces.
Each element must be an <a href="#index-object-fts">Index Object</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="index-object-fts"><a class="anchor" href="#index-object-fts"></a>Index Object</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L88">index-object ::= '{' keyspace-property ',' indexes-property '}'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/index-object.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Use this object to specify indexes for a single keyspace.
It must contain a <a href="#keyspace-property-fts">Keyspace Property</a> and an <a href="#indexes-property-fts">Indexes Property</a>.
The order of the properties within the object is not significant.</p>
</div>
</div>
<div class="sect3">
<h4 id="keyspace-property-fts"><a class="anchor" href="#keyspace-property-fts"></a>Keyspace Property</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L106">keyspace-property ::= ( '"keyspace"' | '"alias"' ) ':' '"' keyspace '"'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/keyspace-property.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Synonym for <code>"keyspace"</code>: <code>"alias"</code></p>
</div>
<div class="paragraph">
<p>The value of this property is the keyspace or alias to which this hint applies.</p>
</div>
</div>
<div class="sect3">
<h4 id="indexes-property-fts"><a class="anchor" href="#indexes-property-fts"></a>Indexes Property</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L92-L94">indexes-property ::= '"indexes"' ':' ( 'null'
                                     | '"' index '"'
                                     | '[' '"' index '"' ( ',' '"' index '"' )* ']' )</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/indexes-property.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>The value of this property may be:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>null</code>
</td>
<td class="hdlist2">
<p>The optimizer considers all full-text indexes available in the given keyspace.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<em>index</em> string
</td>
<td class="hdlist2">
<p>A full-text index that the optimizer should consider for the given keyspace.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<em>index</em> array
</td>
<td class="hdlist2">
<p>An array of full-text indexes that the optimizer should consider for the given keyspace.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="index-fts-examples"><a class="anchor" href="#index-fts-examples"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/keyspace-hints.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div id="ex-index-fts-hint" class="exampleblock">
<div class="title">INDEX_FTS hint</div>
<div class="content">
<div class="paragraph">
<p>This example specifies that the optimizer should prefer any suitable FTS index, without specifying an index by name.
To qualify for this query, there must be an FTS index on <code>state</code> and <code>type</code>, using the keyword analyzer.
(Or alternatively, an FTS index on <code>state</code>, with a custom type mapping on "hotel".)</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT /*+ INDEX_FTS (hotel) */
       META().id
FROM hotel
WHERE state = "Corse" OR state = "California";</code></pre>
</div>
</div>
<div class="paragraph">
<p>All FTS indexes are considered.
If a qualified FTS index is available, it is selected for the query.
If none of the available FTS indexes are qualified, the available GSI indexes are considered instead.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="legacy-equivalent-2"><a class="anchor" href="#legacy-equivalent-2"></a>Legacy Equivalent</h3>
<div class="paragraph">
<p>This hint is equivalent to the legacy <code>USE INDEX (USING FTS)</code> clause.
For more details, refer to <a href="hints.html#use-index-clause" class="xref page">USE INDEX Clause</a>.</p>
</div>
<div class="paragraph">
<p>Note that you cannot use a hint comment and the <code>USE</code> clause to specify optimizer hints on the same keyspace.
If you do this, the hint comment and the <code>USE</code> clause are marked as erroneous and ignored by the optimizer.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use_nl"><a class="anchor" href="#use_nl"></a>USE_NL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This hint directs the optimizer to consider a nested-loop join for the specified keyspace.
This hint must be specified on the keyspace on the right-hand side of the join.
If not specified, the optimizer selects the optimal join method.</p>
</div>
<div class="sect2">
<h3 id="simple-syntax-3"><a class="anchor" href="#simple-syntax-3"></a>Simple Syntax</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L44">nl-hint-simple ::= 'USE_NL' '(' ( keyspace )+ ')'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/nl-hint-simple.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>With the simple syntax, this hint specifies one or more keyspaces.
You may also use this hint multiple times within the hint comment.</p>
</div>
<div class="sect3">
<h4 id="arguments-3"><a class="anchor" href="#arguments-3"></a>Arguments</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">keyspace</dt>
<dd>
<p>The keyspace or alias to which this hint applies.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="json-syntax-3"><a class="anchor" href="#json-syntax-3"></a>JSON Syntax</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L76">nl-hint-json ::= '"use_nl"' ':' ( keyspace-array | keyspace-object )</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/nl-hint-json.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>With the JSON syntax, this hint takes the form of a <code>use_nl</code> property.
You may only use this property once within the hint comment.
The value of this property may be a <a href="#keyspace-array">Keyspace Array</a> or a <a href="#keyspace-object">Keyspace Object</a>.</p>
</div>
<div class="sect3">
<h4 id="keyspace-array"><a class="anchor" href="#keyspace-array"></a>Keyspace Array</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L98">keyspace-array ::= '[' keyspace-object ( ',' keyspace-object )* ']'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/keyspace-array.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Use this array to apply the hint to multiple keyspaces.
Each element must be a <a href="#keyspace-object">Keyspace Object</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="keyspace-object"><a class="anchor" href="#keyspace-object"></a>Keyspace Object</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L102">keyspace-object ::= '{' keyspace-property '}'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/keyspace-object.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Use this object to apply the hint to a single keyspace.
It must contain a <a href="#keyspace-property-nl">Keyspace Property</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="keyspace-property-nl"><a class="anchor" href="#keyspace-property-nl"></a>Keyspace Property</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L106">keyspace-property ::= ( '"keyspace"' | '"alias"' ) ':' '"' keyspace '"'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/keyspace-property.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Synonym for <code>"keyspace"</code>: <code>"alias"</code></p>
</div>
<div class="paragraph">
<p>The value of this property is the keyspace or alias to which this hint applies.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use-nl-examples"><a class="anchor" href="#use-nl-examples"></a>Examples</h3>
<div class="paragraph">
<p>For the examples in this section, it is assumed that the cost-based optimizer is active, and all optimizer statistics are up-to-date.</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/keyspace-hints.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div id="ex-use-nl-opt" class="exampleblock">
<div class="title">Optimized join method selection</div>
<div class="content">
<div class="paragraph">
<p>The following query does not include a join hint.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-nl-opt.n1ql#L6-L11">SELECT a.airportname AS airport, r.id AS route
FROM route AS r,
     airport AS a
WHERE a.faa = r.sourceairport
  AND r.sourceairport = "SFO"
LIMIT 4;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you examine the plan for this query, you can see that the optimizer has selected the hash join method.</p>
</div>
<div class="listingblock">
<div class="title">Explain plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-nl-opt.jsonc#L72-L73">{
  "#operator": "HashJoin",</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-use-nl-hint" class="exampleblock">
<div class="title">USE_NL hint</div>
<div class="content">
<div class="paragraph">
<p>The following query is equivalent to the one in the <a href="#ex-use-nl-opt">Optimized join method selection</a> example, but includes a nested-loop join hint.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-nl-hint.n1ql#L6-L12">SELECT /*+ USE_NL (a) */ <i class="conum" data-value="1"></i><b>(1)</b>
       a.airportname AS airport, r.id AS route
FROM route AS r,
     airport AS a <i class="conum" data-value="2"></i><b>(2)</b>
WHERE a.faa = r.sourceairport
  AND r.sourceairport = "SFO"
LIMIT 4;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The keyspace is given an explicit alias in the query.
You must therefore refer to the keyspace using the explicit alias.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In this case, the explicit alias is <code>a</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you examine the plan text for this query, you can see that the query uses the suggested join method.</p>
</div>
<div class="listingblock">
<div class="title">Explain plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-nl-hint.jsonc#L70-L71">{
  "#operator": "NestedLoopJoin",</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="legacy-equivalent-3"><a class="anchor" href="#legacy-equivalent-3"></a>Legacy Equivalent</h3>
<div class="paragraph">
<p>This hint is equivalent to the legacy <code>USE NL</code> clause.
For more details, refer to <a href="join.html#use-nl-hint" class="xref page">USE NL Clause</a>.</p>
</div>
<div class="paragraph">
<p>Note that you cannot specify optimizer hints and the <code>USE</code> clause on the same keyspace in the same query.
If you do this, the optimizer hints and <code>USE</code> clause are both marked as erroneous and ignored by the optimizer.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use_hash"><a class="anchor" href="#use_hash"></a>USE_HASH</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="edition"><a href="https://www.couchbase.com/products/editions">ENTERPRISE EDITION</a></span></p>
</div>
<div class="paragraph">
<p>This hint directs the optimizer to consider a hash join for the specified keyspace.
This hint must be specified on the keyspace on the right-hand side of the join.
If not specified, the optimizer selects the optimal join method.</p>
</div>
<div class="paragraph">
<p>A hash join has two sides: a <strong>build</strong> side and a <strong>probe</strong> side.
The build side of the join is used to create an in-memory hash table.
The probe side uses that table to find matches and perform the join.
Typically, this means you want the build side to be used on the smaller of the two sets.</p>
</div>
<div class="paragraph">
<p>This hint enables you specify whether the right side of the join should be the build side or the probe side.
If you specify that the right side of the join is the build side, then the left side will be the probe side, and vice versa.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Couchbase Server Community Edition (CE), only nested-loop join is considered by the optimizer, and any specified <code>USE_HASH</code> hint will be silently ignored.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="simple-syntax-4"><a class="anchor" href="#simple-syntax-4"></a>Simple Syntax</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L48">hash-hint-simple ::= 'USE_HASH' '(' ( keyspace ( '/' ( 'BUILD' | 'PROBE' ) )? )+ ')'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/hash-hint-simple.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>With the simple syntax, this hint specifies one or more keyspaces.
For each keyspace, you may also add a slash, followed by an option.
You may also use this hint multiple times within the hint comment.</p>
</div>
<div class="sect3">
<h4 id="arguments-4"><a class="anchor" href="#arguments-4"></a>Arguments</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">keyspace</dt>
<dd>
<p>The keyspace or alias to which this hint applies.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="options"><a class="anchor" href="#options"></a>Options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">/BUILD</dt>
<dd>
<p>The specified keyspace is to be used as the build side of the join.</p>
</dd>
<dt class="hdlist1">/PROBE</dt>
<dd>
<p>The specified keyspace is to be used as the probe side of the join.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If you omit the option (including the slash), the optimizer determines whether the specified keyspace is to be used as the build side or the probe side of the join, based on the estimated cardinality of both sides.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="json-syntax-4"><a class="anchor" href="#json-syntax-4"></a>JSON Syntax</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L80">hash-hint-json ::= '"use_hash"' ':' ( hash-array | hash-object )</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/hash-hint-json.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>With the JSON syntax, this hint takes the form of a <code>use_hash</code> property.
You may only use this property once within the hint comment.
The value of this property may be a <a href="#hash-array">Hash Array</a> or a <a href="#hash-object">Hash Object</a>.</p>
</div>
<div class="sect3">
<h4 id="hash-array"><a class="anchor" href="#hash-array"></a>Hash Array</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L110">hash-array ::= '[' hash-object ( ',' hash-object )* ']'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/hash-array.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Use this array to apply the hint to multiple keyspaces.
Each element must be a <a href="#hash-object">Hash Object</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hash-object"><a class="anchor" href="#hash-object"></a>Hash Object</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L114">hash-object ::= '{' keyspace-property ( "," option-property )? '}'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/hash-object.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Use this object to apply the hint to a single keyspace.
It must contain a <a href="#keyspace-property-hash">Keyspace Property</a> and an optional <a href="#option-property">Option Property</a>.
The order of the properties within the object is not significant.</p>
</div>
</div>
<div class="sect3">
<h4 id="keyspace-property-hash"><a class="anchor" href="#keyspace-property-hash"></a>Keyspace Property</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L106">keyspace-property ::= ( '"keyspace"' | '"alias"' ) ':' '"' keyspace '"'</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/keyspace-property.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>Synonym for <code>"keyspace"</code>: <code>"alias"</code></p>
</div>
<div class="paragraph">
<p>The value of this property is the keyspace or alias to which this hint applies.</p>
</div>
</div>
<div class="sect3">
<h4 id="option-property"><a class="anchor" href="#option-property"></a>Option Property</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ebnf hljs" data-lang="ebnf" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/partials/grammar/hints.ebnf#L118">option-property ::= '"option"' ':' ( '"build"' | '"probe"' | 'null' )</code></pre>
</div>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/n1ql-language-reference/option-property.png" alt="Syntax diagram: refer to source code listing">
</div>
</div>
<div class="paragraph">
<p>The value of this property may be:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>"build"</code>
</td>
<td class="hdlist2">
<p>The specified keyspace is to be used as the build side of the join.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>"probe"</code>
</td>
<td class="hdlist2">
<p>The specified keyspace is to be used as the probe side of the join.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>null</code>
</td>
<td class="hdlist2">
<p>The optimizer determines whether the specified keyspace is to be used as the build side or the probe side of the join, based on the estimated cardinality of both sides.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Similarly, if you omit this property entirely, the optimizer determines whether the specified keyspace is to be used as the build side or the probe side of the join.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use-hash-examples"><a class="anchor" href="#use-hash-examples"></a>Examples</h3>
<div class="paragraph">
<p>For the examples in this section, it is assumed that the cost-based optimizer is active, and all optimizer statistics are up-to-date.</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/keyspace-hints.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div id="ex-use-hash-opt" class="exampleblock">
<div class="title">Optimized join method selection</div>
<div class="content">
<div class="paragraph">
<p>The following query does not include a join hint.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-hash-opt.n1ql#L6-L9">SELECT COUNT(1) AS Total_Count
FROM route rte
INNER JOIN airline aline
ON rte.airlineid = META(aline).id;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you examine the plan for this query, you can see that the optimizer has selected to use the hash join method, and to put the <code>aline</code> keyspace on the build side of the join.</p>
</div>
<div class="listingblock">
<div class="title">Explain plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-hash-opt.jsonc">{
  "#operator": "HashJoin",
  "build_aliases": [
    "aline"
  ],
  "build_exprs": [
    "cover ((meta(`aline`).`id`))"
  ],
  "on_clause": "(((`rte`.`airlineid`) = cover ((meta(`aline`).`id`))))",
// ...
  "probe_exprs": [
    "(`rte`.`airlineid`)"
  ],</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-use-hash-probe-hint" class="exampleblock">
<div class="title">USE_HASH with PROBE</div>
<div class="content">
<div class="paragraph">
<p>The following query is equivalent to the one in the <a href="#ex-use-hash-opt">Optimized join method selection</a> example, but specifies that the keyspace <code>aline</code> is to be joined (with <code>rte</code>) using a hash join, and <code>aline</code> is used as the probe side of the hash join.</p>
</div>
<div class="listingblock">
<div class="title">Query&#8201;&#8212;&#8201;simple syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-hash-probe-hint.n1ql#L6-L10">SELECT /*+ USE_HASH (aline/PROBE) */
       COUNT(1) AS Total_Count
FROM route rte
INNER JOIN airline aline
ON rte.airlineid = META(aline).id;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you examine the explain plan for this query, you can see that the query uses the hash join method as suggested, with the <code>aline</code> keyspace on the probe side of the join.</p>
</div>
<div class="listingblock">
<div class="title">Explain plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-hash-probe-hint.jsonc">{
  "#operator": "HashJoin",
  "build_aliases": [
    "rte"
  ],
  "build_exprs": [
    "(`rte`.`airlineid`)"
  ],
  "on_clause": "(((`rte`.`airlineid`) = cover ((meta(`aline`).`id`))))",
// ...
  "probe_exprs": [
    "cover ((meta(`aline`).`id`))"
  ],</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-use-hash-build-hint" class="exampleblock">
<div class="title">USE_HASH with BUILD</div>
<div class="content">
<div class="paragraph">
<p>This is effectively the same query as the <a href="#ex-use-hash-probe-hint">USE_HASH with PROBE</a> example, except the two keyspaces are switched, and here the <code>BUILD</code> option is used, indicating the hash join should use <code>rte</code> as the build side.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-hash-build-hint.n1ql#L6-L10">SELECT /*+ { "use_hash": { "keyspace": "rte", "option": "build" } } */
       COUNT(1) AS Total_Count
FROM airline aline
INNER JOIN route rte
ON (rte.airlineid = META(aline).id);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you examine the explain plan for this query, you can see that the query uses the hash join method as suggested, with the <code>rte</code> keyspace on the build side.</p>
</div>
<div class="listingblock">
<div class="title">Explain plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-hash-probe-hint.jsonc">{
  "#operator": "HashJoin",
  "build_aliases": [
    "rte"
  ],
  "build_exprs": [
    "(`rte`.`airlineid`)"
  ],
  "on_clause": "(((`rte`.`airlineid`) = cover ((meta(`aline`).`id`))))",
// ...
  "probe_exprs": [
    "cover ((meta(`aline`).`id`))"
  ],</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-use-hash-null-hint" class="exampleblock">
<div class="title">USE_HASH with optimizer</div>
<div class="content">
<div class="paragraph">
<p>This is the same query as the <a href="#ex-use-hash-probe-hint">USE_HASH with PROBE</a> example, but the hint does not specify whether the <code>aline</code> keyspace should be on the probe side or the build side of the join.</p>
</div>
<div class="listingblock">
<div class="title">Query&#8201;&#8212;&#8201;JSON syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-hash-null-hint.n1ql#L6-L10">SELECT /*+ USE_HASH (aline) */
       COUNT(1) AS Total_Count
FROM route rte
INNER JOIN airline aline
ON rte.airlineid = META(aline).id;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you examine the explain plan for this query, you can see that the query uses the hash join method as suggested, but the optimizer has selected to put the <code>aline</code> keyspace on the build side of the join.</p>
</div>
<div class="listingblock">
<div class="title">Explain plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/select/use-hash-null-hint.jsonc">{
  "#operator": "HashJoin",
  "build_aliases": [
    "aline"
  ],
  "build_exprs": [
    "cover ((meta(`aline`).`id`))"
  ],
  "on_clause": "(((`rte`.`airlineid`) = cover ((meta(`aline`).`id`))))",
// ...
  "probe_exprs": [
    "(`rte`.`airlineid`)"
  ],</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="legacy-equivalent-4"><a class="anchor" href="#legacy-equivalent-4"></a>Legacy Equivalent</h3>
<div class="paragraph">
<p>This hint is equivalent to the legacy <code>USE HASH</code> clause.
For more details, refer to <a href="join.html#use-hash-hint" class="xref page">USE HASH Clause</a>.</p>
</div>
<div class="paragraph">
<p>Note that you cannot specify both optimizer hints and the <code>USE</code> clause on the same keyspace.
If you do this, the optimizer hints and the <code>USE</code> clause are both marked as erroneous and ignored by the optimizer.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-links"><a class="anchor" href="#related-links"></a>Related Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="cost-based-optimizer.html" class="xref page">Cost-Based Optimizer</a></p>
</li>
<li>
<p><a href="optimizer-hints.html" class="xref page">Optimizer Hints</a></p>
</li>
<li>
<p><a href="query-hints.html" class="xref page">Query Block Hints</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
