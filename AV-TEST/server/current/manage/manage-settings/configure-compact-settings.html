<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Auto-Compaction | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Auto-Compaction settings determine the &lt;em&gt;compaction process&lt;/em&gt;; whereby databases and their respective view-indexes are compacted.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/manage/manage-settings/configure-compact-settings.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/manage/pages/manage-settings/configure-compact-settings.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Manage</li>
<li class="crumb"><a href="manage-settings.html">Manage Settings</a></li>
<li class="crumb"><a href="configure-compact-settings.html">Auto-Compaction</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Auto-Compaction</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Auto-Compaction settings determine the <em>compaction process</em>; whereby databases and their respective view-indexes are compacted.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-auto-compaction"><a class="anchor" href="#understanding-auto-compaction"></a>Understanding Auto-Compaction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Auto-Compaction is enabled by default for all Couchbase buckets.
However, settings can be overridden on a per bucket basis.</p>
</div>
<div class="paragraph">
<p>Auto-compaction settings affect <em>on-disk</em> data, and therefore do not apply to Ephemeral buckets.</p>
</div>
<div class="paragraph">
<p>Full and Cluster administrators can configure compaction settings with <a href="#configure-auto-compaction-with-the-ui">Couchbase Web Console</a>, the Couchbase <a href="#configure-auto-compaction-with-the-cli">CLI</a>, or the <a href="#configure-auto-compaction-with-the-rest-api">REST</a> API.</p>
</div>
<div class="paragraph">
<p>Note that in Couchbase Server Enterprise Edition, auto-compaction does not apply to memory-optimized index storage, and there are no settings necessary for configuring the auto-compaction of Global Secondary Indexes using standard index storage.
However, for installations of Couchbase Server Enterprise Edition running on Linux, note that hole punching is required to enable auto-compaction of Global Secondary Indexes using standard index storage.
See <a href="#learn:services-and-indexes/indexes/storage-modes.adoc#standard-index-storage" class="xref unresolved">Standard Index Storage</a>, for information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-auto-compaction-with-the-ui"><a class="anchor" href="#configure-auto-compaction-with-the-ui"></a>Configure Auto-Compaction with the UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instructions on accessing Auto-Compaction settings are provided below.</p>
</div>
<div class="sect2">
<h3 id="for-a-new-bucket"><a class="anchor" href="#for-a-new-bucket"></a>For a New Bucket</h3>
<div class="paragraph">
<p>To access the auto-compaction settings-panel for an new, individual bucket, proceed as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the <strong>Buckets</strong> screen provided by the Couchbase Web Console.
Left-click on the <strong>ADD BUCKET</strong> tab:</p>
<div id="add-bucket-button" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/addBucketButton.png" alt="addBucketButton" width="100">
</div>
</div>
</li>
<li>
<p>When the <strong>Add Data Bucket</strong> dialog appears, add appropriate data into the initial fields; then left-click on the <strong class="ui">Advanced bucket settings</strong> tab:</p>
<div id="show_advanced_settings" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/show-advanced-settings.png" alt="show advanced settings" width="360">
</div>
</div>
<div class="paragraph">
<p>The dialog now expands, and displays additional configuration-options.</p>
</div>
</li>
<li>
<p>Access the <strong class="ui">Auto-Compaction</strong> panel, and check the <strong class="ui">Override the default auto-compaction settings?</strong> checkbox:</p>
<div id="override_default_auto_compaction" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/override-default-auto-compaction.png" alt="override default auto compaction" width="370">
</div>
</div>
<div class="paragraph">
<p>The dialog expands again, and displays Auto-Compaction settings available for this bucket.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="for-an-existing-bucket"><a class="anchor" href="#for-an-existing-bucket"></a>For an Existing Bucket</h3>
<div class="paragraph">
<p>To access the auto-compaction settings-panel for an individual, existing bucket, proceed as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Left-click on the information-row for the bucket, on the <strong>Buckets</strong> screen of Couchbase Web Console.
When the <strong>Edit</strong> button appears, left-click on it:</p>
<div id="edit-bucket-definition-button" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/edit-bucket-definition-button.png" alt="edit bucket definition button" width="300">
</div>
</div>
<div class="paragraph">
<p>This brings up the <strong class="ui">Edit Bucket Settings</strong> dialog.</p>
</div>
</li>
<li>
<p>Left-click on the <strong class="ui">Show advanced bucket settings</strong> tab.</p>
</li>
<li>
<p>Access the <strong class="ui">Auto-Compaction</strong> panel, and check the <strong class="ui">Override the default auto-compaction settings?</strong> checkbox.
The dialog expands, thereby showing the available Auto-Compaction settings.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="for-no-override-buckets"><a class="anchor" href="#for-no-override-buckets"></a>To Establish Defaults for All Buckets</h3>
<div class="paragraph">
<p>To access the auto-compaction settings-screen that provides defaults for all buckets not otherwise assigned customized settings, proceed as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Left-click on the <strong class="ui">Settings</strong> tab, in the vertical navigation-bar at the left-hand side.</p>
</li>
<li>
<p>When the <strong class="ui">Settings</strong> screen appears, left-click on the <strong class="ui">Auto-Compaction</strong> tab, on the horizontal control-bar at the top:</p>
<div id="auto_compaction_tab" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/auto-compaction-tab.png" alt="auto compaction tab" width="360">
</div>
</div>
<div class="paragraph">
<p>This brings up the <strong class="ui">Auto-Compaction</strong> screen.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="establishing-auto-compaction-settings"><a class="anchor" href="#establishing-auto-compaction-settings"></a>Establishing Auto-Compaction Settings</h3>
<div class="paragraph">
<p>The <strong class="ui">Auto-Compaction</strong> view of the <strong class="ui">Settings</strong> screen appears as follows.
(Note that the <strong class="ui">Index Fragmentation</strong> settings are only displayed for Couchbase Server Community Edition.)</p>
</div>
<div id="auto_compact_defaultNewUI" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/auto-compact-defaultNewUI.png" alt="auto compact defaultNewUI" width="820">
</div>
</div>
<div class="paragraph">
<p>All settings on this screen are also provided on the dialogs whereby you establish custom-settings for an individual new or existing bucket&#8201;&#8212;&#8201;with the exception of the settings for <a href="#index-fragmentation">Index Fragmentation</a>, which can only be established on a cluster-wide basis.</p>
</div>
<div class="paragraph">
<p>Settings constitute <em>conditions</em>, which must be met for the compaction-process to be triggered.
The settings are described below.</p>
</div>
</div>
<div class="sect2">
<h3 id="database-fragmentation"><a class="anchor" href="#database-fragmentation"></a>Database Fragmentation</h3>
<div class="paragraph">
<p>The <strong class="ui">Database Fragmentation</strong> panel appears as follows:</p>
</div>
<div id="database_fragmentationNewUI" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/database-fragmentationNewUI.png" alt="database fragmentationNewUI" width="420">
</div>
</div>
<div class="paragraph">
<p>Compaction is triggered when database-fragmentation reaches the point specified by means of this interface.
You can specify the fragmentation-level as a percentage (the upper field, selected by checking the adjacent checkbox); or as a number of megabytes (the lower).</p>
</div>
</div>
<div class="sect2">
<h3 id="view-fragmentation"><a class="anchor" href="#view-fragmentation"></a>View Fragmentation</h3>
<div class="paragraph">
<p>The <strong class="ui">View Fragmentation</strong> panel appears as follows:</p>
</div>
<div id="view_fragmentation_interface" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/view-fragmentation-interface.png" alt="view fragmentation interface" width="420">
</div>
</div>
<div class="paragraph">
<p>Compaction is triggered when view-fragmentation reaches the point specified by means of this interface.
You can specify the fragmentation-level as a percentage (the upper field, selected by checking the adjacent checkbox); or as a number of megabytes (the lower).</p>
</div>
</div>
<div class="sect2">
<h3 id="time-interval"><a class="anchor" href="#time-interval"></a>Time Interval</h3>
<div class="paragraph">
<p>The <strong class="ui">Time Interval</strong> pane provides a number of settings whereby compaction is scheduled:</p>
</div>
<div id="time_interval_interface" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/time-interval-interface.png" alt="time interval interface" width="420">
</div>
</div>
<div class="paragraph">
<p>To set a time-interval during which compaction is permitted to run, check the checkbox at the top of the pane.
Then, add a start and an end time into the interactive fields.
Note that each left-hand field specifies the hour-of-the-day; while each right-hand specifies the minute-of-the-hour.</p>
</div>
<div class="paragraph">
<p>Checkboxes are provided to allow you to specify: first, that compaction can be aborted if the specified time is exceeded; secondly, that database and view compaction are executed simultaneously (implying a heavier processing and disk I/O load, during the compaction-process).</p>
</div>
<div class="paragraph">
<p>For example, the following, completed <strong class="ui">Time Interval</strong> pane specifies that compaction should run between 1:00 am and 2:30 am; should be aborted if not completed in time; and should feature parallel compaction of database and indexes:</p>
</div>
<div id="time_interval_interface_completed" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/time-interval-interface-completed.png" alt="time interval interface completed" width="310">
</div>
</div>
</div>
<div class="sect2">
<h3 id="index-fragmentation"><a class="anchor" href="#index-fragmentation"></a>Index Fragmentation</h3>
<div class="paragraph">
<p>The <strong class="ui">Index Fragmentation</strong> panel, which is only available in Couchbase Server Community Edition, provides settings that cannot be overridden at individual bucket-level.
The panel appears as follows:</p>
</div>
<div id="index_fragmentation" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/index-fragmentation.png" alt="index fragmentation" width="520">
</div>
</div>
<div class="paragraph">
<p>This interface sets the write-strategy and trigger-point for compaction.</p>
</div>
<div class="paragraph">
<p>Select from the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Append-only write mode with index fragmentation level trigger</strong>.
Turns on <em>append only</em> writes for index-storage, and triggers the compaction-job based on the fragmentation-level of each index file.
Check the checkbox, then specify a fragmentation-level as a percentage, in the interactive text-field.</p>
</li>
<li>
<p><strong>Circular write mode with day + time interval trigger</strong>.
Turns on writes with <em>circular reuse</em> for index-storage, and triggers the compaction-job based on a time-interval.
To specify when compaction is permitted to run, select appropriate <em>days of the week</em>, by checking the appropriate checkboxes; then, select the start-time on each of those days; and optionally, an end-time.</p>
<div class="paragraph">
<p>Optionally, check the <strong class="ui">Abort compaction if run time exceeds the set time interval</strong> checkbox: if you do so, compaction is aborted if the specified end-time is exceeded.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that whenever you change the compaction settings for the index, the system starts the global secondary index process on all the nodes.</p>
</div>
<div class="paragraph">
<p>See <a href="#learn:services-and-indexes/indexes/storage-modes.adoc#standard-index-storage" class="xref unresolved">Standard Index Storage</a> for information on append-only and circular write modes.</p>
</div>
</div>
<div class="sect2">
<h3 id="tombstone-purge-interval"><a class="anchor" href="#tombstone-purge-interval"></a>Metadata Purge Interval</h3>
<div class="paragraph">
<p>Sets the frequency of the metadata (or <em>tombstone</em>) purge interval, for <em>Couchbase</em> buckets only.
The default value is three days.</p>
</div>
<div class="paragraph">
<p>The panel appears as follows:</p>
</div>
<div id="meta_data_purge_interface" class="imageblock text-left">
<div class="content">
<img src="../_images/manage-settings/meta-data-purge-interface.png" alt="meta data purge interface" width="240">
</div>
</div>
<div class="paragraph">
<p><em>Tombstones</em> are records of expired or deleted items.
They include key and metadata.
Tombstones are used in Couchbase Server to provide eventual consistency of data between clusters.
The specified number of days will elapse before tombstones for expired or deleted items are <em>permanently</em> removed.
The default value is three days.
The permitted range of values is <code>0.04</code> to <code>60</code> (where <code>0.04</code> equals one hour, and <code>1</code> equals one day.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you set this value too low, you may see inconsistent results in Views queries, such as deleted items appearing in a result set.
You may also see inconsistent items across clusters, if XDCR has been set up between the clusters.</p>
</div>
<div class="paragraph">
<p>If the metadata purge interval is set too low, it can also cause severe issues with transactions, especially for ephemeral buckets.</p>
</div>
<div class="paragraph">
<p>If you set this value too high, it delays Couchbase Server from reclaiming disk space.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <strong>Metadata Purge Interval</strong> panel on this screen establishes a default purge interval for <em>Couchbase buckets only</em>.
Therefore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a Couchbase bucket is left at its default setting, any change made here to the default value duly changes the frequency of metadata purges for that bucket.</p>
</li>
<li>
<p>If a Couchbase bucket has already been given a customized setting, no change made here to the default value has any effect on the frequency of metadata purges for that bucket.
For information on providing customized settings, see <a href="../manage-buckets/create-bucket.html" class="xref page">Create a Bucket</a> and <a href="../manage-buckets/edit-bucket.html" class="xref page">Edit a Bucket</a>.</p>
</li>
<li>
<p>Neither the default nor the customized frequency of metadata purges for any Ephemeral bucket is affected by changes made here.
Note that although the default interval for Ephemeral buckets is, as with Couchbase buckets, <code>3</code>, only <em>per bucket</em> interval-changes can be made, for Ephemeral buckets: the default interval for Ephemeral buckets cannot be changed globally.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="../../learn/buckets-memory-and-storage/storage-settings.html" class="xref page">Storage Settings</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-auto-compaction-with-the-cli"><a class="anchor" href="#configure-auto-compaction-with-the-cli"></a>Configure Auto-Compaction with the CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure auto-compaction with the CLI, use the <a href="#cli:cbcli/couchbase-cli-setting-compaction.adoc" class="xref unresolved">setting-compaction</a> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">/opt/couchbase/bin/couchbase-cli setting-compaction \
--cluster 10.143.192.101 \
--username Administrator \
--password password \
--compaction-db-percentage 30 \
--compaction-db-size 1024 \
--compaction-view-percentage 30 \
--compaction-view-size 1024 \
--compaction-period-from 00:00 \
--compaction-period-to 06:00 \
--enable-compaction-abort 1 \
--enable-compaction-parallel 0 \
--metadata-purge-interval 3 \
--gsi-compaction-mode circular \
--compaction-gsi-interval Monday,Wednesday,Friday \
--compaction-gsi-period-from 06:00 \
--compaction-gsi-period-to 09:00 \
--enable-gsi-compaction-abort 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>compaction</code>-related flags correspond to the UI fields described above in <a href="#database-fragmentation">Database Fragmentation</a> and <a href="#view-fragmentation">View Fragmentation</a>; and also to the associated <a href="#time-interval">Time Interval</a> fields. The GSI compaction mode is specified as <code>circular</code>; and other <code>gsi</code>-related flags correspond to the fields in the lower part of the <a href="#time-interval">Time Interval</a> panel, which correspond to index compaction. Parallel compaction is disabled, with the <code>--enable-compaction-parallel</code> flag; and GSI compaction is enabled to abort, with the <code>--enable-gsi-compaction-abort</code> flag.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-auto-compaction-with-the-rest-api"><a class="anchor" href="#configure-auto-compaction-with-the-rest-api"></a>Configure Auto-Compaction with the REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To return current auto-compaction settings by means of the REST API, use the <code>/settings/autoCompaction</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">curl -i -X GET -u Administrator:password \
http://127.0.0.1:8091/settings/autoCompaction</code></pre>
</div>
</div>
<div class="paragraph">
<p>If successful, this returns a JSON document containing the current settings.
Formatted, this might appear as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "autoCompactionSettings": {
    "parallelDBAndViewCompaction": true,
    "allowedTimePeriod": {
      "fromHour": 0,
      "toHour": 2,
      "fromMinute": 0,
      "toMinute": 0,
      "abortOutside": false
    },
    "databaseFragmentationThreshold": {
      "percentage": 30,
      "size": 536870912
    },
    "viewFragmentationThreshold": {
      "percentage": 30,
      "size": 536870912
    },
    "indexCompactionMode": "full",
    "indexCircularCompaction": {
      "daysOfWeek": "Monday,Wednesday,Friday",
      "interval": {
        "fromHour": 6,
        "toHour": 9,
        "fromMinute": 0,
        "toMinute": 0,
        "abortOutside": true
      }
    },
    "indexFragmentationThreshold": {
      "percentage": 30
    }
  },
  "purgeInterval": 4
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="../../rest-api/rest-memory-and-storage.html" class="xref page">Getting Auto-Compaction Settings</a>, for more information.</p>
</div>
<div class="paragraph">
<p>To modify auto-compaction settings, use the <code>/controller/setAutoCompaction</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">curl -i -X POST http://10.143.192.101:8091/controller/setAutoCompaction \
-u Administrator:password \
-d databaseFragmentationThreshold[percentage]=30 \
-d databaseFragmentationThreshold[size]=1073741824 \
-d viewFragmentationThreshold[percentage]=30 \
-d viewFragmentationThreshold[size]=1073741824 \
-d allowedTimePeriod[fromHour]=0 \
-d allowedTimePeriod[fromMinute]=0 \
-d allowedTimePeriod[toHour]=6 \
-d allowedTimePeriod[toMinute]=0 \
-d allowedTimePeriod[abortOutside]=true \
-d parallelDBAndViewCompaction=false \
-d purgeInterval=3.0 \
-d indexCompactionMode=circular \
-d indexCircularCompaction[daysOfWeek]=Monday,Wednesday,Friday \
-d indexCircularCompaction[interval][fromHour]=6 \
-d indexCircularCompaction[interval][fromMinute]=0 \
-d indexCircularCompaction[interval][toHour]=9 \
-d indexCircularCompaction[interval][toMinute]=0 \
-d indexCircularCompaction[interval][abortOutside]=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example establishes fragmentation thresholds and sizes for database and view, and specifies the time-period during which compaction should occur.
It specifies that compaction be aborted if it should overrun this time-period.
Parallel compaction for database and view is switched <em>off</em>.
The tombstone purge interval is set to 3 days; and <em>circular</em> standard compaction is specified for particular days and hours.</p>
</div>
<div class="paragraph">
<p>See <a href="../../rest-api/rest-memory-and-storage.html" class="xref page">Setting Auto-Compaction</a>, for more information.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
