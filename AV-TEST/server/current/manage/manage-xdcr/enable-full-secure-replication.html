<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Enable Fully Secure Replications | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="&lt;em&gt;Fully&lt;/em&gt; secure replications handle both authentication and data-transfer via TLS.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/manage/manage-xdcr/enable-full-secure-replication.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/manage/pages/manage-xdcr/enable-full-secure-replication.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Manage</li>
<li class="crumb"><a href="xdcr-management-overview.html">Manage XDCR</a></li>
<li class="crumb"><a href="secure-xdcr-replication.html">Secure a Replication</a></li>
<li class="crumb"><a href="enable-full-secure-replication.html">Fully Secure</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Enable Fully Secure Replications</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<em>Fully</em> secure replications handle both authentication and data-transfer via TLS.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-fully-secure-replications"><a class="anchor" href="#understanding-fully-secure-replications"></a>Understanding Fully Secure Replications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>fully</em> secure replication handles both authentication and data-transfer via TLS.
This can be accomplished in either of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specifying username, password, and root certificate.</p>
</li>
<li>
<p>Specifying root and client certificates, and client private key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For an overview of certificates, see <a href="../../learn/security/certificates.html" class="xref page">Certificates</a>.
For specific details on how to prepare and handle certificates for servers and clients, see <a href="../manage-security/manage-certificates.html" class="xref page">Manage Certificates</a>.</p>
</div>
<div class="paragraph">
<p>Note that if the client certificate has been generated using the root certificate, the client certificate itself must be specified.
Alternatively, if the client certificate has been generated using intermediate certificates, the entire certificate chain — including the client certificate and all intermediate certificates — must be specified.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples-on-this-page-fully-secure-replication"><a class="anchor" href="#examples-on-this-page-fully-secure-replication"></a>Examples on This Page</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The examples in the subsections below show how to secure a replication <em>fully</em>; using the <a href="#enable-fully-secure-replications-with-the-ui">UI</a>, the <a href="#enable-fully-secure-replications-with-the-cli">CLI</a>, and the <a href="#enable-fully-secure-replications-with-the-rest-api">REST API</a> respectively.
As their starting-point, the examples assume the scenario that concluded the page <a href="resume-xdcr-replication.html" class="xref page">Resume a Replication</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enable-fully-secure-replications-with-the-ui"><a class="anchor" href="#enable-fully-secure-replications-with-the-ui"></a>Enable Fully Secure Replications with the UI</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access Couchbase Web Console.
Left-click on the <strong>XDCR</strong> tab, in the right-hand navigation menu.</p>
<div id="left_click_on_xdcr_tab" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-xdcr/left-click-on-xdcr-tab.png" alt="left click on xdcr tab" width="100">
</div>
</div>
<div class="paragraph">
<p>This brings up the <strong class="ui">XDCR Replications</strong> screen.
The upper part of the main panel, entitled <strong>Remote Clusters</strong>, lists the currently defined reference.</p>
</div>
</li>
<li>
<p>Left-click on the <strong>Edit</strong> button, located at the right-hand side of the row:</p>
<div id="references-edit-tab" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-xdcr/left-click-on-edit-button.png" alt="left click on edit button" width="220">
</div>
</div>
<div class="paragraph">
<p>This brings up the partially filled <strong>Edit Remote Cluster</strong> dialog:</p>
</div>
<div id="edit-remote-cluster-dialog" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-xdcr/xdcr-edit-remote-cluster-dialog.png" alt="xdcr edit remote cluster dialog" width="400">
</div>
</div>
</li>
<li>
<p>In the dialog, enter the <strong>Password</strong> for the remote cluster, and check the <strong>Enable Secure Connection</strong> checkbox.
The dialog now expands vertically:</p>
<div id="edit-remote-cluster-dialog-expanded" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-xdcr/xdcr-edit-remote-cluster-dialog-expanded.png" alt="xdcr edit remote cluster dialog expanded" width="400">
</div>
</div>
<div class="paragraph">
<p>The <strong>Half</strong> radio button is checked by default: this means that half-secure replication is selected.
Instead, select the <strong>Full (TLS encrypt password and data)</strong> button.
The dialog again expands vertically, and now appears as follows:</p>
</div>
<div id="xdcr-edit-remote-cluster-full-expanded-initial" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-xdcr/xdcr-edit-remote-cluster-full-expanded-initial.png" alt="xdcr edit remote cluster full expanded initial" width="400">
</div>
</div>
<div class="paragraph">
<p>Proceed in either of the ways explained immediately below.</p>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="specify-full-xdcr-security-with-credentials"><a class="anchor" href="#specify-full-xdcr-security-with-credentials"></a>Specify Username, Password, and Root Certificate</h3>
<div class="paragraph">
<p>This procedure requires access to the root certificate for the destination cluster.
This can be obtained by accessing the destination cluster by means of Couchbase Web Console; and accessing the <strong>Root Certificate</strong> panel, from the <strong>Security</strong> screen.
See <a href="../manage-security/manage-security-settings.html#root-certificate-security-screen-display" class="xref page">Root Certificate</a>.</p>
</div>
<div class="paragraph">
<p>A procedure for substituting a different root certificate for the provided default is provided in <a href="../manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the open <strong>Add</strong> or <strong>Edit</strong> dialog, enter the <strong>Username for Remote Cluster</strong>, and <strong>Password</strong>.</p>
</li>
<li>
<p>Copy and paste the root certificate for the remote cluster into the top interactive pane, below the radio buttons — leaving both of the lower interactive panes blank.</p>
<div class="paragraph">
<p>The dialog now appears approximately as follows:</p>
</div>
<div id="xdcr-edit-remote-cluster-dialog-expanded-with-creds" class="imageblock">
<div class="content">
<img src="../_images/manage-xdcr/xdcr-edit-remote-cluster-dialog-expanded-with-creds.png" alt="xdcr edit remote cluster dialog expanded with creds" width="400">
</div>
</div>
</li>
<li>
<p>Left-click on the <strong>Save</strong> button, at the lower-right of the dialog.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All replications to the edited reference now proceed securely.</p>
</div>
</div>
<div class="sect2">
<h3 id="specify-full-xdcr-security-with-certificates"><a class="anchor" href="#specify-full-xdcr-security-with-certificates"></a>Specify Root and Client Certificates, and Client Private Key</h3>
<div class="paragraph">
<p>This procedure requires access to the root certificate for the destination cluster.
This can be obtained by accessing the destination cluster by means of Couchbase Web Console; and accessing the <strong>Root Certificate</strong> panel, from the <strong>Security</strong> screen.
See <a href="../manage-security/manage-security-settings.html#root-certificate-security-screen-display" class="xref page">Root Certificate</a>.</p>
</div>
<div class="paragraph">
<p>A procedure for substituting a different root certificate for the provided default is provided in <a href="../manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a>.
This also demonstrates how the contents of certificates and keys can be displayed on the command line, and so made available for copying and pasting.</p>
</div>
<div class="paragraph">
<p>Information on creating a corresponding <em>client certificate</em> and <em>client private key</em> is provided in <a href="../manage-security/configure-client-certificates.html" class="xref page">Configure Client Certificates</a>.</p>
</div>
<div class="paragraph">
<p>Proceed as follows.
(Note that specific file-examples to be used are listed in <a href="../manage-security/configure-client-certificates.html#using-client-and-server-certificates-for-secure-xdcr" class="xref page">Using Client and Server Certificates for Secure XDCR</a>.)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy and paste the root certificate for the destination cluster into the top interactive pane.</p>
</li>
<li>
<p>Check the <strong>Use Client Certificate Authentication</strong> checkbox.
The dialog expands vertically, as follows:</p>
<div class="imageblock">
<div class="content">
<img src="../_images/manage-xdcr/xdcr-expanded-client-certificate-authentication-dialog.png" alt="xdcr expanded client certificate authentication dialog" width="400">
</div>
</div>
<div class="paragraph">
<p>Interactive fields have thus become visible, for the specifying of <strong>Client Certificate</strong> and <strong>Client Key</strong>.</p>
</div>
</li>
<li>
<p>Copy and paste the client certificate prepared for the source cluster into the middle interactive pane.</p>
</li>
<li>
<p>Copy and paste the client private key prepared for the source cluster into the bottom interactive pane.</p>
</li>
<li>
<p>Ensure that the <strong>Username for Remote Cluster</strong> and <strong>Password</strong> fields are blank.
The dialog now appears approximately as follows:</p>
<div id="xdcr-edit-remote-cluster-dialog-expanded-with-certs" class="imageblock">
<div class="content">
<img src="../_images/manage-xdcr/xdcr-edit-remote-cluster-dialog-expanded-with-certs.png" alt="xdcr edit remote cluster dialog expanded with certs" width="400">
</div>
</div>
</li>
<li>
<p>Left-click on the <strong>Save</strong> button, at the lower-right of the dialog.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If errors have occurred in certificate-preparation, these are displayed at the top of the dialog.
Otherwise, all replications for the edited reference are now fully secured.</p>
</div>
<div class="paragraph">
<p>See <a href="../manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a> and <a href="../manage-security/configure-client-certificates.html" class="xref page">Configure Client Certificates</a> for information on certificate-preparation.</p>
</div>
</div>
<div class="sect2">
<h3 id="enable-fully-secure-replications-with-add-remote-cluster"><a class="anchor" href="#enable-fully-secure-replications-with-add-remote-cluster"></a>Enable Fully Secure Replications with Add Remote Cluster</h3>
<div class="paragraph">
<p>Left-clicking on the <strong>Add Remote Cluster</strong> button, located at the upper-right of the <strong>XDCR Replications</strong> screen, brings up the <strong>Add Remote Cluster</strong> dialog.
As shown in <a href="create-xdcr-reference.html#create-an-xdcr-reference-with-the-ui" class="xref page">Create an XDCR Reference with the UI</a>, this is used to create a new reference.
The field-content of this dialog is identical to that of the <strong>Edit Remote Cluster</strong> dialog, just examined: therefore it too can be used to establish security for the reference and its corresponding replications.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enable-fully-secure-replications-with-the-cli"><a class="anchor" href="#enable-fully-secure-replications-with-the-cli"></a>Enable Fully Secure Replications with the CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To create and edit a reference, and attribute to it a security-level, use the <code>xdcr-setup</code> command.
Use of this command to create a non-secure reference is already demonstrated in <a href="create-xdcr-reference.html#create-an-xdcr-reference-with-the-cli" class="xref page">Create an XDCR Reference with the CLI</a>.</p>
</div>
<div class="paragraph">
<p>From the starting-point given above, in <a href="#examples-on-this-page-full-secure-replication">Examples on this Page</a>, proceed as follows.</p>
</div>
<div class="sect2">
<h3 id="edit-existing-reference-to-fully-secure-with-creds-cli"><a class="anchor" href="#edit-existing-reference-to-fully-secure-with-creds-cli"></a>Secure an Existing Reference with CLI, Using Credentials</h3>
<div class="paragraph">
<p>To edit the existing non-secure reference to <code>10.142.180.102</code>, specifying fully secure replication by means of the remote cluster&#8217;s appropriate administrative credentials and its root certificate, enter the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>couchbase-cli xdcr-setup -c 10.142.180.101 \
-u Administrator -p password \
--edit \
--xdcr-cluster-name 10.142.180.102 \
--xdcr-hostname 10.142.180.102 \
--xdcr-username Administrator \
--xdcr-password password \
--xdcr-secure-connection full \
--xdcr-certificate /Users/username/cert/ca.pem</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>--edit</code> flag is specified.
The <code>--xdcr-username</code> and <code>--xdcr-password</code> are those for the remote cluster.
The value of <code>--xdcr-certificate</code> is set to <code>full</code>.
The value of <code>--xdcr-certificate</code> is the root certificate of the remote cluster, specified as a local pathname.
If successful, the command returns the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SUCCESS: Cluster reference edited</pre>
</div>
</div>
<div class="paragraph">
<p>The reference and its associated replications are now fully secured.</p>
</div>
</div>
<div class="sect2">
<h3 id="edit-existing-reference-to-fully-secure-with-certs-cli"><a class="anchor" href="#edit-existing-reference-to-fully-secure-with-certs-cli"></a>Secure an Existing Reference with CLI, Using Certificates</h3>
<div class="paragraph">
<p>To edit the existing non-secure reference to <code>10.142.180.102</code>, specifying fully secure replication by means of the remote cluster&#8217;s root certificate, a client certificate, and a client private key, enter the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>couchbase-cli xdcr-setup -c 10.142.180.101 \
-u Administrator \
-p password \
--edit \
--xdcr-cluster-name 10.142.180.102 \
--xdcr-hostname 10.142.180.102 \
--xdcr-username Administrator \
--xdcr-password password \
--xdcr-secure-connection full \
--xdcr-certificate /Users/username/cert/ca.pem \
--xdcr-user-certificate /Users/username/clientcert/travel-sample.pem \
--xdcr-user-key /Users/username/clientcert/travel-sample.key</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>--edit</code> flag is specified.
The <code>--xdcr-username</code> and <code>--xdcr-password</code> are those for the remote cluster.
The value of <code>--xdcr-certificate</code> is set to <code>full</code>.
Specified as local pathnames are the values of <code>--xdcr-certificate</code> (the root certificate of the remote cluster), <code>--xdcr-user-certificate</code> (the client certificate), and <code>--xdcr-user-key</code> (the client&#8217;s private key).
If successful, the command returns the  following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SUCCESS: Cluster reference edited</pre>
</div>
</div>
<div class="paragraph">
<p>The reference and its associated replications are now fully secured.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-new-fully-secure-reference-with-creds"><a class="anchor" href="#create-new-fully-secure-reference-with-creds"></a>Create a New, Fully Secure Reference with CLI, Using Credentials</h3>
<div class="paragraph">
<p>To create a new, fully secure reference from <code>10.142.180.101</code> to <code>10.142.180.103</code> by means of the remote cluster&#8217;s appropriate administrative credentials and its root certificate, enter the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>couchbase-cli xdcr-setup -c 10.142.180.101 \
-u Administrator -p password \
--create \
--xdcr-cluster-name 10.142.180.103 \
--xdcr-hostname 10.142.180.103 \
--xdcr-username Administrator \
--xdcr-password password \
--xdcr-secure-connection full \
--xdcr-certificate /Users/username/cert/ca.pem</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>--create</code> flag is specified.
The <code>--xdcr-username</code> and <code>--xdcr-password</code> are those for the remote cluster.
The value of <code>--xdcr-secure-connection</code> is set to <code>full</code>.
The value of <code>--xdcr-certificate</code> is the root certificate of the remote cluster, specified as a local pathname.
If successful, the command returns the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SUCCESS: Cluster reference created</pre>
</div>
</div>
<div class="paragraph">
<p>The new reference is now fully secured, as will be its associated replications.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-new-fully-secure-reference-with-certs-cli"><a class="anchor" href="#create-new-fully-secure-reference-with-certs-cli"></a>Create a New, Fully Secure Reference with CLI, Using Certificates</h3>
<div class="paragraph">
<p>To create a new, fully secure reference from <code>10.142.180.101</code> to <code>10.142.180.103</code> by means of the remote cluster&#8217;s root certificate, a client certificate, and a client private key, enter the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>couchbase-cli xdcr-setup -c 10.142.180.101 \
-u Administrator -p password \
--create \
--xdcr-cluster-name 10.142.180.103 \
--xdcr-hostname 10.142.180.103 \
--xdcr-username Administrator \
--xdcr-password password \
--xdcr-secure-connection full \
--xdcr-certificate /Users/username/cert/ca.pem \
--xdcr-user-certificate /Users/username/clientcert/travel-sample.pem \
--xdcr-user-key /Users/username/clientcert/travel-sample.key</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>--create</code> flag is specified.
The <code>--xdcr-username</code> and <code>--xdcr-password</code> are those for the remote cluster.
The value of <code>--xdcr-secure-connection</code> is set to <code>full</code>.
Specified as local pathnames are the values of <code>--xdcr-certificate</code> (the root certificate of the remote cluster), <code>--xdcr-user-certificate</code> (the client certificate), and <code>--xdcr-user-key</code> (the client&#8217;s private key).</p>
</div>
<div class="paragraph">
<p>If successful, the command returns the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SUCCESS: Cluster reference created</pre>
</div>
</div>
<div class="paragraph">
<p>The reference is now fully secured, as will be its associated replications.</p>
</div>
<div class="paragraph">
<p>For more information, see the complete reference for <a href="#cli:cbcli/couchbase-cli-xdcr-setup.adoc" class="xref unresolved">xdcr-setup</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enable-fully-secure-replications-with-the-rest-api"><a class="anchor" href="#enable-fully-secure-replications-with-the-rest-api"></a>Enable Fully Secure Replications with the REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To create or edit a reference, and attribute <em>full</em> security to it, use the <code>/pools/default/remoteClusters</code> URI.
Reference-creation with this URI is already demonstrated in <a href="create-xdcr-reference.html#create-an-xdcr-reference-with-the-rest-api" class="xref page">Create an XDCR Reference with the REST API</a>: note that this example used the <code>demandEncryption</code> flag with a value of zero, to specify non-secure replications.</p>
</div>
<div class="paragraph">
<p>From the starting-point given above in <a href="enable-half-secure-replication.html#examples-on-this-page-half-secure-replication" class="xref page">Examples on this Page</a>, proceed as described in the subsections below.</p>
</div>
<div class="sect2">
<h3 id="make-existing-reference-fully-secure-with-creds-rest"><a class="anchor" href="#make-existing-reference-fully-secure-with-creds-rest"></a>Secure an Existing Reference with REST, Using Credentials</h3>
<div class="paragraph">
<p>To edit the existing reference from <code>10.142.180.101</code> to <code>10.142.180.102</code>, fully securing it by means of the remote cluster&#8217;s appropriate administrative credentials and its root certificate, enter the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST -u Administrator:password \
http://10.142.180.101:8091/pools/default/remoteClusters/10.142.180.102 \
-d name=10.142.180.102 \
-d hostname=10.142.180.102:8091 \
-d "username=Administrator" \
-d "password=password" \
-d "demandEncryption=true" \
-d secureType=full \
--data-urlencode "certificate=$(cat /Users/username/cert/ca.pem)"</pre>
</div>
</div>
<div class="paragraph">
<p>The URI terminates with the name of the remote cluster, signifying that this operation <em>edits</em>, rather than <em>creates</em>.
The <code>username</code> and <code>password</code> specified are those of the remote cluster.
Note that the <code>demandEncryption</code> flag is set to <code>true</code>, and the <code>encryptionType</code> flag specifies <code>full</code>.
The required <code>--dataurlencode</code> flag specifies the local path to the root certificate for the remote cluster.</p>
</div>
<div class="paragraph">
<p>Formatted, the output from a successful execution is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "certificate": "-----BEGIN CERTIFICATE-----\nMIIDAjCCAeqgAwIB...
  ...e5yV\nkOYCnuwY\n-----END CERTIFICATE-----",
  "deleted": false,
  "demandEncryption": true,
  "encryptionType": "full",
  "hostname": "10.142.180.102:8091",
  "name": "10.142.180.102",
  "secureType": "full",
  "uri": "/pools/default/remoteClusters/10.142.180.102",
  "username": "Administrator",
  "uuid": "fe8df4ff66e7e8121c249de13fb3324a",
  "validateURI": "/pools/default/remoteClusters/10.142.180.102?just_validate=1"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>secureType</code> field specifies <code>full</code>: therefore, the reference and its associated replications have now been fully secured.</p>
</div>
</div>
<div class="sect2">
<h3 id="make-existing-reference-fully-secure-with-certs-rest"><a class="anchor" href="#make-existing-reference-fully-secure-with-certs-rest"></a>Secure an Existing Reference with REST, Using Certificates</h3>
<div class="paragraph">
<p>To edit the existing non-secure reference from <code>10.142.180.101</code> to <code>10.142.180.102</code>, specifying fully secure replication by means of the remote cluster&#8217;s root certificate, a client certificate, and a client private key, enter the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://10.142.180.101:8091/pools/default/remoteClusters/10.142.180.102 \
-d name=10.142.180.102 \
-d hostname=10.142.180.102:8091 \
-d "username=Administrator" \
-d "password=password" \
-d "demandEncryption=true" \
-d secureType=full \
--data-urlencode "certificate=$(cat /Users/username/cert/ca.pem)" \
--data-urlencode "clientCertificate=$(cat /Users/username/clientcert/travel-sample.pem)" \
--data-urlencode "clientKey=$(cat /Users/username/clientcert/travel-sample.key)"</pre>
</div>
</div>
<div class="paragraph">
<p>The URI terminates with the name of the remote cluster, signifying that this operation <em>edits</em>, rather than <em>creates</em>.
The <code>username</code> and <code>password</code> specified are those of the remote cluster.
Note that the <code>demandEncryption</code> flag is set to <code>true</code>, and the <code>encryptionType</code> flag specifies <code>full</code>.
The value of <code>--xdcr-certificate</code> is set to <code>full</code>.
Specified as local pathnames are the values of <code>--xdcr-certificate</code> (the root certificate of the remote cluster), <code>--xdcr-user-certificate</code> (the client certificate), and <code>--xdcr-user-key</code> (the client&#8217;s private key).</p>
</div>
<div class="paragraph">
<p>If successful, the command returns the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
 "certificate": "-----BEGIN CERTIFICATE-----\nMIIDAjCCAeqgAwIB...
 ...e5yV\nkOYCnuwY\n-----END CERTIFICATE-----",
 "deleted": false,
 "demandEncryption": true,
 "encryptionType": "full",
 "hostname": "10.142.180.102:8091",
 "name": "10.142.180.102",
 "secureType": "full",
 "uri": "/pools/default/remoteClusters/10.142.180.102",
 "username": "Administrator",
 "uuid": "fe8df4ff66e7e8121c249de13fb3324a",
 "validateURI": "/pools/default/remoteClusters/10.142.180.102?just_validate=1"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>secureType</code> field specifies <code>full</code>: therefore, the reference and its associated
replications have now been fully secured.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-new-fully-secure-reference-with-creds-rest"><a class="anchor" href="#create-new-fully-secure-reference-with-creds-rest"></a>Create a New, Fully Secure Reference with REST, Using Credentials</h3>
<div class="paragraph">
<p>To create a new, fully secure reference from <code>10.142.180.101</code> to <code>10.142.180.103</code> by means of the remote cluster&#8217;s appropriate administrative credentials and its root certificate, enter the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST -u Administrator:password \
http://10.142.180.101:8091/pools/default/remoteClusters \
-d name=10.142.180.103 \
-d hostname=10.142.180.103:8091 \
-d "username=Administrator" \
-d "password=password" \
-d "demandEncryption=true" \
-d secureType=full \
--data-urlencode "certificate=$(cat /Users/username/cert/ca.pem)"</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>username</code> and <code>password</code> specified are those of the remote cluster.
Note that the <code>demandEncryption</code> flag is set to <code>true</code>, and the <code>encryptionType</code> flag specifies <code>full</code>.
The required <code>--dataurlencode</code> flag specifies the local path to the root certificate for the remote cluster.</p>
</div>
<div class="paragraph">
<p>Formatted, the output from a successful execution is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "certificate": "-----BEGIN CERTIFICATE-----\nMIIDAjCCAeqgAwIBAgIIFVl...
  ...nkOYCnuwY\n-----END CERTIFICATE-----",
  "deleted": false,
  "demandEncryption": true,
  "encryptionType": "full",
  "hostname": "10.142.180.103:8091",
  "name": "10.142.180.103",
  "secureType": "full",
  "uri": "/pools/default/remoteClusters/10.142.180.103",
  "username": "Administrator",
  "uuid": "fe8df4ff66e7e8121c249de13fb3324a",
  "validateURI": "/pools/default/remoteClusters/10.142.180.102?just_validate=1"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>secureType</code> field specifies <code>full</code>: therefore, the new reference is fully secured, as will be its associated replications.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-new-fully-secure-reference-with-certs-rest"><a class="anchor" href="#create-new-fully-secure-reference-with-certs-rest"></a>Create a New, Fully Secure Reference with REST, Using Certificates</h3>
<div class="paragraph">
<p>To create a new, fully secure reference from <code>10.142.180.101</code> to <code>10.142.180.103</code>, specifying fully secure replication by means of the remote cluster&#8217;s root certificate, a client certificate, and a client private key, enter the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST -u Administrator:password \
http://10.142.180.101:8091/pools/default/remoteClusters \
-d name=10.142.180.103 \
-d hostname=10.142.180.103:8091 \
-d "username=Administrator" \
-d "password=password" \
-d "demandEncryption=true" \
-d secureType=full \
--data-urlencode "certificate=$(cat /Users/username/cert/ca.pem)"  \
--data-urlencode "clientCertificate=$(cat /Users/username/clientcert/travel-sample.pem)" \
--data-urlencode "clientKey=$(cat /Users/username/clientcert/travel-sample.key)"</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>username</code> and <code>password</code> specified are those of the remote cluster.
Note that the <code>demandEncryption</code> flag is set to <code>true</code>, and the <code>encryptionType</code> flag specifies <code>full</code>.
The value of <code>--xdcr-certificate</code> is set to <code>full</code>.
Specified as local pathnames are the values of <code>--xdcr-certificate</code> (the root certificate of the remote cluster), <code>--xdcr-user-certificate</code> (the client certificate), and <code>--xdcr-user-key</code> (the client&#8217;s private key).</p>
</div>
<div class="paragraph">
<p>If successful, the command returns the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
 "certificate": "-----BEGIN CERTIFICATE-----\nMIIDAjCCAeqgAwIBAgIIFVl...
 ...nkOYCnuwY\n-----END CERTIFICATE-----",
 "deleted": false,
 "demandEncryption": true,
 "encryptionType": "full",
 "hostname": "10.142.180.103:8091",
 "name": "10.142.180.103",
 "secureType": "full",
 "uri": "/pools/default/remoteClusters/10.142.180.103",
 "username": "Administrator",
 "uuid": "fe8df4ff66e7e8121c249de13fb3324a",
 "validateURI": "/pools/default/remoteClusters/10.142.180.102?just_validate=1"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>secureType</code> field specifies <code>full</code>: therefore, the reference and its associated replications have now been fully secured.</p>
</div>
<div class="paragraph">
<p>For more information on using the REST API to create half-secure connections, see the reference page at <a href="../../rest-api/rest-xdcr-create-ref.html" class="xref page">Creating and Editing References</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-xdcr-steps-after-fully-secure-replication"><a class="anchor" href="#next-xdcr-steps-after-fully-secure-replication"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>XDCR supports replication between <em>scopes</em> and <em>collections</em>.
See <a href="replicate-using-scopes-and-collections.html" class="xref page">Replicate Using Scopes and Collections</a>.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
