<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Add a Node and Rebalance | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="A new Couchbase Server node can be added to an existing cluster.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/manage/manage-nodes/add-node-and-rebalance.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/manage/pages/manage-nodes/add-node-and-rebalance.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Manage</li>
<li class="crumb"><a href="node-management-overview.html">Manage Nodes and Clusters</a></li>
<li class="crumb"><a href="add-node-and-rebalance.html">Add a Node and Rebalance</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Add a Node and Rebalance</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
A new Couchbase Server node can be added to an existing cluster.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-node-addition"><a class="anchor" href="#understanding-node-addition"></a>Understanding Node-Addition</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Full</em> and <em>Cluster</em> administrators can use the UI, CLI, or REST API to add Couchbase Server nodes to existing clusters.
On each node to be added, Couchbase Server must have been <em>installed and started</em>.
The process of node-addition grants to the new node the settings already established for the parent cluster.
(See <a href="../manage-settings/manage-settings.html" class="xref page">Manage Settings</a> for details.)
The process allows services to be assigned to the new node.
If the new node was previously <em>initialized</em> with custom disk-paths, these can either be retained or modified.
All aspects of <em>provisioning</em> that may previously have occurred on the new node are eliminated: this includes buckets, services, and settings.</p>
</div>
<div class="paragraph">
<p>Following node-addition, <em>rebalance</em> is required, to make the new node an active member of the cluster.</p>
</div>
<div class="sect2">
<h3 id="node-addition-and-certificate-management"><a class="anchor" href="#node-addition-and-certificate-management"></a>Node-Addition and Certificate-Management</h3>
<div class="paragraph">
<p>The examples on this page assume that the default, <em>system-generated</em> certificates provided by Couchbase Server continue to be resident on the cluster and the node to be added.
In a production or similar context, to ensure security, only administrator-configured certificates should be used on a cluster: these should rely on a well known <em>Certificate Authority</em>, whose certificate is loaded as the cluster&#8217;s <em>root</em> certificate.
(For more information, see <a href="../../learn/security/certificates.html#server-certificates" class="xref page">Default Certificates and Certificate Substitution</a>.)</p>
</div>
<div class="paragraph">
<p>In such a context, no node can be added to the cluster until conformant administrator-configured certificates have been loaded onto it&#8201;&#8212;&#8201;such activities will thus need to be performed in addition to those shown by the examples on this page.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="../manage-security/configure-server-certificates.html#adding-new-nodes" class="xref page">Adding and Joining New Nodes</a>.
A complete overview of Couchbase-Server certificate-management is provided in <a href="../../learn/security/certificates.html" class="xref page">Certificates</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples-on-this-page-node-addition"><a class="anchor" href="#examples-on-this-page-node-addition"></a>Examples on This Page</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The examples in the subsections below show how to add the same node to the same one-node cluster; using the <a href="#add-a-node-with-the-ui">UI</a>, the <a href="#add-a-node-with-the-cli">CLI</a>, and the <a href="#add-a-node-with-the-rest-api">REST API</a> respectively.
The examples assume:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A one-node cluster already exists; and is named after its IP address: <code>10.142.181.101</code>.
It is running the Data, Query, and Index services, and has the <code>travel-sample</code> bucket installed.
(To access and install this, see <a href="../manage-settings/install-sample-buckets.html" class="xref page">Sample Buckets</a>.)</p>
</li>
<li>
<p>A new node has been started.
This is named after its IP address: <code>10.142.181.102</code>.
It has not been initialized or provisioned.</p>
</li>
<li>
<p>The cluster has the Full Administrator username of <code>Administrator</code>, and password of <code>password</code>.</p>
</li>
<li>
<p>The cluster is protected by the default Couchbase-Server certificate-configuration.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="add-a-node-with-the-ui"><a class="anchor" href="#add-a-node-with-the-ui"></a>Add a Node and Rebalance with the UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Proceed as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Bring up Couchbase Web Console, and log into cluster <code>10.142.181.101</code>, using the Full Administrator username and password.
Access the <strong>Servers</strong> tab, in the left-hand navigation bar:</p>
<div id="left_click_on_servers_tab" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/accessServersTab.png" alt="accessServersTab" width="90">
</div>
</div>
<div class="paragraph">
<p>The <strong>Servers</strong> screen for the cluster is now displayed:</p>
</div>
<div id="servers-screen-initial" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/singleNodeClusterBeforeAddNode.png" alt="singleNodeClusterBeforeAddNode" width="800">
</div>
</div>
<div class="paragraph">
<p>This shows the name of the only node currently in the cluster, <code>10.142.181.101</code>, plus additional information, including the services hosted.</p>
</div>
</li>
<li>
<p>Ensure that the node to be added has been started.
This can be accomplished by checking the IP address and port number for the new node in the address bar of the browser.
The following interface is displayed:</p>
<div id="new-node-welcome-screen" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/newNodeWelcomeScreen.png" alt="newNodeWelcomeScreen" width="400">
</div>
</div>
<div class="paragraph">
<p>This indicates that Couchbase Server is installed and running on the new node, but has not yet been provisioned.
Do not use this interface: instead, return to Couchbase Web Console for the cluster, <code>10.142.181.101</code>.</p>
</div>
</li>
<li>
<p>In the <strong>Servers</strong> panel for the cluster, left-click on the <strong>ADD SERVER</strong> button, at the upper right:</p>
<div id="add-server-button" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/addServerButton.png" alt="addServerButton" width="140">
</div>
</div>
<div class="paragraph">
<p>The <strong>Add Server Node</strong> dialog is now displayed:</p>
</div>
<div id="add-server-node-dialog" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/addServerNodeDialog.png" alt="addServerNodeDialog" width="400">
</div>
</div>
<div class="paragraph">
<p>Note the warning provided at the top of the dialog: if the node to be added has already been provisioned, the results of such provisioning will be eliminated and replaced on the node&#8217;s addition to the current cluster.
(In fact, the node to be added in this example, has neither been initialized nor provisioned.)</p>
</div>
</li>
<li>
<p>Specify the IP address of the node to be added.
A placeholder password must be specified, even though the node has not yet been provisioned with one.
Uncheck all of the <strong>Services</strong> check-boxes except <strong>Data</strong>.
The dialog now appears as follows:</p>
<div id="add-server-node-dialog-complete" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/addServerNodeDialogComplete.png" alt="addServerNodeDialogComplete" width="400">
</div>
</div>
<div class="paragraph">
<p>Optionally, the <strong>Customize disk storage paths (this node)</strong> checkbox can be checked, to display interactive fields that allow such paths to be modified for the node that is to be added:</p>
</div>
<div id="check-disk-storage-checkbox" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/checkDiskStorageCheckbox.png" alt="checkDiskStorageCheckbox" width="280">
</div>
</div>
<div class="paragraph">
<p>The dialog is now extended vertically, to display the interactive fields for <strong>Data</strong>, <strong>Indexes</strong>, and <strong>Analytics</strong> data paths:</p>
</div>
<div id="add-server-dialog-vertically-extended" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/addServerNodeDialogVerticallyExtended.png" alt="addServerNodeDialogVerticallyExtended" width="400">
</div>
</div>
<div class="paragraph">
<p>For the current example, the displayed, default paths do not need to be modified.</p>
</div>
<div class="paragraph">
<p>Left-click on the <strong>Add Server</strong> button to save the settings.
The <strong>Servers</strong> screen is redisplayed, with the following appearance:</p>
</div>
<div id="servers-screen-with-node-added" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/twoNodeClusterAfterAddNodeExpanded.png" alt="twoNodeClusterAfterAddNodeExpanded" width="800">
</div>
</div>
<div class="paragraph">
<p>This indicates that the new node, <code>10.142.181.102</code> has been successfully added.
However, it is not yet taking traffic, and will be added following a <em>rebalance</em>. Note, at this point, the figure under the <strong>Items</strong> column for for <code>10.142.181.101</code>: this is <code>63.1 K/0</code>, which indicates that the node contains 63.1 K items in <em>active</em> vBuckets, and 0 items in <em>replica</em> vBuckets.
Meanwhile, the <strong>Items</strong> figure for <code>10.142.181.102</code> is 0/0, indicating that no items are yet distributed onto that node in either active or replica form.</p>
</div>
<div class="paragraph">
<p>For an architectural description of how vBuckets and their items are distributed across a cluster, see <a href="../../learn/clusters-and-availability/intra-cluster-replication.html" class="xref page">Intra-Cluster Replication</a>.</p>
</div>
</li>
<li>
<p>To perform a rebalance, left-click on the <strong>Rebalance</strong> button, at the upper right:</p>
<div id="rebalance-button" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/rebalanceButton.png" alt="rebalanceButton" width="140">
</div>
</div>
<div id="rebalance-progress-add-node" class="paragraph">
<p>The new node is rebalanced into the cluster, meaning that whatever active and replica vBuckets were previously distributed across the original cluster nodes are redistributed across the superset of nodes created by the addition.
Additionally, a <strong>Rebalance</strong> dialog is displayed:</p>
</div>
<div class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/rebalanceInOfNodeTwo6.5v2.png" alt="rebalanceInOfNodeTwo6.5v2" width="800">
</div>
</div>
<div class="paragraph">
<p>The dialog indicates rebalance progress for each of the services on the cluster.
To see more information on the progress related to the Data Service, left-click on the <strong>travel-sample</strong> tab, under <strong>Data</strong>:
The pane expands to provide additional information on the progress of data-transfer for the <strong>travel-sample</strong> bucket:</p>
</div>
<div class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/rebalanceOpenedDataTabfor7.0.png" alt="rebalanceOpenedDataTabfor7.0" width="430">
</div>
</div>
<div class="paragraph">
<p>The dialog indicates the progress of both vBuckets and documents, as they are moved between nodes.
Average times for <strong>Views Compaction</strong> are also provided.</p>
</div>
<div class="paragraph">
<p>A new panel now appears at the bottom of the <strong>Servers</strong> screen.
This also reports rebalance progress:</p>
</div>
<div class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/rebalanceProgressFooter.png" alt="rebalanceProgressFooter" width="760">
</div>
</div>
<div id="rebalance-complete-dialog-appearance" class="paragraph">
<p>When the rebalance is complete, the panel at the bottom of the screen disappears, and the dialog appears as follows:</p>
</div>
<div class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/rebalanceCompletion7.0.png" alt="rebalanceCompletion7.0" width="430">
</div>
</div>
<div class="paragraph">
<p>Note that time-completion figures are also provided for the other services, <strong>Index</strong> and <strong>Query</strong>.
Additionally, a complete report on the concluded rebalance activity can be downloaded, by left-clicking on the <strong>Download Report</strong> button:</p>
</div>
<div id="download-button" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/downloadButton.png" alt="downloadButton" width="180">
</div>
</div>
<div class="paragraph">
<p>See the <a href="../../rebalance-reference/rebalance-reference.html" class="xref page">Rebalance Reference</a>, for information on the contents of the report.</p>
</div>
<div class="paragraph">
<p>Left-click on the <strong>X</strong> at the upper-right of the dialog, to dismiss the dialog.</p>
</div>
<div class="paragraph">
<p>The <strong>Servers</strong> screen now displays two rows &#8212; one each for servers <code>10.142.181.101</code> and <code>10.142.181.102</code>.
Left-click on the row for <code>10.142.181.102</code>, to open it.
The screen now appears as follows:</p>
</div>
<div id="servers-screen-with-node-added-after-rebalance" class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/twoNodeClusterAfterRebalance.png" alt="twoNodeClusterAfterRebalance" width="800">
</div>
</div>
<div class="paragraph">
<p>Note that the figure in the <strong>Items</strong> column for node <code>10.142.181.101</code> is <code>31.5 K/31.6 K</code>, which indicates that 31.5 K items are stored on the node in <em>active</em> vBuckets, and 31.6 K in <em>replica</em> vBuckets.
The figure for <code>10.142.181.102</code> indicates the converse.
Therefore, replication has successfully distributed the contents of <code>travel-sample</code> across both nodes, providing a single replica vBucket for each active vBucket.</p>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="node-information-within-the-ui"><a class="anchor" href="#node-information-within-the-ui"></a>Node Information Within the UI</h4>
<div class="paragraph">
<p>When the row for a node is open, as is the case here for <code>10.142.181.102</code>, information on the node is displayed immediately under its <strong>name</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Addresses</strong> provides at a minimum the <em>internal</em> IP address of the node; and also lists <em>external</em> (that is, <em>alternate</em>) IP addresses, if they have been defined &#8212; see <a href="../../learn/clusters-and-availability/connectivity.html#alternate-addresses" class="xref page">Alternate Addresses</a>, for information.</p>
</li>
<li>
<p>The <strong>Address Family</strong> of the node is specified as either <strong>IPv4</strong> or <strong>IPv6</strong>: see <a href="manage-address-families.html" class="xref page">Manage Address Families</a>, for information.</p>
</li>
<li>
<p><strong>Node-to-Node Encryption</strong> for the cluster is specified as either <strong>enabled</strong> or <strong>disabled</strong>: see <a href="apply-node-to-node-encryption.html" class="xref page">Manage Node-to-Node Encryption</a>.</p>
</li>
<li>
<p>The <strong>Version</strong> of the Couchbase-Server instance on the node, its current <strong>Uptime</strong>, and the <strong>OS</strong> on which it runs are also specified.</p>
</li>
<li>
<p>The <strong>RAM Quotas</strong> for each service on the node, and each established <strong>Storage Path</strong> (for one or more of <strong>Data</strong>, <strong>Indexes</strong>, <strong>Eventing</strong>, and <strong>Analytics</strong>) are specified: see <a href="create-cluster.html" class="xref page">Create a Cluster</a> for examples of how to establish these.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="rebalance-failure-notification"><a class="anchor" href="#rebalance-failure-notification"></a>Rebalance Failure Notification</h3>
<div class="paragraph">
<p>If rebalance fails &#8212; for example, due to a node&#8217;s becoming non-responsive &#8212; Couchbase Web Console displays a notification such as the following:</p>
</div>
<div class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/rebalanceFailureNotification.png" alt="rebalanceFailureNotification" width="250">
</div>
</div>
<div class="paragraph">
<p>As this indicates, detailed information can be found by left-clicking on the <strong>Logs</strong> tab, in the left-hand, vertical navigation bar.
This brings up the <strong>Logs</strong> screen, containing information such as the following:</p>
</div>
<div class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/rebalanceFailureLog.png" alt="rebalanceFailureLog" width="800">
</div>
</div>
<div class="paragraph">
<p>Information is also provided on the <strong>Rebalance</strong> dialog:</p>
</div>
<div class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/rebalanceDialogFailureNotification.png" alt="rebalanceDialogFailureNotification" width="400">
</div>
</div>
<div class="paragraph">
<p>If an unresponsive node become responsive again, rebalance can simply be reattempted manually.
Alternatively, the handling of a rebalance-failure can be configured to occur automatically, as described immediately <a href="#automated-rebalance-failure-handling">below</a>.</p>
</div>
<div class="paragraph">
<p>Before attempting rebalance with a reduced number of nodes, assess whether the available resources can support the intended number of replicas.
See <a href="../../learn/clusters-and-availability/removal.html" class="xref page">Removal</a>, for guidance.</p>
</div>
</div>
<div class="sect2">
<h3 id="automated-rebalance-failure-handling"><a class="anchor" href="#automated-rebalance-failure-handling"></a>Automated Rebalance-Failure Handling</h3>
<div class="paragraph">
<p>The handling of a rebalance-failure can be configured to occur automatically.
Configuration occurs by means of the <strong>General</strong> settings screen.
Up to 3 <em>retries</em> can be configured.
Each retry occurs after the elapsing of a time-period specified by the administrator, in seconds.
By default, automated rebalance-failure handling is <em>not</em> enabled.
For detailed information, see <a href="../manage-settings/general-settings.html#rebalance-settings" class="xref page">Rebalance Settings</a>.</p>
</div>
<div class="paragraph">
<p>If automated rebalance-failure handling has been enabled (meaning that between 1 and 3 retries have been specified), following a rebalance failure, the following notifications appear at the lower left of the main screen of Couchbase Web Console:</p>
</div>
<div class="imageblock text-middle">
<div class="content">
<img src="../_images/manage-nodes/rebalanceFailureMessage.png" alt="rebalanceFailureMessage" width="260">
</div>
</div>
<div class="paragraph">
<p>The middle notification indicates that a retry is planned, in accordance with the configuration made on the <strong>General</strong> settings screen.
The displayed integer represents the number of seconds remaining before the retry is commenced; and is gradually decremented, from the configured maximum to zero; at which point, retry is commenced.</p>
</div>
<div class="paragraph">
<p>If a retry fails, additional retries occur successively; until the maximum configured number have been attempted.</p>
</div>
</div>
<div class="sect2">
<h3 id="retry-cancellation"><a class="anchor" href="#retry-cancellation"></a>Retry-Cancellation</h3>
<div class="paragraph">
<p>If one or more retries have been configured, and, following a rebalance failure, a retry is pending, no administrative tasks should be performed on the cluster.
Instead, <em>either</em> allow configured retries continue occurring &#8212; until one has succeeded, or all have failed; <em>or</em> cancel the entire retry sequence.
Then, continue performing administrative tasks as appropriate.</p>
</div>
<div class="paragraph">
<p>To cancel, left-click on the <strong>CANCEL RETRY</strong> link, on the retry notification.
Note that this cancels <strong>all</strong> currently scheduled retries.
However, the configured number of retries will be rescheduled for each subsequent, manually initiated rebalance.</p>
</div>
<div class="paragraph">
<p>Retries can also be cancelled by means of the CLI and the REST API.
See <a href="#cancel-retries-with-the-cli">Cancel Retries with the CLI</a> and <a href="#cancel-retries-with-the-rest-api">Cancel Retries with the REST API</a>, below.</p>
</div>
<div class="sect3">
<h4 id="restricting-the-addition-of-nodes"><a class="anchor" href="#restricting-the-addition-of-nodes"></a>Restricting the Addition of Nodes</h4>
<div class="paragraph">
<p>To ensure cluster-security, in Couchbase Server Version 7.1.1+, restrictions can be placed on addition, based on the establishment of <em>node-naming conventions</em>.
Only nodes whose names correspond to at least one of the stipulated conventions can be added.
For information, see <a href="../../rest-api/rest-specify-node-addition-conventions.html" class="xref page">Restrict Node-Addition</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="add-a-node-with-the-cli"><a class="anchor" href="#add-a-node-with-the-cli"></a>Add a Node and Rebalance with the CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To add a new Couchbase Server-node to an existing cluster, use the <a href="#cli:cbcli/couchbase-cli-server-add.adoc" class="xref unresolved">server-add</a> command.
Note that this command requires that arguments be provided for its <code>--server-add-username</code> and <code>--server-add-password</code> flags.
In this case, meaningful arguments do not exist, since the new node features an instance of Couchbase Server that is running, but has not been provisioned with a username or password.
Therefore, specify placeholder arguments.
Additionally, specify that the <code>data</code> service be run on the node, once it is part of the cluster.</p>
</div>
<div class="paragraph">
<p>Note that a server to be added (as specified by the value of the <code>server-add</code> parameter) can be prefixed with the scheme <code>https://</code>, and/or with the port <code>18091</code>): if no scheme and no port is specified, <code>https://</code> and <code>18091</code> are used as defaults.
The scheme <code>http://</code> cannot be used, nor can the port <code>8091</code>: since in 7.1+, addition must occur over a secure connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>couchbase-cli server-add -c 10.142.181.101:8091 \
--username Administrator \
--password password \
--server-add https://10.142.181.102:18091 \
--server-add-username someName \
--server-add-password somePassword \
--services data</pre>
</div>
</div>
<div class="paragraph">
<p>If successful, the command returns the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SUCCESS: Server added</pre>
</div>
</div>
<div class="paragraph">
<p>The newly added node must now be rebalanced into the cluster. Use the <a href="#cli:cbcli/couchbase-cli-rebalance.adoc" class="xref unresolved">rebalance</a> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>couchbase-cli rebalance -c 10.142.181.101:8091 \
--username Administrator \
--password password</pre>
</div>
</div>
<div class="paragraph">
<p>During rebalance, progress is displayed as console output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Rebalancing
Bucket: 01/01 (travel-sample)                      60714 docs remaining
[=====                                                          ] 4.56%</pre>
</div>
</div>
<div class="paragraph">
<p>If successful, the command returns the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SUCCESS: Rebalance complete</pre>
</div>
</div>
<div class="paragraph">
<p>Note that when the operation is highly complex, it may be desirable to get status on its progress, or stop the operation. See the command reference for <a href="#cli:cbcli/couchbase-cli-rebalance-status.adoc" class="xref unresolved">rebalance-status</a> and <a href="#cli:cbcli/couchbase-cli-rebalance-stop.adoc" class="xref unresolved">rebalance-stop</a>, for more information.</p>
</div>
<div class="sect2">
<h3 id="cancel-retries-with-the-cli"><a class="anchor" href="#cancel-retries-with-the-cli"></a>Cancel Retries with the CLI</h3>
<div class="paragraph">
<p><em>Retries</em> (described above, in <a href="#automated-rebalance-failure-handling">Automated Rebalance-Failure Handling</a>) can be cancelled with the CLI, by means of the <a href="#cli:cbcli/couchbase-cli-setting-rebalance.adoc" class="xref unresolved">setting-rebalance</a> command.</p>
</div>
<div class="paragraph">
<p>Note that use of <code>setting-rebalance</code> for setting and getting the current rebalance-failure configuration is documented in <a href="../manage-settings/general-settings.html" class="xref page">General Settings</a>.</p>
</div>
<div class="paragraph">
<p>If, following a rebalance failure, a retry is pending, retrieve information on the pending retry as follows.
Note that the command is piped to the <a href="https://stedolan.github.io/jq/">jq</a> program, to facilitate readability:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/opt/couchbase/bin/couchbase-cli setting-rebalance \
-c 10.143.192.101 \
-u Administrator \
-p password \
--pending-info | jq '.'</pre>
</div>
</div>
<div class="paragraph">
<p>This returns the following object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "retry_rebalance": "pending",
  "rebalance_id": "29d89aa757097523898588c28efd3b4a",
  "type": "rebalance",
  "attempts_remaining": 2,
  "retry_after_secs": 184,
  "known_nodes": [
    "ns_1@10.143.192.101",
    "ns_1@10.143.192.103"
  ],
  "eject_nodes": [],
  "delta_recovery_buckets": "all"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The output indicates that a <code>retry_rebalance</code> is <code>pending</code>, and indicates that the <code>rebalance_id</code> for the pending retry is <code>29d89aa757097523898588c28efd3b4a</code>.
This id can be used to cancel the current retry sequence.
The output also indicates that 2 further retries are scheduled to be made, if necessary; and the <code>184</code> seconds remain before the next retry starts.
The nodes in the cluster are listed.
None is specified to be ejected.
All buckets are selected for <code>delta</code> recovery.</p>
</div>
<div class="paragraph">
<p>The current rebalance sequence can be cancelled by means of the <code>setting-rebalance</code> command, specifying the retrieved <code>rebalance_id</code>.
Enter the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/opt/couchbase/bin/couchbase-cli setting-rebalance \
-c 10.143.192.101 \
-u Administrator \
-p password \
--cancel \
--rebalance-id 29d89aa757097523898588c28efd3b4a</pre>
</div>
</div>
<div class="paragraph">
<p>If successful, the command returns the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SUCCESS: Rebalance retry canceled</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="add-a-node-with-the-rest-api"><a class="anchor" href="#add-a-node-with-the-rest-api"></a>Add a Node and Rebalance with the REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To add a new Couchbase Server-node to an existing cluster, use the <code>/controller/addNode</code> URI.</p>
</div>
<div class="paragraph">
<p>The following command adds node <code>10.142.181.102</code> to cluster <code>10.142.181.101</code>.
Note that a server to be added can be prefixed with the scheme <code>https://</code>, and/or can be suffixed with the port <code>18091</code>): if no scheme or port is specified, <code>https://</code> and <code>18091</code> are used as defaults.
The scheme <code>http://</code> cannot be used; nor can the port <code>8091</code>, since in 7.1+, node-addition takes place only over a secure connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -u Administrator:password -v -X POST \
10.142.181.101:8091/controller/addNode \
-d 'hostname=10.142.181.102&amp;user=someName&amp;password=somePassword&amp;services=kv'</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the argument passed for <code>services</code> is <code>kv</code>, which signifies the Data Service.
Optionally, other services can be specified: <code>index</code> (Index Service), <code>n1ql</code> (Query Service), <code>eventing</code> (Eventing Service), <code>fts</code> (Search Service), and <code>cbas</code> (Analytics Service).
If multiple services are specified, this should be as a comma-separated list: for example, <code>n1ql,index,fts</code>.
As with the CLI command shown above, a username and password are expected, even though in this case, the new node has not been provisioned: therefore, placeholders are used. If successful, the command returns the name of the newly added node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"otpNode":"ns_1@10.142.181.102"}</pre>
</div>
</div>
<div class="paragraph">
<p>The newly added node must now be rebalanced into the cluster. Use the <code>/controller/rebalance</code> URI, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -u Administrator:password -v -X POST \
10.142.181.101:8091/controller/rebalance \
-d 'knownNodes=ns_1@10.142.181.101,ns_1@10.142.181.102'</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>knownNodes</code> argument lists each of the nodes in the cluster.
If successful, the command returns no output.</p>
</div>
<div class="paragraph">
<p>For further information on adding nodes with the REST API, see <a href="../../rest-api/rest-cluster-addnodes.html" class="xref page">Adding Nodes to Clusters</a>; on rebalancing, see <a href="../../rest-api/rest-cluster-rebalance.html" class="xref page">Rebalancing the Cluster</a>.</p>
</div>
<div class="sect2">
<h3 id="cancel-retries-with-the-rest-api"><a class="anchor" href="#cancel-retries-with-the-rest-api"></a>Cancel Retries with the REST API</h3>
<div class="paragraph">
<p><em>Retries</em> (described above, in <a href="#automated-rebalance-failure-handling">Automated Rebalance-Failure Handling</a>) can be cancelled with the REST API.</p>
</div>
<div class="paragraph">
<p>Note that use of the REST API for setting and getting the current rebalance-failure configuration is documented in <a href="../manage-settings/general-settings.html#rebalance-settings-via-rest" class="xref page">Rebalance Settings via REST</a>.</p>
</div>
<div class="paragraph">
<p>If, following a rebalance failure, a retry is pending, use the <code>GET /pools/default/pendingRetryRebalance</code> http method and URI to identify the pending retry, as follows.
Note that this example uses the <a href="https://stedolan.github.io/jq/">jq</a> tool, to facilitate readability of output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -u Administrator:password -v -X GET \
http://10.143.192.101:8091/pools/default/pendingRetryRebalance | jq '.'</pre>
</div>
</div>
<div class="paragraph">
<p>The output is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "retry_rebalance": "pending",
  "rebalance_id": "ff5845cdce693db2dce9a9308cbf885d",
  "type": "rebalance",
  "attempts_remaining": 2,
  "retry_after_secs": 291,
  "known_nodes": [
    "ns_1@10.143.192.101",
    "ns_1@10.143.192.103"
  ],
  "eject_nodes": [],
  "delta_recovery_buckets": "all"
}</pre>
</div>
</div>
<div class="paragraph">
<p>This indicates that the status of <code>retry_rebalance</code> is <code>pending</code>; and provides a <code>rebalance_id</code> for the process, of <code>ff5845cdce693db2dce9a9308cbf885d</code>.
This id can be used to cancel the retry.
The output also lists the cluster&#8217;s nodes, indicates that <code>2</code> retry attempts are scheduled to occur if necessary after the current one, and indicates that <code>291</code> seconds are still to elapse before the pending retry.</p>
</div>
<div class="paragraph">
<p>To cancel the pending retry, use the <code>POST /controller/cancelRebalanceRetry</code> http method and URI, specifying the retrieved <code>rebalance_id</code> as the endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -u Administrator:password -v -X POST \
http://10.143.192.101:8091/controller/cancelRebalanceRetry/ff5845cdce693db2dce9a9308cbf885d</pre>
</div>
</div>
<div class="paragraph">
<p>If successful, this produces a <code>HTTP/1.1 200 OK</code> success message.
Subsequently, the <code>GET /pools/default/pendingRetryRebalance</code> http method and URI can again be used, to verify that there is no longer a retry pending.
This would be indicated by the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "retry_rebalance": "not_pending"
}</pre>
</div>
</div>
<div class="paragraph">
<p>All scheduled retries have thus been successfully cancelled.</p>
</div>
<div class="paragraph">
<p>Note that reference pages for these commands are provided at <a href="../../rest-api/rest-get-rebalance-retry.html" class="xref page">Get Rebalance-Retry Status</a> and <a href="../../rest-api/rest-cancel-rebalance-retry.html" class="xref page">Cancel Rebalance Retries</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps-after-adding-and-rebalancing"><a class="anchor" href="#next-steps-after-adding-and-rebalancing"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As well as supporting a cluster&#8217;s adding a node to itself, Couchbase Server also supports a node&#8217;s joining itself to a cluster (which is essentially the same operation, but proceeding from the node, rather than from the cluster).
See <a href="join-cluster-and-rebalance.html" class="xref page">Join a Cluster and Rebalance</a> for details.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
