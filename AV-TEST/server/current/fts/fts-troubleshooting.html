<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Troubleshooting and FAQs | Couchbase Docs</title>
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/fts/fts-troubleshooting.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/fts/pages/fts-troubleshooting.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb"><a href="fts-introduction.html">Search</a></li>
<li class="crumb"><a href="fts-troubleshooting.html">Troubleshooting and FAQs</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Troubleshooting and FAQs</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Full Text logs can be found in the file fts.log.
This is stored with the other Couchbase Server logs; the exact location depends on your operating system.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-i-just-did-a-search-but-i-dont-see-the-document-contents-i-just-see-the-document-ids-i-dont-want-to-have-to-click-on-document-ids"><a class="anchor" href="#q-i-just-did-a-search-but-i-dont-see-the-document-contents-i-just-see-the-document-ids-i-dont-want-to-have-to-click-on-document-ids"></a><strong>Q: I just did a search but I don’t see the document contents, I just see the document IDs. I don’t want to have to click on document IDs.</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need to store fields in order to see result snippets and highlighting.
Note that doing so makes your indexes larger and take longer to build, so make sure you need these features.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-why-doesnt-a-search-for-x-return-document-y"><a class="anchor" href="#q-why-doesnt-a-search-for-x-return-document-y"></a><strong>Q: Why doesn’t a search for X return document Y?</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How are the search terms being analyzed?</p>
<div class="paragraph">
<p>Text is analyzed when it is written to the index, and separately, search terms are analyzed when you perform a search.
These processes are independent.
Unless the same analyzer is used for both indexing and search, the terms may not match.</p>
</div>
<div class="paragraph">
<p>The analyzer being used on your search terms may not the one you expected.
This may happen if the search is not be scoped to the field, or is scoped to the wrong field name.</p>
</div>
<div class="paragraph">
<p>If the search clause is scoped to a field, FTS uses the same analyzer that the index mapping dictates for that field.</p>
</div>
</li>
<li>
<p>After analysis, what terms is the search looking for in the index?</p>
<div class="paragraph">
<p>Once you know what analyzer is being used on your search query, use http://analysis.blevesearch.com/ to see the exact terms that the analyzer outputs for your search.
For example, if you’ve determined that the "en" analyzer is being used, a search for "marketing blunders" will result in term searches for "market" and "blunder."</p>
</div>
</li>
<li>
<p>Run a special query called a term search for one term at a time, exactly as the terms come from the analyzer in step 2.
Be sure to return the document id match.
Rerun for each term.</p>
<div class="listingblock">
<div class="content">
<pre>curl -XPOST -H "Content-Type: application/json" \
        http://localhost:8094/api/index/perf_fts_index/query \
        -d '{
            "query": {
                "conjuncts": [
                    {
                        "term": "market"
                    },
                    {
                        "ids": ["Y"]
                    }
                ]
            }
        }'</pre>
</div>
</div>
</li>
<li>
<p>Did you get any results?</p>
<div class="paragraph">
<p>If yes, the search query is working fine.
If not, check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The document (as analyzed) does not contain the terms in question.
Review the contents of the document.</p>
</li>
<li>
<p>The terms in the document don’t analyze the way the user expected.
Try changing the analyzer, possibly define a custom analyzer.</p>
</li>
<li>
<p>The index mapping may be incorrect and the expected analyzer isn’t actually being used.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Advanced: Digging deeper into the index</p>
<div class="paragraph">
<p>Run command-line tools on the pindex that contains the document you expect to match.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbft-bleve dump doc [path_to_pindex] [doc_id]</pre>
</div>
</div>
<div class="paragraph">
<p>This dumps everything the index knows about that document.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-why-is-this-document-in-the-search-results-or-why-is-this-document-ranked-high-in-the-search-results"><a class="anchor" href="#q-why-is-this-document-in-the-search-results-or-why-is-this-document-ranked-high-in-the-search-results"></a><strong>Q: Why is this document in the search results, or why is this document ranked high in the search results?</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the query with the option "explain" set to true.
Understand which terms contributed to the document scoring the way it did.
Higher numbers indicate that a term contributes more weight.</p>
</li>
<li>
<p>Experiment with boost to adjust this.
For example, a query like "name:margaret^2 hobby:singing" would give twice as much weight to a match in the name field as the hobby field.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-why-is-indexing-so-slow"><a class="anchor" href="#q-why-is-indexing-so-slow"></a><strong>Q: Why is indexing so slow?</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, FTS tries to index all the fields in a document yet you typically only need to search on a few key fields.
Indexing all fields requires more computation and results in larger indexes than you get if you limit the index to just the fields you need.</p>
</div>
<div class="paragraph">
<p>Here are some tips to speed up indexing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Build a custom mapping, set "dynamic": false to disable automatic indexing, and explicitly index only the named fields that you need to search.</p>
</li>
<li>
<p>Avoid numeric/date fields if there is no query use case/requirements around those non-text fields.</p>
</li>
<li>
<p>Avoid storing fields unless you absolutely need snippets or highlighting.</p>
</li>
<li>
<p>Consider disabling term vectors for a particular field if you know that you do not need snippets, highlights, or phrase search.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-why-is-querying-so-slow"><a class="anchor" href="#q-why-is-querying-so-slow"></a><strong>Q: Why is querying so slow?</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Slow queries can be caused by searches that require a lot of processing to satisfy.
This is commonly due to a search includes high frequency terms, that is, terms that appear in many or even all documents.
Searches on high frequency terms require more work than searches for low frequency terms and can easily be 100x slower due to the large number of matches.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If possible, consider adding high frequency terms to a stop word list and reindex so they are not excluded from the index altogether.
High frequency words often contribute little to the search effectiveness and they can have a seriously detrimental impact on search performance, index size and index build times.</p>
</li>
<li>
<p>Check your indexes to rule out unexpected high frequency terms.
Words like "the" and "a" in English are relatively obvious candidates to add to a stopword list, but you may also have unexpected high frequency terms in your index, perhaps because there is a common token in your data you didn’t expect or a tokenizer is breaking words in an unexpected way, leading to other common terms.</p>
</li>
<li>
<p>Try rewriting queries to be more efficient if you must search on high frequency terms.
Using conjunction (AND) queries can help make the search faster.
In a query string, you can do this by using the + operator (MUST).
For If searching for the following is slow: lowFreqTerm highFreqTerm, try +lowFreqTerm highFreqTerm.</p>
<div class="paragraph">
<p>Although it is a different search, it should perform better and may be acceptable.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-why-are-the-queries-getting-rejected-with-http-status-code-429"><a class="anchor" href="#q-why-are-the-queries-getting-rejected-with-http-status-code-429"></a><strong>Q: Why are the queries getting rejected with HTTP status code 429?</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>At a high level, the HTTP status code 429 indicates that ftsMemoryQuota for the cluster is under-provisioned. Whenever Search service receives a query, it tries to forecast the memory requirements for performing that search request. When processing an incoming query, the query gets rejected by FTS when the cumulative memory usage has exceeded the set memory quota limit.
The memory allotted to Search service could be used by any of the following concurrent operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Parallel queries handled by the system.</p>
</li>
<li>
<p>Heavy concurrent indexing of data.</p>
</li>
<li>
<p>Parallel rebalance operations.</p>
</li>
<li>
<p>Complex queries with higher from/size parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can fix this by following the right sizing guidelines, increasing the ftsMemoryQuota, or by adding more Search nodes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-sort-isnt-working-like-i-think-it-should-why-do-i-see-some-weird-characters-in-my-search-response-objects-sort-field"><a class="anchor" href="#q-sort-isnt-working-like-i-think-it-should-why-do-i-see-some-weird-characters-in-my-search-response-objects-sort-field"></a><strong>Q: Sort isn&#8217;t working like I think it should. Why do I see some weird characters in my search response object&#8217;s sort field?</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you sort results on a field that isn&#8217;t indexed, or when a particular document is missing a value for that field, you will see the following series of Unicode non-printable characters appear in the <code>sort</code> field: <code>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd</code>.
The same characters may render differently when using a graphic tool or command line tools like <code>jq</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>      "sort": [
        "����������",
        "hotel_9723",
        "_score"
      ]</pre>
</div>
</div>
<div class="paragraph">
<p>Check your index definition to confirm that you&#8217;re indexing all the fields you intend to sort by.
You can control the sort behavior for missing attributes using the <code>missing</code> field. See <a href="fts-sorting.html" class="xref page">Sorting Query Results</a>.</p>
</div>
<div class="paragraph">
<p>Also remember, documents that have the same value for every field you specified in the <code>sort</code> field will be sorted non-deterministically.
Try adding <code>_id</code>, which is guaranteed unique.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-are-there-command-line-tools-to-help-troubleshoot"><a class="anchor" href="#q-are-there-command-line-tools-to-help-troubleshoot"></a><strong>Q: Are there command-line tools to help troubleshoot?</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Yes - cbft-bleve command line utility. It supports several options.</p>
</div>
<div class="paragraph">
<p>These are upside_down specific commands &#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>check</p>
<div class="ulist">
<ul>
<li>
<p>checks the contents of the index</p>
</li>
</ul>
</div>
</li>
<li>
<p>count</p>
<div class="ulist">
<ul>
<li>
<p>counts the number of documents in the index</p>
</li>
</ul>
</div>
</li>
<li>
<p>dictionary</p>
<div class="ulist">
<ul>
<li>
<p>prints the term dictionary for the specified field in the index</p>
</li>
</ul>
</div>
</li>
<li>
<p>dump</p>
<div class="ulist">
<ul>
<li>
<p>dumps the contents of the index</p>
</li>
</ul>
</div>
</li>
<li>
<p>fields</p>
<div class="ulist">
<ul>
<li>
<p>lists the fields in this index</p>
</li>
</ul>
</div>
</li>
<li>
<p>mapping</p>
<div class="ulist">
<ul>
<li>
<p>prints the mapping used for this index</p>
</li>
</ul>
</div>
</li>
<li>
<p>query</p>
<div class="ulist">
<ul>
<li>
<p>queries the index</p>
</li>
</ul>
</div>
</li>
<li>
<p>registry</p>
<div class="ulist">
<ul>
<li>
<p>registry lists the bleve components compiled into this executable</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are scorch specific commands &#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>scorch</p>
<div class="ulist">
<ul>
<li>
<p>command-line tool to interact with a scorch index</p>
</li>
</ul>
</div>
</li>
<li>
<p>zap</p>
<div class="ulist">
<ul>
<li>
<p>command-line tool to interact with a zap file</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Invoking the commands above with --help will highlight more information and further sub commands available for each.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-how-does-the-search-service-fts-score-documents"><a class="anchor" href="#q-how-does-the-search-service-fts-score-documents"></a><strong>Q: How does the Search service (FTS) score documents?</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FTS&#8217;s internal text indexing library (bleve) uses a slightly modified version of standard tf-idf scoring. This improvisation is done to normalize the score by various relevant factors. The search scoring happens at query time.</p>
</div>
<div class="paragraph">
<p>When bleve scores a document - it sort of sums a set of sub scores to reach the final score. Scores across different searches are not directly comparable as the search query is also an input factor to the scoring function. The more conjuncts/disjuncts/sub clauses your query has, the more it will influence the scoring.
The score of a particular hit is not absolute, meaning that it can only be used as a comparison to the highest score from the same search result. There isn&#8217;t a pre-defined range for valid scores.</p>
</div>
<div class="paragraph">
<p>Below is the summary of the scoring function in Search service,</p>
</div>
<div class="paragraph">
<p>Given a document which has a field  <code>f</code>  over which a given  match query <code>q</code>  is applied, then the  <code>scoreFn</code>  for that document is defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>scoreFn(q, f) = coord(q, f) * SUM(tw(t0, q, f), tw(t1, q, f), tw(t2, q, f)..., tw(tn, q, f))
where ti := term in q
coord(q, f) = nFoundTokens(q, f)/nTokens(q)
tw(ti, q, f) = queryWeight(q, f, ti) * fieldWeight(f, ti)
queryWeight(q, ti) = w(ti) * queryNorm(q)
w(ti) = boost(ti) * idf(ti)
queryNorm(q) = 1 / SQROOT(SUM(SQ(w(t0)),...,SQ(w(tn))))
fieldWeight(f, ti) = SQROOT(FREQ(ti, f))*idf(f, ti)*fieldNorm(f)
fieldNorm(f) = 1 / SQROOT(nTokens(f))
idf(f, ti) = 1 + LN(|Docs| / (1 + FREQ(ti, FIELDNAME(f), Docs)))
Docs = a set of all indexed documents</pre>
</div>
</div>
<div class="paragraph">
<p>where SQROOT, SUM, and LN denote standard mathematical functions. Auxiliary functions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>coord(q, f)</strong>  — is a dampening factor defined as a ratio of query tokens that are found in the given field, and the total number of tokens in a query.</p>
</li>
<li>
<p><strong>tw(ti, q, f)</strong>  — <strong>ti</strong> ’s term weight is the product of  <strong>ti</strong> ’s query weight and ti’s field weight.</p>
</li>
<li>
<p><strong>queryWeight(q, ti)</strong>  —  <strong>ti</strong> ’s query weight (wrt to  <strong>q</strong> ) is the product of its <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">inverse document frequency</a> (see  <strong>idf</strong>  below) and its <a href="http://www.blevesearch.com/docs/Query-String-Query/">boosting factor</a>.</p>
</li>
<li>
<p><strong>queryNorm(q)</strong>  — is used to normalize each query term’s contribution. It uses the <a href="https://en.wikipedia.org/wiki/Norm_(mathematics)#Euclidean_norm">Euclidean distance</a> as the normalization factor.</p>
</li>
<li>
<p><strong>fieldWeight(f, ti)</strong>  — is a normalized product of  <strong>ti</strong> ’s idf and the square root of its frequency.</p>
</li>
<li>
<p><strong>FREQ(ti, f)</strong>  — is the frequency of  <strong>ti</strong>  in the given field  <strong>f</strong> .</p>
</li>
<li>
<p><strong>fieldNorm(f)</strong>  — normalizes each (in  <strong>f</strong> ) term’s contribution to the score. The normalisation factor is the square root of the number of distinct terms in  <strong>f.</strong>  (Note that  <strong>f</strong> ’s terms may and may not be part of  <strong>q.</strong> )</p>
</li>
<li>
<p><strong>idf(f, ti)</strong>  — a dampening factor that favours terms that have high frequency in a small set of field, but not across the whole indexed (document) set.</p>
</li>
<li>
<p><strong>FREQ(ti, FIELDNAME(f), Docs)</strong>  —frequency of  <strong>ti</strong>  across all documents’ fields that have the same ID/Name as  <strong>f</strong> .</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bleve&#8217;s tf-idf scoring variant differs with the standard  <strong>textbook</strong>  functions (see <a href="http://nlp.stanford.edu/IR-book/html/htmledition/queries-as-vectors-1.html">Intro to Information Retrieval</a>):  mainly in these points.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Term frequency is augmented with the square root function.</p>
</li>
<li>
<p>The idf function is “ <strong>inverse document frequency smooth</strong> ” (due to the (1+) factor). Note that it is present in both the query weight and the field weight.</p>
</li>
<li>
<p>The normalization factors are different for the field weight (a variant of the  <strong>byte size</strong>  normalization) and the query weight ( <strong>Euclidean</strong> ).</p>
</li>
<li>
<p>The coordination factor, which is often not present by default, can have an impact on scores for small queries.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have an option to explore the score computations during any search in FTS by enabling the "Explain" field in the searchRequest to retrieve the score deriving details for the hits.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-can-i-store-specific-document-fields-within-fts-and-retrieve-those-as-a-part-of-the-search-results"><a class="anchor" href="#q-can-i-store-specific-document-fields-within-fts-and-retrieve-those-as-a-part-of-the-search-results"></a><strong>Q: Can I store specific document fields within FTS and retrieve those as a part of the search results?</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Yes, it involves a two-step process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Indexing</strong> - you need to specify the desired fields of the matching documents to be retrieved as a part of the index definition. To do so, select the "store" option checkbox in the field mapping definition for the desired fields. The FTS index will store the original field contents intact (without applying any text analysis) as a part of its internal storage.</p>
<div class="paragraph">
<p>For example, if you want to retrieve the field "description" in the document, then enable the "store" option like below.</p>
</div>
<div id="fts-type-mappings-child-field" class="imageblock text-left">
<div class="content">
<img src="_images/fts-type-mappings-child-field-dialog-complete.png" alt="fts type mappings child field dialog complete" width="460">
</div>
</div>
</li>
<li>
<p><strong>Searching</strong> - you need to specify the fields to be retrieved in the "fields" setting within the search request. This setting takes an array of field names which will be returned as part of the search response. The field names must be specified as strings. While there is no field name pattern matching available, you can use an asterisk ("*") to specify that all stored fields be returned with the response.</p>
<div class="paragraph">
<p>For retrieving the contents of the aforementioned "description" field, you may use the following search request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -XPOST -H "Content-Type: application/json" -u username:password http://host:port/api/index/FTS/query -d '{
  "fields": ["description"],
  "query": {"field": "queryFieldName", "match": "query text"},
}'</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="q-does-fts-support-in-memory-search-indexes"><a class="anchor" href="#q-does-fts-support-in-memory-search-indexes"></a><strong>Q: Does FTS support in-memory search indexes?</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FTS does not support in-memory search indexes. The search indexes are persisted to disk and are accessed as memory-mapped files.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
