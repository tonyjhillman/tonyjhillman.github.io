<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>ADVISOR Function | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="The ADVISOR function provides index recommendations to optimize query response time.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/n1ql/n1ql-language-reference/advisor.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/pages/n1ql-language-reference/advisor.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb"><a href="../query.html">Query</a></li>
<li class="crumb"><a href="index.html">SQL++ Language Reference</a></li>
<li class="crumb"><a href="functions.html">Functions</a></li>
<li class="crumb"><a href="metafun.html">Miscellaneous Utility Functions</a></li>
<li class="crumb"><a href="advisor.html">ADVISOR Function</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">ADVISOR Function</h1>
<div class="labels">
<ul><li class="reference"><span><i class="fas fa-book"></i></i> reference</span></li>
</ul>
</div>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise Edition</a></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The ADVISOR function provides index recommendations to optimize query response time.
There are two main scenarios for using this function.
One is to invoke the index advisor <em>immediately</em> for a given query or set of queries; the other is to start a session in which every query of interest is collected for a set time period, then invoke the index advisor <em>asynchronously</em> for that collection of queries when the session ends.
Within these two scenarios, this function has several different usages.
The operation and output of each usage depends on the function&#8217;s single argument.
For clarity, each usage is listed separately on this page.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advisor-string"><a class="anchor" href="#advisor-string"></a>ADVISOR(<code>string</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description"><a class="anchor" href="#description"></a>Description</h3>
<div class="paragraph">
<p>When used with a string argument, the function invokes the index advisor for a single SQL++ query.
The index advisor works with <a href="selectintro.html" class="xref page">SELECT</a>, <a href="update.html" class="xref page">UPDATE</a>, <a href="delete.html" class="xref page">DELETE</a>, or <a href="merge.html" class="xref page">MERGE</a> queries.</p>
</div>
</div>
<div class="sect2">
<h3 id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">string</dt>
<dd>
<p>A string, or an expression which resolves to a string, containing a single SQL++ query.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="return-value"><a class="anchor" href="#return-value"></a>Return Value</h3>
<div class="paragraph">
<p>Returns an index advisor results object with the following properties.</p>
</div>
<div id="results" class="paragraph">
<p><strong>Results</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>current_used_indexes</strong><br>
<em>optional</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If the query engine can select any current primary or secondary indexes to use with an input query, this is an array of Index objects, each giving information about one of the current indexes.</p>
</div>
<div class="paragraph">
<p>If the query engine cannot select a current index to use with an input query, this field does not appear.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt; <a href="#indexes">Indexes</a> &gt; array</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>recommended_covering_indexes</strong><br>
<em>optional</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If the index advisor recommends any indexes, this is an array of Index objects, each giving information about one of the recommended indexes.</p>
</div>
<div class="paragraph">
<p>If the index advisor cannot recommend any covering indexes, this field does not appear.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt; <a href="#indexes">Indexes</a> &gt; array</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>recommended_indexes</strong><br>
<em>optional</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If the index advisor recommends any indexes, this is an array of Index objects, each giving information about one of the recommended indexes.</p>
</div>
<div class="paragraph">
<p>If the index advisor cannot recommend any indexes, this field does not appear.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt; <a href="#indexes">Indexes</a> &gt; array</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="indexes" class="paragraph">
<p><strong>Indexes</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>index</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The SQL++ command used to define the index.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>statements</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An array of Statement objects, each giving information about one of the SQL++ input queries associated with this index.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt; <a href="#statements">Statements</a> &gt; array</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="statements" class="paragraph">
<p><strong>Statements</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 61.1111%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>run_count</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When the function is used with a single SQL++ input query, this is always 1.</p>
</div>
<div class="paragraph">
<p>When the function is used with an array of queries, or a collection of queries from a session, this is the number of times that this SQL++ input query occurs in the input array or session.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>integer</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>statement</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The SQL++ input query.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="example"><a class="anchor" href="#example"></a>Example</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/advisor.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="title">Get index advice for a single query</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-single.n1ql">SELECT ADVISOR("SELECT * FROM landmark
WHERE activity = 'eat' AND city = 'Paris'") AS Single;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-single.jsonc">[
  {
    "Single": {
      "current_used_indexes": [
        {
          "index": "CREATE INDEX def_inventory_landmark_city ON `default`:`travel-sample`.`inventory`.`landmark`(`city`)",
          "statements": [
            {
              "run_count": 1,
              "statement": "SELECT * FROM `travel-sample`.inventory.landmark\nWHERE activity = 'eat' AND city = 'Paris'"
            }
          ]
        }
      ],
      "recommended_indexes": [
        {
          "index": "CREATE INDEX adv_city_activity ON `default`:`travel-sample`.`inventory`.`landmark`(`city`,`activity`)",
          "statements": [
            {
              "run_count": 1,
              "statement": "SELECT * FROM `travel-sample`.inventory.landmark\nWHERE activity = 'eat' AND city = 'Paris'"
            }
          ]
        }
      ]
    }
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only one statement occurs in these results, because the function was called with a single query input.
In this case, the index advisor identifies one index which is currently used by the query, and recommends one secondary index.
No covering indexes are recommended.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advisor-array"><a class="anchor" href="#advisor-array"></a>ADVISOR(<code>array</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description-2"><a class="anchor" href="#description-2"></a>Description</h3>
<div class="paragraph">
<p>When used with an array argument, the function invokes the index advisor for multiple SQL++ queries.
The index advisor works with <a href="selectintro.html" class="xref page">SELECT</a>, <a href="update.html" class="xref page">UPDATE</a>, <a href="delete.html" class="xref page">DELETE</a>, or <a href="merge.html" class="xref page">MERGE</a> queries.</p>
</div>
</div>
<div class="sect2">
<h3 id="arguments-2"><a class="anchor" href="#arguments-2"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">array</dt>
<dd>
<p>An array of strings, or an expression which resolves to an array of strings, each of which contains a SQL++ query.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="return-value-2"><a class="anchor" href="#return-value-2"></a>Return Value</h3>
<div class="paragraph">
<p>Returns an <a href="#results">index advisor results</a> object.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples"><a class="anchor" href="#examples"></a>Examples</h3>
<div class="paragraph">
<p>Unresolved include directive in modules/n1ql/pages/n1ql-language-reference/advisor.adoc - include::ROOT:partial$query-context.adoc[]</p>
</div>
<div class="exampleblock">
<div class="title">Get index advice for multiple queries</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-multiple.n1ql">SELECT ADVISOR([
  "SELECT * FROM landmark
   WHERE activity = 'eat' AND city = 'Paris'",
  "SELECT * FROM landmark
   WHERE activity = 'see' AND city = 'San Francisco'"
]) AS Multiple;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-multiple.jsonc">[
  {
    "Multiple": {
      "current_used_indexes": [
        {
          "index": "CREATE INDEX def_inventory_landmark_city ON `default`:`travel-sample`.`inventory`.`landmark`(`city`)",
          "statements": [
            {
              "run_count": 1,
              "statement": "SELECT * FROM `travel-sample`.inventory.landmark\n   WHERE activity = 'eat' AND city = 'Paris'"
            },
            {
              "run_count": 1,
              "statement": "SELECT * FROM `travel-sample`.inventory.landmark\n   WHERE activity = 'see' AND city = 'San Francisco'"
            }
          ]
        }
      ],
      "recommended_indexes": [
        {
          "index": "CREATE INDEX adv_city_activity ON `default`:`travel-sample`.`inventory`.`landmark`(`city`,`activity`)",
          "statements": [
            {
              "run_count": 1,
              "statement": "SELECT * FROM `travel-sample`.inventory.landmark\n   WHERE activity = 'eat' AND city = 'Paris'"
            }
          ]
        },
        {
          "index": "CREATE INDEX adv_activity_city ON `default`:`travel-sample`.`inventory`.`landmark`(`activity`,`city`)",
          "statements": [
            {
              "run_count": 1,
              "statement": "SELECT * FROM `travel-sample`.inventory.landmark\n   WHERE activity = 'see' AND city = 'San Francisco'"
            }
          ]
        }
      ]
    }
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the index advisor recommends an index which would be suitable for both of the input queries.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Get index advice for recent completed requests</div>
<div class="content">
<div class="paragraph">
<p>This example uses a subquery to get an array of statements from the <a href="../../manage/monitor/monitoring-n1ql-query.html#sys-completed-req" class="xref page">system:completed_requests</a> catalog.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-recent.n1ql">SELECT ADVISOR((SELECT RAW statement FROM system:completed_requests)) AS Recent;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-recent.jsonc">[
  {
    "Recent": {
      "current_used_indexes": [
        {
          "index": "CREATE PRIMARY INDEX def_inventory_route_primary ON `default`:`travel-sample`.`inventory`.`route`",
          "statements": [
            {
              "run_count": 3,
              "statement": "SELECT * FROM `travel-sample`.inventory.route r JOIN `travel-sample`.inventory.airline a ON r.airlineid= META(a).id WHERE a.country = \"France\";"
            },
            {
              "run_count": 2,
              "statement": "SELECT d.id, d.destinationairport, RATIO_TO_REPORT(d.distance) OVER (PARTITION BY d.destinationairport) AS `distance-ratio` FROM `travel-sample`.inventory.route AS d LIMIT 7;"
            },
// ...
          ]
        },
        {
          "index": "CREATE PRIMARY INDEX def_inventory_airport_primary ON `default`:`travel-sample`.`inventory`.`airport`",
          "statements": [
            {
              "run_count": 1,
              "statement": "SELECT airportname FROM `travel-sample`.inventory.airport WHERE geo.alt NOT BETWEEN 0 AND 100;"
            }
          ]
        }
      ],
      "recommended_covering_indexes": [
        {
          "index": "CREATE INDEX adv_geo_alt_airportname ON `default`:`travel-sample`.`inventory`.`airport`(`geo`.`alt`,`airportname`)",
          "statements": [
            {
              "run_count": 1,
              "statement": "SELECT airportname FROM `travel-sample`.inventory.airport WHERE geo.alt NOT BETWEEN 0 AND 100;"
            }
          ]
        }
      ],
      "recommended_indexes": [
        {
          "index": "CREATE INDEX adv_geo_alt ON `default`:`travel-sample`.`inventory`.`airport`(`geo`.`alt`)",
          "statements": [
            {
              "run_count": 1,
              "statement": "SELECT airportname FROM `travel-sample`.inventory.airport WHERE geo.alt NOT BETWEEN 0 AND 100;"
            }
          ]
        },
        {
          "index": "CREATE INDEX adv_airlineid ON `default`:`travel-sample`.`inventory`.`route`(`airlineid`)",
          "statements": [
            {
              "run_count": 3,
              "statement": "SELECT * FROM `travel-sample`.inventory.route r JOIN `travel-sample`.inventory.airline a ON r.airlineid= META(a).id WHERE a.country = \"France\";"
            }
// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the index advisor recommends several covering indexes and secondary indexes, each of which would be suitable for multiple recent queries.
(Results are truncated for brevity.)</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advisor-session-start"><a class="anchor" href="#advisor-session-start"></a>ADVISOR(<code>start_obj</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description-3"><a class="anchor" href="#description-3"></a>Description</h3>
<div class="paragraph">
<p>When used with a <code>start_obj</code> object argument, the function can be used to start an index advisor session.
As long as the session is running, any queries that meet the criteria you specify are collected for later analysis.</p>
</div>
<div class="paragraph">
<p>By default, the session continues running for the duration you specify when you start the session.
At the end of the duration, the index advisor analyzes any queries that have been collected by this session.
The session and any resulting index advice are retained in the <em>tasks cache</em>.
You can then <a href="#advisor-session-get">get the results</a> for this session to see the index advice.</p>
</div>
</div>
<div class="sect2">
<h3 id="arguments-3"><a class="anchor" href="#arguments-3"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">start_obj</dt>
<dd>
<p>An object with the following properties:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">action</dt>
<dd>
<p>[Required] The string <code>start</code>.</p>
</dd>
<dt class="hdlist1">profile</dt>
<dd>
<p>[Optional] A string specifying the user profile whose queries you want to collect.
If omitted, all queries are collected.</p>
</dd>
<dt class="hdlist1">response</dt>
<dd>
<p>[Optional] A string representing a duration.
All completed queries lasting longer than this threshold are collected for analysis by the index advisor.
Valid time units are <code>ns</code> (nanoseconds), <code>us</code> (microseconds), <code>ms</code> (milliseconds), <code>s</code> (seconds), <code>m</code> (minutes), or <code>h</code> (hours).
If omitted, the default setting is <code>0s</code>.</p>
</dd>
<dt class="hdlist1">duration</dt>
<dd>
<p>[Required] A string representing a duration.
The index advisor session runs for the length of this duration.
Valid time units are <code>ns</code> (nanoseconds), <code>us</code> (microseconds), <code>ms</code> (milliseconds), <code>s</code> (seconds), <code>m</code> (minutes), or <code>h</code> (hours).</p>
</dd>
<dt class="hdlist1">query_count</dt>
<dd>
<p>[Optional] An integer specifying the maximum number of queries to be collected for analysis by the index advisor.
If omitted, the default setting is the same as the service-level <a href="../../settings/query-settings.html#completed-limit" class="xref page">completed-limit</a> setting.
You can change the service-level <code>completed-limit</code> setting to change the default for this property.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="return-value-3"><a class="anchor" href="#return-value-3"></a>Return Value</h3>
<div class="paragraph">
<p>Returns an object with the following property:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 61.1111%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>session</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the index advisor session.
You will need to refer to this name to <a href="#advisor-session-get">get the results</a> for this session, or to <a href="#advisor-session-stop">stop</a>, <a href="#advisor-session-abort">abort</a>, or <a href="#advisor-session-purge">purge</a> this session.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string (UUID)</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="example-2"><a class="anchor" href="#example-2"></a>Example</h3>
<div class="exampleblock">
<div class="title">Start an index advisor session</div>
<div class="content">
<div class="paragraph">
<p>The following example starts an index advisor session to run for one hour.
All completed queries taking longer than 0 seconds will be collected.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-start.n1ql">SELECT ADVISOR({"action": "start", "response": "0s", "duration": "1h"}) AS Collect;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-start.jsonc">[
  {
    "Collect": {
      "session": "0cd09ae4-a083-4a7e-86cd-85e42c140d60"
    }
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advisor-session-list"><a class="anchor" href="#advisor-session-list"></a>ADVISOR(<code>list_obj</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description-4"><a class="anchor" href="#description-4"></a>Description</h3>
<div class="paragraph">
<p>When used with a <code>list_obj</code> object argument, the function can be used to list index advisor sessions.
Each index advisor session is stored as a scheduled task in the <a href="../../manage/monitor/monitoring-n1ql-query.html#sys-tasks-cache" class="xref page">system:tasks_cache</a> catalog.</p>
</div>
</div>
<div class="sect2">
<h3 id="arguments-4"><a class="anchor" href="#arguments-4"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">list_obj</dt>
<dd>
<p>An object with the following properties:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">action</dt>
<dd>
<p>[Required] The string <code>list</code>.</p>
</dd>
<dt class="hdlist1">status</dt>
<dd>
<p>[Optional] A string specifying the status of the index advisor sessions to list.
This must be one of the following:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>completed</code>&#8201;&#8212;&#8201;only list completed sessions</p>
</li>
<li>
<p><code>active</code>&#8201;&#8212;&#8201;only list active sessions</p>
</li>
<li>
<p><code>all</code>&#8201;&#8212;&#8201;list all sessions</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>If omitted, the default is <code>all</code>.</p>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="return-value-4"><a class="anchor" href="#return-value-4"></a>Return Value</h3>
<div class="paragraph">
<p>Returns an array of tasks cache objects, each of which has the following properties.</p>
</div>
<div id="tasks-cache" class="paragraph">
<p><strong>Tasks Cache</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 61.1111%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>tasks_cache</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A nested object that gives information about an index advisor session.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#session">Session</a></p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="session" class="paragraph">
<p><strong>Session</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 61.1111%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>class</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The class of the session; in this case, <code>advisor</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>delay</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The scheduled duration of the session.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string (duration)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>id</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The internal ID of the session.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string (UUID)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>name</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the session.
You will need to refer to this name to <a href="#advisor-session-get">get the results</a> for this session, or to <a href="#advisor-session-stop">stop</a>, <a href="#advisor-session-abort">abort</a>, or <a href="#advisor-session-purge">purge</a> this session.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string (UUID)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>node</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The node where the session was started.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string (address)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>state</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The state of the session:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>scheduled</code>&#8201;&#8212;&#8201;the session is active.</p>
</li>
<li>
<p><code>cancelled</code>&#8201;&#8212;&#8201;the session was stopped.</p>
</li>
<li>
<p><code>completed</code>&#8201;&#8212;&#8201;the session is completed.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>enum (cancelled, completed, scheduled)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>subClass</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The subclass of the session; in this case, <code>analyze</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>submitTime</strong><br>
<em>required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The date and time when the function was called to start the session.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string (date-time)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>startTime</strong><br>
<em>optional</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The date and time when the session started.</p>
</div>
<div class="paragraph">
<p>If the session is still active, this field is not present.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string (date-time)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>stopTime</strong><br>
<em>optional</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The date and time when the session stopped.</p>
</div>
<div class="paragraph">
<p>If the session is still active, this field is not present.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>string (date-time)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>results</strong><br>
<em>optional</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An array containing a single <a href="#results">index advisor results</a> object.</p>
</div>
<div class="paragraph">
<p>If the session is still active, this field is not present.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt; <a href="#results">Results</a> &gt; array</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Returns an empty array if there are no index advisor sessions in the tasks cache.</p>
</div>
</div>
<div class="sect2">
<h3 id="example-3"><a class="anchor" href="#example-3"></a>Example</h3>
<div class="exampleblock">
<div class="title">List all index advisor sessions</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-list.n1ql">SELECT ADVISOR({"action": "list"}) AS List;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-list.jsonc">[
  {
    "List": [
      {
        "tasks_cache": {
          "class": "advisor",
          "delay": "10s",
          "id": "583af6ae-841e-5090-9a74-3607784533fa",
          "name": "0cd09ae4-a083-4a7e-86cd-85e42c140d60",
          "node": "127.0.0.1:8091",
          "results": [
// ...
          ],
          "startTime": "2021-01-19 15:57:51.015716783 +0000 UTC m=+19106.791327072",
          "state": "completed",
          "stopTime": "2021-01-19 15:57:51.123751229 +0000 UTC m=+19106.899361513",
          "subClass": "analyze",
          "submitTime": "2021-01-19 15:57:41.01262637 +0000 UTC m=+19096.788236671"
        }
      },
      {
        "tasks_cache": {
          "class": "advisor",
          "delay": "1h0m0s",
          "id": "ce4ec13f-720e-56ae-8790-8136ea0648e3",
          "name": "4e394fad-03d5-4fbf-b9a5-6ad902c8df75",
          "node": "127.0.0.1:8091",
          "results": [
            {}
          ],
          "state": "cancelled",
          "subClass": "analyze",
          "submitTime": "2021-01-19 15:56:12.398458243 +0000 UTC m=+19008.174068538"
        }
      }
    ]
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Results are truncated for brevity.)</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advisor-session-stop"><a class="anchor" href="#advisor-session-stop"></a>ADVISOR(<code>stop_obj</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description-5"><a class="anchor" href="#description-5"></a>Description</h3>
<div class="paragraph">
<p>When used with a <code>stop_obj</code> object argument, the function can be used to stop an index advisor session.
In this case, the session is stopped, and the index advisor analyzes any queries that have been collected by this session so far.
The session and any resulting index advice are retained in the tasks cache.
You can then <a href="#advisor-session-get">get the results</a> for this session to see the index advice.</p>
</div>
</div>
<div class="sect2">
<h3 id="arguments-5"><a class="anchor" href="#arguments-5"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">stop_obj</dt>
<dd>
<p>An object with the following properties:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">action</dt>
<dd>
<p>[Required] The string <code>stop</code>.</p>
</dd>
<dt class="hdlist1">session</dt>
<dd>
<p>[Required] A string specifying the name of a session.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="return-value-5"><a class="anchor" href="#return-value-5"></a>Return Value</h3>
<div class="paragraph">
<p>Returns an empty array.</p>
</div>
</div>
<div class="sect2">
<h3 id="example-4"><a class="anchor" href="#example-4"></a>Example</h3>
<div class="exampleblock">
<div class="title">Stop an index advisor session</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-stop.n1ql">SELECT ADVISOR({"action": "stop", "session": "0cd09ae4-a083-4a7e-86cd-85e42c140d60"})
AS Stop;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-stop.jsonc">[
  {
    "Stop": []
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advisor-session-abort"><a class="anchor" href="#advisor-session-abort"></a>ADVISOR(<code>abort_obj</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description-6"><a class="anchor" href="#description-6"></a>Description</h3>
<div class="paragraph">
<p>When used with an <code>abort_obj</code> object argument, the function can be used to abort an index advisor session.
In this case, the session is stopped, and the session is removed from the tasks cache.</p>
</div>
</div>
<div class="sect2">
<h3 id="arguments-6"><a class="anchor" href="#arguments-6"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">abort_obj</dt>
<dd>
<p>An object with the following properties:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">action</dt>
<dd>
<p>[Required] The string <code>abort</code>.</p>
</dd>
<dt class="hdlist1">session</dt>
<dd>
<p>[Required] A string specifying the name of a session.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="return-value-6"><a class="anchor" href="#return-value-6"></a>Return Value</h3>
<div class="paragraph">
<p>Returns an empty array.</p>
</div>
</div>
<div class="sect2">
<h3 id="example-5"><a class="anchor" href="#example-5"></a>Example</h3>
<div class="exampleblock">
<div class="title">Abort an index advisor session</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-abort.n1ql">SELECT ADVISOR({"action": "abort", "session": "0cd09ae4-a083-4a7e-86cd-85e42c140d60"})
AS Abort;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-abort.jsonc">[
  {
    "Abort": []
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advisor-session-get"><a class="anchor" href="#advisor-session-get"></a>ADVISOR(<code>get_obj</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description-7"><a class="anchor" href="#description-7"></a>Description</h3>
<div class="paragraph">
<p>When used with a <code>get_obj</code> object argument, the function can be used to get the results of a completed index advisor session.
The index advisor is invoked for any collected <a href="selectintro.html" class="xref page">SELECT</a>, <a href="update.html" class="xref page">UPDATE</a>, <a href="delete.html" class="xref page">DELETE</a>, or <a href="merge.html" class="xref page">MERGE</a> queries.</p>
</div>
</div>
<div class="sect2">
<h3 id="arguments-7"><a class="anchor" href="#arguments-7"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">get_obj</dt>
<dd>
<p>An object with the following properties:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">action</dt>
<dd>
<p>[Required] The string <code>get</code>.</p>
</dd>
<dt class="hdlist1">session</dt>
<dd>
<p>[Required] A string specifying the name of a session.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="return-value-7"><a class="anchor" href="#return-value-7"></a>Return Value</h3>
<div class="paragraph">
<p>Returns an array containing an array, which in turn contains an <a href="#results">index advisor results</a> object.</p>
</div>
<div class="paragraph">
<p>Returns an empty array if the specified session collected no queries, or if the specified session does not exist.</p>
</div>
</div>
<div class="sect2">
<h3 id="example-6"><a class="anchor" href="#example-6"></a>Example</h3>
<div class="exampleblock">
<div class="title">Get index advice for an index advisor session</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-get.n1ql">SELECT ADVISOR({"action": "get", "session": "0cd09ae4-a083-4a7e-86cd-85e42c140d60"})
AS Get;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-get.jsonc">[
  {
    "Get": [
      [
        {
          "current_used_indexes": [
            {
              "index": "CREATE PRIMARY INDEX idx_airport_primary ON `default`:`travel-sample`.`inventory`.`airport`",
              "statements": [
                {
                  "run_count": 1,
                  "statement": "SELECT airportname FROM `travel-sample`.inventory.airport WHERE geo.alt NOT BETWEEN 0 AND 100;"
                }
              ]
// ...
            }
          ],
          "recommended_covering_indexes": [
            {
              "index": "CREATE INDEX adv_city_name ON `default`:`travel-sample`.`inventory`.`hotel`(`city`,`name`)",
              "statements": [
                {
                  "run_count": 1,
                  "statement": "SELECT h.name, h.city, a.airportname FROM `travel-sample`.inventory.hotel h JOIN `travel-sample`.inventory.airport a ON h.city = a.city LIMIT 5;"
                }
              ]
// ...
            }
          ],
          "recommended_indexes": [
            {
              "index": "CREATE INDEX adv_geo_alt ON `default`:`travel-sample`.`inventory`.`airport`(`geo`.`alt`)",
              "statements": [
                {
                  "run_count": 1,
                  "statement": "SELECT airportname FROM `travel-sample`.inventory.airport WHERE geo.alt NOT BETWEEN 0 AND 100;"
                }
              ]
            }
          ]
        }
      ]
    ]
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Results are truncated for brevity.)</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advisor-session-purge"><a class="anchor" href="#advisor-session-purge"></a>ADVISOR(<code>purge_obj</code>)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="description-8"><a class="anchor" href="#description-8"></a>Description</h3>
<div class="paragraph">
<p>When used with a <code>purge_obj</code> object argument, the function can be used to purge the results of a completed index advisor session from the tasks cache.</p>
</div>
</div>
<div class="sect2">
<h3 id="arguments-8"><a class="anchor" href="#arguments-8"></a>Arguments</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">purge_obj</dt>
<dd>
<p>An object with the following properties:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">action</dt>
<dd>
<p>[Required] The string <code>purge</code>.</p>
</dd>
<dt class="hdlist1">session</dt>
<dd>
<p>[Required] A string specifying the name of a session.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="return-value-8"><a class="anchor" href="#return-value-8"></a>Return Value</h3>
<div class="paragraph">
<p>Returns an empty array.</p>
</div>
</div>
<div class="sect2">
<h3 id="example-7"><a class="anchor" href="#example-7"></a>Example</h3>
<div class="exampleblock">
<div class="title">Purge an index advisor session</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-purge.n1ql">SELECT ADVISOR({"action": "purge", "session": "0cd09ae4-a083-4a7e-86cd-85e42c140d60"})
AS Purge;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Result</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/n1ql/examples/functions/advisor-purge.jsonc">[
  {
    "Purge": []
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-links"><a class="anchor" href="#related-links"></a>Related Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The <a href="advise.html" class="xref page">ADVISE</a> statement&#8201;&#8212;&#8201;also describes the index advisor <a href="advise.html#recommendation-rules" class="xref page">recommendation rules</a></p>
</li>
<li>
<p>The <a href="../../tools/query-workbench.html#index-advisor" class="xref page">Index Advisor</a> in the Query Workbench</p>
</li>
<li>
<p>The <a href="../../manage/monitor/monitoring-n1ql-query.html#sys-tasks-cache" class="xref page">system:tasks_cache</a> catalog</p>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
