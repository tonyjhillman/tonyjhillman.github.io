<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>View Operations | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Views create indexes on your information that enable search and select operations on the data.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/learn/views/views-operation.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/learn/pages/views/views-operation.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Reference</li>
<li class="crumb"><a href="views-intro.html">Views Reference</a></li>
<li class="crumb"><a href="views-basics.html">View Concepts</a></li>
<li class="crumb"><a href="views-operation.html">View Operations</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">View Operations</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Views create indexes on your information that enable search and select operations on the data.
</blockquote>
</div>
<div class="paragraph">
<p>All views within Couchbase operate as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Views are updated as the document data is updated in memory.
There may be a delay between the document being created or updated and the document being updated within the view depending on the client-side query parameters.</p>
</li>
<li>
<p>Documents that are stored with an expiry are not automatically removed until the background expiry process removes them from the database.
This means that expired documents may still exist within the index.</p>
</li>
<li>
<p>Views are scoped within a design document, with each design document part of a single bucket.
A view can only access the information within the corresponding bucket.</p>
</li>
<li>
<p>View names must be specified using one or more UTF-8 characters.
You cannot have a blank view name.
View names cannot have leading or trailing white-space characters (space, tab, newline, or carriage-return).</p>
</li>
<li>
<p>Document IDs that are not UTF-8 encodable are automatically filtered and not included in any view.
The filtered documents are logged so that they can be identified.</p>
</li>
<li>
<p>If you have a long view request, use POST instead of GET.</p>
</li>
<li>
<p>Views can only access documents defined within their corresponding bucket.
You cannot access or aggregate data from multiple buckets within a given view.</p>
</li>
<li>
<p>Views are created as part of a design document, and each design document exists within the corresponding named bucket.</p>
<div class="ulist">
<ul>
<li>
<p>Each design document can have 0-n views.</p>
</li>
<li>
<p>Each bucket can contain 0-n design documents.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All the views within a single design document are updated when the update to a single view is triggered.
For example, a design document with three views updates all three views simultaneously when one view is updated.</p>
</li>
<li>
<p>Updates can be triggered in two ways:</p>
<div class="ulist">
<ul>
<li>
<p>At the point of access or query by using the <code>stale</code> parameter.</p>
</li>
<li>
<p>Automatically by Couchbase Server based on the number of updated documents, or the period since the last update.
Automatic updates can be controlled either globally, or individually on each design document.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Views are updated incrementally.
The first time the view is accessed, all the documents within the bucket are processed through the map/reduce functions.
Each new access to the view only processes the documents that have been added, updated, or deleted, since the last time the view index was updated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In practice, this means that views are entirely incremental in nature.
Updates to views are typically quick as they only update changed documents.
Ensure that views are updated by using either the built-in automatic update system, through client-side triggering, or explicit updates within your application framework.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The view update process is incremental by nature.
The information is only appended to the index stored on the disk making sure that the index gets updated efficiently.
Compaction (including auto-compaction) will optimize the index size on disk and optimize the index structure.
An optimized index is more efficient to be updated and queried.</p>
</li>
<li>
<p>The entire view is recreated if the view definition has changed.
Because this would have a detrimental effect on live data, only development views can be modified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Design documents organize views, and indexes are created according to the design document.
If you change a single view in a design document that contains multiple views, you will invalidate all the views and stored indexes within the design document.
You will then have to rebuild all corresponding views defined in that design document.
Rebuilding of the index will increase the I/O across the cluster, in addition to the I/O required for any active production views.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can choose to update the result set from a view before you query it or after you query.
Or you can choose to retrieve the existing result set from a view when you query the view.
In this case, the results are possibly out of date, or stale.</p>
</li>
<li>
<p>The views engine creates an index is for each design document; this index contains the results for all the views within that design document.</p>
</li>
<li>
<p>The index information stored on disk consists of the combination of both the key and value information defined within your view.
The key and value data is stored in the index so that the information can be returned as quickly as possible.
Views can then include a reduce function and return the reduced information by extracting that data from the index.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The value and key information from the defined map function are stored in the index.
The overall index size can be larger than the stored data if the emitted key/value information is larger than the original source document data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-expiration-impacts-views"><a class="anchor" href="#how-expiration-impacts-views"></a>How expiration impacts views</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Be aware that Couchbase Server does lazy expiration, that is, expired items are flagged as deleted rather than being immediately erased.
Couchbase Server has a maintenance process, called <em>expiry pager</em> that periodically looks through all information and erase expired items.
The maintenance process runs every 10 minutes, by default, unless configured to run at a different interval.
When an item is requested, Couchbase Server removes the item flagged for deletion and provides a response that the item does not exist.</p>
</div>
<div class="paragraph">
<p>The result set from a view <em>will contain</em> any items stored on disk that meet the requirements of your views function.
Therefore, the information not removed from the disk may appear as part of a result set when you query a view.</p>
</div>
<div class="paragraph">
<p>Using Couchbase views, you can also perform the <em class="term">reduce</em> functions on data, which perform calculations or other aggregations of data.
For instance, if you want to count the instances of a type of object, use a reduce function.
Once again, if an item is on disk, it will be included in any calculation performed by your reduce functions.
Based on this behavior due to disk persistence, here are guidelines on handling expiration with views:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Detect expired documents in result sets</strong>: The items not removed as part of the expiry pager maintenance process are part of a result set returned by querying the view.</p>
</li>
<li>
<p><strong>Perform aggregations and calculations on data</strong>: In some cases, you can perform the <code>reduce</code> function to aggregate and calculate data in Couchbase Server.
In this case, Couchbase Server takes pre-calculated values stored for an index and derives a final result.
Any expired items still on disk will be part of the reduction, which might not be an issue for your final result if the ratio of expired items is proportionately low compared to other items.
For instance, if you have ten expired scores still on disk for an average performed over 1 million players, there may be only a minimal level of difference in the final result.
However, if you have ten expired scores on disk for an average performed over 20 players, you would get very different result than the average you would expect.</p>
<div class="paragraph">
<p>Run the expiry pager process more frequently to ensure that items that have expired are not included in calculations used in the reduce function.
Do note that this interval will have some slight impact on node performance as it will be performing cleanup more frequently on the node.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about setting intervals for the maintenance process, refer to the Couchbase command-line tool and review the examples on <code>exp_pager_stime</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-views-function-in-a-cluster"><a class="anchor" href="#how-views-function-in-a-cluster"></a>How views function in a cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Distributing data</strong>.
If you familiar working with Couchbase Server, you know that the server distributes data across different nodes in a cluster.
If you have four nodes in a cluster, on average, each node will contain about 25% of active data.
If you use views with Couchbase Server, the indexing process runs on all four nodes, and the four nodes will contain roughly 25% of the results from indexing on disk.
This index is called a <em>partial index</em> since it is based on a subset of data within a cluster (shown in the illustration).</p>
</div>
<div class="paragraph">
<p><strong>Replicating data and Indexes</strong>.
Couchbase Server also provides data replication; this means that the server will replicate data from one node to another node.
In case the first node fails the second node can still handle requests for the data.
To handle possible node failure, you can specify that Couchbase Server also replicate a partial index for replicated data.
By default, each node in a cluster will have a copy of each design document and view functions.
If you make any changes to a views function, Couchbase Server will replicate this change to all nodes in the cluster.
The sever will generate indexes from views within a single design document and store the indexes in a single file on each node in the cluster:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/views/views_replica.png" alt="views replica" width="720">
</div>
</div>
<div class="paragraph">
<p>Couchbase Server can optionally create replica indexes on nodes that contain replicated data; this is to prepare your cluster for a failover scenario.
The server does not replicate index information from another node.
Instead, each node creates an index for the replicated data it stores.
The server recreates indexes using the replicated data on a node for each defined design document and view.
By providing replica indexes, the server enables you to perform queries even in the event of node failure.
You can specify whether Couchbase Server creates replica indexes or not when you create a data bucket.</p>
</div>
<div class="paragraph">
<p><strong>Query Time within a Cluster</strong></p>
</div>
<div class="paragraph">
<p>When you query a view and thereby trigger the indexing process, you send that request to a single node in the cluster.
This node then distributes the request to all other nodes in the cluster.
Depending on the parameter sent in your query, each node will either send the most current partial index at that node, will update the partial index and send it, or send the partial index and update it on disk.
Couchbase Server will collect and collate these partial indexes and send this aggregate result to a client.</p>
</div>
<div class="paragraph">
<p>To handle errors when you perform a query, you can configure how the cluster behaves when errors occur.</p>
</div>
<div class="paragraph">
<p><strong>Queries During Rebalance or Failover</strong></p>
</div>
<div class="paragraph">
<p>You can query an index during cluster rebalance and node failover operations.
If you perform queries during rebalancing or node failure, Couchbase Server will ensure that you receive the query results that you would expect from a node as if there were no rebalance or node failure.</p>
</div>
<div class="paragraph">
<p>During node rebalancing, you will get the same results you would get as if the data were active data on a node and as if data were not being moved from one node to another.
In other words, this feature ensures you get query results from a node during rebalancing that are consistent with the query results you would have received from the node before rebalance started.
This functionality operates by default in Couchbase Server.
However,  you can optionally choose to disable it.</p>
</div>
<div class="paragraph">
<p>If querying of indexes during cluster rebalancing and node failover is enabled, cluster rebalancing will take more time.
However, it is not recommended that you disable this functionality in production without thorough testing or you might observe inconsistent query results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="view-performance"><a class="anchor" href="#view-performance"></a>View performance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>View performance includes the time taken to update the view, the time required for the view update to be accessed, and the time for the updated information to be returned, depend on different factors.
Your file system cache, frequency of updates, and the time between updating document data and accessing (or updating) a view will all impact performance.</p>
</div>
<div class="paragraph">
<p>Some key notes and points are provided below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Index queries are always accessed from disk; indexes are not kept in RAM by Couchbase Server.
However, frequently used indexes are likely to be stored in the filesystem cache used for caching information on disk.
Increasing your filesystem cache, and reducing the RAM allocated to Couchbase Server from the total RAM available will increase the RAM available for the OS.</p>
</li>
<li>
<p>The filesystem cache will play a role in the update of the index information process.
Recently updated documents are likely to be stored in the filesystem cache.
Requesting a view update immediately after an update operation will likely use information from the filesystem cache.
The eventual persistence nature implies a small delay between updating a document, it being persisted, and then being updated within the index.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keeping some RAM reserved for your operating system to allocate filesystem cache, or increasing the RAM allocated to filesystem cache, will help keep space available for index file caching.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View indexes are stored, accessed, and updated, entirely independently of the document updating system.
The index update and retrieval are not dependent on documents in memory to build the index information.
Separate systems also mean that the performance, when retrieving and accessing the cluster, is not dependent on the document store.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="index-stale"><a class="anchor" href="#index-stale"></a>Index updates and the stale parameter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Indexes are created by Couchbase Server based on the view definition, but updating of these indexes can be controlled at the point of data querying, rather than each time data is inserted.
Whether the index is updated when queried can be controlled through the <code>stale</code> parameter.</p>
</div>
<div class="paragraph">
<p>Irrespective of the <code>stale</code> parameter, documents can only be indexed by the system once the document is persisted to the disk.
If the document is not persisted to the disk, use of <code>stale</code> will not force this process.
You can use the <code>observe</code> operation to monitor when documents are persisted to the disk or updated in the index.</p>
</div>
<div class="paragraph">
<p>Views can also be updated automatically according to a document change, or interval count.</p>
</div>
<div class="paragraph">
<p>Three values for <code>stale</code> are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>stale=ok</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The index is not updated.
If an index exists for the given view, then the information in the current index is used as the basis for the query and the results are returned accordingly.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/views/views-stale-sequence-stale.png" alt="views stale sequence stale" width="360">
</div>
</div>
<div class="paragraph">
<p>This setting results in the fastest response times to a given query since the existing index is used without being updated.
However, this might return incomplete information if changes have been made to the database, and these documents would otherwise be included in the given view.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>stale=false</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The index is updated before you execute the query, making sure that any documents updated and persisted to disk are included in the view.
The client will wait until the index has been updated before the query has executed and, therefore, the response will be delayed until the updated index is available.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/views/views-stale-sequence-updatebefore.png" alt="views stale sequence updatebefore" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>stale=update_after</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the default setting if no <code>stale</code> parameter is specified.
The existing index is used as the basis of the query, but the index is marked for updating once the results have been returned to the client.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/views/views-stale-sequence-updateafter.png" alt="views stale sequence updateafter" width="600">
</div>
</div>
<div class="paragraph">
<p>The indexing engine is an asynchronous process; this means querying an index may produce results you may not expect.
For example, if you update a document, and then immediately run a query on that document you may not get the new information in the emitted view data.
The document updates have not yet been committed to the disk, at which point the updates are indexed.</p>
</div>
<div class="paragraph">
<p>The deleted documents may appear in the index even after deletion because the deleted document is still not removed from the index.</p>
</div>
<div class="paragraph">
<p>When you have multiple clients accessing an index, the index update process and results returned to clients depend on the parameters passed by each client and the sequence that the clients interact with the server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Situation 1</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Client 1 queries view with <code>stale=false</code></p>
</li>
<li>
<p>Client 1 waits until server updates the index</p>
</li>
<li>
<p>Client 2 queries view with <code>stale=false</code> while re-indexing from Client 1 still in progress</p>
</li>
<li>
<p>Client 2 will wait until existing index process triggered by Client 1 completes.
Client 2 gets updated index.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Situation 2</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Client 1 queries view with <code>stale=false</code></p>
</li>
<li>
<p>Client 1 waits until server updates the index</p>
</li>
<li>
<p>Client 2 queries view with <code>stale=ok</code> while re-indexing from Client 1 in progress</p>
</li>
<li>
<p>Client 2 will get the existing index</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Situation 3</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Client 1 queries view with <code>stale=false</code></p>
</li>
<li>
<p>Client 1 waits until server updates the index</p>
</li>
<li>
<p>Client 2 queries view with <code>stale=update_after</code></p>
</li>
<li>
<p>If re-indexing from Client 1 not done, Client 2 gets the existing index.
If re-indexing from Client 1 is done, Client 2 gets this updated index and triggers re-indexing.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Index updates may be stacked if multiple clients request the view be updated before the information is returned ( <code>stale=false</code> ).
Multiple clients updating and querying the index data can then get the updated document and version of the view each time.
For <code>stale=update_after</code> queries, there is no stacking, since all updates occur after the query has been accessed.</p>
</div>
<div class="paragraph">
<p>Sequential accesses</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client 1 queries view with stale=ok</p>
</li>
<li>
<p>Client 2 queries view with stale=false</p>
</li>
<li>
<p>View gets updated</p>
</li>
<li>
<p>Client 1 queries a second time view with stale=ok</p>
</li>
<li>
<p>Client 1 gets the updated view version</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The above scenario can cause problems when paginating over a number of records as the record sequence might change between individual queries.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="automated-index-updates"><a class="anchor" href="#automated-index-updates"></a>Automated index updates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to a configurable update interval, you can also update all indexes automatically in the background.
You configure automated update through two parameters, the update time interval in seconds and the number of document changes that occur before the views engine updates an index.
These two parameters are <code>updateInterval</code> and <code>updateMinChanges</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>updateInterval</code>: the time interval in milliseconds, the default is 5000 milliseconds.
At every <code>updateInterval</code> the views engine checks if the number of document mutations on disk is greater than <code>updateMinChanges</code>.
If true, it triggers the view update.
The documents stored on disk potentially lag documents that are in-memory for tens of seconds.</p>
</li>
<li>
<p><code>updateMinChanges</code>: the number of document changes that occur before re-indexing occurs, the default is 5000 changes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The auto-update process only operates on the full-set development and production indexes.
Auto-update does not operate on partial set development indexes.</p>
</div>
<div class="paragraph">
<p>Irrespective of the automated update process, documents can only be indexed by the system once the document has been persisted to disk.
If the document has not been persisted to disk, the automated update process will not force the unwritten data to be written to disk.
You can use the <code>observe</code> operation to monitor when documents have been persisted to disk or updated in the index.</p>
</div>
<div class="paragraph">
<p>The updates are applied as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Active indexes, Production views</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For all active, production views, indexes are automatically updated according to the update interval <code>updateInterval</code> and the number of document changes <code>updateMinChanges</code>.</p>
</div>
<div class="paragraph">
<p>If <code>updateMinChanges</code> is set to 0 (zero), then automatic updates are disabled for main indexes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replica indexes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If replica indexes have been configured for a bucket, the index is automatically updated according to the document changes ( <code>replicaUpdateMinChanges</code> ; default 5000) settings.</p>
</div>
<div class="paragraph">
<p>If <code>replicaUpdateMinChanges</code> is set to 0 (zero), then automatic updates are disabled for replica indexes.</p>
</div>
<div class="paragraph">
<p>The trigger level can be configured both globally and for individual design documents for all indexes using the REST API.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>ddocs</code> allow you to set <code>updateMinChanges</code> or <code>replicaUpdateMinChanges</code> only via options.
The <code>updateInterval</code> can only be set for the whole cluster.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To obtain the current view update daemon settings, access a node within the cluster on the administration port using the URL <code>http://nodename:8091/settings/viewUpdateDaemon</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET http://Administrator:Password@nodename:8091/settings/viewUpdateDaemon</pre>
</div>
</div>
<div class="paragraph">
<p>The request returns the JSON of the current update settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "updateInterval":5000,
    "updateMinChanges":5000,
    "replicaUpdateMinChanges":5000
}</pre>
</div>
</div>
<div class="paragraph">
<p>To update the settings, use <code>POST</code> with a data payload that includes the updated values.
For example, to update the time interval to 10 seconds, and document changes to 7000 each:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>POST http://nodename:8091/settings/viewUpdateDaemon
updateInterval=10000&amp;updateMinChanges=7000</pre>
</div>
</div>
<div class="paragraph">
<p>If successful, the return value is the JSON of the updated configuration.</p>
</div>
<div class="paragraph">
<p>To configure the <code>updateMinChanges</code> or <code>replicaUpdateMinChanges</code> values explicitly on individual design documents, specify the parameters within the <code>options</code> section of the design document.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
   "_id": "_design/myddoc",
   "views": {
      "view1": {
          "map": "function(doc, meta) { if (doc.value) { emit(doc.value, meta.id);} }"
      }
   },
   "options": {
       "updateMinChanges": 1000,
       "replicaUpdateMinChanges": 20000
   }
}</pre>
</div>
</div>
<div class="paragraph">
<p>You can set this information when creating and updating design documents through the design document REST API.
To perform this operation using the <code>curl</code> tool:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; curl -X POST -v -d 'updateInterval=7000&amp;updateMinChanges=7000' \
    'http://Administrator:Password@192.168.0.72:8091/settings/viewUpdateDaemon'</pre>
</div>
</div>
<div class="paragraph">
<p>Partial-set development views are not automatically rebuilt.
During rebalancing development views are not updated, even when consistent views are enabled, as this relies on the automated update mechanism.
Updating development views in this way would waste system resources.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
