<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Certificates | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Server supports x.509 certificates for client and server.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/learn/security/certificates.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/learn/pages/security/certificates.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Learn</li>
<li class="crumb"><a href="security-overview.html">Security</a></li>
<li class="crumb"><a href="authentication.html">Authentication</a></li>
<li class="crumb"><a href="certificates.html">Certificates</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Certificates</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Couchbase Server supports x.509 certificates for client and server.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="certificates-in-couchbase"><a class="anchor" href="#certificates-in-couchbase"></a>Certificates and Couchbase Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Server supports the use of x.509 certificates, for clients and servers.
This ensures that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only approved users, applications, machines, and endpoints have access to system resources.
Consequently, the mechanism can be used by Couchbase SDK clients, to access Couchbase Services; and by source clusters that use XDCR to replicate data to target clusters.</p>
</li>
<li>
<p>Clients can verify the identity of Couchbase Server, thereby ensuring that they are not exchanging data with a rogue entity.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Full Admin, Local User Security Admin, or External User Security Admin privileges are required, for the management of certificates.</p>
</div>
<div class="paragraph">
<p>This page provides a general overview of certificates, and of their management in the context of Couchbase Server.
For step-by-step instructions on certificate creation and deployment, see <a href="../../manage/manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a> and <a href="../../manage/manage-security/configure-client-certificates.html" class="xref page">Configure Client Certificates</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="certificate-content"><a class="anchor" href="#certificate-content"></a>Certificate Content</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Certificate-based authentication relies on a <em>Certificate Authority</em> (CA), to validate identities and issue certificates.
Each certificate includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name of the entity it identifies.</p>
</li>
<li>
<p>An expiration date.</p>
</li>
<li>
<p>The name of the CA that issued the certificate.</p>
</li>
<li>
<p>The digital signature either of the issuing CA, or of an intermediate certificate through which the authority of the issuing CA can be traced.</p>
</li>
<li>
<p>A public key, which corresponds to the <em>private</em> key that was used to generate the certificate; and which can therefore potentially be used in conjunction with that private key, so as to handle authentication and secure communication between client and server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This information associates the <em>identified entity</em> (that is, the server-node or client bearing the certificate) with the issuing CA, such that third parties who know and trust the CA, but are unfamiliar with the identified entity, may elect to trust the identified entity on the basis of their trust in the CA.
Note that all systems that use certificates for authentication maintain their own collection of trusted CA certificates: if, when an entity attempts to authenticate, the entity proves that it has itself been authorized by a CA whose certificate is included in the system&#8217;s collection, the entity may be trusted by the system.</p>
</div>
<div class="paragraph">
<p>Additionally, certificates can each be configured to contain <em>extensions</em>, which are used to constrain the certificate&#8217;s capabilities (for example, by indicating the IP address of the server on which the certificate must reside; or by indicating the uses to which its public key must be restricted); or to identify a <em>username</em>, based on which client-authentication and authorization can proceed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="certificate-hierarchies"><a class="anchor" href="#certificate-hierarchies"></a>Certificate Hierarchies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On a Couchbase-Server cluster, certificates are managed and deployed <em>hierarchically</em>.
The certificate with overall authority for the cluster is at the top of the hierarchy; and its authority is inherited by all certificates on lower tiers of the hierarchy.
One certificate <em>issues</em> another certificate &#8212; thereby letting the new certificate inherit its own authority and occupy the tier immediately below itself &#8212; by the process of <em>certificate signing</em>.</p>
</div>
<div class="paragraph">
<p>A <em>two-tier</em> certificate hierarchy is one where the CA certificate has itself issued a certificate directly for one or more <em>identified entities</em> &#8212; each of which could be an individual node within a cluster, or a client application that wishes to interact with the cluster.
If a third party trusts a CA, then it will also trust an identified entity whose own certificate has been issued by that CA.
The CA, being at the top of the two-tier hierarchy, is often referred to as the <em>Root CA</em>.</p>
</div>
<div class="paragraph">
<p>A <em>two-plus-tier</em> certificate hierarchy is one where a Root CA has issued a certificate to an <em>intermediate authority</em>, which in turn has issued a certificate either to another intermediate authority, or directly to one or more entities that are to be identified.
Use of a two-plus-tier hierarchy requires that all intermediate certificates, as well as a given entity&#8217;s certificate, be available for inspection when authentication is attempted; otherwise, the ultimate authority of the root will not be traced, and authentication will fail.
All certificates, both on the server-side and on the client-side, should therefore be made available to the requesting party as a complete <em>trust chain</em>.
In 7.1+, either of the following procedures can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The entity&#8217;s own certificate, and all intermediate certificates, are provided directly to the requesting party.
The requesting party is expected to find the CA&#8201;&#8212;&#8201;the last certificate in the chain&#8201;&#8212;&#8201;in its own trust store; and if it does, authentication may proceed.</p>
</li>
<li>
<p>The entity&#8217;s own certificate alone is provided directly to the requesting party.
The requesting party is expected to find all associated intermediates, and the CA, in its own trust store; and if it does, authentication may proceed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="server-certificates"><a class="anchor" href="#server-certificates"></a>Default Certificates and Certificate Substitution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, Couchbase Server provides minimally defined <em>root</em> and <em>entity</em> certificates to protect cluster and individual nodes.
Administrators can replace these, with customized or externally acquired certificates, and with corresponding certificate-chains.
All certificates and certificate-chains for client-side use need to be explicitly created and/or deployed by administrators, as appropriate.</p>
</div>
<div class="sect2">
<h3 id="cluster-certificate"><a class="anchor" href="#cluster-certificate"></a>Cluster Certificate</h3>
<div class="paragraph">
<p>The cluster certificate is the <em>root certificate</em> issued for the cluster; and contains the public key of the corresponding Certificate Authority (CA).
The certificate itself is often referred to as the <em>Root CA</em>.
Programs that wish to interact securely with Couchbase Server must elect to trust this CA.
By means of <em>certificate signing</em>, the cluster certificate grants its authority to other certificates: this includes both server-side and client-side certificates.
Thus, if client and server share the same root certificate, they are likely to trust one another.</p>
</div>
<div class="paragraph">
<p>Couchbase Server provides a default, self-signed cluster certificate, which is created and deployed when the first node in a cluster is created.
A new, replacement cluster certificate can be deployed on the cluster by means of the Couchbase REST API or CLI.
The current cluster certificate is always visible on the <strong>Root Certificate</strong> panel of the <strong>Security</strong> screen of Couchbase Web Console.
See <a href="../../manage/manage-security/manage-security-settings.html#root-certificate-security-screen-display" class="xref page">Root Certificate</a>.</p>
</div>
<div class="paragraph">
<p>The file for the cluster certificate (indeed, for any other server or client certificate) is required to be in <em>Privacy Enhanced Mail</em> (or <em>PEM</em>) format, with a <code>.pem</code> extension.
The file can have any name, although <code>ca.pem</code> is commonly used.
On creation, the certificate is generated (indeed, all certificates, whether server-side or client-side are generated) from a corresponding, already created <em>private key</em>; whose file is in <em>PKCS #1</em> or <em>PKCS #8</em> format, with a <code>.key</code> extension.
(For further information, see <a href="#private-key-formats">Private Key Formats</a>, below.)
The name of the private key often corresponds to the name of the certificate it generates: for example, <code>ca.key</code> would be used to generate <code>ca.pem</code>.
When an existing certificate is to be used to grant its authority to another, the existing certificate&#8217;s <code>.key</code> and <code>.pem</code> files are both specified in the creation-process for the new certificate.</p>
</div>
<div class="paragraph">
<p>Note that the private key of the default, self-signed cluster certificate is <em>not</em> made available.
Consequently, custom certificate-chains based on the default certificate <em>cannot</em> be created.
To create custom certificate-chains, a custom cluster certificate and private key must be generated (or alternatively, a Root CA must be acquired from an external authority, and certificate-chains then created based on an authority-signed <em>intermediate certificate</em>, as described below).</p>
</div>
<div class="paragraph">
<p>Examples of creating cluster and other certificates based on private keys are provided in <a href="../../manage/manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a></p>
</div>
<div class="sect3">
<h4 id="multiple-root-cas"><a class="anchor" href="#multiple-root-cas"></a>Multiple Root CAs</h4>
<div class="paragraph">
<p>Couchbase Server allows multiple Root CA certificates to be loaded.
Together, these constitute a <em>trust store</em>, whereby Couchbase Server is able to determine whether or not to trust a client that is attempting access: if the client&#8217;s Root CA, as identified through examination of the client-certificates&#8217;s trust chain, resides in the cluster&#8217;s trust store, the client may be trusted.</p>
</div>
<div class="paragraph">
<p>The Couchbase-Server trust store includes one or more Root CAs that are used to provide authority to individual nodes: each node has at most one node certificate, potentially with a concatenated trust chain; and this points to a single Root CA in the cluster&#8217;s trust store.
A single Root CA may be pointed to by the trust chains of multiple nodes.
All Root CAs in the trust store are accessible to all nodes, and multiple Root CAs may therefore be used in facilitating encrypted node-to-node communication.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="using-multiple-cas.html" class="xref page">Using Multiple Root Certificates</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="intermediate-certificates"><a class="anchor" href="#intermediate-certificates"></a>Intermediate Certificates</h3>
<div class="paragraph">
<p>An <em>intermediate certificate</em> (sometimes referred to as a <em>subordinate certificate</em>, an <em>Intermediate CA</em>, or a <em>Signing CA</em>) can be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A certificate signed by the cluster certificate (the <em>Root CA</em>).</p>
</li>
<li>
<p>One of a chain of intermediate certificates, each of which has been signed by that preceding it in the chain; except the first, which has been signed by the cluster certificate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main purpose of the intermediate certificate is to sign <em>node certificates</em>, <em>client certificates</em>, or other <em>intermediate certificates</em>; and thereby convey the authority of the cluster certificate to the node or client certificates <em>indirectly</em>.
This allows the cluster certificate&#8217;s own private key to be only minimally used (and thereby more securely maintained) when multiple nodes or clients need to be signed &#8212; possibly across multiple clusters, subnets, or data centers.</p>
</div>
<div class="paragraph">
<p>The default certificates provided by Couchbase Server do not include intermediates: entity certificates are all signed directly by the root (the <em>cluster</em> certificate).
However, if customized certificates and certificate-chains are substituted by the administrator, intermediate certificates can be defined and used.</p>
</div>
<div class="paragraph">
<p>Intermediate certificates can be uploaded to the Couchbase-Server trust store.
For information, see <a href="using-multiple-cas.html#adding-intermediate-certificates-to-the-trust-store" class="xref page">Adding Intermediate Certificates to the Trust Store</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="node-certificate"><a class="anchor" href="#node-certificate"></a>Node Certificates</h3>
<div class="paragraph">
<p>A <em>node certificate</em>, signed directly by the <em>cluster</em> certificate, is assigned to each node in a Couchbase Cluster by default.
The process whereby default node certificates are generated (based on a new private key) and signed (by means of the current cluster certificate and cluster private key) is entirely automated; and occurs whenever a single-node cluster is created, and whenever additional nodes are added or joined.
Certificate-based security for a Couchbase Server-cluster is thereby provided, in a limited form, <em>out-of-the-box</em> (supporting, for example, all the standard Couchbase-Server secure ports &#8212; which are described in <a href="../../install/install-ports.html" class="xref page">Couchbase Server Ports</a> &#8212;  and <a href="../clusters-and-availability/node-to-node-encryption.html" class="xref page">Node-to-Node Encryption</a>).
However, broader security requirements may need to be supported by means of <em>customized</em> certificates, configured to include special extensions and <em>Subject Alternative Names</em>, based on an administrator-selected root authority.</p>
</div>
<div class="paragraph">
<p>When customized node certificates have been prepared for a cluster, the following elements must be deployed on each node of the cluster, for its node certificate to become active:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The node private key, which has been used to create the node certificate for the current node.
On each node, this must be named <code>pkey.key</code>.</p>
</li>
<li>
<p>The node certificate chain-file.
On each node, this must be named <code>chain.pem</code>.
When the node certificate has been signed directly by the cluster certificate, <code>chain.pem</code> is nothing more than the node certificate file, renamed.
However, when the node certificate has gained the CA&#8217;s authority by means of a sequence of one or more intermediate certificates, <code>chain.pem</code> may be a correspondingly ordered <em>concatenation</em> of all the certificates in the chain, except the cluster certificate: access to this file allows the authority of the node certificate to be established by progressive examination of the signing authorities in its chain.</p>
<div class="paragraph">
<p>Alternatively, if indeed the node certificate has gained the CA&#8217;s authority by means of a sequence of one or more intermediate certificates, <code>chain.pem</code> may still be configured to contain only the node certificate; if it is assumed that all intermediates in the chain are already resident in the client&#8217;s <em>trust store</em>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Couchbase Server requires that these files, when newly created, be manually copied to a specific location in the filesystem: from this location, they are deployed by Couchbase Server.
Examples are provided in <a href="../../manage/manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="client-certificates"><a class="anchor" href="#client-certificates"></a>Client Certificates</h3>
<div class="paragraph">
<p>A Couchbase Server-client can use a <em>client certificate</em> to identify itself to Couchbase Server: this allows the server to authenticate the client, and to authorize the client&#8217;s associated <em>user</em>.
Information included in the certificate identifies the user by means of a <em>username</em>.</p>
</div>
<div class="paragraph">
<p>Couchbase Server creates and uses client certificates by default, for inter-node communication; but these are not visible to the user.
Client certificates required for XDCR or SDK-client access must be explicitly created by the administrator; based on a customized, replacement cluster certificate.</p>
</div>
<div class="paragraph">
<p>When authenticating a client that uses certificate-based authentication, Couchbase Server asks the client to present the client certificate.
Couchbase Server inspects the client certificate: if this is ascertained to be part of a chain that leads to a root authority that is recognized by Couchbase Server, the client may be trusted.
The certificate&#8217;s time-validity and other details are checked.
If the certificate has not expired and is valid in all other necessary respects, the <em>username</em> provided by the certificate is determined, and this is checked by Couchbase Server against registered users and their roles.
If the user exists, and the associated roles are appropriate, access is granted; otherwise, access is denied.</p>
</div>
<div class="paragraph">
<p>Note that the private key used to create the client certificate is itself used in the process whereby the client authenticates itself against the server: the client digitally signs a message, using its private key, and sends this message to the server; allowing the client&#8217;s <em>public</em> key then to be used by the server to verify that the message has indeed been sent by the client.
An example of specifying the private key for this purpose, in the context of securing XDCR, is provided in <a href="../../manage/manage-xdcr/enable-full-secure-replication.html#specify-full-xdcr-security-with-certificates" class="xref page">Specify Root and Client Certificates, and Client Private Key</a>.
A further example, in the context of securing contact with an LDAP host, is provided in <a href="../../manage/manage-security/configure-ldap.html#client-certificate" class="xref page">Configure LDAP</a>.</p>
</div>
<div class="paragraph">
<p>Note also that these steps, whereby the client authenticates with the server, are additionally followed to allow the server to authenticate with the client.
The overall, two-way authentication process is referred to as <em>mutual TLS</em> (<em>mTLS</em>) or <a href="https://en.wikipedia.org/wiki/Mutual_authentication" target="_blank" rel="noopener">mutual authentication</a>.</p>
</div>
<div class="sect3">
<h4 id="identity-encoding-in-client-certificates"><a class="anchor" href="#identity-encoding-in-client-certificates"></a>Specifying Usernames for Client-Certificate Authentication</h4>
<div class="paragraph">
<p>The <em>username</em> to be authorized by Couchbase Server can be specified by means of several elements included in the client certificate.
Couchbase Server can be configured to search for appropriate elements within the client certificate; and then attempt to authenticate and authorize, using each element as the basis for a Couchbase-Server username.</p>
</div>
<div class="paragraph">
<p>If multiple elements within the client certificate are so used, the first to be successfully authenticated by Couchbase Server is the one used.
The order in which the elements are examined is that configured on Couchbase Server, as described in <a href="../../manage/manage-security/enable-client-certificate-handling.html" class="xref page">Enable Client Certificate Handling</a>.</p>
</div>
<div class="sect4">
<h5 id="specifying-usernames-in-certificates"><a class="anchor" href="#specifying-usernames-in-certificates"></a>Embedding Usernames in Certificates</h5>
<div class="paragraph">
<p>Within a certificate presented for authentication, the elements that can be used to specify a username include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>Subject</code> for the certificate, featuring the <em>Common Name</em>.
For example, on the command-line, during client-certificate preparation, <code>-subj "/CN=clientuser"</code> might be specified; to allow <code>clientuser</code> to be identified as the username.</p>
<div class="paragraph">
<p>Note that use of Subject Common Name is now deprecated (see <a href="https://tools.ietf.org/html/rfc6125#section-6.4.4" target="_blank" rel="noopener">section 6.4.4 of RFC 6125</a>); but continues to be supported by Couchbase Server.
See also <a href="#deprecation-of-subject-common-name">Deprecation of Subject Common Name</a>, below.</p>
</div>
</li>
<li>
<p>The <code>DNS</code> name, provided as a <em>Subject Alternative Name</em> for the certificate.
For example, <code>subjectAltName = DNS:node2.cb.com</code> would, with no prefix or delimiter specified in the Couchbase Server handling-configuration, allow <code>node2.cb.com</code> to be identified as the username.</p>
<div class="paragraph">
<p><em>Prefix</em> and <em>delimiter</em> are explained below, in <a href="#identifying-certificate-based-usernames-on-couchbase-server">Identifying Certificate-Based Usernames on Couchbase Server</a>.</p>
</div>
</li>
<li>
<p>The <code>email</code>, provided as a <em>Subject Alternative Name</em> for the certificate.
For example, <code>subjectAltName = email:john.smith@mail.com</code> would, with no prefix configured or delimiter specified, allow <code>john.smith@mail.com</code> to be extracted and identified as the username.
Note, however, that since the character <code>@</code> is not permitted in Couchbase Server usernames, no such user could exist.
Nevertheless, the user <code>john.smith</code> <em>could</em> be defined on Couchbase Server; and this name could be extracted from <code>john.smith@mail.com</code>, given appropriate server-side configuration of a <em>delimiter</em>, as explained in <a href="#identifying-certificate-based-usernames-on-couchbase-server">Identifying Certificate-Based Usernames on Couchbase Server</a>, below.</p>
</li>
<li>
<p>The <code>URI</code> provided as a <em>Subject Alternative Name</em> for the certificate.
For example, <code>subjectAltName = URI:www.acme.com</code> would, with no prefix or delimiter specified, allow <code>www.acme.com</code> to be extracted and identified as the username.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples of specifying <em>Subject Common Names</em> and <em>Subject Alternative Names</em> are provided in <a href="../../manage/manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a> and <a href="../../manage/manage-security/configure-client-certificates.html" class="xref page">Configure Client Certificates</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="identifying-certificate-based-usernames-on-couchbase-server"><a class="anchor" href="#identifying-certificate-based-usernames-on-couchbase-server"></a>Identifying Certificate-Based Usernames on Couchbase Server</h5>
<div class="paragraph">
<p>Client-certificate handling is <em>disabled</em> by default on Couchbase Server: it can optionally be <em>enabled</em>; and if required, specified as <em>mandatory</em>.</p>
</div>
<div class="paragraph">
<p>When client-certificate handling has been enabled, <em>paths</em> specified within the client certificate can be configured to be searched for, in order to retrieve <em>usernames</em> for authentication.</p>
</div>
<div class="paragraph">
<p>Each specified <em>path</em> can be one of the following path-types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>subject.cn</code>.
The <em>Subject Common Name</em> specified in the certificate will be extracted.</p>
</li>
<li>
<p><code>san.dns</code>.
The <code>DNS</code> <em>Subject Alternative Name</em> for the certificate will be extracted.</p>
</li>
<li>
<p><code>san.email</code>.
The <code>email</code> <em>Subject Alternative Name</em> for the certificate will be extracted.</p>
</li>
<li>
<p><code>san.uri</code>.
The <code>URI</code> <em>Subject Alternative Name</em> for the certificate will be extracted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any number of paths can be specified on Couchbase Server, with multiple instances of any path-type.</p>
</div>
<div class="paragraph">
<p>The name retrieved by searching for a Couchbase Server-specified path can optionally be <em>parsed</em>, so that the symbols that constitute the username are isolated from extraneous characters.
This is achieved by associating the path with a specified <em>prefix</em> and/or <em>delimiter</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If neither a prefix nor a delimiter is specified for a given path, no parsing of the corresponding name is attempted; and authentication is attempted with the unparsed name.</p>
</li>
<li>
<p>If only a prefix is specified for a given path, parsing is attempted in accordance with the specified prefix.
If no instance of the prefix is located in the name, authentication is then attempted with the name unchanged.</p>
</li>
<li>
<p>If only a delimiter is specified for a given path, parsing is attempted in accordance with the specified delimiter.
If no instance of the delimiter is located in the name, authentication is then attempted with the name unchanged.</p>
</li>
<li>
<p>If both a prefix and a delimiter are specified for a given path, parsing is attempted for each in turn &#8212; prefix first, then delimiter &#8212; as described above.
Authentication is then attempted with the string produced by these sequential parsing-attempts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Prefix</em> and <em>delimiter</em> are defined as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Prefix</em>: One or more characters that, if exactly matched with the substring that begins the string specified as the Subject Common Name or Subject Alternative Name, are removed from that string.
For example, if a certificate-specified <code>san.uri</code> is <code>www.couchbase.com</code>, and the server-specified prefix is <code>www.</code>, then <code>www.</code> is removed from <code>www.couchbase.com</code>, leaving the string <code>couchbase.com</code>.</p>
<div class="paragraph">
<p>However, if a certificate-specified <code>san.uri</code> is <code>foo.bar.com</code>, and the server-specified prefix is <code>www.</code>, nothing is removed from <code>foo.bar.com</code>.</p>
</div>
</li>
<li>
<p><em>Delimiter</em>: A single character that, if matched with a single instance in the string being parsed, causes both itself and all subsequent characters to be discarded from the string.
For example, a delimiter of <code>.</code> causes the substring <code>.com</code> to be discarded from <code>couchbase.com</code>; and leaves <code>couchbase</code> as the username to be authenticated.</p>
<div class="paragraph">
<p>Note that if a string contains multiple instances of the character specified as the delimiter, the <em>first</em> instance is the one used.
For example, a delimiter of <code>.</code> causes the substring <code>.couchbase.com</code> to be discarded from <code>www.couchbase.com</code>, leaving <code>www</code> as the username to be authenticated.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For step-by-step instructions, see <a href="../../manage/manage-security/enable-client-certificate-handling.html" class="xref page">Enable Client Certificate Handling</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deprecation-of-subject-common-name"><a class="anchor" href="#deprecation-of-subject-common-name"></a>Deprecation of Subject Common Name</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use of the <em>Subject Common Name</em> to identify either a server or a client is now deprecated (see <a href="https://tools.ietf.org/html/rfc6125#section-6.4.4" target="_blank" rel="noopener">section 6.4.4 of RFC 6125</a>).
For Couchbase Server, this means that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The node-certificate for each server in the cluster is recommended to specify at least one <em>Subject Alternative Name</em>, in order to be identified: typically, the node&#8217;s IP address or DNS name should be provided in this way.
Subject Common Name may continue to be specified.</p>
</li>
<li>
<p>A client-certificate may continue to specify only a Subject Common Name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples of certificate-creation provided in <a href="../../manage/manage-security/manage-certificates.html" class="xref page">Manage Certificates</a> continue to include definitions of Subject Common Name for both server and client.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="private-key-formats"><a class="anchor" href="#private-key-formats"></a>Private Key Formats</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In version 7.1 and later, Couchbase Server supports <em>PKCS #1</em> and <em>PKCS #8</em> &#8212; in each case, only for use with private keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>PKCS #1</em> can be used for <em>unencrypted</em> private keys only.</p>
</li>
<li>
<p><em>PKCS #8</em> can be used for both <em>unencrypted</em> and <em>encrypted</em> private keys: note that the user-specified <code>EncryptedPrivateKeyInfo</code> must use <em>PKCS #5 v2</em> algorithms.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-passphrase-registration"><a class="anchor" href="#json-passphrase-registration"></a>JSON Passphrase Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a node-certificate is to be associated with an encrypted private key, a procedure can be defined to allow Couchbase Server to access and use the key&#8217;s passphrase, when use of the key is required: the passphrase can be <em>registered</em>, by specifying a JSON object with the REST API.
For information, see <a href="../../rest-api/upload-retrieve-node-cert.html" class="xref page">Upload and Retrieve a Node Certificate</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Examples of file-types and their generation, of extension-definition, of intermediate-certificate use, and of Couchbase-Server specific deployment requirements are provided for the server-side in <a href="../../manage/manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a>, and for the client-side in <a href="../../manage/manage-security/configure-client-certificates.html" class="xref page">Configure Client Certificates</a>.
The examples allow <em>Cross Data Center Replication</em> to be secured with certificates only.
They also support secure access to Couchbase Server from Java clients.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
