<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Configure a Private Network | Couchbase Docs</title>
<link rel="canonical" href="https://docs.couchbase.com/cloud/clouds/private-network.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Setting up a private network enables your application to interact with Couchbase Capella over a private connection by co-locating them through VPC or VNet peering.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="cloud">
<meta name="dcterms.identifier" content="master">
<meta name="page-url" content="/cloud/clouds/private-network.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/CapellaGA/docs/public/modules/clouds/pages/private-network.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">Couchbase Capella</a></li>
<li class="crumb">Connect an App</li>
<li class="crumb"><a href="private-network.html">Configure Private Networking to Speed up Your App</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Configure a Private Network</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Setting up a private network enables your application to interact with Couchbase Capella over a private connection by co-locating them through VPC or VNet peering.
</blockquote>
</div>
<div class="paragraph">
<p>Use the procedures on this page to configure a private network connection from Couchbase Capella clusters hosted with AWS or GCP to your application&#8217;s VPC.</p>
</div>
<div class="paragraph">
<p>Using a private network (also known as network peering) provides an added layer of security for organizations by avoiding communication over the Internet.
It also results in a significant reduction in latency and egress costs.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Capella does <em>not</em> support setting up a private network between different cloud providers.
For example, you cannot set up private networking between a Capella cluster hosted in GCP with an application hosted on AWS.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Setting up a Private Network</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To set up a private network, use the instructions provided on the tab that corresponds with your Capella cluster&#8217;s cloud provider.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_aws"></a>AWS</p>
</li>
<li>
<p><a id="tabset1_gcp"></a>GCP</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_aws">
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To configure Couchbase Capella private networking with AWS, you need to complete the following prerequisites steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In AWS, enable <em>DNS hostnames</em> for the VPC:</p>
<div class="imageblock">
<div class="content">
<img src="_images/pn1-dns-hostname.png" alt="Enable DNS hostnames for the VPC.">
</div>
</div>
</li>
<li>
<p>In AWS, enable <em>DNS resolution</em> for the VPC:</p>
<div class="imageblock">
<div class="content">
<img src="_images/pn2-dns-res.png" alt="Enable DNS resolution for the VPC.">
</div>
</div>
</li>
<li>
<p>You must also ensure that your Capella cluster&#8217;s CIDR block (specified when setting up the cluster) does not overlap with the application VPC CIDR block.
You can retrieve the CIDR block for a cluster <a href="../reference/rest-endpoints-all.html#samples-26" class="xref page">using the public API</a>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Creating a Private Network</strong></p>
</div>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Capella, add a new private network for your cluster.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open the cluster where you want to create the new private network.</p>
</li>
<li>
<p>Click the <strong>Connect</strong> tab.</p>
<div class="paragraph">
<p>This opens the <em>Database Access</em> page.</p>
</div>
</li>
<li>
<p>Inside the <em>Virtual Network</em> block, click <b class="button">Manage Private Networks</b>.</p>
</li>
<li>
<p>Click  <b class="button">Setup Private Network</b>.</p>
</li>
<li>
<p>In the <strong>Setup Private Network</strong> fly-out menu, confirm the prerequisites and click <b class="button">Next</b>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/pn3-prereq.png" alt="Accepting prerequisites.">
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>In Capella, configure your private network details.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Fill out the <em>Network Details</em> fields.</p>
<div class="imageblock">
<div class="content">
<img src="_images/pn5-cidr.png" alt="Filling in the CIDR block(s).">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can find most of the required info for these fields on the page for your chosen VPC in AWS.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Name</dt>
<dd>
<p>Enter any name that you wish.</p>
</dd>
<dt class="hdlist1">AWS Account ID</dt>
<dd>
<p>The numeric AWS Account ID.</p>
</dd>
<dt class="hdlist1">Virtual Network ID</dt>
<dd>
<p>The alphanumeric VPC ID which starts with <code>vpc-</code>.</p>
</dd>
<dt class="hdlist1">Available Regions</dt>
<dd>
<p>The AWS region where your VPC is deployed (this can be seen in the top-right corner of the AWS console).</p>
</dd>
<dt class="hdlist1">CIDR Block</dt>
<dd>
<p>The AWS VPC CIDR block of network in which your application runs.
This cannot overlap with your Capella CIDR Block.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have multiple CIDR blocks associated with a VPC you will need to set up multiple private networks, one for each CIDR block.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Click <b class="button">Link</b>.</p>
<div class="paragraph">
<p>Capella will set up the private network.
This typically takes up to a minute.
If successful you should see the private network added to the list of private networks, then you may briefly see the cluster enter a "Deploying" state while the new network is set up.</p>
</div>
<div class="paragraph">
<p>If there&#8217;s a problem with the private network then Capella will tell you via an error message, such as in the case of overlapping CIDR blocks.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pn6-cidr-problem.png" alt="CIDR overlap warning message.">
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>Finishing Private Network Setup</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Once setup is complete, you will see the new network listed in the list of networks:</p>
<div class="imageblock">
<div class="content">
<img src="_images/pn7-network-list.png" alt="New private network now listed.">
</div>
</div>
</li>
<li>
<p>While the status of the network says "Complete" there are a final few steps you need to carry out before you can access your Capella cluster from your VPC over this private network.</p>
<div class="paragraph">
<p>If you click on the Private Network it will show you two commands that you must run to accept the peering request and also link your VPC to the appropriate DNS server for hostname resolution.
You can also accept the VPC peering request in the AWS console:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pn8-peering.png" alt="Accepting the VPC peering request in the AWS console.">
</div>
</div>
</li>
<li>
<p>However, you must associate the hosted zone via the AWS CLI command provided in Capella, as it is not currently possible to do this via the AWS console.</p>
<div class="paragraph">
<p>Upon executing these commands, you should see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ aws ec2 accept-vpc-peering-connection --region=us-west-2 --vpc-peering-connection-id=pcx-004adebd9bf32a24f</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">{
	"VpcPeeringConnection": {
    	"AccepterVpcInfo": {
        	"CidrBlock": "10.0.0.0/20",
        	"CidrBlockSet": [
            	{
                	"CidrBlock": "10.0.0.0/20"
            	}
        	],
        	"OwnerId": "264138468394",
        	"PeeringOptions": {
            	"AllowDnsResolutionFromRemoteVpc": false,
            	"AllowEgressFromLocalClassicLinkToRemoteVpc": false,
            	"AllowEgressFromLocalVpcToRemoteClassicLink": false
        	},
        	"VpcId": "vpc-09af4fa45689ca44c",
        	"Region": "us-west-2"
    	},
    	"RequesterVpcInfo": {
        	"CidrBlock": "10.0.16.0/20",
        	"CidrBlockSet": [
            	{
                	"CidrBlock": "10.0.16.0/20"
            	}
        	],
        	"OwnerId": "689827245340",
        	"VpcId": "vpc-091c6caeba936ac48",
        	"Region": "us-east-1"
    	},
    	"Status": {
        	"Code": "provisioning",
        	"Message": "Provisioning"
    	},
    	"Tags": [],
    	"VpcPeeringConnectionId": "pcx-004adebd9bf32a24f"
	}
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ aws route53 associate-vpc-with-hosted-zone --hosted-zone-id=Z04089311NGVVH0FO3QGG --vpc=VPCId=vpc-09af4fa45689ca44c,VPCRegion=us-west-2 --region=us-east-1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">{
	"ChangeInfo": {
    	"Id": "/change/C0508746QOHOO1XX5BH5",
    	"Status": "PENDING",
    	"SubmittedAt": "2021-12-03T16:58:38.401Z",
    	"Comment": ""
	}
}</code></pre>
</div>
</div>
</li>
<li>
<p>The final step is to then update the Route Table for your application VPC to ensure that all traffic destined for your Capella cluster is appropriately routed.</p>
<div class="paragraph">
<p>First, identify the Route Table for your application VPC:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pn9-route-table.png" alt="Finding the correct Route Table.">
</div>
</div>
</li>
<li>
<p>Then you want to edit the routes of this Route Table to add the Capella cluster as a new route.
Take the CIDR block of the <code>RequesterVpcInfo</code> from the VPC peering request output, in this example <code>10.0.16.0/20</code>, and enter this as the destination. The target should be the <code>VpcPeeringConnectionId</code>, in this example <code>pcx-004adebd9bf32a24f</code>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/pn10-target.png" alt="Entering destination and target.">
</div>
</div>
</li>
<li>
<p>If your VPC has any outbound security groups associated with it (i.e. limiting outbound traffic to specific IPs), then you must also add the CIDR block for your Capella cluster to the outbound security group.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_gcp">
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To configure Couchbase Capella private networking with GCP, you need a <a href="https://cloud.google.com/iam/docs/service-accounts" target="_blank" rel="noopener">service account</a> with these roles:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://cloud.google.com/iam/docs/understanding-roles#dns.admin" target="_blank" rel="noopener">DNS Administrator</a> (<code>roles/dns.admin</code>)</p>
</li>
<li>
<p><a href="https://cloud.google.com/iam/docs/understanding-roles#compute.networkAdmin" target="_blank" rel="noopener">Compute Network Admin</a> (<code>roles/compute.networkAdmin</code>)</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Creating a Private Network</strong></p>
</div>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Capella, add a new private network for your cluster.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open the cluster where you want to create the new private network.</p>
</li>
<li>
<p>Click the <strong>Connect</strong> tab.</p>
<div class="paragraph">
<p>This opens the <em>Database Access</em> page.</p>
</div>
</li>
<li>
<p>Inside the <em>Virtual Network</em> block, click <b class="button">Manage Private Networks</b>.</p>
</li>
<li>
<p>Click  <b class="button">Setup Private Network</b>.</p>
</li>
<li>
<p>In the <strong>Setup Private Network</strong> fly-out menu, confirm the prerequisites and click <b class="button">Next</b>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/pn3-prereq-gcp.png" alt="Accepting prerequisites.">
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>In Capella, configure your private network details.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Fill out the <em>Network Details</em> fields.</p>
<div class="imageblock">
<div class="content">
<img src="_images/gcp-pn3-config.png" alt="The Network Details fields.">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can find most of the required info for these fields on the page for your chosen VPC in GCP.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Name</dt>
<dd>
<p>Enter a descriptive name for the new private network.</p>
</dd>
<dt class="hdlist1">GCP Project ID</dt>
<dd>
<p>The unique identifier for your <a href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" target="_blank" rel="noopener">GCP project</a>.
This is typically autogenerated in the form of <code>rock-galaxy-123456</code> or similar.</p>
</dd>
<dt class="hdlist1">GCP Network Name</dt>
<dd>
<p>The <a href="https://cloud.google.com/vpc/docs/create-modify-vpc-networks#viewing-networks" target="_blank" rel="noopener">GCP VPC network name</a>.</p>
</dd>
<dt class="hdlist1">CIDR Block</dt>
<dd>
<p>The GCP VPC CIDR block of network in which your application runs.
This cannot overlap with your Capella CIDR Block.</p>
</dd>
<dt class="hdlist1">Service Account Email</dt>
<dd>
<p>The email address of the associated <a href="https://cloud.google.com/iam/docs/service-accounts" target="_blank" rel="noopener">service account</a>.
This looks like <code>&lt;service-account-id&gt;@rock-galaxy-123456.iam.gserviceaccount.com</code>.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Click <b class="button">Link</b>.</p>
<div class="paragraph">
<p>Capella will set up the private network.
This typically takes up to a minute.
If successful you should see the private network added to the list of private networks, then you may briefly see the cluster enter a "Deploying" state while the new network is set up.</p>
</div>
<div class="paragraph">
<p>If there&#8217;s a problem with the private network then Capella will tell you via an error message.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Finishing Private Network Setup</strong></p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Once setup is complete, you will see the new network listed in the list of networks.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pn7-network-list.png" alt="New private network now listed.">
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
While the status of the network says "Complete" there are some final steps you must carry out before you can access your Capella cluster from your VPC over this private network.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the <strong>Private Networks</strong> screen, click the listing for the new Private Network.</p>
<div class="paragraph">
<p>This shows you two commands that you must run to accept the peering request and also link your VPC to the appropriate DNS server for hostname resolution. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ gcloud compute networks peerings create &lt;your-peer-name&gt; --network=&lt;your-vpc-network-name&gt; --peer-project &lt;your-gcp-project-id&gt; --peer-network &lt;capella-vpc-network-name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ gcloud dns managed-zones create &lt;your-zone-name&gt; --description="Peering Zone to Capella" --dns-name=&lt;dns-name-suffix&gt; --account=&lt;service-account-email-address&gt; --networks=&lt;your-vpc-network-name&gt; --target-network=&lt;your-vpc-network-name&gt; --target-project=&lt;your-gcp-project-id&gt; --visibility=private</code></pre>
</div>
</div>
</li>
<li>
<p>Using the <a href="https://cloud.google.com/sdk/gcloud" target="_blank" rel="noopener">gcloud CLI</a>, run the commands provided by Capella.</p>
</li>
<li>
<p><a href="#verify-connectivity">Verify connectively</a> to ensure that the applications connecting from the application VPC are using the private network correctly.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="verify-connectivity"><a class="anchor" href="#verify-connectivity"></a>Verifying Connectivity to Private Networks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With a private network set up, it&#8217;s important to ensure that applications connecting from the application VPC are using the private network correctly.</p>
</div>
<div class="paragraph">
<p><strong>Hostname Resolution</strong></p>
</div>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first step whenever an application connects to a Capella cluster is to resolve the hostnames of all nodes in the cluster.
Within the Capella UI, you can see the URL for the cluster, which is an SRV record containing multiple nodes of the cluster.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can retrieve the DNS SRV record for your cluster within the <em>Wide Area Network</em> section of the <strong>Connect</strong> tab.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This hostname can be resolved using a command such as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">nslookup -type=SRV _couchbases._tcp.cb.a-lxzt-gdkzoqfuu.cloud.couchbase.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">Server:   	 127.0.0.53
Address:    127.0.0.53#53

Non-authoritative answer:
_couchbases._tcp.cb.a-lxzt-gdkzoqfuu.cloud.couchbase.com    service = 0 0 11207 9qvj8x-f2oxhahtz.a-lxzt-gdkzoqfuu.cloud.couchbase.com.
_couchbases._tcp.cb.a-lxzt-gdkzoqfuu.cloud.couchbase.com    service = 0 0 11207 jkzlapnfpklgjhtl.a-lxzt-gdkzoqfuu.cloud.couchbase.com.
_couchbases._tcp.cb.a-lxzt-gdkzoqfuu.cloud.couchbase.com    service = 0 0 11207 4ncgebm6lmtbxmkr.a-lxzt-gdkzoqfuu.cloud.couchbase.com.</code></pre>
</div>
</div>
</li>
<li>
<p>You should then resolve one of these individual hostnames returned from the SRV record, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">nslookup 9qvj8x-f2oxhahtz.a-lxzt-gdkzoqfuu.cloud.couchbase.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">Server:   	 127.0.0.53
Address:    127.0.0.53#53

Non-authoritative answer:
Name:    9qvj8x-f2oxhahtz.a-lxzt-gdkzoqfuu.cloud.couchbase.com
Address: 10.0.18.110</code></pre>
</div>
</div>
</li>
<li>
<p>If the DNS resolution is working correctly then you should see the private IP of the Capella Node (i.e. an IP from the cluster&#8217;s CIDR block).
If you see that the public IP is returned for this node then you should validate that you have:</p>
<div class="ulist">
<ul>
<li>
<p>Enabled DNS resolution</p>
</li>
<li>
<p>Enabled DNS hostnames</p>
</li>
<li>
<p>Associated the hosted zone with your VPC</p>
<div class="paragraph">
<p>See the <a href="#prerequisites">Prerequisites</a> section, above.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Network Connectivity</strong></p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Now that you have validated that DNS resolution is working correctly, you should validate the network connectivity between your application instances and your Capella cluster.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To validate that the routing is correctly set up for your VPC, you can run a <code>traceroute</code> to one of the nodes in your cluster (retrieved from the previous DNS resolution step). For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">traceroute -T 9qvj8x-f2oxhahtz.a-lxzt-gdkzoqfuu.cloud.couchbase.com -p 18091</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">traceroute to 9qvj8x-f2oxhahtz.a-lxzt-gdkzoqfuu.cloud.couchbase.com (10.0.18.110), 30 hops max, 60 byte packets
 1  ip-10-0-18-110.us-west-2.compute.internal (10.0.18.110)  0.303 ms  0.288 ms  0.302 ms</code></pre>
</div>
</div>
</li>
<li>
<p>This command should return quickly, if not then there are likely issues with your routing and you should validate the route table associated with the VPC to ensure that you have associated the correct CIDR block with the peering connection.</p>
</li>
<li>
<p>Finally, you can run a curl command to validate that Couchbase Server is responding correctly over the private network:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ curl -k https://9qvj8x-f2oxhahtz.a-lxzt-gdkzoqfuu.cloud.couchbase.com:18091</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;301 Moved Permanently&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Moved Permanently&lt;/h1&gt;&lt;p&gt;The document has moved &lt;a href="https://9qvj8x-f2oxhahtz.a-lxzt-gdkzoqfuu.cloud.couchbase.com:18091/ui/index.html&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshoot-private-network-issues"><a class="anchor" href="#troubleshoot-private-network-issues"></a>Troubleshoot Private Network Issues</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="check-the-status-of-your-private-network-connection"><a class="anchor" href="#check-the-status-of-your-private-network-connection"></a>Check the Status of Your Private Network Connection</h3>
<div class="paragraph">
<p>The following table provides information about the status</p>
</div>
<table id="table-private-network-connection-status" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Private Network Connection Status</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Setup (Default state)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No networks exist and no infrastructure has been provisioned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linking Network</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more networks are being connected and/or the infrastructure is being provisioned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linking Failed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more networks have failed to connect but the infrastructure was provisioned successfully.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infrastructure Failed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infrastructure provisioning failed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ready</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more networks are linked successfully.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No Networks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No networks are linked but the infrastructure has been provisioned for your cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infrastructure Provisioning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The infrastructure is being provisioned. Note that this is an intermediate state that is only possible for the first network linked for a cluster.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you create multiple networks in rapid succession, both the Linking and Provisioning states may be displayed as <code>Failed</code> at the same time.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="possible-errors-and-workarounds"><a class="anchor" href="#possible-errors-and-workarounds"></a>Possible Errors and Workarounds</h3>
<div class="ulist">
<ul>
<li>
<p>You can set up private networks on a new deployment only after the private networking feature is enabled. Check if you are using an existing cluster and/or if the feature is enabled.</p>
</li>
<li>
<p>If the private networking feature does not exist in your region, the private zone creation can fail. Check that the feature is enabled in your region.</p>
</li>
<li>
<p>Policy added for the private zone could fail. Retry adding the policy to resolve the issue.</p>
</li>
<li>
<p>Security group update for the CIDR may fail. Retry the operation to resolve the issue.</p>
</li>
<li>
<p>If you provided an incorrect CIDR block, application VPC, VPC ID, or Regions when creating a private network, we recommend that you delete that private network and re-create a new one with the correct values.</p>
</li>
<li>
<p>Ensure that both DNS settings are enabled on the AWS VPC side&#8201;&#8212;&#8201;<em>DNS hostname</em> and <em>DNS resolution</em>.
If changing this setting, allow time for DNS caching.</p>
</li>
<li>
<p>While we support multiple subscriptions within a single Azure tenant, VNet peering across two or more Azure tenants is not supported.</p>
</li>
<li>
<p>If using Couchbase Go SDK Version 1.6 with private networking, ensure that you set <code>network=default</code> in the connection string.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Tools such as the  <a href="https://docs.aws.amazon.com/vpc/latest/reachability/what-is-reachability-analyzer.html">AWS VPC Reachability Analyzer</a> can be useful to verify communications.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Capella","components":["cloud"],"url":"/cloud/index.html","latestVersions":{"cloud":"master"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../_/js/site.js"></script>
<script defer src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
