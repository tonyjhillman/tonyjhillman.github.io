<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Frequently Asked Questions | Couchbase Docs</title>
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="This section provides answers to commonly asked questions pertaining to the Eventing Service and Functions.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/eventing/eventing-faq.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/eventing/pages/eventing-faq.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb"><a href="eventing-faq.html">Frequently Asked Questions</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Frequently Asked Questions</h1>
<div class="labels">
<ul></ul>
</div>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise Edition</a></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
This section provides answers to commonly asked questions pertaining to the Eventing Service and Functions.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generic"><a class="anchor" href="#generic"></a>Generic</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Is Eventing an MDS-enabled service?</p>
<div class="paragraph">
<p>Yes. MDS enables workload isolation in a Couchbase cluster.
Eventing nodes can be added as more Functions are added, or if the mutation rates are high.</p>
</div>
</li>
<li>
<p>What kind of nodes do I run my Eventing Service on?</p>
<div class="paragraph">
<p>Eventing leverages the latest trends in multi-core CPUs; therefore nodes that you select for the Eventing Service should optimally have a higher number of cores than those for indexing.</p>
</div>
</li>
<li>
<p>Can the Eventing Service be co-located with other services?</p>
<div class="paragraph">
<p>Yes, the Eventing Service node can be co-located with other MDS-enabled services.</p>
</div>
</li>
<li>
<p>Is it supported for both text and binary formats of the documents?</p>
<div class="paragraph">
<p><strong>Yes</strong> only for versions 6.6.2+</p>
</div>
<div class="paragraph">
<p>For versions 6.6.2 and later, the value or the document can be either text or binary. Starting with version 6.6.2, Eventing processes binary documents. Eventing Functions can read a binary value from a bucket alias or via an Advanced Accessor. The documents are based on a key-value format where the value can be arbitrary text or binary data. However, in practice the value is typically a well formatted JSON text payload.  Note, Eventing Functions via the curl() function can also handle binary data to and from an external REST endpoint. Furthermore, every mutation OnUpdate(doc,meta) will now have a property "datatype" set to either "binary" or "json", however this information is not available via OnDelete(meta,options) or Basic Bucket Ops.</p>
</div>
<div class="paragraph">
<p><strong>No</strong> for versions 6.6.1 and earlier.</p>
</div>
<div class="paragraph">
<p>For versions 6.6.1 and earlier, the value or the document must always be text. Eventing currently doesn&#8217;t process binary documents (binary documents will not generate mutations). Additionally, an Eventing Function can’t currently read a binary value from a bucket alias. The documents are based on a key-value format where the value can be arbitrary text. However, in practice the value is typically a well formatted JSON text payload.  There is one exception, Eventing Functions via the curl() function can handle binary data to and from an external REST endpoint.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="change-capture"><a class="anchor" href="#change-capture"></a>Change Capture</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Will all the updates to a document be seen in DCP?</p>
<div class="paragraph">
<p>When a document is updated multiple times in a small time-window, not all updates are seen in DCP.
This means that the event entry points of <strong>OnUpdate</strong> and <strong>OnDelete</strong> to the Eventing Function will see only those deduplicated events that are published in DCP.</p>
</div>
</li>
<li>
<p>Can a Function listen to all changes across Couchbase Server?</p>
<div class="paragraph">
<p>A defined Function listens only to changes that are exposed using the DCP for the source collection (Couchbase and Ephemeral) in the data-nodes.
Memcached buckets (and thus underlying collections) are not supported.
The Function cannot listen to changes happening in other Couchbase components, such as FTS, Views, or GSI; nor can it listen to system events.</p>
</div>
</li>
<li>
<p>Can we determine what has changed on the document?</p>
<div class="paragraph">
<p>No. But you can implement versioning as part of the application logic.
If versioning is important, include it as part of the data architecture.</p>
</div>
</li>
<li>
<p>Can I get old and new values of the document inside the Function?</p>
<div class="paragraph">
<p>No. We do not support versioning of documents; therefore, this feature is not available out of the box. However, you can have a parent bucket and its replica version. The replica bucket would retain the version of documents before the current set of changes.   Look at the Eventing examples and scriptlets for various work arounds.</p>
</div>
</li>
<li>
<p>Is the ordering of document mutations enforced?</p>
<div class="paragraph">
<p>All changes from a document are always processed in order.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="functions"><a class="anchor" href="#functions"></a>Functions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Are Functions similar to a Database Trigger?</p>
<div class="paragraph">
<p>In a rough sense, Eventing Functions are similar to the Post-Triggers of the database world.
But with Functions, the action is already completed at the data-layer, and the entry points of <strong>OnUpdate</strong> and <strong>OnDelete</strong> give an interface by which developers can key in the logic of what needs to happen ‘after’ the action is done.
What an Eventing Function sees is the actual event of the change, and hence it does not directly correlate with Database Triggers.</p>
</div>
</li>
<li>
<p>Are Functions similar to a Rules Engine?</p>
<div class="paragraph">
<p>Not exactly.
A Rules Engine enforces ordering and other semantics that is not possible out of the box with Functions.
The Function in its purest form offers a business rule to implemented closer to the data, but cannot trigger another Function directly.</p>
</div>
</li>
<li>
<p>Are Functions similar to a Stored Procedure?</p>
<div class="paragraph">
<p>Stored Procedures enforce a request-response model.
A stored procedure will not be invoked automatically; it has to be invoked by a calling method.
Functions are based on the idea of events.
Changes to the data or mutations are the events that trigger Functions, and hence this is not a request-response model in its purest sense.</p>
</div>
</li>
<li>
<p>Do I need a separate middleware to consume the Functions? How do I consume changes in my middleware/application?</p>
<div class="paragraph">
<p>No.
Functions do not require any additional infrastructure mutations are consumed and acted upon by the defined Function. There is no other programmatic way of accessing the changes processed by a Function (such as by using an SDK, or some other form of middleware). REST endpoints are exposed, to perform administrative operations.</p>
</div>
</li>
<li>
<p>Can I import my own JS libraries or Node Modules?</p>
<div class="paragraph">
<p>No.
We do not allow import of node modules or external JS libraries or Node modules. Though you can define other JavaScript functions inside a Eventing Function (outside the scope of OnUpdate and OnDelete) that can be invoked any number of times from JavaScript code within the Eventing Function.</p>
</div>
</li>
<li>
<p>Are Functions supported for both Data Node and Document storage?</p>
<div class="paragraph">
<p>The Eventing Service listens to changes that appear in the Database Change Protocol (DCP) stream.
Since DCP is valid for the Data Service, and Eventing Functions only operate on documents that are text based. The documents are based on a key-value format where the value can be arbitrary text. However in practice the value is typically a well formatted JSON text payload. Note, the key is passed as meta.id and the value is passed as doc to the <strong>OnUpdate</strong> handler and only the key as meta.id is passed to the <strong>OnDelete</strong> handler.</p>
</div>
</li>
<li>
<p>Can Functions interact with external processes?</p>
<div class="paragraph">
<p>Yes.
Functions support a cURL API as a way of interacting with external entities or REST endpoints using HTTP. This functionality
allows propagation of data changes to other systems, notifying the application about interesting events, enriching documents
with data from external resources, and so on. The native cURL that lets users propagate events of interest to other APIs when
mutation rates are low.</p>
</div>
</li>
<li>
<p>Can a Function be debugged and what happens when a Function is debugged?</p>
<div class="paragraph">
<p>Yes.
Functions offer multiple diagnosability solutions (debugger, logs, and statistics), all designed to have minimal impact on overall
performance and scalability.
When debugging a function a single mutation is blocked and handed off to the debugger session, while the rest of the mutations continue to be serviced by the Eventing Function, refer to the <a href="eventing-debugging-and-diagnosability.html" class="xref page">Debugging and Diagnosability</a> section.</p>
</div>
</li>
<li>
<p>Can the logic in a Function in production be altered while it is running?</p>
<div class="paragraph">
<p>Yes.
Functions can be "paused, edited and resumed" without losing a single mutation; as such continuity is maintained. Note this sequence is similar to the operations of "undeploy, edited, and deployed with a feed boundary ‘From now’", however in this later case you can lose mutations.</p>
</div>
</li>
<li>
<p>How do I perform a Function&#8217;s lifecycle operations from CI/CD?</p>
<div class="paragraph">
<p>To perform Functions lifecycle operations from CI/CD, refer to the <a href="#cli:cbcli/couchbase-cli-eventing-function-setup.adoc" class="xref unresolved">CLI Eventing</a> section.</p>
</div>
</li>
<li>
<p>How to invoke a REST endpoint from inside the Function?</p>
<div class="paragraph">
<p>To invoke a REST Endpoint from inside the Function, refer to the <a href="https://docs.couchbase.com/server/6.5/eventing/eventing-api.html">Functions REST API</a> section.</p>
</div>
</li>
<li>
<p>How does the Functions offering compare with the Couchbase’s Kafka Connector?</p>
<div class="paragraph">
<p>The Functions offering is about server-side processing or compute of business logic; it does not require any additional infrastructure layer or middleware to be deployed or managed.
Couchbase’s Kafka connector is an SDK component that needs an application container or middleware to run.</p>
</div>
</li>
<li>
<p>Do I have to update and/or deploy my Functions on each Eventing node?</p>
<div class="paragraph">
<p>No. The Eventing service will properly distribute the Function code or lifecycle requests across all Eventing nodes.
It is a best practice to only have one (1) Admin UI to a single node in your cluster when developing or modifying your Eventing Functions.
Note that if you edit Eventing Functions (code or settings) in two browser windows or tabs (to same node or different nodes), you might inadvertently deploy a slightly older or “stale” definition if you switch back and forth between different UI sessions.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="eventing-function-code"><a class="anchor" href="#eventing-function-code"></a>Eventing Function Code</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>What languages are supported?</p>
<div class="paragraph">
<p>Only JavaScript (ECMAScript 6) is supported. However, to support the ability to shard and scale Function execution automatically, some capabilities have been removed (Global state, Asynchrony, etc.), refer to the <a href="eventing-language-constructs.html#removed-lang-features" class="xref page">Language Constructs: Removed Language Features</a> section.</p>
</div>
</li>
<li>
<p>Why can’t I create global variables?</p>
<div class="paragraph">
<p>Functions do not allow global variables, this restriction is mandatory for the Function logic to shard and scale and remain agnostic during rebalance. All state must be saved and retrieved from persistence providers, therefore KV bucket(s) made available to the Function through bindings can be used to store any required global state. Eventing Functions (as of 7.0.0) do however support global constants via the "Constant alias" binding.</p>
</div>
</li>
<li>
<p>What is in the "meta" Function parameter (OnUpdate, OnDelete)? Is this the metadata we currently write in order to figure out what has changed in the document?</p>
<div class="paragraph">
<p>No, the meta parameter does not include information on what fields changed or mutated in the document.
This parameter is composed of the meta fields associated with the document. For more information, refer to the <a href="https://docs.couchbase.com/server/6.5/learn/data/data.html#metadata">metadata</a> section.</p>
</div>
<div class="paragraph">
<p>It should be noted, “document metadata” is different from the "Eventing Storage" keyspace (metadata collection), described in the next section, used by the Eventing Service to maintain state and checkpoints.</p>
</div>
</li>
<li>
<p>Can there be more than one Function listening to changes to a collection?</p>
<div class="paragraph">
<p>Yes.
More than one Function can be defined for the same source collection.
This lets you process the change according to the business logic that you enforce.
But there is no enforced ordering; for example, if collection 'wine' has three different Functions, which are FunctionA, FunctionB, and FunctionC, you cannot enforce the order in which these Functions are executed.</p>
</div>
<div class="paragraph">
<p>However, for each Function you start a set of DCP streams so for a busy system you will get better performance by coalescing  multiple Eventing Functions that have the same source collection into a single Function.
This merging is easy to do with a JavaScript switch statement or a simple if-then-else block.</p>
</div>
</li>
<li>
<p>Is it possible to get additional state during a Function execution?</p>
<div class="paragraph">
<p>Yes.
For example, you can fetch related data from another document (using a document id) from any other collection that is exposed to the Function via a "bucket binding".
It is also possible to utilize the cURL API to read additional state from an external REST endpoint.</p>
</div>
</li>
<li>
<p>Is it possible to update state (or change a document) during a Function execution?</p>
<div class="paragraph">
<p>Yes.
For example, you can your enrich or update a document with data from another document (using a document id) from any other collection that is exposed to the Function via a binding with access level of "Read Write" inclusive of the source collection.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-eventing-storage-keyspace-or-metadata-collection"><a class="anchor" href="#the-eventing-storage-keyspace-or-metadata-collection"></a>The Eventing Storage keyspace (or metadata collection)</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>What is the Eventing Storage keyspace? Do I need to create a separate collection?</p>
<div class="paragraph">
<p>To provide better resiliency and restartability semantics across Eventing nodes, some of the metadata that is used by the Eventing service needs a collection to be stored in a standard <a href="../learn/buckets-memory-and-storage/buckets.html" class="xref page">Couchbase bucket</a> (hereafter referred to as the 'metadata collection').</p>
</div>
<div class="paragraph">
<p>After provisioning the Eventing nodes in your cluster, you&#8217;ll need to create the metadata collection before you can start using the Eventing service.
All Eventing functions within a cluster can share the same metadata collection (this is a best practice but not a requirement), regardless of the number of functions, or their source and destination collection.
(Setting up a metadata collection is a one-time activity for the cluster should you choose to follow this best practice.)</p>
</div>
<div class="paragraph">
<p>Some additional requirements of the metadata collection are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You should enable <a href="../manage/manage-buckets/create-bucket.html" class="xref page">vBucket replicas</a> on the metadata collection to allow for failure recovery.</p>
</li>
<li>
<p>You should reserve the metadata collection solely for Eventing housekeeping.
It shouldn&#8217;t be used for any other data storage.</p>
</li>
<li>
<p>Each Eventing function always requires a fixed amount of space of about 2MB (1024 docs * 1884 bytes).</p>
</li>
<li>
<p>If an Eventing function uses timers, then an additional fixed amount of space of about 0.2MB (1024 * docs of 196 bytes) is needed.
From version 6.6.1 on only 0.04MB (256 docs * 196 bytes) is needed if the function uses timers.</p>
</li>
<li>
<p>If an Eventing function uses timers, then for each active timer, an additional amount of space between 832 and 1856 bytes (832 bytes + sizeof(context)) is needed.
Where by default the context cannot be larger than 1024 bytes and the maximum number of active timers is based on both the business logic and the mutation rate.
Note, the "timer_context_size" can be overridden on a per function bases via the <a href="eventing-api.html" class="xref page">Eventing: REST API</a>.
It is best to keep the size of the context small by using a reference rather than passing and storing a massive document in the timer.</p>
</li>
<li>
<p>Every timer requires up to three documents (<em>root</em>, <em>alarm</em>, and <em>context</em>) which are stored in the Eventing Storage (or metadata collection).
Note sometimes only two (2) additional documents are needed if the timer shares the same scan interval or <em>root</em> document with a previous timer.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Why is the metadata collection not getting cleared when I cancel a timer or a set of timers.</p>
<div class="paragraph">
<p>When a timer is canceled the <em>context</em> document is removed immediately, however the <em>root</em> and <em>alarm</em> documents are removed in a lazy fashion when the canceled timer was originally scheduled to fire.
Thus is 100K timers are scheduled to fire one (1) year in the future and canceled up to 2 additional documents will persist for one (1) year.
Note the <em>cancelTimer()</em> function was introduced in version 6.6.0.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="timer-behavior"><a class="anchor" href="#timer-behavior"></a>Timer Behavior</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Timer Delays: When I schedule a timer to fire at an exact time, I see some delay. Why?</p>
<div class="paragraph">
<p>The timer implementation is designed to handle large numbers of distributed timers (i.e., millions of timers) and the only promise is to run timers as soon as possible, e.g. no timers lost.</p>
</div>
<div class="paragraph">
<p>In a steady state you may see a 3-4 second delay from the scheduled time, however if scheduling timers close to the system wall-clock this delay may increase to about 14 seconds.
For more details on Timer scheduling refer to <a href="eventing-timers.html#wall-clock-accuracy" class="xref page">Timers: Wall-clock Accuracy</a> section.</p>
</div>
</li>
<li>
<p>Can I cancel a Timer?</p>
<div class="paragraph">
<p>Yes.
As of the release 6.6.0 Eventing Timers can be cancelled using <em>cancelTimer()</em> function, or by creating a new Timer with the same reference as an existing Timer refer to <a href="eventing-timers.html#limitations" class="xref page">Timers: Limitations</a>.</p>
</div>
</li>
<li>
<p>Can I create a Recurring timer?</p>
<div class="paragraph">
<p>Yes.
As of the release 6.6.0 Recurring Timers are fully supported, i.e. a function that is invoked by a Timer callback can reliably create fresh Timers refer to <a href="eventing-timers.html#limitations" class="xref page">Timers: Limitations</a>.</p>
</div>
</li>
<li>
<p>Can I schedule a Timer far into the future?</p>
<div class="paragraph">
<p>Yes.
As of the release 6.6.0, recurring Timers can be created days, weeks, or years in the future with no adverse performance impact on an otherwise idle Eventing system. Refer to <a href="eventing-timers.html#limitations" class="xref page">Timers: Limitations</a>.</p>
</div>
</li>
<li>
<p>Why do I see a burst of activity in bucket OPs (in the bucket that holds the metadata collection) after a timer is paused for an extended period of time?</p>
<div class="paragraph">
<p>Resuming an Eventing Function with a timer callback or handler after a prolonged period of time where the Function was in the paused state (like days) will cause a period of high bucket OPs upon resuming the Function.  In addition mutation processing is blocked until the timer scan is completed which can take some time (this delay is proportional to the duration of pause).</p>
</div>
</li>
<li>
<p>Why do I see unexpected documents in the metadata collection when I cancel or overwrite an Eventing Timer?</p>
<div class="paragraph">
<p>When overwriting or canceling a Timer only one of possible three documents, i.e. the "context", is immediately cleared from the metadata bucket. The extra documents, an "alarm" document associated with each Timer and a "root" document (1 per vBucket for the specific time) are left in the metadata bucket. These items are cleaned up at the original execution time that the Timer was scheduled to fire.</p>
</div>
</li>
<li>
<p>Can I pass a binding (Bucket or URL alias) in a Timer&#8217;s context?</p>
<div class="paragraph">
<p>No.
Bindings, whether a Bucket alias or an URL alias, are not serializable objects and only exist in the scope of the executing V8 worker. When a Timer fires it can execute on a different thread. Of course the Timer&#8217;s callback can reference the binding directly.  However you can pass a "Constant alias" to a timer callback.</p>
</div>
</li>
<li>
<p>Can I pass a JavaScript function in a Timer&#8217;s context?</p>
<div class="paragraph">
<p>No.
A JavaScript function is a memory reference in a given V8 worker. As such, it is not a serializable object and only exists in the scope of the executing V8 worker. When a Timer fires it can execute on a different thread. Of course the Timer&#8217;s callback can reference the function directly. Additionally, if needed, you can pass the name of the function in the context and utilize JavaScript&#8217;s eval method.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cluster-behavior"><a class="anchor" href="#cluster-behavior"></a>Cluster Behavior</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>What happens to the Eventing Service during a failover condition?</p>
<div class="paragraph">
<p>When the Data service experiences a failover condition, mutations may be lost and these lost mutations are not processed by the Eventing service.
When the Eventing node experiences a failover condition, few mutations may be processed more than once.</p>
</div>
</li>
<li>
<p>Does a rebalance have any effect on the firing of events?</p>
<div class="paragraph">
<p>No. Functions do not lose any mutations during a rebalance operation.</p>
</div>
</li>
<li>
<p>I have Functions deployed on my cluster, when can I perform an Eventing rebalance operation?</p>
<div class="paragraph">
<p>The Function lifecycle operations (deploying, undeploying, pausing, resuming, and deleting) and the Eventing rebalance operation are mutually exclusive.
The Eventing rebalance  operation fails when a Function lifecycle operation is currently in progress.
Likewise, when the Eventing rebalance operation is in progress, you cannot perform a Function lifecycle operation.</p>
</div>
<div class="paragraph">
<p>Due to a regression, <a href="https://issues.couchbase.com/browse/MB-43343">MB-43343</a>, impacting only 6.6.1 during a rebalance in of an Eventing node a race can occur resulting in Eventing functions becoming hung in deploying state.
Users can run into this issue when they have multiple functions deployed against the same source collection and they try to rebalance-in an eventing node.
The workaround is to ensure that you pause all Eventing Functions before any rebalance.</p>
</div>
</li>
<li>
<p>How do I increase performance of an Eventing Function?</p>
<div class="paragraph">
<p>You can scale up vertically by adding additional workers (in the Eventing Function&#8217;s settings) to increase performance for a specific Function.
You can also scale out horizontally via Couchbase’s elastic scaling option by adding another node and rebalancing.
In this case each eventing node is assigned a subset of vBuckets. Note this sharding increases overall performance for all Functions.</p>
</div>
<div class="paragraph">
<p>In 7.0.0 the default number of workers for new Eventing Functions is now one (1), previously it was one (3).  Thus pay attention to your performance and adjust the number of works to fit your application. Note, all upgrades of existing Functions will keep the number of workers they were created with.</p>
</div>
<div class="paragraph">
<p>However keep in mind that sometimes the Function is limited by the overall performance of the Data Service.
In this case it is appropriate to scale the Data service.</p>
</div>
</li>
<li>
<p>When I maximize the workers Eventing Function I sometimes see a stall in processing?</p>
<div class="paragraph">
<p>When scaling up vertically by adding additional workers (in the Eventing Function&#8217;s settings) typically above 48 workers (<em>the issues is workload
dependent and occurs typically on source collection updates</em>) you may see a stall in Eventing Function&#8217;s progress.  This is typically related
to resources given to the Eventing service and can be solved by adding additional Memory Quota to Eventing in the Cluster Settings.  By
default Eventing allocates 256 MB, raising this value to 512 MB will typically solve this resource issue (this is one of the rare instances
that you may need to raise the Memory Quota for Eventing).</p>
</div>
<div class="paragraph">
<p>However keep in mind that sometimes the Function is limited by both the number of cores in the Eventing instance the overall
performance of the Data Service.  In these cases it is appropriate to either scale compute power of the Eventing node, scale the
Eventing service, or scale the Data service.</p>
</div>
</li>
<li>
<p>Does Eventing support node-to-node encryption ?</p>
<div class="paragraph">
<p>Yes, node-to-node encryption is  available in the Couchbase Server for the Eventing Service in the 7.X train starting with version 7.0.2 and the 6.X train starting with version 6.6.5.
Therefore, on earlier versions (in either train), when <em>all</em> is specified, the data passed to and from all other Couchbase Services is passed in encrypted form, whereas the data passed to and from the Eventing Service continues to be passed in <em>unencrypted</em> form.</p>
</div>
<div class="paragraph">
<p>When node-to-node encryption is enabled or disabled all deployed Eventing Functions need to be temporarily paused and can be resumed after the necessary changes have been made (to prevents the potential loss of mutations during the encryption change.)</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
