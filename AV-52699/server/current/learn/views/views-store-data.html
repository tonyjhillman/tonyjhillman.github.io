<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Views and Stored Data | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="This section describes how the views system relates to stored data.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/learn/views/views-store-data.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/learn/pages/views/views-store-data.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Reference</li>
<li class="crumb"><a href="views-intro.html">Views Reference</a></li>
<li class="crumb"><a href="views-basics.html">View Concepts</a></li>
<li class="crumb"><a href="views-store-data.html">Views and Stored Data</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Views and Stored Data</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
This section describes how the views system relates to stored data.
</blockquote>
</div>
<div class="paragraph">
<p>The view system relies on the information being formatted as a JSON document.
The formatting of the data in this form enables the individual fields of the data to be identified and used.</p>
</div>
<div class="paragraph">
<p>Information is stored into your Couchbase database the data stored is parsed, if the information can be identified as valid JSON then the information is tagged and identified in the database as valid JSON.
If the information cannot be parsed as valid JSON then it is stored as a verbatim binary copy of the submitted data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/views/view-types-datastore.png" alt="view types datastore" width="600">
</div>
</div>
<div class="paragraph">
<p>When retrieving the stored data, the format of the information depends on whether the data was tagged as valid JSON or not:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-information"><a class="anchor" href="#json-information"></a>JSON information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Information identified as JSON data may not be returned in a format identical to that stored.
The information will be semantically identical, in that the same fields, data and structure as submitted will be returned.
Metadata information about the document is presented in a separate structure available during view processing.</p>
</div>
<div class="paragraph">
<p>The white space, field ordering may differ from the submitted version of the JSON document.</p>
</div>
<div class="paragraph">
<p>For example, the JSON document below, stored using the key <code>mykey</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
   "title" : "Fish Stew",
   "servings" : 4,
   "subtitle" : "Delicious with fresh bread"
}</pre>
</div>
</div>
<div class="paragraph">
<p>May be returned within the view processor as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "servings": 4,
    "subtitle": "Delicious with fresh bread",
    "title": "Fish Stew"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="non-json-information"><a class="anchor" href="#non-json-information"></a>Non-JSON information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Information not parsable as JSON will always be stored and returned as a binary copy of the information submitted to the database.
If you store an image, for example, the data returned will be an identical binary copy of the stored image.</p>
</div>
<div class="paragraph">
<p>Non-JSON data is available as a base64 string during view processing.
A non-JSON document can be identified by examining the <code>type</code> field of the metadata structure.</p>
</div>
<div class="paragraph">
<p>The significance of the returned structure can be seen when editing the view within the Web Console.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-basics"><a class="anchor" href="#json-basics"></a>JSON basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JSON is used because it is a lightweight, easily parsed, cross-platform data representation format.
There are a multitude of libraries and tools designed to help developers work efficiently with data represented in JSON format, on every platform and every conceivable language and application framework, including, of course, most web browsers.</p>
</div>
<div class="paragraph">
<p>JSON supports the same basic types as supported by JavaScript, these are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number (either integer or floating-point).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JavaScript supports a maximum numerical value of 2<sup>53</sup>.
If you are working with numbers larger than this from within your client library environment (for example, 64-bit numbers), you must store the value as a string.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String — this should be enclosed by double-quotes and supports Unicode characters and backslash escaping.
For example:</p>
<div class="listingblock">
<div class="content">
<pre>"A String"</pre>
</div>
</div>
</li>
<li>
<p>Boolean — a <code>true</code> or <code>false</code> value.
You can use these strings directly.
For example:</p>
<div class="paragraph">
<p><code>{ "value": true}</code></p>
</div>
</li>
<li>
<p>Array — a list of values enclosed in square brackets.
For example:</p>
<div class="paragraph">
<p><code>["one", "two", "three"]</code></p>
</div>
</li>
<li>
<p>Object — a set of key-value pairs (such as an associative array or hash).
The key must be a string, but the value can be any of the supported JSON values.
For example:</p>
<div class="listingblock">
<div class="content">
<pre>{
   "servings" : 4,
   "subtitle" : "Easy to make in advance, and then cook when ready",
   "cooktime" : 60,
   "title" : "Chicken Coriander"
}</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the submitted data cannot be parsed as a JSON, the information will be stored as a binary object, not a JSON document.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-metadata"><a class="anchor" href="#document-metadata"></a>Document metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During view processing, metadata about individual documents is exposed through a separate JSON object, <code>meta</code>, that can be optionally defined as the second argument to the <code>map()</code>.
This metadata can be used to further identify and qualify the document being processed.</p>
</div>
<div class="paragraph">
<p>The <code>meta</code> structure contains the following fields and associated information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The ID or key of the stored data object.
This is the same as the key used when writing the object to the Couchbase database.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rev</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An internal revision ID used internally to track the current revision of the information.
The information contained within this field is not consistent or trackable and should not be used in client applications.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The type of the data that has been stored.
A valid JSON document will have the type <code>json</code>.
Documents identified as binary data will have the type <code>base64</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>flags</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The numerical value of the flags set when the data was stored.
The availability and value of the flags is dependent on the client library you are using to store your data.
Internally the flags are stored as a 32-bit integer.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expiration</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The expiration value for the stored object.
The stored expiration time is always stored as an absolute Unix epoch time value.</p>
</div>
<div class="paragraph">
<p>These additional fields are only exposed when processing the documents within the view server.
These fields are not returned when you access the object through the Memcached/Couchbase protocol as part of the document.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="non-json-data"><a class="anchor" href="#non-json-data"></a>Non-JSON data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All documents stored in Couchbase Server will return a JSON structure, however, only submitted information that could be parsed into a JSON document will be stored as a JSON document.
If you store a value that cannot be parsed as a JSON document, the original binary data is stored.
This can be identified during view processing by using the <code>meta</code> object supplied to the <code>map()</code> function.</p>
</div>
<div class="paragraph">
<p>Information that has been identified and stored as binary documents instead of JSON documents can still be indexed through the views system by creating an index on the key data.
This can be particularly useful when the document key is significant.
For example, if you store information using a prefix to the key to identify the record type, you can create document-type specific indexes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-storage-and-indexing-sequence"><a class="anchor" href="#document-storage-and-indexing-sequence"></a>Document storage and indexing sequence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The method of storage of information into the Couchbase Server affects how and when the indexing information is built, and when data written to the cluster is incorporated into the indexes.
In addition, the indexing of data is also affected by the view system and the settings used when the view is accessed.</p>
</div>
<div class="paragraph">
<p>The basic storage and indexing sequence is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A document is stored within the cluster.
Initially the document is stored only in RAM.</p>
</li>
<li>
<p>The document is communicated to the indexer through replication to be indexed by views.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This sequence means that the view results are eventually consistent with what is stored in memory based on the latency in replication of the change to the indexer.
It is possible to write a document to the cluster and access the index without the newly written document appearing in the generated view.</p>
</div>
<div class="paragraph">
<p>Conversely, documents that have been stored with an expiry may continue to be included within the view until the document has been removed from the database by the expiry pager.</p>
</div>
<div class="paragraph">
<p>Couchbase Server supports the Observe command, which enables the current state of a document and whether the document has been replicated to the indexer or whether it has been considered for inclusion in an index.</p>
</div>
<div class="paragraph">
<p>When accessing a view, the contents of the view are asynchronous to the stored documents.
In addition, the creation and updating of the view is subject to the <code class="opt">stale</code> parameter.
This controls how and when the view is updated when the view content is queried.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
