<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Durability | Couchbase Docs</title>
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="&lt;em&gt;Durability&lt;/em&gt; ensures the greatest likelihood of data-writes surviving unexpected anomalies, such as node-outages.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/learn/data/durability.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/learn/pages/data/durability.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Learn</li>
<li class="crumb"><a href="data.html">Data</a></li>
<li class="crumb"><a href="durability.html">Durability</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Durability</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<em>Durability</em> ensures the greatest likelihood of data-writes surviving unexpected anomalies, such as node-outages.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-durability"><a class="anchor" href="#understanding-durability"></a>Understanding Durability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Writes to Couchbase-Server buckets can optionally be assigned <em>durability requirements</em>; which instruct Couchbase Server to update the specified document on multiple nodes in memory and/or disk locations across the cluster; before considering the write to be committed.
The greater the number of memory and/or disk locations specified in the requirements, the greater the level of <em>durability</em> achieved.</p>
</div>
<div class="paragraph">
<p>Once the write has been committed as specified by the requirements, Couchbase Server notifies the client of success.
If commitment was not possible, Couchbase Server notifies the client of failure; and the data retains its former value throughout the cluster.</p>
</div>
<div class="paragraph">
<p>This form of write is referred to as a <em>durable</em> or <em>synchronous</em> write.</p>
</div>
<div class="paragraph">
<p>Couchbase Server supports durability for up to <em>two</em> replicas: it <em>does not</em> support durability for <em>three</em> replicas.</p>
</div>
<div class="paragraph">
<p>Durability is used by <a href="transactions.html" class="xref page">Transactions</a>, which support the <em>atomicity</em> of mutations across multiple documents.</p>
</div>
<div class="paragraph">
<p>Durability requirements can be specified by a client, assigned to a bucket, or both.
Both Couchbase and Ephemeral buckets are supported: however, Ephemeral buckets only support durability requirements that do not involve persistence to disk.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="durability-benefits-and-costs"><a class="anchor" href="#durability-benefits-and-costs"></a>Benefits and Costs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Durability allows developers to distinguish between regular and durable writes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>regular</em> write is <em>asynchronous</em>, and is not supported by durability.
Such a write may be appropriate when writing data whose loss would produce only a minor inconvenience.
For example, a single instance of sensor data, out of the tens of thousands of instances that are being continuously received.</p>
</li>
<li>
<p>A <em>durable</em> write is <em>synchronous</em>, and is supported by durability.
Such a write may be appropriate when saving data whose loss could have a considerable, negative impact.
For example, data corresponding to a financial transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that in most cases, a durable write takes significantly longer than a regular write; due to the increased amount of either replication or persistence it demands from Couchbase Server, prior to completion.
In considering whether to use durability, therefore, the application-designer must choose between the higher throughput (and lesser data-protection) provided by regular writes, and the greater data-protection (and lower throughput) provided by durable writes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="majority"><a class="anchor" href="#majority"></a>Majority</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Durability requirements use the concept of <em>majority</em>, to indicate the number of configured Data Service nodes to which commitment is required, based on the number of replicas defined for the bucket.
The correspondences are as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Number of Replicas</th>
<th class="tableblock halign-left valign-top">Number of Nodes Required for Majority</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Not supported</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="durability-requirements"><a class="anchor" href="#durability-requirements"></a>Durability Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Durability requirements that can be specified are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Level</em>.
The level of durability required.
The possible values are:</p>
<div class="ulist">
<ul>
<li>
<p><em>majority</em>.
The mutation must be replicated to (that is, held in the memory allocated to the bucket on) a majority of the Data Service nodes.
Valid for both Couchbase and Ephemeral buckets.</p>
</li>
<li>
<p><em>majorityAndPersistActive</em>.
The mutation must be replicated to a majority of the Data Service nodes.
Additionally, it must be <em>persisted</em> (that is, written and synchronised to disk) on the node hosting the active vBucket for the data.
Valid for Couchbase buckets only.</p>
</li>
<li>
<p><em>persistToMajority</em>.
The mutation must be persisted to a majority of the Data Service nodes.
Accordingly, it will be written to disk on those nodes.
Valid for Couchbase buckets only.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Timeout</em>.
The number of milliseconds within which the durability requirements must be met.
The SDK specifies a default of 2500.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="specifying-levels"><a class="anchor" href="#specifying-levels"></a>Specifying Levels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Durability <em>levels</em> can be specified by a client, and can also be assigned to a bucket by an administrator.
A level assigned to a bucket is subsequently enforced as the <em>minimum</em> level at which <em>all</em> writes to the bucket occur.
Therefore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a level is specified by the client, and no level has been assigned to the bucket, the level specified by the client is enforced.</p>
</li>
<li>
<p>If no level is specified by the client (meaning that a non-durable write is being requested), but a level <em>has</em> been assigned to the bucket, the level assigned to the bucket is enforced.</p>
</li>
<li>
<p>If a level is specified by the client, and a level has <em>also</em> been assigned to the bucket, the higher level is enforced.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="process-and-communication"><a class="anchor" href="#process-and-communication"></a>Process and Communication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A durable write is atomic.
Client-reads of the value undergoing a durable write return the value that precedes the durable write.
Clients that attempt to write to a key whose value is undergoing a durable write receive an error message from the active node, and may retry.</p>
</div>
<div id="durable-write-lifecycle" class="paragraph">
<p>The lifecycle of a durable write is shown by the following, annotated diagram; which shows multiple clients' attempts to update and read a value, with the timeline moving from left to right.</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/data/durabilityDiagram.png" alt="durabilityDiagram" width="780">
</div>
</div>
<div class="paragraph">
<p>The annotations are as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Client 1 specifies durability requirements for a durable write, to change a key’s existing value from a to b.</p>
</li>
<li>
<p>The Active Node receives the request, and the durable write process is initiated.
Couchbase Server attempts to meet the client’s specified durability requirements.</p>
</li>
<li>
<p>During the durable write process, Client 2 performs a read on the value undergoing the durable write.
Couchbase Server returns the value, a,  that preceded the durable-write request.</p>
</li>
<li>
<p>During the durable-write process, Client 3 attempts either a durable write or a regular write on the value that is already undergoing a durable write.
Couchbase Server returns a <code>SYNC_WRITE_IN_PROGRESS</code> message, to indicate that the new write cannot occur.</p>
</li>
<li>
<p>At the point the mutation has met the specified durability requirements, the Active Node commits the durable write, and sends a status response of <code>SUCCESS</code> to Client 1.</p>
</li>
<li>
<p>After the durable-write process, Client 2 performs a second read on the  value.
Couchbase Server returns the value, b, committed by the durable write.
Indeed, from this point, all clients see the value b.</p>
<div class="paragraph">
<p>If Couchbase Server aborts a durable write, all mutations to active and replica vBuckets in memory and on disk are rolled back, and all copies of the data are reverted to their value from before the data-write.
Couchbase Server duly informs the client.
See <a href="#failure-scenarios">Failure Scenarios</a>, below.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In some circumstances, rather than acknowledging to a client that the durable write has succeeded, Couchbase Server acknowledges an <em>ambiguous outcome</em>: for example, due to the client-specified timeout having elapsed.
See <a href="#handling-ambiguous-results">Handling Ambiguous Results</a>, below.</p>
</div>
<div class="paragraph">
<p>Subsequent to a durable write’s commitment and due acknowledgement, Couchbase Server continues the process of replication and persistence, until all active and replica vBuckets, both in memory and on disk, have been appropriately updated across all nodes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="regular-writes"><a class="anchor" href="#regular-writes"></a>Regular Writes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A write that occurs <em>without</em> durability is considered a <em>regular</em> (that is <em>asynchronous</em>) write.
No durability requirement is imposed.
Couchbase Server acknowledges success to the client as soon as the data is in the memory of the node hosting the active vBucket: Couchbase Server <em>does not</em> confirm that the write has been propagated to any replica.
A regular write therefore provides no guarantee of durability.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="failure-scenarios"><a class="anchor" href="#failure-scenarios"></a>Failure Scenarios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A durable write fails in the following situations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Server timeout exceeded</em>.
The active node aborts the durable write, instructs all replica nodes also to abort the pending write, and informs the client that the durable write has had an ambiguous result.
See <a href="#handling-ambiguous-results">Handling Ambiguous Results</a>, below.</p>
</li>
<li>
<p><em>Replica node fails while SyncWrite is pending (that is, before the active node can identify whether the node hosted a replica)</em>.
If enough alternative replica nodes can be identified, the durable write can proceed.
Otherwise, the active node waits until a server-side timeout has expired; then aborts the durable write, and duly informs the client that the durable write has had an ambiguous result.</p>
</li>
<li>
<p><em>Active node fails while SyncWrite is pending</em>.
This disconnects the client, which must assume that the result of the durable write has proved ambiguous.
If the active node is failed over, a replica is promoted from a replica node: depending on how advanced the durable write was at the time of active-node failure, the durable write may proceed.</p>
</li>
<li>
<p><em>Write while SyncWrite is pending</em>.
A client that attempts a durable or an asynchronous write on a key whose value is currently undergoing a durable write receives a <code>SYNC_WRITE_IN_PROGRESS</code> message, to indicate that the new write cannot currently proceed.
The client may retry.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handling-ambiguous-results"><a class="anchor" href="#handling-ambiguous-results"></a>Handling Ambiguous Results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Server informs the client of an ambiguous result whenever Couchbase Server cannot confirm that an intended commit was successful.
This situation may be caused by node-failure, network-failure, or timeout.</p>
</div>
<div class="paragraph">
<p>If a client receives notification of an ambiguous result, and the attempted durable write is <em>idempotent</em>, the durable write can be re-attempted.
If the attempted durable write is <em>not</em> idempotent, the options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify the current state of the saved data; and re-attempt the durable write if appropriate.</p>
</li>
<li>
<p>Return an error to the user.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rebalance"><a class="anchor" href="#rebalance"></a>Rebalance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>rebalance</em> process moves active and replica vBuckets across nodes, to ensure optimal availability.
During the process, clients’ access to data is uninterrupted.
The durable-write process is likewise uninterrupted by rebalance, and continues throughout the rebalance process.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performance"><a class="anchor" href="#performance"></a>Performance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The performance of durable writes may be optimized by the appropriate allocation of <em>writer</em> threads.
See <a href="../buckets-memory-and-storage/storage-settings.html#threading" class="xref page">Threading</a> for conceptual information, and <a href="../../manage/manage-settings/general-settings.html#data-settings" class="xref page">Data Settings</a> for practical steps.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="protection-guarantees-overview"><a class="anchor" href="#protection-guarantees-overview"></a>Protection Guarantees: Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the durable-write process is complete, the application is notified that <em>commitment</em> has occurred.
During the time-period that starts at the point of commitment, and lasts until the point at which the new data has been fully propagated throughout the cluster (this being potentially but not necessarily later than the point of commitment), if an outage occurs, the new data is guaranteed to be protected from loss &#8212; <em>within certain constraints</em>.
The constraints are related to the <em>level</em> of durability specified, the nature of the outage, and the number of replicas.
The guarantees and associated constraints are stated on this page, below.</p>
</div>
<div class="sect2">
<h3 id="replica-count-restriction"><a class="anchor" href="#replica-count-restriction"></a>Replica-Count Restriction</h3>
<div class="paragraph">
<p>Couchbase-Server durability supports buckets with up to <em>two</em> replicas.
It does <em>not</em> support buckets with <em>three</em> replicas.
If a durable write is attempted on a bucket that has been configured with three replicas, the write fails with an <code>EDurabilityImpossible</code> message.</p>
</div>
</div>
<div class="sect2">
<h3 id="protection-guarantees-and-automatic-failover"><a class="anchor" href="#protection-guarantees-and-automatic-failover"></a>Protection Guarantees and Automatic Failover</h3>
<div class="paragraph">
<p><a href="../clusters-and-availability/automatic-failover.html" class="xref page">Automatic Failover</a> removes a non-responsive node from the cluster automatically, following an administrator-configured timeout.
Active vBuckets thereby lost are replaced by the promotion of replica vBuckets, on the surviving nodes.
A maximum of three sequential automatic failovers can be configured to occur.</p>
</div>
<div class="paragraph">
<p>In cases where commitment based on <em>persistToMajority</em> has occurred, but no further propagation of the new data across the cluster has yet occurred, automatic failover of the nodes containing the new data results in the data&#8217;s loss &#8212; since no updated replica vBucket yet exists elsewhere on the cluster.</p>
</div>
<div class="paragraph">
<p>For example, if a bucket has two replicas, the total number of nodes on which the data resides is <em>three</em>; and the <em>majority</em> of nodes, on which persistence must occur prior to commitment, is <em>two</em>.
After commitment, if those two nodes become unresponsive, automatic failover, if configured to occur up to a maximum of two times, allows those two nodes to be failed over <em>before</em> the durable write has been made persistent on the third node.
In such a case, the durable write is lost, and the success message already delivered to the application rendered false.</p>
</div>
<div class="paragraph">
<p>To prevent this, and thereby maintain guaranteed protection, at least one of the unresponsive nodes containing the new data should <em>not</em> be failed over.
Therefore, auto-failover should be configured to occur sequentially only up to the number of times that supports this requirement.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="protection-guarantees-1-replica"><a class="anchor" href="#protection-guarantees-1-replica"></a>Protection Guarantees: One Replica</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When one replica has been defined, from the point of commitment until the new data has been fully propagated across the cluster, protection guarantees are as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 30%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Level</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Failure(s)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>majority</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The active node fails, and is automatically failed over.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new data is lost from the memory of the active node; but exists in the memory of the replica node.
The replica vBucket is promoted to active status on the replica node, and the new data is thus preserved.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 30%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>majorityAndPersistActive</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The active node fails, and is automatically failed over.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new data is lost from the memory and disk of the active node; but exists in the memory of the replica node.
The replica vBucket is promoted to active status on the replica node, and the new data is thus preserved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The active node fails, but restarts before auto-failover occurs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new data is lost from the memory of the active node; but exists on the disk of the active node, and is thereby recovered when the active node has restarted.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 30%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>persistToMajority</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The active node fails, and is automatically failed over.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new data is lost from the memory and disk of the active node; but exists in the memory and disk of the replica node.
The replica vBucket is promoted to active status on the replica node, and the new data is thus preserved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The active node fails, but restarts before auto-failover occurs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new data is lost from the memory of the active node; but exists on the disk of the active node, and is thereby recovered when the active node has restarted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The active node fails, and is automatically failed over.
Then, the promoted replica node itself fails, and then restarts.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The new data is lost from the memory and disk of the active node, but exists in the memory and on the disk of the replica node; and is promoted there to active status.
Then, the promoted replica node itself fails, and the new data is temporarily unavailable. However, when the promoted replica node has restarted, the new data again becomes available on disk.</p>
<p class="tableblock">To ensure auto-failover does not conflict with guaranteed protection, when two replicas have been configured, establish <code>1</code> as the maximum number of sequential automatic failovers that can take place without administrator intervention.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="protection-guarantees-2-replicas"><a class="anchor" href="#protection-guarantees-2-replicas"></a>Protection Guarantees: Two Replicas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The durability protection guarantees for two replicas are identical to those described above, for <a href="#protection-guarantees-1-replica">One Replica</a>.
This is because <em>majority</em> is <code>2</code> for both cases: see the table in <a href="#majority">Majority</a>, above.</p>
</div>
<div class="paragraph">
<p>Commitment therefore occurs without the second replica being guaranteed an update.
To ensure auto-failover does not conflict with guaranteed protection, when two replicas have been configured, establish <code>1</code> as the maximum number of sequential automatic failovers that can take place without administrator intervention.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
