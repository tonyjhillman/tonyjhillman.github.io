<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>XDCR Security and Networking | Couchbase Docs</title>
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Specific requirements must be satisfied in order to ensure the successful creation of XDCR replications over different network configurations.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/xdcr-reference/xdcr-security-and-networking.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/xdcr-reference/pages/xdcr-security-and-networking.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Reference</li>
<li class="crumb"><a href="xdcr-reference-intro.html">XDCR Reference</a></li>
<li class="crumb"><a href="xdcr-security-and-networking.html">Security and Networking</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">XDCR Security and Networking</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Specific requirements must be satisfied in order to ensure the successful creation of XDCR replications over different network configurations.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-and-networking-contexts"><a class="anchor" href="#security-and-networking-contexts"></a>Security and Networking Contexts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This page considers three, specific contexts in which XDCR replications must sometimes be established.
These respectively involve:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Handling <em>Couchbase Schemes</em>, Using <em>DNS SRV</em></p>
</li>
<li>
<p>Using <em>Alternate Addresses</em></p>
</li>
<li>
<p>Using <em>Certificates</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each is explained below.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dnssrv"><a class="anchor" href="#dnssrv"></a>Handling Couchbase Schemes, Using DNS SRV</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Targets for XDCR replication can be specified using the schemes <em>http://</em> and <em>https://</em>, and with the standard port number <code>8091</code> or <code>18091</code>, as applicable.
Targets <em>cannot</em> be specified with the <em>Couchbase</em> schemes <em>couchbase://</em> and <em>couchbases://</em>, which are, instead, used to support the memcached protocol on ports <code>11210</code> and <code>11207</code>, respectively.</p>
</div>
<div class="paragraph">
<p>Targets <em>can</em>, however, be specified with a <em>Fully Qualified Domain Name</em> (<em>FQDN</em>) that is either tagged with one of the standard port numbers, or is untagged.
In such cases, XDCR performs a <a href="https://go.dev/src/net/lookup.go" target="_blank" rel="noopener">LookupSRV</a> on the FQDN, using the local machine’s <em>DNS resolver</em>.
LookupSRV obtains the appropriate name from a local DNS <a href="https://en.wikipedia.org/wiki/SRV_record" target="_blank" rel="noopener">SRV record</a>: which is a specification of data in the Domain Name System that defines the <em>location</em> (the hostname and port number) of a server for a particular service.
When LookupSRV has returned the name, XDCR concatenates a standard port number to the name, and uses the resulting concatenation as the target-reference.</p>
</div>
<div class="paragraph">
<p>Consequently, resources named by means of the Couchbase schemes can be resolved to appropriate XDCR-target names: by first removing the <em>couchbase</em> or <em>couchbases</em> prefix, and then specifying the remaining symbol, which is the FQDN&#8201;&#8212;&#8201;so that LookupSRV resolves the FQDN to a name that XDCR can include in the ultimate target-reference.
Note, however, that this does assume the target&#8217;s use of one of the standard port numbers&#8201;&#8212;&#8201;<code>8091</code> or <code>18091</code>.</p>
</div>
<div class="sect2">
<h3 id="example"><a class="anchor" href="#example"></a>Example</h3>
<div class="paragraph">
<p>Suppose a resource is provided with the Couchbase scheme as follows: <code>couchbases://7cb51b5b-d9cd-410d-9cc7-1be93e2f31d9.dp.cloud.couchbase.com</code>.
The scheme&#8217;s prefix <code>couchbases://</code> can be removed, so as to leave an FQDN as follows: <code>7cb51b5b-d9cd-410d-9cc7-1be93e2f31d9.dp.cloud.couchbase.com</code>.
This FQDN can be specified by the administrator as the <em>hostname</em> of the target cluster for XDCR replication.</p>
</div>
<div class="paragraph">
<p>Note that the command <code>nslookup -type=srv</code> can be used manually to determine whether this hostname corresponds to one or more true, DNS SVR records.
The format of an SRV record is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>_service._proto.name. ttl IN SRV priority weight port target</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://en.wikipedia.org/wiki/SRV_record" target="_blank" rel="noopener">SRV record</a>, for a full explanation of this syntax.</p>
</div>
<div class="paragraph">
<p>For manual lookup to be performed, values must be provided for the <code>_service._proto.name.</code> arguments.
Thus, <code>couchbases</code> can be used for the <code>service</code> argument; <code>tcp</code> for the <code>proto</code> argument; and the hostname <code>7cb51b5b-d9cd-410d-9cc7-1be93e2f31d9.dp.cloud.couchbase.com</code> for the <code>name</code> argument.
The command therefore becomes as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nslookup -type=srv _couchbases._tcp.7cb51b5b-d9cd-410d-9cc7-1be93e2f31d9.dp.cloud.couchbase.com</pre>
</div>
</div>
<div class="paragraph">
<p>If execution is successful, output is similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Server:		176.103.130.130
Address:	176.103.130.130#53

Non-authoritative answer:
_couchbases._tcp.7cb51b5b-d9cd-410d-9cc7-1be93e2f31d9.dp.cloud.couchbase.com	service = 0 0 11207 cb-0001.7cb51b5b-d9cd-410d-9cc7-1be93e2f31d9.dp.cloud.couchbase.com.
_couchbases._tcp.7cb51b5b-d9cd-410d-9cc7-1be93e2f31d9.dp.cloud.couchbase.com	service = 0 0 11207 cb-0002.7cb51b5b-d9cd-410d-9cc7-1be93e2f31d9.dp.cloud.couchbase.com.
_couchbases._tcp.7cb51b5b-d9cd-410d-9cc7-1be93e2f31d9.dp.cloud.couchbase.com	service = 0 0 11207 cb-0000.7cb51b5b-d9cd-410d-9cc7-1be93e2f31d9.dp.cloud.couchbase.com.</pre>
</div>
</div>
<div class="paragraph">
<p>This output shows that three SRV records have been found to correspond with the values specified.
The final value of each displayed record is the <code>target</code> for the record: each is a name beginning with <code>cb-</code>; and each name corresponds to an individual, server node.</p>
</div>
<div class="paragraph">
<p>The process shown manually above is essentially that followed programmatically by LookupSRV.
Note that XDCR ignores the value of the <code>port</code> argument returned in the record (which is in each case the secure memcached port, <code>11207</code>).</p>
</div>
<div class="paragraph">
<p>Using the target-reference derived from SRV, XDCR then performs its usual <em>cluster add</em> procedure, to contact the other server nodes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-alternate-addresses"><a class="anchor" href="#using-alternate-addresses"></a>Using Alternate Addresses</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Alternate addresses</em> are used to allow a cluster to keep its <em>internally visible</em> addresses private, while using a router or other networked entity to provide <em>externally visible</em> addresses that are to be used by networked clients of the cluster.
Instances of <em>Kubernetes</em> and <em>AWS</em> frequently use alternate addresses for their connections with external entities.</p>
</div>
<div class="paragraph">
<p>Alternate addresses used in this way are said to constitute an <em>external network</em>.
Any cluster that is established within an external network must have its nodes configured to use the corresponding alternate addresses for external communications; and if the cluster is to be used as an XDCR target, these addresses must be referenced by the XDCR source.
This involves, on the target, <em>port forwarding</em>, which is described in <a href="../learn/clusters-and-availability/connectivity.html#alternate-addresses" class="xref page">Alternate Addresses</a>.
It also involves, on the source, specification of the external network interface, either as an FQDN, or an IP address.</p>
</div>
<div class="paragraph">
<p>When a cluster has been configured in this way for external networking, and status on the cluster is returned by means of Couchbase Web Console, the CLI, or the REST API, both the internal and the external addresses are represented.</p>
</div>
<div class="paragraph">
<p>The REST API reference page <a href="../rest-api/rest-set-up-alternate-address.html" class="xref page">Managing Alternate Addresses</a> explains how alternate addresses can be established for and removed from nodes.
The REST API reference page <a href="../rest-api/rest-list-node-services.html" class="xref page">Listing Node Services</a> explains how to retrieve all internal and external address settings.</p>
</div>
<div class="sect2">
<h3 id="kubernetes"><a class="anchor" href="#kubernetes"></a>Kubernetes</h3>
<div class="paragraph">
<p><em>Kubernetes</em> employs a dual network environment, where an external interface is established for the reception of externally generated network traffic.
Such traffic includes inbound XDCR mutations: therefore, the source cluster must use the external interface established for Kubernetes.</p>
</div>
<div class="paragraph">
<p>A diagram of dual-network setup is provided in <a href="../learn/clusters-and-availability/connectivity.html#dual-network" class="xref page">Dual Network</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="aws-and-cloud"><a class="anchor" href="#aws-and-cloud"></a>AWS and Cloud</h3>
<div class="paragraph">
<p>If a cluster is established on a public cloud such as AWS, or is a Kubernetes cluster, and is intended to become the target for XDCR, the cluster must be configured with alternate addresses, to support the source cluster&#8217;s access.
A diagram is provided in <a href="../learn/clusters-and-availability/connectivity.html#internal-network-or-cloud-access" class="xref page">Internal Network or Cloud Access</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="specifying-addresses"><a class="anchor" href="#specifying-addresses"></a>Specifying Addresses</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a target cluster is configured with alternate addresses, the particular address to which a connection should be made can be specified on the source cluster.
The following options are available for specifying the target-cluster address:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When using Couchbase Web Console, from the <strong>XDCR Replications</strong> screen, left-clicking the <strong>ADD REMOTE</strong> tab brings up the <strong>Add Remote Cluster</strong> dialog, which provides an <strong>IP/Hostname</strong> interactive field.
(See <a href="../manage/manage-xdcr/create-xdcr-reference.html#create-an-xdcr-reference-with-the-ui" class="xref page">Create an XDCR Reference with the UI</a>.)</p>
</li>
<li>
<p>When using the CLI, the <code>xdcr-setup</code> command provides the <code>--xdcr-hostname</code> field.
(See <a href="#cli:cbcli/couchbase-cli-xdcr-setup.adoc" class="xref unresolved">xdcr-setup</a>.)</p>
</li>
<li>
<p>When using the REST API, the <code>POST /pools/default/remoteClusters</code> method and URI provide the <code>hostname</code> field.
(See <a href="../rest-api/rest-xdcr-create-ref.html" class="xref page">Setting a Reference</a>.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In each case:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An IP address or a qualified domain name can be specified.
The name can optionally be tagged with the port number <code>8091</code> or <code>18091</code>.</p>
</li>
<li>
<p>If a specified IP address corresponds to the external address of the target cluster, the external address is used for the connection.
If a specified IP address corresponds to the internal address of the target cluster, the internal address is used for the connection.</p>
<div class="paragraph">
<p>In either case, if the name is not tagged with a port number, the connection defaults to <code>8091</code>; unless a secure connection is specified in another field, in which case <code>18091</code> is used.
(Note that the REST API provides a <code>network_type</code> parameter, which can be set to <code>external</code>, so as to enforce a secure connection: see <a href="../rest-api/rest-xdcr-create-ref.html" class="xref page">Setting a Reference</a>.)</p>
</div>
</li>
<li>
<p>If an FQDN is specified without a port number, LookupSRV is invoked on the FQDN, to match the FQDN to an appropriate target-name.
If an FQDN is specified with one of the standard port numbers, <code>8091</code> and <code>18091</code>, the port number is stripped from the FQDN, and LookupSRV is invoked on the resulting symbol, to match the FQDN to an appropriate target-name.
In either case, if a match is found, a connection is attempted, using the corresponding target-name.
If no match is found, a connection is attempted, using the FQDN&#8217;s standard mapping to the internal or external IP address of a non-SRV target cluster.</p>
<div class="paragraph">
<p>(See <a href="#dnssrv">Handling Couchbase Schemes, using DNS SRV</a>, above.)</p>
</div>
<div class="paragraph">
<p>Note that if LookupSRV is attempted and fails, XDCR retries the connection, using the FQDN&#8217;s standard mapping: if the retry succeeds, the standard mapping continues to be used.
Note that connectivity status for all of a source cluster&#8217;s defined references can be retrieved by means of the REST API: see <a href="../rest-api/rest-xdcr-get-ref.html" class="xref page">Getting a Reference</a>.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-certificates"><a class="anchor" href="#using-certificates"></a>Using Certificates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To be fully secure, XDCR requires <em>x.509 certificates</em> to have been established on the target cluster.
The source cluster can authenticate with the target by means <em>either</em> of a username and password <em>or</em> of its own x.509 certificates.</p>
</div>
<div class="sect2">
<h3 id="preparing-to-configure-secure-replications"><a class="anchor" href="#preparing-to-configure-secure-replications"></a>Preparing to Configure Secure Replications</h3>
<div class="paragraph">
<p>A complete overview of certificate management for Couchbase Server is provided in <a href="../learn/security/certificates.html" class="xref page">Certificates</a>; examples of establishing secure connections are provided in <a href="../manage/manage-xdcr/secure-xdcr-replication.html" class="xref page">Secure a Replication</a>.
An overview of <em>Transport Layer Security</em> is provided in <a href="../learn/security/on-the-wire-security.html" class="xref page">On-the-Wire Security</a>; and examples of configuring TLS are provided in <a href="../manage/manage-security/manage-tls.html" class="xref page">Manage On-the-Wire Security</a>.
Detailed information on the communication <em>handshake</em> implemented by <em>Transport Layer Security</em> can be found in <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_handshake" target="_blank" rel="noopener">TLS Handshake</a>.</p>
</div>
<div class="paragraph">
<p>Administrators intending to establish secure replications should be familiar with all of the above content.
A number of key issues are summarized below.</p>
</div>
</div>
<div class="sect2">
<h3 id="defining-client-and-server"><a class="anchor" href="#defining-client-and-server"></a>Defining Client and Server</h3>
<div class="paragraph">
<p>When a fully secure XDCR replication is configured, the source cluster should be considered the <em>client</em>, and the target cluster the <em>server</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="understanding-root-intermediate-and-node-certificates"><a class="anchor" href="#understanding-root-intermediate-and-node-certificates"></a>Understanding Root, Intermediate, and Node Certificates</h3>
<div class="paragraph">
<p>As described in <a href="../learn/security/certificates.html" class="xref page">Certificates</a>, the authority of a networked entity, such as a cluster or an application, is, in a typical production context, represented by a <em>root</em> certificate that has been provided by a known <em>Certificate Authority</em>.
This root certificate (or <em>CA</em>) must be included in the <em>trust store</em> of the target cluster.
See <a href="../learn/security/using-multiple-cas.html" class="xref page">Using Multiple Root Certificates</a> for information on the trust store, and see <a href="../rest-api/load-trusted-cas.html" class="xref page">Load Root Certificates</a> for information on loading a CA into a trust store.</p>
</div>
<div class="paragraph">
<p>Note that when the known authority&#8217;s CA has been successfully loaded, it is visible by means of Couchbase Web Console, as shown in the documentation for the <a href="../manage/manage-security/manage-security-settings.html#root-certificate-security-screen-display" class="xref page">Certificates</a> security screen.
If, on the target cluster, the CA is not visible here, it has not been loaded, and no fully secure replication will be supported.</p>
</div>
<div class="paragraph">
<p>Each node in the target cluster must be represented by its own <em>node</em> certificate.
The CA for the target cluster must have been used to <em>digitally sign</em> each node certificate: either directly, or (more likely) <em>indirectly</em>, by means of an <em>intermediate</em> certificate.
When signing is complete, each node certificate must be <em>concatenated</em> with however many intermediate certificates have been used, to form a <em>certificate chain</em>, and then appropriately posted on the node it is representing.</p>
</div>
<div class="paragraph">
<p>To support fully secure XDCR, each node in a target cluster must be identified by its <code>subjectAlName</code> extension, in its node certificate.</p>
</div>
<div class="paragraph">
<p>An overview of node-certificate preparation is provided in <a href="../learn/security/certificates.html#certificate-hierarchies" class="xref page">Certificate Hierarchies</a>, and examples (including use of <code>subjectAltName</code>) are provided in <a href="../manage/manage-security/manage-certificates.html" class="xref page">Manage Certificates</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="performing-certificate-based-authentication"><a class="anchor" href="#performing-certificate-based-authentication"></a>Performing Certificate-Based Authentication</h3>
<div class="paragraph">
<p>When the XDCR source cluster authenticates with the target cluster, the <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_handshake" target="_blank" rel="noopener">TLS Handshake</a> is performed.
During the course of this, the <em>server</em> (which is the target-cluster node) provides its certificate chain to the <em>client</em> (which is the source cluster).
The source cluster validates the chain, as described in <a href="../learn/security/certificates.html#node-certificate" class="xref page">Node Certificates</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="recognizing-cas"><a class="anchor" href="#recognizing-cas"></a>Recognizing CAs</h3>
<div class="paragraph">
<p>The top certificate in the chain that is provided to the source cluster (the <em>client</em>) points to the CA for the target cluster (the <em>server</em>).
As explained above, this CA must have been loaded into the trust store for the target cluster.
Additionally, this CA must be recognizable to the source cluster: therefore, XDCR allows the CA to be passed to the source cluster during the set-up of the secure connection.
See <a href="../manage/manage-xdcr/enable-full-secure-replication.html" class="xref page">Enable Fully Secure Replications</a> for examples; covering the UI, the CLI, and the REST API.</p>
</div>
<div class="paragraph">
<p>Note that, in Couchbase Server 7.1+, <em>multiple root certificates</em> are supported (see <a href="../learn/security/using-multiple-cas.html" class="xref page">Using Multiple Root Certificates</a>).
Therefore, source and target clusters need not rely on the authority of the same CA: however, each must trust the CA of the other, if the client is to perform certificate-based authentication&#8201;&#8212;&#8201;and consequently, if the CAs are different, the CA of the client must have been loaded into the trust store of the server, for authentication to succeed.</p>
</div>
<div class="paragraph">
<p>See <a href="../rest-api/load-trusted-cas.html" class="xref page">Load Root Certificates</a>, for further information.</p>
</div>
</div>
<div class="sect2">
<h3 id="handling-client-certificates"><a class="anchor" href="#handling-client-certificates"></a>Handling Client Certificates</h3>
<div class="paragraph">
<p>If the source cluster (the <em>client</em>) wishes to authenticate with the target cluster (the <em>server</em>) by means of <em>client certificates</em>, the administrator must first <a href="../manage/manage-security/enable-client-certificate-handling.html" class="xref page">Enable Client-Certificate Handling</a>, on the server.</p>
</div>
<div class="paragraph">
<p>See <a href="../manage/manage-xdcr/enable-full-secure-replication.html#specify-full-xdcr-security-with-certificates" class="xref page">Specify Root and Client Certificates, and Client Private Key</a>, for an example of making the subsequent connection, from the client.</p>
</div>
</div>
<div class="sect2">
<h3 id="xdcr-certificates-and-containers"><a class="anchor" href="#xdcr-certificates-and-containers"></a>XDCR, Certificates, and Containers</h3>
<div class="paragraph">
<p>If either a source or a target cluster for an XDCR replication resides within a container, such as a Kubernetes pod, the container&#8217;s image must itself contain the trusted CA that is relied on for validating the cluster that is being connected to.</p>
</div>
<div class="paragraph">
<p>Note that Couchbase <em>Operator</em> has a <em>Dynamic Admissions Controller</em> (DAC), which performs TLS certificate-generation and assignment, including rotation.
Therefore, if DAC is being used, the Root Certificate referred to by the client when setting up a fully secure replication must be the one whose authority, on the server, is relied on for these DAC operations.</p>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
