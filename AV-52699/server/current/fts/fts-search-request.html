<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Search Request | Couchbase Docs</title>
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/fts/fts-search-request.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/fts/pages/fts-search-request.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb"><a href="fts-search-request.html">Search Request</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Search Request</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div class="sect1">
<h2 id="Query"><a class="anchor" href="#Query"></a>Query</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Search allows multiple query types to be performed on Full Text Indexes. Each of these query types helps enhance the search and retrievability of the indexed data.</p>
</div>
<div class="paragraph">
<p>These capabilities include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Input-text and target-text can be analyzed: this transforms input-text into token-streams, according to different specified criteria, allowing richer and more finely controlled forms of text-matching.</p>
</li>
<li>
<p>The fuzziness of a query can be specified, so that the scope of matches can be constrained to a particular level of exactitude. A high degree of fuzziness means that a large number of partial matches may be returned.</p>
</li>
<li>
<p>Multiple queries can be specified for simultaneous processing, with one given a higher boost than another, ensuring that its results are returned at the top of the set.</p>
</li>
<li>
<p>Regular expressions and wildcards can be used in text-specification for search-input.</p>
</li>
<li>
<p>Compound queries can be designed such that an appropriate conjunction or disjunction of the total result-set can be returned.</p>
</li>
<li>
<p>Geospatial queries can be used for finding the nearest neighbor or points of interest in a bounded region.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All the above options, and others, are explained in detail in <a href="fts-supported-queries.html" class="xref page">Supported Queries</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Consistency"><a class="anchor" href="#Consistency"></a>Consistency</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A mechanism to ensure that the Full Text Search (FTS) index can obtain the most up-to-date version of the document written to a collection or a bucket.</p>
</div>
<div class="paragraph">
<p>The consistency mechanism provides <a href="#consistency-vectors">Consistency Vectors</a> as objects in the search query that ensures FTS index searches all your last data written to the vBucket.</p>
</div>
<div class="paragraph">
<p>The search service does not respond to the query until the designated vBucket receives the correct sequence number.</p>
</div>
<div class="paragraph">
<p>The search query remains blocked while continuously polling the vBucket for the requested data. Once the sequence number of the data is obtained, the query is executed over the data written to the vBucket.</p>
</div>
<div class="paragraph">
<p>When using this consistency mode, the query service will ensure that the indexes are synchronized with the data service before querying.</p>
</div>
<div class="sect2">
<h3 id="workflow-to-understand-consistency"><a class="anchor" href="#workflow-to-understand-consistency"></a>Workflow to understand Consistency</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an FTS index in Couchbase.</p>
</li>
<li>
<p>Write a document to the Couchbase cluster.</p>
</li>
<li>
<p>Couchbase returns the associate vector to the app, which needs to issue a query request with the vector.</p>
</li>
<li>
<p>The FTS index starts searching the data written to the vBucket.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In this workflow, it is possible that the document written to the vBucket is not yet indexed. So, when FTS starts searching that document, the most up-to-date document versions are not retrieved, and only the indexed versions are queried.</p>
</div>
<div class="paragraph">
<p>Therefore, the Couchbase server provides a consistency mechanism to overcome this issue and ensures that the FTS index can search the most up-to-date document written to the vBucket.</p>
</div>
</div>
<div class="sect2">
<h3 id="consistency-level"><a class="anchor" href="#consistency-level"></a>Consistency Level</h3>
<div class="paragraph">
<p>The consistency level is a parameter that either takes an empty string indicating the unbounded (not_bounded) consistency or at_plus indicating the bounded consistency.</p>
</div>
<div class="sect3">
<h4 id="at_plus"><a class="anchor" href="#at_plus"></a>at_plus</h4>
<div class="paragraph">
<p>Executes the query, requiring indexes first to be updated to the timestamp of the last update.</p>
</div>
<div class="paragraph">
<p>This implements bounded consistency. The request includes a scan_vector parameter and value, which is used as a lower bound. This can be used to implement read-your-own-writes (RYOW).</p>
</div>
<div class="paragraph">
<p>If index-maintenance is running behind, the query waits for it to catch up.</p>
</div>
</div>
<div class="sect3">
<h4 id="not_bounded"><a class="anchor" href="#not_bounded"></a>not_bounded</h4>
<div class="paragraph">
<p>Executes the query immediately, without requiring any consistency for the query. No timestamp vector is used in the index scan.</p>
</div>
<div class="paragraph">
<p>This is the fastest mode, because it avoids the costs of obtaining the vector and waiting for the index to catch up to the vector.</p>
</div>
<div class="paragraph">
<p>If index-maintenance is running behind, out-of-date results may be returned.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="consistency-vectors"><a class="anchor" href="#consistency-vectors"></a>Consistency Vectors</h3>
<div class="paragraph">
<p>The consistency vectors supporting the consistency mechanism in Couchbase contain the mapping of the vBucket and sequence number of the data stored in the vBucket.</p>
</div>
<div class="paragraph">
<p>For more information about consistency mechanism, see <a href="fts-search-request.html" class="xref page">Consistency</a></p>
</div>
<div class="sect3">
<h4 id="example"><a class="anchor" href="#example"></a>Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  "ctl": {
    "timeout": 10000,
    "consistency": {
      "vectors": {
        "index1": {
          "607/205096593892159": 2,
          "640/298739127912798": 4
        }
      },
      "level": "at_plus"
    }
  },
  "query": {
    "match": "jack",
    "field": "name"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, this is the set of consistency vectors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"index1": {
  "607/205096593892159": 2,
  "640/298739127912798": 4
}</pre>
</div>
</div>
<div class="paragraph">
<p>The query is looking within the FTS index "index1" - for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>vbucket 607 (with UUID 205096593892159) to contain sequence number 2</p>
</li>
<li>
<p>vbucket 640 (with UUID 298739127912798) to contain sequence number 4</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="consistency-timeout"><a class="anchor" href="#consistency-timeout"></a>Consistency Timeout</h3>
<div class="paragraph">
<p>It is the amount of time (in milliseconds) the search service will allow for a query to execute at an index partition level.</p>
</div>
<div class="paragraph">
<p>If the query execution surpasses this <code>timeout</code> value, the query is canceled. However, at this point if some of the index partitions have responded, you might see partial results, otherwise no results at all.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  "ctl": {
    "timeout": 10000,
    "consistency": {
      "vectors": {
        "index1": {
          "607/205096593892159": 2,
          "640/298739127912798": 4
        }
      },
      "level": "at_plus"
    }
  },
  "query": {
    "match": "jack",
    "field": "name"
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="consistency-results"><a class="anchor" href="#consistency-results"></a>Consistency Results</h3>
<div class="paragraph">
<p>Consistency result is the attribute that you can use to set the query result option, such as complete.</p>
</div>
<div class="sect3">
<h4 id="example-2"><a class="anchor" href="#example-2"></a>Example:</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  "query": {...},
  "ctl": {
    "consistency": {
      "results": "complete"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-complete-option"><a class="anchor" href="#the-complete-option"></a>The "Complete" option</h3>
<div class="paragraph">
<p>The complete option allows you to set the query result as "complete" which indicates that if any of the index partitions are unavailable due to the node not being reachable, the query will display an error in response instead of partial results.</p>
</div>
<div class="sect3">
<h4 id="example-3"><a class="anchor" href="#example-3"></a>Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{
  "query": {...},
  "ctl": {
    "consistency": {
      "results": "complete"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="consistency-tips-and-recommendations"><a class="anchor" href="#consistency-tips-and-recommendations"></a>Consistency Tips and Recommendations</h3>
<div class="paragraph">
<p>Consistency vectors provide "read your own writes" functionality where the read operation waits for a specific time until the write operation is finished.</p>
</div>
<div class="paragraph">
<p>When users know that their queries are complex which require more time in completing the write operations, they can set the timeout value higher than the default timeout of 10 seconds so that consistency can be obtained in the search operations.</p>
</div>
<div class="paragraph">
<p>However, if this consistency is not required, the users can optimize their search operations by using the default timeout of 10 seconds.</p>
</div>
<div class="sect3">
<h4 id="example-4"><a class="anchor" href="#example-4"></a>Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-JSON hljs" data-lang="JSON">{

  "ctl": {
    "timeout": 10000,
    "consistency": {
      "vectors": {
        "index1": {
          "607/205096593892159": 2,
          "640/298739127912798": 4
        }
      },
      "level": "at_plus"
    }
  },
  "query": {
    "match": "airport",
    "field": "type"
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Sizes-From-Pages"><a class="anchor" href="#Sizes-From-Pages"></a>Size/From/Pages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The number of results obtained for a Full Text Search request can be large. Pagination of these results becomes essential for sorting and displaying a subset of these results.</p>
</div>
<div class="paragraph">
<p>There are multiple ways to achieve pagination with settings within a search request. Pagination will fetch a deterministic set of results when the results are sorted in a certain fashion.</p>
</div>
<div class="paragraph">
<p>Pagination provides the following options:</p>
</div>
<div class="sect2">
<h3 id="sizefrom-or-offsetlimit"><a class="anchor" href="#sizefrom-or-offsetlimit"></a>Size/from or offset/limit</h3>
<div class="paragraph">
<p>This pagination settings can be used to obtain a subset of results and works deterministically when combined with a certain sort order.</p>
</div>
<div class="paragraph">
<p>Using <code>size/limit</code> and <code>offset/from</code> would fetch at least <code>size + from</code> ordered results from a partition and then return the <code>size</code> number of results starting at offset <code>from</code>.</p>
</div>
<div class="paragraph">
<p>Deep pagination can therefore get pretty expensive when using <code>size + from</code> on a sharded index due to each shard having to possibly return large resultsets (at least <code>size + from</code>) over the network for merging at the coordinating node before returning the <code>size</code> number of results starting at offset <code>from</code>.</p>
</div>
<div class="paragraph">
<p>The default sort order is based on <em>score</em> (relevance) where the results are ordered from the highest to the lowest score.</p>
</div>
<div class="sect3">
<h4 id="example-5"><a class="anchor" href="#example-5"></a>Example</h4>
<div class="paragraph">
<p>Here&#8217;s an example query that fetches results from the 11th onwards to the 15th that have been ordered by <em>score</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "query": {
      "match": "California",
      "field": "state"
  },
  "size": 5,
  "from": 10
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="search-afterbefore"><a class="anchor" href="#search-afterbefore"></a>Search after/before</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For an efficient pagination, you can use the <code>search_after/search_before</code> settings.</p>
</div>
<div class="paragraph">
<p><code>search_after</code> is designed to fetch the <code>size</code> number of results after the key specified and <code>search_before</code> is designed to fetch the <code>size</code> number of results before the key specified.</p>
</div>
<div class="paragraph">
<p>These settings allow for the client to maintain state while paginating - the sort key of the last result (for search_after) or the first result (for search_before) in the current page.</p>
</div>
<div class="paragraph">
<p>Both the attributes accept an array of strings (sort keys) - the length of this array will need to be the same length of the "sort" array within the search request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot use both <code>search_after</code> and <code>search_before</code> in the same search request.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="example-6"><a class="anchor" href="#example-6"></a>Example</h3>
<div class="paragraph">
<p>Here are some examples using <code>search_after/search_before</code> over sort key "_id" (an internal field that carries the document ID).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "query": {
      "match": "California",
      "field": "state"
  },
  "sort": ["_id"],
  "search_after": ["hotel_10180"],
  "size": 3
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "query": {
      "match": "California",
      "field": "state"
  },
  "sort": ["_id"],
  "search_before": ["hotel_17595"],
  "size": 4
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A Full Text Search request that doesn&#8217;t carry any pagination settings will return the first 10 results (<code>"size: 10", "from": 0</code>) ordered by <em>score</em> sequentially from the highest to lowest.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pagination-tips-and-recommendations"><a class="anchor" href="#pagination-tips-and-recommendations"></a>Pagination tips and recommendations</h3>
<div class="paragraph">
<p>The pagination of search results can be done using the <code>from</code> and <code>size</code> parameters in the search request. But as the search gets into deeper pages, it starts consuming more resources.</p>
</div>
<div class="paragraph">
<p>To safeguard against any arbitrary higher memory requirements, FTS provides a configurable limit bleveMaxResultWindow (10000 default) on the maximum allowable page offsets. However, bumping this limit to higher levels is not a scalable solution.</p>
</div>
<div class="paragraph">
<p>To circumvent this problem, the concept of key set pagination in FTS, is introduced.</p>
</div>
<div class="paragraph">
<p>Instead of providing <code>from</code> as a number of search results to skip, the user will provide the sort value of a previously seen search result (usually, the last result shown on the current page).  The idea is that to show the next page of the results, we just want the top N results of that sort after the last result from the previous page.</p>
</div>
<div class="paragraph">
<p>This solution requires a few preconditions be met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The search request must specify a sort order.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The sort order must impose a total order on the results.  Without this, any results which share the same sort value might be left out when handling the page navigation boundaries.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A common solution to this is to always include the document ID as the final sort criteria.</p>
</div>
<div class="paragraph">
<p>For example, if you want to sort by [“name”, “-age”], instead of sort by [“name”, “-age”, "_id"].</p>
</div>
<div class="paragraph">
<p>With <code>search_after</code>/<code>search_before</code> paginations, the heap memory requirement of deeper page searches is made proportional to the requested page size alone. So it reduces the heap memory requirement of deeper page searches significantly down from the offset+from values.
<em>.</em></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Sorting"><a class="anchor" href="#Sorting"></a>Sorting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The FTS results are returned as objects. FTS query includes options to order the results.</p>
</div>
<div class="sect2">
<h3 id="sorting-result-data"><a class="anchor" href="#sorting-result-data"></a>Sorting Result Data</h3>
<div class="paragraph">
<p>FTS sorting is sorted by descending order of relevance. It can, however, be customized to sort by different fields, depending on the application.</p>
</div>
<div class="paragraph">
<p>On query-completion, <em>sorting</em> allows specified members of the result-set to be displayed prior to others: this facilitates a review of the most significant data.</p>
</div>
<div class="paragraph">
<p>Within a JSON query object, the required sort-type is specified by using the <code>sort</code> field.</p>
</div>
<div class="paragraph">
<p>This takes an array of either <em>strings</em>, <em>objects</em>, or <em>numeric</em> as its value.</p>
</div>
</div>
<div class="sect2">
<h3 id="sorting-with-strings"><a class="anchor" href="#sorting-with-strings"></a>Sorting with Strings</h3>
<div class="paragraph">
<p>You can specify the value of the <code>sort</code> field as an array of strings.
These can be of three types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>field name</em>: Specifies the name of a field.</p>
<div class="paragraph">
<p>If multiple fields are included in the array, the sorting of documents begins according to their values for the field whose name is first in the array.</p>
</div>
<div class="paragraph">
<p>If any number of these values are identical, their documents are sorted again, this time according to their values for the field whose name is second; then, if any number of these values are identical, their documents are sorted a third time, this time according to their values for the field whose name is third; and so on.</p>
</div>
<div class="paragraph">
<p>Any document-field may be specified to hold the value on which sorting is to be based, provided that the field has been indexed in some way, whether dynamically or specifically.</p>
</div>
<div class="paragraph">
<p>The default sort-order is <em>ascending</em>.
If a field-name is prefixed with the <code>-</code> character, that field&#8217;s results are sorted in <em>descending</em> order.</p>
</div>
</li>
<li>
<p><code>_id</code>:Refers to the document identifier.
Whenever encountered in the array, causes sorting to occur by document identifer.</p>
</li>
<li>
<p><code>_score</code>: Refers to the score assigned the document in the result-set.
Whenever encountered in the array, causes sorting to occur by score.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="example-7"><a class="anchor" href="#example-7"></a>Example</h4>
<div class="listingblock">
<div class="content">
<pre>"sort": ["country", "state", "city","-_score"]</pre>
</div>
</div>
<div class="paragraph">
<p>This <code>sort</code> statement specifies that results will first be sorted by <code>country</code>.</p>
</div>
<div class="paragraph">
<p>If some documents are then found to have the same value in their <code>country</code> fields, they are re-sorted by <code>state</code>.</p>
</div>
<div class="paragraph">
<p>Next, if some of these documents are found to have the same value in their <code>state</code> fields, they are re-sorted by <code>city</code>.</p>
</div>
<div class="paragraph">
<p>Finally, if some of these documents are found to have the same value in their <code>city</code> fields, they are re-sorted by <code>score</code>, in <em>descending</em> order.</p>
</div>
<div class="paragraph">
<p>The following JSON query demonstrates how and where the <code>sort</code> property can be specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "explain": false,
  "fields": [
    "title"
  ],
  "highlight": {},
  "sort": ["country", "-_score","-_id"],
  "query":{
    "query": "beautiful pool"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how the <code>sort</code> field accepts <em>combinations</em> of strings and objects as its value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   ...
   "sort": [
      "country",
      {
       "by" : "field",
       "field" : "reviews.ratings.Overall",
       "mode" : "max",
       "missing" : "last",
        "type": "number"
      },
      {
       "by" : "field",
       "field" : "reviews.ratings.Location",
       "mode" : "max",
       "missing" : "last",
       "type": "number"
      },
      "-_score"
   ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sorting-with-objects"><a class="anchor" href="#sorting-with-objects"></a>Sorting with Objects</h3>
<div class="paragraph">
<p>Fine-grained control over sort-procedure can be achieved by specifying <em>objects</em> as array-values in the <code>sort</code> field.</p>
</div>
<div class="paragraph">
<p>Each object can have the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>by</code>: Sorts results on <code>id</code>, <code>score</code>, or a specified <code>field</code> in the Full Text Index.</p>
</li>
<li>
<p><code>field</code>: Specifies the name of a field on which to sort.
Used only if <code>field</code> has been specified as the value for the <code>by</code> field; otherwise ignored.</p>
</li>
<li>
<p><code>missing</code>: Specifies the sort-procedure for documents with a missing value in a field specified for sorting.
The value of <code>missing</code> can be <code>first</code>, in which case results with missing values appear <em>before</em> other results; or <code>last</code> (the default), in which case they appear <em>after</em>.</p>
</li>
<li>
<p><code>mode</code>: Specifies the search-order for index-fields that contain multiple values (in consequence of arrays or multi-token analyzer-output).
The <code>default</code> order is undefined but deterministic, allowing the paging of results from <code>from (<em>offset</em>)</code>, with reliable ordering.
To sort using the minimum or maximum value, the value of <code>mode</code> should be set to either <code>min</code> or <code>max</code>.</p>
</li>
<li>
<p><code>type</code>: Specifies the type of the search-order field value.
For example, <code>string</code> for text fields, <code>date</code> for DateTime fields, or <code>number</code> for numeric/geo fields.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To fetch more accurate sort results, we strongly recommend specifying the <code>type</code> of the sort fields in the sort section of the search request.</p>
</div>
<div class="sect3">
<h4 id="example-8"><a class="anchor" href="#example-8"></a>Example</h4>
<div class="paragraph">
<p>The example below shows how to specify the object-sort.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The below sample assumes that the <code>travel-sample</code> bucket has been loaded, and a default index has been created on it.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "explain": false,
  "fields": [
     "*"
   ],
   "highlight": {},
   "query": {
     "match": "bathrobes",
     "field": "reviews.content",
     "analyzer": "standard"
   },
   "size" : 10,
   "sort": [
      {
       "by" : "field",
       "field" : "reviews.ratings.Overall",
       "mode" : "max",
       "missing" : "last",
       "type": "number"
      }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For information on loading sample buckets, see <a href="../manage/manage-settings/install-sample-buckets.html" class="xref page">Sample Buckets</a>. For instructions on creating a default Full Text Index by means of the Couchbase Web Console, see <a href="fts-creating-index-from-UI-classic-editor.html" class="xref page">Creating Index from UI</a>.</p>
</div>
<div class="paragraph">
<p>This query sorts search-results based on <code>reviews.ratings.Overall</code> — a field that is normally multi-valued because it contains an array of different users' ratings.</p>
</div>
<div class="paragraph">
<p>When there are multiple values, the highest <code>Overall</code> ratings are used for sorting.</p>
</div>
<div class="paragraph">
<p>Hotels with no <code>Overall</code> rating are placed at the end.</p>
</div>
<div class="paragraph">
<p>The following example shows how the <code>sort</code> field accepts <em>combinations</em> of strings and objects as its value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{

   "sort": [
      "country",
      {
       "by" : "field",
       "field" : "reviews.ratings.Overall",
       "mode" : "max",
       "missing" : "last",
        "type": "number"
      },
      {
       "by" : "field",
       "field" : "reviews.ratings.Location",
       "mode" : "max",
       "missing" : "last",
       "type": "number"
      },
      "-_score"
   ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sorting-with-numeric"><a class="anchor" href="#sorting-with-numeric"></a>Sorting with Numeric</h3>
<div class="paragraph">
<p>You can specify the value of the <code>sort</code> field as a numeric type. You can use the <code>type</code> field in the object that you specify with the sort.</p>
</div>
<div class="paragraph">
<p>With <code>type</code> field, you can specify the type of the search order to numeric, string, or DateTime.</p>
</div>
<div class="sect3">
<h4 id="example-9"><a class="anchor" href="#example-9"></a>Example</h4>
<div class="paragraph">
<p>The example below shows how to specify the object-sort with type field as <code>number</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "explain": false,
  "fields": [
     "*"
   ],
   "highlight": {},
   "query": {
     "match": "bathrobes",
     "field": "reviews.content",
     "analyzer": "standard"
   },
   "size" : 10,
   "sort": [
      {
       "by" : "field",
       "field" : "reviews.ratings.Overall",
       "mode" : "max",
       "missing" : "last",
       "type": "number"
      }
   ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tips-for-sorting-with-fields"><a class="anchor" href="#tips-for-sorting-with-fields"></a>Tips for Sorting with fields</h3>
<div class="paragraph">
<p>When you sort results on a field that is not indexed, or when a particular document is missing a value for that field, you will see the following series of Unicode non-printable characters appear in the sort field:</p>
</div>
<div class="paragraph">
<p><code>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd</code></p>
</div>
<div class="paragraph">
<p>The same characters may render differently when using a graphic tool or command line tools like <code>jq</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">      "sort": [
        "����������",
        "hotel_9723",
        "_score"
      ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check your index definition to confirm that you are indexing all the fields you intend to sort by. You can control the sort behavior for missing attributes using the missing field.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Scoring"><a class="anchor" href="#Scoring"></a>Scoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Search result scoring occurs at a query time. The result of the search request is ordered by <strong>score</strong> (relevance), with the descending sort order unless explicitly set not to do so.</p>
</div>
<div class="paragraph">
<p>Couchbase uses a slightly modified version of the standard <strong>tf-idf</strong>  algorithm. This deviation is to normalize the score and is based on <strong>tf-idf</strong> algorithm.</p>
</div>
<div class="paragraph">
<p>For more details on tf-idf, refer <a href="#scoring-td-idf">tf-idf</a></p>
</div>
<div class="paragraph">
<p>By selecting the <code>explain score</code> option within the search request, you can obtain the explanation of how the score was calculated for a result alongside it.</p>
</div>
<div id="fts_explain_scoring_option_enabled" class="imageblock text-left">
<div class="content">
<img src="_images/fts-td-idf-explain-scoring-enabled.png" alt="fts td idf explain scoring enabled" width="850">
</div>
</div>
<div class="paragraph">
<p>Search query scores all the qualified documents for relevance and applies relevant filters.</p>
</div>
<div class="paragraph">
<p>In a search request, you can set <code>score</code> to <code>none</code> to disable scoring by. See <a href="#scoring-option-none">Score:none</a></p>
</div>
<div class="sect2">
<h3 id="example-10"><a class="anchor" href="#example-10"></a>Example</h3>
<div class="paragraph">
<p>The following sample query response shows the <strong>score</strong> field for each document retrieved for the query request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  "hits": [
    {
      "index": "DemoIndex_76059e8b3887351c_4c1c5584",
      "id": "hotel_10064",
      "score": 10.033205341869529,
      "sort": [
        "_score"
      ],
      "fields": {
        "_$c": "hotel"
      }
    },
    {
      "index": "DemoIndex_76059e8b3887351c_4c1c5584",
      "id": "hotel_10063",
      "score": 10.033205341869529,
      "sort": [
        "_score"
      ],
      "fields": {
        "_$c": "hotel"
      }
    }
  ],
  "total_hits": 2,
  "max_score": 10.033205341869529,
  "took": 284614211,
  "facets": null
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scoring-td-idf"><a class="anchor" href="#scoring-td-idf"></a>tf-idf</h3>
<div class="paragraph">
<p><code>tf-idf</code>, a short form of <strong>term frequency-inverse document frequency</strong>, is a numerical statistical value that is used to reflect how important a word is to a document in collection or scope.</p>
</div>
<div class="paragraph">
<p><code>tf-idf</code> is used as a weighting factor in a search for information retrieval and text mining. The <code>tf–idf</code> value increases proportionally to the number of times a word appears in the document, and it is offset by the number of documents in the collection or scope that contains the word.</p>
</div>
<div class="paragraph">
<p>Search engines often use the variations of <code>tf-idf</code> weighting scheme as a tool in scoring and ranking a document&#8217;s relevance for a given query. The tf-idf scoring for a document relevancy is done on the basis of per-partition index, which means that documents across different partitions may have different scores.</p>
</div>
<div class="paragraph">
<p>When bleve scores a document, it sums a set of sub scores to reach the final score. The scores across different searches are not directly comparable as the scores are directly dependent on the search criteria. So, changing the search criteria, like terms, boost factor etc. can vary the score.</p>
</div>
<div class="paragraph">
<p>The more conjuncts/disjuncts/sub clauses in a query can influence the scoring. Also, the score of a particular search result is not absolute, which means you can only use the score as a comparison to the highest score from the same search result.</p>
</div>
<div class="paragraph">
<p>FTS does not provide any predefined range for valid scores.</p>
</div>
<div class="paragraph">
<p>In Couchbase application, you get an option to explore the score computations during any search in FTS.</p>
</div>
<div id="fts_explain_scoring_option" class="imageblock text-left">
<div class="content">
<img src="_images/fts-td-idf-explain-scoring.png" alt="fts td idf explain scoring" width="850">
</div>
</div>
<div class="paragraph">
<p>On the Search page, you can search for a term in any index. The search result displays the search records along with the option <strong>Explain Scoring</strong> to view the score deriving details for search hits and which are determined by using the <code>tf-idf</code> algorithm.</p>
</div>
<div id="fts_explain_scoring_option_enabled" class="imageblock text-left">
<div class="content">
<img src="_images/fts-td-idf-explain-scoring-enabled.png" alt="fts td idf explain scoring enabled" width="850">
</div>
</div>
</div>
<div class="sect2">
<h3 id="scoring-option-none"><a class="anchor" href="#scoring-option-none"></a>Score:none</h3>
<div class="paragraph">
<p>You can disable the scoring by setting <code>score</code> to <code>none</code> in the search request. This is recommended in a situation where scoring (document relevancy) is not needed by the application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using <code>"score": "none"</code> is expected to boost query performance in certain situations.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="example-11"><a class="anchor" href="#example-11"></a>Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "query": {
      "match": "California",
      "field": "state"
  },
  "score": "none",
  "size": 100
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scoring-tips-and-recommendations"><a class="anchor" href="#scoring-tips-and-recommendations"></a>Scoring Tips and Recommendations</h3>
<div class="paragraph">
<p>For a select term, FTS calculates the relevancy score. So, the documents having a higher relevancy score automatically appear at the top in the result.</p>
</div>
<div class="paragraph">
<p>It is often observed that users are using Full-Text Search for the exact match queries with a bit of fuzziness or other search-specific capabilities like geo.</p>
</div>
<div class="paragraph">
<p>Text relevancy score does not matter when the user is looking for exact or more targeted searches with many predicates or when the dataset size is small.</p>
</div>
<div class="paragraph">
<p>In such a case, FTS unnecessarily uses more resources in calculating the relevancy score. Users can, however, optimize the query performance by skipping the scoring. Users may skip the scoring by passing a “score”: “none” option in the search request.</p>
</div>
<div class="sect3">
<h4 id="example-12"><a class="anchor" href="#example-12"></a>Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{

 "query": {},
 "score": "none",
 "size": 10,
 "from": 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This improves the search query performance significantly in many cases, especially for composite queries with many child search clauses.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Highlighting"><a class="anchor" href="#Highlighting"></a>Highlighting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>Highlight</code> object indicates whether highlighting was requested.</p>
</div>
<div class="paragraph">
<p>The pre-requisite includes term vectors and store options to be enabled at the field level to support Highlighting.</p>
</div>
<div class="paragraph">
<p>The highlight object contains the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>style</strong> - (Optional) Specifies the name of the highlighter. For example, "html"or "ansi".</p>
</li>
<li>
<p><strong>fields</strong> - Specifies an array of field names to which Highlighting is restricted.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="example-1"><a class="anchor" href="#example-1"></a>Example 1</h3>
<div class="paragraph">
<p>As per the following example, when you search the content in the index, the matched content in the <code>address</code> field is highlighted in the search response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">curl -u username:password -XPOST -H "Content-Type: application/json" \
http://localhost:8094/api/index/travel-sample-index/query \
-d '{
    "explain": true,
    "fields": [
        "*"
    ],
    "highlight": {
      "style":"html",
      "fields": ["address"]
    },
    "query": {
        "query": "address:farm"
    }
}'</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="result"><a class="anchor" href="#result"></a>Result</h4>
<div id="fts_highlighting_in_address_field" class="imageblock text-left">
<div class="content">
<img src="_images/fts-highlighting-in-address-field.png" alt="fts highlighting in address field" width="520">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-2-2"><a class="anchor" href="#example-2-2"></a>Example 2</h3>
<div class="paragraph">
<p>As per the following example, when you search the content in the index, the matched content in the <code>description</code> field is highlighted in the search response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">curl -u username:password -XPOST -H "Content-Type: application/json" \
http://localhost:8094/api/index/travel-sample-index/query \
-d '{
    "explain": true,
    "fields": [
        "*"
    ],
    "highlight": {
      "style":"html",
      "fields": ["description"]
    },
    "query": {
        "query": "description:complementary breakfast"
    }
}'</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="result-2"><a class="anchor" href="#result-2"></a>Result</h4>
<div id="fts_highlighting_in_description_field" class="imageblock text-left">
<div class="content">
<img src="_images/fts-highlighting-in-description-field.png" alt="fts highlighting in description field" width="520">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Fields"><a class="anchor" href="#Fields"></a>Fields</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can store specific document fields within FTS and retrieve those as a part of the search results.</p>
</div>
<div class="paragraph">
<p>It involves the following two-step process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Indexing</strong></p>
<div class="paragraph">
<p>you need to specify the desired fields of the matching documents to be retrieved as a part of the index definition. To do so, select the "store" option checkbox in the field mapping definition for the desired fields. The FTS index will store the original field contents intact (without applying any text analysis) as a part of its internal storage.</p>
</div>
<div class="paragraph">
<p>For example, if you want to retrieve the field "description" in the document, then enable the "store" option like below.</p>
</div>
<div id="fts-type-mappings-child-field" class="imageblock text-left">
<div class="content">
<img src="_images/fts-type-mappings-child-field-dialog-complete.png" alt="fts type mappings child field dialog complete" width="460">
</div>
</div>
</li>
<li>
<p><strong>Searching</strong></p>
<div class="paragraph">
<p>you need to specify the fields to be retrieved in the "fields" setting within the search request. This setting takes an array of field names which will be returned as part of the search response. The field names must be specified as strings. While there is no field name pattern matching available, you can use an asterisk ("*") to specify that all stored fields be returned with the response.</p>
</div>
<div class="paragraph">
<p>For retrieving the contents of the aforementioned "description" field, you may use the following search request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -XPOST -H "Content-Type: application/json" -uUsername:password http://host:port/api/index/FTS/query -d '{
  "fields": ["description"],
  "query": {"field": "queryFieldName", "match": "query text"},
}'</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Facets"><a class="anchor" href="#Facets"></a>Search Facets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Facets are aggregate information collected on a particular result set.
For any search, the user can collect additional facet information along with it.</p>
</div>
<div class="paragraph">
<p>All the facet examples below, are for the query "<code class="code">water</code>" on the beer-sample dataset.
FTS supports the following types of facets:</p>
</div>
<div class="sect2">
<h3 id="term-facet"><a class="anchor" href="#term-facet"></a>Term Facet</h3>
<div class="paragraph">
<p>A term facet counts how many matching documents have a particular term for a specific field.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When building a term facet, use the keyword analyzer. Otherwise, multi-term values get tokenized, and the user gets unexpected results.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="example-13"><a class="anchor" href="#example-13"></a>Example</h4>
<div class="ulist">
<ul>
<li>
<p>Term Facet - computes facet on the type field which has two values: <code>beer</code> and <code>brewery</code>.</p>
<div class="listingblock">
<div class="content">
<pre>curl -X POST -H "Content-Type: application/json" \
http://localhost:8094/api/index/bix/query -d \
'{
    "size": 10,
    "query": {
        "boost": 1,
        "query": "water"
     },
    "facets": {
         "type": {
             "size": 5,
             "field": "type"
         }
    }
}'</pre>
</div>
</div>
<div class="paragraph">
<p>The result snippet below only shows the facet section for clarity.
Run the curl command to see the HTTP response containing the full results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"facets": {
    "type": {
        "field": "type",
        "total": 91,
        "missing": 0,
        "other": 0,
        "terms": [
            {
                "term": "beer",
                "count": 70
            },
            {
                "term": "brewery",
                "count": 21
            }
        ]
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="numeric-range-facet"><a class="anchor" href="#numeric-range-facet"></a>Numeric Range Facet</h3>
<div class="paragraph">
<p>A numeric range facet works by the users defining their own buckets (numeric ranges).</p>
</div>
<div class="paragraph">
<p>The facet then counts how many of the matching documents fall into a particular bucket for a particular field.</p>
</div>
<div class="sect3">
<h4 id="example-14"><a class="anchor" href="#example-14"></a>Example</h4>
<div class="ulist">
<ul>
<li>
<p>Numeric Range Facet - computes facet on the <code>abv</code> field with 2 buckets describing <code>high</code> (greater than 7) and <code>low</code> (less than 7).</p>
<div class="listingblock">
<div class="content">
<pre>curl -X POST -H "Content-Type: application/json" \
http://localhost:8094/api/index/bix/query -d \
'{
    "size": 10,
    "query": {
        "boost": 1,
        "query": "water"
    },
    "facets": {
        "abv": {
            "size": 5,
            "field": "abv",
            "numeric_ranges": [
                {
                    "name": "high",
                    "min": 7
                },
                {
                    "name": "low",
                    "max": 7
                }
             ]
        }
    }
}'</pre>
</div>
</div>
<div class="paragraph">
<p>Results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">facets": {
    "abv": {
        "field": "abv",
        "total": 70,
        "missing": 21,
        "other": 0,
        "numeric_ranges": [
            {
                "name": "high",
                "min": 7,
                "count": 13
            },
            {
                "name": "low",
                "max": 7,
                "count": 57
            }
        ]
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="date-range-facet"><a class="anchor" href="#date-range-facet"></a>Date Range Facet</h3>
<div class="paragraph">
<p>The Date Range facet is same as numeric facet, but on dates instead of numbers.</p>
</div>
<div class="paragraph">
<p>Full text search and Bleve expect dates to be in the format specified by <a href="https://www.ietf.org/rfc/rfc3339.txt" target="_blank" rel="noopener">RFC-3339</a>, which is a specific profile of ISO-8601 that is more restrictive.</p>
</div>
<div class="sect3">
<h4 id="example-15"><a class="anchor" href="#example-15"></a>Example</h4>
<div class="ulist">
<ul>
<li>
<p>Date Range Facet - computes facet on the ‘updated’ field that has 2 values old and new.</p>
<div class="listingblock">
<div class="content">
<pre>curl -XPOST -H "Content-Type: application/json" -uAdministrator:asdasd http://&lt;node&gt;:8094/api/index/bix/query -d '{
"ctl": {"timeout": 0},
"from": 0,
"size": 0,
"query": {
            "field": "country",
            "term": "united"
},
        "facets": {
        "types": {
        "size": 10,
        "field": "updated",
        "date_ranges": [
        {
        "name": "old",
        "end": "2010-08-01"
        },
        {
        "name": "new",
        "start": "2010-08-01"
        }
]
}
}
}'</pre>
</div>
</div>
<div class="paragraph">
<p>Results</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> "facets": {
             "types": {
                "field": "updated",
                "total": 954,
                "missing": 0,
                "other": 0,
             "date_ranges": [
              {
                "name": "old",
                "end": "2010-08-01T00:00:00Z",
                "count": 934
              },
              {
                "name": "new",
                "start": "2010-08-01T00:00:00Z",
                "count": 20
              }
               ]
             }
           }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Collections"><a class="anchor" href="#Collections"></a>Collections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Collections field lets the user specify an optional list of collection names.</p>
</div>
<div class="paragraph">
<p>This would help the users scope their search request to only those specified collections within a multi-collection index.</p>
</div>
<div class="paragraph">
<p>This becomes useful with multi-collection indexes as it can speed up searches, as well as the user can manage the Role Based Access Control more granularly with this option. Ie the search user only needs permissions for the requested collections and not for every other collection indexed within the index.</p>
</div>
<div class="paragraph">
<p>In the absence of any collection names, the search request would be treated as a normal search request and would retrieve documents from all the indexed collections within the index.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Includelocations"><a class="anchor" href="#Includelocations"></a>IncludeLocations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Search is capable of returning the array positions for the search term relative to the whole document hierarchical structure. If the user sets it to true then the search service returns the <code>array_positions</code> of the search term occurrences inside the document. The user has to enable the <code>term_vector</code> field option for the relevant field during the indexing for fetching the location details during the search time.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
