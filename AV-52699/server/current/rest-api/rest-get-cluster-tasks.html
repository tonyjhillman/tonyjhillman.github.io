<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>(window.dataLayer=window.dataLayer||[]).push({event:'gtm.js','gtm.start':+new Date()})</script>
<script async src="https://www.googletagmanager.com/gtm.js?id=GTM-MVPNN2"></script>
<title>Getting Cluster Tasks | Couchbase Docs</title>
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="A list of ongoing cluster tasks can be returned with the &lt;code&gt;GET /pools/default/tasks&lt;/code&gt; HTTP method and URI.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/rest-api/rest-get-cluster-tasks.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/tony.hillman/Documents/71docs/docs-server/modules/rest-api/pages/rest-get-cluster-tasks.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Reference</li>
<li class="crumb"><a href="rest-intro.html">REST API Reference</a></li>
<li class="crumb"><a href="rest-cluster-intro.html">Nodes and Clusters API</a></li>
<li class="crumb"><a href="rest-status-and-events-overview.html">Status and Events</a></li>
<li class="crumb"><a href="rest-get-cluster-tasks.html">Getting Cluster Tasks</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Getting Cluster Tasks</h1>
<div class="labels">
<ul><li class="reference"><span><i class="fas fa-book"></i></i> reference</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
A list of ongoing cluster tasks can be returned with the <code>GET /pools/default/tasks</code> HTTP method and URI.
Additionally, a report on the last-completed rebalance can be returned with <code>GET /logs/rebalanceReport?reportID=&lt;report-id&gt;</code>.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-method-and-uri"><a class="anchor" href="#http-method-and-uri"></a>HTTP methods and URIs</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>GET /pools/default/tasks

GET /logs/rebalanceReport?reportID=&lt;report-id&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rest-get-cluster-tasks-description"><a class="anchor" href="#rest-get-cluster-tasks-description"></a>Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By means of <code>GET /pools/default/tasks</code>, ongoing cluster-tasks can be reported; with status, id, and additional information returned for each.</p>
</div>
<div class="paragraph">
<p>By means of <code>GET /logs/rebalanceReport?reportID=&lt;report-id&gt;</code>, a report can be returned, providing information on a completed <em>rebalance</em>.
The required <code>report-id</code> is provided in the object returned by <code>GET /pools/default/tasks</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="curl-syntax"><a class="anchor" href="#curl-syntax"></a>Curl Syntax</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>curl -v -X GET -u &lt;username&gt;:&lt;password&gt;
  http://&lt;ip-address&gt;:8091/pools/default/tasks

curl -v -X GET -u &lt;username&gt;:&lt;password&gt;
  http://&lt;ip-address&gt;:8091/logs/rebalanceReport?reportID=&lt;report-id&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The required <code>report-id</code> is provided in the object returned by <code>GET /pools/default/tasks</code>, as the value of <code>lastReportURI</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="responses"><a class="anchor" href="#responses"></a>Responses</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <code>GET /pools/default/tasks</code>, success gives the response code <code>200 OK</code>, and returns an object containing information on the current status of ongoing tasks.
See the examples provided below.</p>
</div>
<div class="paragraph">
<p>For <code>GET /logs/rebalanceReport?reportID=&lt;report-id&gt;</code>, success gives the response code <code>200 OK</code>, and returns an object that contains a report on the last-completed rebalance.
Specifying a <code>report-id</code> that cannot be found gives <code>200 OK</code>, but returns an object signifying the error, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "error": "enoent"
}</pre>
</div>
</div>
<div class="paragraph">
<p>Specifying a <code>report-id</code> of incorrect length gives <code>400 Bad Request</code>, and returns an object signifying the error, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "errors": {
    "reportID": "Length must be in range from 32 to 32"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For both calls, failure to authenticate gives <code>401 Unauthorized</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples: Retrieving Cluster Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following examples show output returned in accordance with <em>whether</em> tasks are in progress; and if so, <em>which</em>.</p>
</div>
<div class="sect2">
<h3 id="no-tasks-underway"><a class="anchor" href="#no-tasks-underway"></a>No Tasks Underway</h3>
<div class="paragraph">
<p>When the cluster has no tasks underway, the method verifies this.
Here, the output is piped to the <a href="https://stedolan.github.io/jq">jq</a> tool, to enhance readability.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -u Administrator:password -v -X GET \
http://10.143.194.101:8091/pools/default/tasks | jq '.'</pre>
</div>
</div>
<div class="paragraph">
<p>Output is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
  {
    "statusId": "28452d665fce646c98385fb590a30adc",
    "type": "rebalance",
    "status": "notRunning",
    "statusIsStale": false,
    "masterRequestTimedOut": false,
    "lastReportURI": "/logs/rebalanceReport?reportID=0c41dba637a8971b1aa921a89e851d83"
  }
]</pre>
</div>
</div>
<div class="paragraph">
<p>The default output indicates that no rebalance is underway.
A <code>statusId</code> and task <code>type</code> are provided.
The <code>lastReportURI</code> specifies the location of the <em>report</em> of the last rebalance to have been performed.
See the <a href="../rebalance-reference/rebalance-reference.html" class="xref page">Rebalance Reference</a>, for further information.</p>
</div>
</div>
<div class="sect2">
<h3 id="adding-a-bucket"><a class="anchor" href="#adding-a-bucket"></a>Adding a Bucket</h3>
<div class="paragraph">
<p>When a bucket is being added (in this case, the sample bucket <code>beer-sample</code>), status can be returned by entering the method in the standard way, specifying the IP address of the cluster, or <code>localhost</code>, as appropriate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -u Administrator:password -v -X GET \
http://localhost:8091/pools/default/tasks | jq '.'</pre>
</div>
</div>
<div class="paragraph">
<p>Output is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
  {
    "statusId": "1f05320a7b359e1672ffc8b7ee69a8b5",
    "type": "rebalance",
    "status": "notRunning",
    "statusIsStale": false,
    "masterRequestTimedOut": false,
    "lastReportURI": "/logs/rebalanceReport?reportID=0c41dba637a8971b1aa921a89e851d83"
  },
  {
    "status": "running",
    "type": "loadingSampleBucket",
    "bucket": "beer-sample",
    "pid": "&lt;0.24849.21&gt;"
  }
]</pre>
</div>
</div>
<div class="paragraph">
<p>The output indicates that no rebalance is underway, but that the <code>loadingSampleBucket</code> operation is ongoing.</p>
</div>
</div>
<div class="sect2">
<h3 id="compacting-a-bucket"><a class="anchor" href="#compacting-a-bucket"></a>Compacting a Bucket</h3>
<div class="paragraph">
<p>When a bucket (in this case, the sample bucket <code>beer-sample</code>) is being compacted, the method can be used to return status as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -u Administrator:password -v -X GET \
http://localhost:8091/pools/default/tasks | jq '.'</pre>
</div>
</div>
<div class="paragraph">
<p>The following output is provided:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
  {
    "statusId": "28452d665fce646c98385fb590a30adc",
    "type": "rebalance",
    "status": "notRunning",
    "statusIsStale": false,
    "masterRequestTimedOut": false,
    "lastReportURI": "/logs/rebalanceReport?reportID=0c41dba637a8971b1aa921a89e851d83"
  },
  {
    "cancelURI": "/pools/default/buckets/beer-sample/controller/cancelBucketCompaction",
    "type": "bucket_compaction",
    "recommendedRefreshPeriod": 2,
    "status": "running",
    "bucket": "beer-sample",
    "changesDone": 177,
    "totalChanges": 682,
    "progress": 25
  }
]</pre>
</div>
</div>
<div class="paragraph">
<p>The output indicates that the <code>beer-sample</code> bucket is being compacted.
Progress is reported in terms of <code>changesDone</code>, <code>totalChanges</code>, and a <code>progress</code> figure that is a percentage of total completion.
A URI is provided for cancelling compaction, if required.</p>
</div>
</div>
<div class="sect2">
<h3 id="loading-a-sample-bucket"><a class="anchor" href="#loading-a-sample-bucket"></a>Loading a Sample Bucket</h3>
<div class="paragraph">
<p>If a sample bucket is loaded, task status can be returned, by entering the method in the standard way, specifying the IP address of the cluster, or <code>localhost</code>, as appropriate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X GET http://localhost:8091/pools/default/tasks -u Administrator:password | jq '.'</pre>
</div>
</div>
<div class="paragraph">
<p>The output includes the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "status": "running",
  "type": "loadingSampleBucket",
  "bucket": "travel-sample",
  "pid": "&lt;0.11528.51&gt;"
}</pre>
</div>
</div>
<div class="paragraph">
<p>This indicates that the <code>travel-sample</code> bucket is being loaded, and shows the process id for the task.</p>
</div>
</div>
<div class="sect2">
<h3 id="performing-xdcr"><a class="anchor" href="#performing-xdcr"></a>Performing XDCR</h3>
<div class="paragraph">
<p>If an instance of XDCR is underway, its task status can be returned, by entering the method in the standard way, specifying the IP address of the cluster, or <code>localhost</code>, as appropriate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X GET http://localhost:8091/pools/default/tasks -u Administrator:password | jq '.'</pre>
</div>
</div>
<div class="paragraph">
<p>The output related to the ongoing replication appears as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "cancelURI": "/controller/cancelXDCR/e82ad198116fd9f9a369df37ab0819b2%2Ftravel-sample%2FtravelSampleBackup",
    "settingsURI": "/settings/replications/e82ad198116fd9f9a369df37ab0819b2%2Ftravel-sample%2FtravelSampleBackup",
    "status": "running",
    "replicationType": "xmem",
    "continuous": true,
    "filterBypassExpiry": false,
    "filterDeletion": false,
    "filterExpiration": false,
    "filterExpression": "",
    "id": "e82ad198116fd9f9a369df37ab0819b2/travel-sample/travelSampleBackup",
    "pauseRequested": false,
    "source": "travel-sample",
    "target": "/remoteClusters/e82ad198116fd9f9a369df37ab0819b2/buckets/travelSampleBackup",
    "type": "xdcr",
    "recommendedRefreshPeriod": 10,
    "changesLeft": 0,
    "docsChecked": 28255,
    "docsWritten": 10518,
    "maxVBReps": null,
    "errors": [
      "2022-10-25 13:40:26 Found following destination collection(s) missing (and will not get replicated to):\nSOURCE ||tenant_agent_04.users|| -&gt; TARGET(s) |Scope: tenant_agent_04 Collection: users| \nSOURCE ||tenant_agent_03.users|| -&gt; TARGET(s) |Scope: tenant_agent_03 Collection: users| \nSOURCE ||tenant_agent_00.users|| -&gt; TARGET(s) |Scope: tenant_agent_00 Collection: users| \nSOURCE ||inventory.route|| -&gt; TARGET(s) |Scope: inventory Collection: route| \nSOURCE ||inventory.landmark|| -&gt; TARGET(s) |Scope: inventory Collection: landmark| \nSOURCE ||inventory.airline|| -&gt; TARGET(s) |Scope: inventory Collection: airline| \nSOURCE ||tenant_agent_01.users|| -&gt; TARGET(s) |Scope: tenant_agent_01 Collection: users| \nSOURCE ||inventory.hotel|| -&gt; TARGET(s) |Scope: inventory Collection: hotel| \nSOURCE ||tenant_agent_02.users|| -&gt; TARGET(s) |Scope: tenant_agent_02 Collection: users| \nSOURCE ||inventory.airport|| -&gt; TARGET(s) |Scope: inventory Collection: airport| \n"
    ]
  }</pre>
</div>
</div>
<div class="paragraph">
<p>The output includes URIs for cancelling the replication, and for retrieving its settings.
It also includes the <code>id</code> for the replication itself.
The numbers of documents checked and written are provided, as is a list of errors that have been recorded.</p>
</div>
</div>
<div class="sect2">
<h3 id="recovering-data-with-xdcr"><a class="anchor" href="#recovering-data-with-xdcr"></a>Recovering Data with XDCR</h3>
<div class="paragraph">
<p>When data on the local cluster has been lost, the data can be recovered from a remote cluster to which data was previously replicated by means of XDCR.
This is described and exemplified in <a href="../manage/manage-xdcr/recover-data-with-xdcr.html" class="xref page">Recover Data with XDCR</a>.
Recovery is performed with the <code>cbrecovery</code> tool.
During the recovery process, task-status can be returned by entering the method in the standard way, specifying the IP address of the cluster, or <code>localhost</code>, as appropriate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X GET http://localhost:8091/pools/default/tasks -u Administrator:password | jq '.'</pre>
</div>
</div>
<div class="paragraph">
<p>The output related to the ongoing recovery process is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
   "type": "recovery",
   "bucket": "travel-sample",
   "uuid": "1e9009c3e807060ea72a369342e6d025",
   "recommendedRefreshPeriod": 10,
   "stopURI": "/pools/default/buckets/travel-sample/controller/stopRecovery?recovery_uuid=1e9009c3e807060ea72a369342e6d025",
   "commitVBucketURI": "/pools/default/buckets/travel-sample/controller/commitVBucket?recovery_uuid=1e9009c3e807060ea72a369342e6d025",
   "recoveryStatusURI": "/pools/default/buckets/travel-sample/recoveryStatus?recovery_uuid=1e9009c3e807060ea72a369342e6d025"
 },</pre>
</div>
</div>
<div class="paragraph">
<p>The output verifies that the <code>recovery</code> task is being performed, with data being restored to the <code>travel-sample</code> bucket.
The operation is given a universally unique identifier.
A URI is provided for stopping the recovery process, if necessary.
This can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST http://localhost:8091/pools/default/buckets/travel-sample/controller/stopRecovery?recovery_uuid=1e9009c3e807060ea72a369342e6d025 -u Administrator:password</pre>
</div>
</div>
<div class="paragraph">
<p>If the process is successfully stopped, a message such as <code>{"code":"ok"}</code> is displayed.</p>
</div>
<div class="paragraph">
<p>Additionally, a URI is provided for retrieving status on the recovery process.
This can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X GET http://localhost:8091/pools/default/buckets/travel-sample/recoveryStatus?recovery_uuid=1e9009c3e807060ea72a369342e6d025 -u Administrator:password</pre>
</div>
</div>
<div class="paragraph">
<p>If successful, the call returns a status object, such as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "uuid": "1e9009c3e807060ea72a369342e6d025",
  "code": "ok",
  "recoveryMap": [
    {
      "node": "ns_1@10.144.231.101",
      "vbuckets": [
        826,
        827,
        828,
        829,
        830,
        .
        .
        .</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-gsi"><a class="anchor" href="#creating-gsi"></a>Creating Global Secondary Indexes</h3>
<div class="paragraph">
<p>When global secondary indexes are created, task-status can be returned, by entering the method in the standard way, specifying the IP address of the cluster, or <code>localhost</code>, as appropriate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X GET http://localhost:8091/pools/default/tasks -u Administrator:password | jq '.'</pre>
</div>
</div>
<div class="paragraph">
<p>If the above expression is entered immediately subsequent to the loading of the <code>travel-sample</code> bucket, the output includes the following information on index-creation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "type": "global_indexes",
    "recommendedRefreshPeriod": 2,
    "status": "running",
    "bucket": "travel-sample",
    "index": "def_inventory_route_sourceairport",
    "id": 194455929039766300,
    "progress": 0,
    "statusIsStale": false
  },
  {
    "type": "global_indexes",
    "recommendedRefreshPeriod": 2,
    "status": "running",
    "bucket": "travel-sample",
    "index": "def_inventory_route_schedule_utc",
    "id": 18302711027814693000,
    "progress": 0,
    "statusIsStale": false
  },</pre>
</div>
</div>
<div class="paragraph">
<p>This provides status on two tasks, related to the creation of the indexes <code>def_inventory_route_sourceairport</code> and <code>def_inventory_route_schedule_utc</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="rebalance-following-node-addition"><a class="anchor" href="#rebalance-following-node-addition"></a>Rebalance Following Node-Addition</h3>
<div class="paragraph">
<p>When rebalance is used to eject node <code>10.143.194.103</code> from a cluster of three nodes, which has included <code>10.143.194.101</code> and <code>10.143.194.102</code> in addition to itself, and which is hosting the <code>travel-sample</code> and <code>beer-sample</code> sample buckets, the progress of the task can be retrieved as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -u Administrator:password -v -X GET \
http://10.143.194.101:8091/pools/default/tasks | jq '.'</pre>
</div>
</div>
<div class="paragraph">
<p>Depending on at what point in the rebalance the method is run, the output might be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
  {
    "statusId": "1a51786a937213ac456d2f066f65c08a",
    "type": "rebalance",
    "subtype": "rebalance",
    "recommendedRefreshPeriod": 0.25,
    "status": "running",
    "progress": 1.531444089632196,
    "perNode": {
      "ns_1@10.143.194.101": {
        "progress": 0.9765625
      },
      "ns_1@10.143.194.102": {
        "progress": 0.9784735812133072
      },
      "ns_1@10.143.194.103": {
        "progress": 2.639296187683282
      }
    },
    "detailedProgress": {
      "bucket": "beer-sample",
      "bucketNumber": 1,
      "bucketsCount": 2,
      "perNode": {
        "ns_1@10.143.194.103": {
          "ingoing": {
            "docsTotal": 0,
            "docsTransferred": 0,
            "activeVBucketsLeft": 0,
            "replicaVBucketsLeft": 0
          },
          "outgoing": {
            "docsTotal": 2479,
            "docsTransferred": 135,
            "activeVBucketsLeft": 323,
            "replicaVBucketsLeft": 340
          }
        },
        "ns_1@10.143.194.102": {
          "ingoing": {
            "docsTotal": 2419,
            "docsTransferred": 82,
            "activeVBucketsLeft": 161,
            "replicaVBucketsLeft": 332
          },
          "outgoing": {
            "docsTotal": 1259,
            "docsTransferred": 0,
            "activeVBucketsLeft": 0,
            "replicaVBucketsLeft": 161
          }
        },
        "ns_1@10.143.194.101": {
          "ingoing": {
            "docsTotal": 2495,
            "docsTransferred": 61,
            "activeVBucketsLeft": 162,
            "replicaVBucketsLeft": 331
          },
          "outgoing": {
            "docsTotal": 1176,
            "docsTransferred": 8,
            "activeVBucketsLeft": 0,
            "replicaVBucketsLeft": 162
          }
        }
      }
    },
    "stageInfo": {
      "data": {
        "totalProgress": 1.531444089632196,
        "perNodeProgress": {
          "ns_1@10.143.194.101": 0.009765625,
          "ns_1@10.143.194.102": 0.009784735812133072,
          "ns_1@10.143.194.103": 0.02639296187683282
        },
        "startTime": "2020-03-16T04:49:22.624-07:00",
        "completedTime": false,
        "timeTaken": 6854,
        "details": {
          "beer-sample": {
            "vbucketLevelInfo": {
              "move": {
                "averageTime": 3150.578947368421,
                "totalCount": 682,
                "remainingCount": 663
              },
              "backfill": {
                "averageTime": 85.21875
              },
              "takeover": {
                "averageTime": 67.2
              },
              "persistence": {
                "averageTime": 57.01063829787234
              }
            },
            "replicationInfo": {
              "ns_1@10.143.194.101": {
                "inDocsTotal": 2495,
                "inDocsLeft": 2434,
                "outDocsTotal": 1176,
                "outDocsLeft": 1168
              },
              "ns_1@10.143.194.102": {
                "inDocsTotal": 2419,
                "inDocsLeft": 2337,
                "outDocsTotal": 1259,
                "outDocsLeft": 1259
              },
              "ns_1@10.143.194.103": {
                "inDocsTotal": 0,
                "inDocsLeft": 0,
                "outDocsTotal": 2479,
                "outDocsLeft": 2344
              }
            },
            "startTime": "2020-03-16T04:49:23.148-07:00",
            "completedTime": false,
            "timeTaken": 6329
          }
        }
      }
    },
    "rebalanceId": "b9a087fb3533d6ada22a1c43d8d09e24",
    "nodesInfo": {
      "active_nodes": [
        "ns_1@10.143.194.101",
        "ns_1@10.143.194.102",
        "ns_1@10.143.194.103"
      ],
      "keep_nodes": [
        "ns_1@10.143.194.101",
        "ns_1@10.143.194.102"
      ],
      "eject_nodes": [
        "ns_1@10.143.194.103"
      ],
      "delta_nodes": [],
      "failed_nodes": []
    },
    "masterNode": "ns_1@10.143.194.102"
  },
  {
    "type": "indexer",
    "recommendedRefreshPeriod": 2,
    "status": "running",
    "bucket": "beer-sample",
    "designDocument": "_design/beer",
    "changesDone": 1,
    "totalChanges": 7,
    "progress": 14
  }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the contents of the object differ significantly, once rebalance is in progress.</p>
</div>
<div class="paragraph">
<p>The response object provides a <code>statusId</code> that now corresponds to the ongoing <code>rebalance</code> operation.
The value of <code>progress</code> is the value as it was at the time of running the method.
A progress value is also given <code>perNode</code>: each value is a percentage &#8212; note that these percentages are displayed by Couchbase Web Console, when it is itself used to monitor rebalance.
All progress values are represented as floating-point numbers with fourteen places.
A <code>detailedProgress</code> object is also provided for each node, with indications of the status of documents and vBuckets: note that at any one time, this object indicates which of the buckets is currently being redistributed &#8212; in this case, it is <code>beer-sample</code>.</p>
</div>
<div class="paragraph">
<p>The <code>stageInfo</code> object provides information on <a href="../learn/clusters-and-availability/rebalance.html#data-service-rebalance-stages" class="xref page">Data-Service Rebalance Stages</a>.
A complete description of the fields is provided in the <a href="../rebalance-reference/rebalance-reference.html" class="xref page">Rebalance Reference</a>.</p>
</div>
<div class="paragraph">
<p>Note that a <code>recommendedRefreshPeriod</code> of <code>2</code> seconds is given.
If the same method is entered subsequently, output indicates that progress has continued:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
  {
    "statusId": "1a51786a937213ac456d2f066f65c08a",
    "type": "rebalance",
    "subtype": "rebalance",
    "recommendedRefreshPeriod": 0.25,
    "status": "running",
    "progress": 60.58881772169409,
    "perNode": {
      "ns_1@10.143.194.101": {
        "progress": 58.69140625
      },
      "ns_1@10.143.194.102": {
        "progress": 55.77299412915851
      },
      "ns_1@10.143.194.103": {
        "progress": 67.30205278592376
      }
    },
    "detailedProgress": {
      "bucket": "travel-sample",
      "bucketNumber": 2,
      "bucketsCount": 2,
      "perNode": {
        "ns_1@10.143.194.103": {
          "ingoing": {
            "docsTotal": 0,
            "docsTransferred": 0,
            "activeVBucketsLeft": 0,
            "replicaVBucketsLeft": 0
          },
          "outgoing": {
            "docsTotal": 10517,
            "docsTransferred": 3620,
            "activeVBucketsLeft": 223,
            "replicaVBucketsLeft": 326
          }
        },
        "ns_1@10.143.194.102": {
          "ingoing": {
            "docsTotal": 10594,
            "docsTransferred": 2301,
            "activeVBucketsLeft": 112,
            "replicaVBucketsLeft": 267
          },
          "outgoing": {
            "docsTotal": 5236,
            "docsTransferred": 0,
            "activeVBucketsLeft": 0,
            "replicaVBucketsLeft": 112
          }
        },
        "ns_1@10.143.194.101": {
          "ingoing": {
            "docsTotal": 10485,
            "docsTransferred": 1782,
            "activeVBucketsLeft": 111,
            "replicaVBucketsLeft": 282
          },
          "outgoing": {
            "docsTotal": 5326,
            "docsTransferred": 463,
            "activeVBucketsLeft": 0,
            "replicaVBucketsLeft": 111
          }
        }
      }
    },
    "stageInfo": {
      "data": {
        "totalProgress": 60.58881772169409,
        "perNodeProgress": {
          "ns_1@10.143.194.101": 0.5869140625,
          "ns_1@10.143.194.102": 0.5577299412915852,
          "ns_1@10.143.194.103": 0.6730205278592376
        },
        "startTime": "2020-03-16T04:49:22.624-07:00",
        "completedTime": false,
        "timeTaken": 119473,
        "details": {
          "beer-sample": {
            "compactionInfo": {
              "perNode": {
                "ns_1@10.143.194.103": {
                  "averageTime": 1883.333333333333
                },
                "ns_1@10.143.194.102": {
                  "averageTime": 131.3333333333333
                },
                "ns_1@10.143.194.101": {
                  "averageTime": 310
                }
              }
            },
            "vbucketLevelInfo": {
              "move": {
                "averageTime": 4294.907624633431,
                "totalCount": 682,
                "remainingCount": 0
              },
              "backfill": {
                "averageTime": 54.17595307917889
              },
              "takeover": {
                "averageTime": 78.80994152046783
              },
              "persistence": {
                "averageTime": 42.66529894490035
              }
            },
            "replicationInfo": {
              "ns_1@10.143.194.101": {
                "inDocsTotal": 2495,
                "inDocsLeft": 0,
                "outDocsTotal": 1176,
                "outDocsLeft": 0
              },
              "ns_1@10.143.194.102": {
                "inDocsTotal": 2419,
                "inDocsLeft": 0,
                "outDocsTotal": 1259,
                "outDocsLeft": 0
              },
              "ns_1@10.143.194.103": {
                "inDocsTotal": 0,
                "inDocsLeft": 0,
                "outDocsTotal": 2479,
                "outDocsLeft": 0
              }
            },
            "startTime": "2020-03-16T04:49:23.148-07:00",
            "completedTime": "2020-03-16T04:51:08.273-07:00",
            "timeTaken": 105125
          },
          "travel-sample": {
            "compactionInfo": {
              "perNode": {
                "ns_1@10.143.194.103": {
                  "averageTime": 0
                }
              }
            },
            "vbucketLevelInfo": {
              "move": {
                "averageTime": 1198.556390977444,
                "totalCount": 682,
                "remainingCount": 549
              },
              "backfill": {
                "averageTime": 44.24113475177305
              },
              "takeover": {
                "averageTime": 44.74015748031496
              },
              "persistence": {
                "averageTime": 31.35452322738386
              }
            },
            "replicationInfo": {
              "ns_1@10.143.194.101": {
                "inDocsTotal": 10485,
                "inDocsLeft": 8703,
                "outDocsTotal": 5326,
                "outDocsLeft": 4863
              },
              "ns_1@10.143.194.102": {
                "inDocsTotal": 10594,
                "inDocsLeft": 8293,
                "outDocsTotal": 5236,
                "outDocsLeft": 5236
              },
              "ns_1@10.143.194.103": {
                "inDocsTotal": 0,
                "inDocsLeft": 0,
                "outDocsTotal": 10517,
                "outDocsLeft": 6897
              }
            },
            "startTime": "2020-03-16T04:51:08.455-07:00",
            "completedTime": false,
            "timeTaken": 13641
          }
        }
      }
    },
    "rebalanceId": "b9a087fb3533d6ada22a1c43d8d09e24",
    "nodesInfo": {
      "active_nodes": [
        "ns_1@10.143.194.101",
        "ns_1@10.143.194.102",
        "ns_1@10.143.194.103"
      ],
      "keep_nodes": [
        "ns_1@10.143.194.101",
        "ns_1@10.143.194.102"
      ],
      "eject_nodes": [
        "ns_1@10.143.194.103"
      ],
      "delta_nodes": [],
      "failed_nodes": []
    },
    "masterNode": "ns_1@10.143.194.102"
  }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the output indicates that, at this point, the <code>travel-sample</code> bucket is being redistributed.
This indicates that redistribution of the <code>beer-sample</code> bucket has concluded.</p>
</div>
<div class="paragraph">
<p>The <code>lastReportURI</code> corresponding to the rebalance that has been performed must be retrieved by means of a subsequent call, once rebalance has concluded.
This is described immediately below.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-a-rebalance-report"><a class="anchor" href="#getting-a-rebalance-report"></a>Example: Getting a Rebalance Report</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A rebalance report can be retrieved by means of the URI specified as the value of <code>lastReportURI</code>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -u Administrator:password -v -X \
GET http://10.143.194.102:8091/logs/rebalanceReport?reportID=f95697f13542aaffb9058cb1920b13c7 | jq</pre>
</div>
</div>
<div class="paragraph">
<p>If successful, the content of the report is returned, and printed to standard output.
The initial section might appear as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "stageInfo": {
    "data": {
      "totalProgress": 100,
      "perNodeProgress": {
        "ns_1@10.143.194.101": 1,
        "ns_1@10.143.194.102": 1,
        "ns_1@10.143.194.103": 1
      },
      "startTime": "2020-03-16T04:49:22.624-07:00",
      "completedTime": "2020-03-16T04:52:13.380-07:00",
      "timeTaken": 170757,
      "details": {
        "beer-sample": {
          "compactionInfo": {
            "perNode": {
              "ns_1@10.143.194.103": {
                "averageTime": 1883.333333333333
              },
              "ns_1@10.143.194.102": {
                "averageTime": 131.3333333333333
              },
              "ns_1@10.143.194.101": {
                "averageTime": 310
              }
            }
          },
          "vbucketLevelInfo": {
            "move": {
              "averageTime": 4294.907624633431,
              "totalCount": 682,
              "remainingCount": 0</pre>
</div>
</div>
<div class="paragraph">
<p>A complete description of the fields in the <code>stageInfo</code> object is provided the in <a href="../rebalance-reference/rebalance-reference.html" class="xref page">Rebalance Reference</a>.</p>
</div>
<div class="sect2">
<h3 id="rebalance-failure"><a class="anchor" href="#rebalance-failure"></a>Rebalance Failure</h3>
<div class="paragraph">
<p>If rebalance fails, the method can be used to retrieve the following confirmation of failure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
  {
    "statusId": "1f05321a7b359e1743ffc8b7ee69a8b9",
    "type": "rebalance",
    "status": "notRunning",
    "errorMessage": "Rebalance failed. See logs for detailed reason. You can try rebalance again."
  }
]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="see-also"><a class="anchor" href="#see-also"></a>See Also</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Examples of adding a node and rebalancing by means of the UI, CLI, and REST API are provided in <a href="../manage/manage-nodes/add-node-and-rebalance.html" class="xref page">Add a Node and Rebalance</a>.
The REST method and URI for rebalance is explained in <a href="rest-cluster-rebalance.html" class="xref page">Rebalancing the Cluster</a>.
The REST method and URI for bucket-compaction is documented in <a href="rest-compact-post.html" class="xref page">Performing Compaction Manually</a>.</p>
</div>
<div class="paragraph">
<p>For additional information on retrieving the progress of the rebalance operation, see <a href="rest-get-rebalance-progress.html" class="xref page">Getting Rebalance Progress</a>.
See the <a href="../rebalance-reference/rebalance-reference.html" class="xref page">Rebalance Reference</a>, for detailed information on downloading and reading rebalance reports.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
